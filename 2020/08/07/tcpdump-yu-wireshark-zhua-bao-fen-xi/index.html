<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><script></script><meta name="theme-color" content="#222"><style>.pace .pace-progress{background:#1e92fb;height:3px}.pace .pace-progress-inner{box-shadow:0 0 10px #1e92fb,0 0 5px #1e92fb}.pace .pace-activity{border-top-color:#1e92fb;border-left-color:#1e92fb}</style><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="HGM141IpbHrSmnAmR6W_zE4bo9Z3f-yXLeHYT3bg1fk"><meta name="baidu-site-verification" content="code-5Ai1DA8e6T"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="网络,tcpdump,"><link rel="alternate" href="/atom.xml" title="凡间的精灵" type="application/atom+xml"><meta name="description" content="一、tcpdump与Wireshark介绍在网络问题的调试中，tcpdump应该说是一个必不可少的工具，和大部分linux下优秀工具一样，它的特点就是简单而强大。它是基于Unix系统的命令行式的数据包嗅探工具，可以抓取流动在网卡上的数据包。默认情况下，tcpdump不会抓取本机内部通讯的报文。根据网络协议栈的规定，对于报文，即使是目的地是本机，也需要经过本机的网络协议层，所以本机通讯肯定是通过AP"><meta name="keywords" content="网络,tcpdump"><meta property="og:type" content="article"><meta property="og:title" content="tcpdump与Wireshark抓包分析"><meta property="og:url" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2020&#x2F;08&#x2F;07&#x2F;tcpdump-yu-wireshark-zhua-bao-fen-xi&#x2F;index.html"><meta property="og:site_name" content="凡间的精灵"><meta property="og:description" content="一、tcpdump与Wireshark介绍在网络问题的调试中，tcpdump应该说是一个必不可少的工具，和大部分linux下优秀工具一样，它的特点就是简单而强大。它是基于Unix系统的命令行式的数据包嗅探工具，可以抓取流动在网卡上的数据包。默认情况下，tcpdump不会抓取本机内部通讯的报文。根据网络协议栈的规定，对于报文，即使是目的地是本机，也需要经过本机的网络协议层，所以本机通讯肯定是通过AP"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2020&#x2F;08&#x2F;07&#x2F;tcpdump-yu-wireshark-zhua-bao-fen-xi&#x2F;%E5%9B%BE%E7%89%871.jpg"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2020&#x2F;08&#x2F;07&#x2F;tcpdump-yu-wireshark-zhua-bao-fen-xi&#x2F;%E5%9B%BE%E7%89%872.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2020&#x2F;08&#x2F;07&#x2F;tcpdump-yu-wireshark-zhua-bao-fen-xi&#x2F;%E5%9B%BE%E7%89%873.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2020&#x2F;08&#x2F;07&#x2F;tcpdump-yu-wireshark-zhua-bao-fen-xi&#x2F;%E5%9B%BE%E7%89%874.png"><meta property="og:updated_time" content="2020-08-07T09:16:02.555Z"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2020&#x2F;08&#x2F;07&#x2F;tcpdump-yu-wireshark-zhua-bao-fen-xi&#x2F;%E5%9B%BE%E7%89%871.jpg"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"always",offset:12,b2t:!0,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://chenzhonzhou.github.io/2020/08/07/tcpdump-yu-wireshark-zhua-bao-fen-xi/"><title>tcpdump与Wireshark抓包分析 | 凡间的精灵</title><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">凡间的精灵</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">凡尘落素一精灵</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://chenzhonzhou.github.io/2020/08/07/tcpdump-yu-wireshark-zhua-bao-fen-xi/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Zhongzhou Chen"><meta itemprop="description" content=""><meta itemprop="image" content="/images/chen.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="凡间的精灵"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">tcpdump与Wireshark抓包分析</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-07T16:15:49+08:00">2020-08-07</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">网络</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">5.4k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">22</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="一、tcpdump与Wireshark介绍"><a href="#一、tcpdump与Wireshark介绍" class="headerlink" title="一、tcpdump与Wireshark介绍"></a>一、tcpdump与Wireshark介绍</h2><p>在网络问题的调试中，tcpdump应该说是一个必不可少的工具，和大部分linux下优秀工具一样，它的特点就是简单而强大。<strong><code>它是基于Unix系统的命令行式的数据包嗅探工具，可以抓取流动在网卡上的数据包</code></strong>。</p><p>默认情况下，tcpdump不会抓取本机内部通讯的报文。根据网络协议栈的规定，对于报文，即使是目的地是本机，也需要经过本机的网络协议层，所以本机通讯肯定是通过API进入了内核，并且完成了路由选择。【比如本机的TCP通信，也必须要socket通信的基本要素：src ip port dst ip port】</p><p>如果要使用tcpdump抓取其他主机MAC地址的数据包，必须开启网卡混杂模式，<strong><code>所谓混杂模式，用最简单的语言就是让网卡抓取任何经过它的数据包，不管这个数据包是不是发给它或者是它发出的</code></strong>。一般而言，Unix不会让普通用户设置混杂模式，因为这样可以看到别人的信息，比如telnet的用户名和密码，这样会引起一些安全上的问题，所以只有root用户可以开启混杂模式，<strong><code>开启混杂模式的命令是：ifconfig en0 promisc, en0是你要打开混杂模式的网卡</code></strong>。</p><h3 id="Linux抓包原理"><a href="#Linux抓包原理" class="headerlink" title="Linux抓包原理"></a>Linux抓包原理</h3><blockquote><p>Linux抓包是通过注册一种虚拟的底层网络协议来完成对网络报文(准确的说是网络设备)消息的处理权。当网卡接收到一个网络报文之后，它会遍历系统中所有已经注册的网络协议，例如以太网协议、x25协议处理模块来尝试进行报文的解析处理，这一点和一些文件系统的挂载相似，就是让系统中所有的已经注册的文件系统来进行尝试挂载，如果哪一个认为自己可以处理，那么就完成挂载。</p><p>当抓包模块把自己伪装成一个网络协议的时候，系统在收到报文的时候就会给这个伪协议一次机会，让它来对网卡收到的报文进行一次处理，此时该模块就会趁机对报文进行窥探，也就是把这个报文完完整整的复制一份，假装是自己接收到的报文，汇报给抓包模块。</p></blockquote><p>Wireshark是一个网络协议检测工具，支持Windows平台、Unix平台、Mac平台，一般只在图形界面平台下使用Wireshark，如果是Linux的话，直接使用tcpdump了，因为一般而言Linux都自带的tcpdump，或者用tcpdump抓包以后用Wireshark打开分析。</p><p>在Mac平台下，Wireshark通过WinPcap进行抓包，封装的很好，使用起来很方便，可以很容易的制定抓包过滤器或者显示过滤器，具体简单使用下面会介绍。<a href="https://www.wireshark.org/download.html" target="_blank" rel="noopener">Wireshark</a>是一个免费的工具，只要google一下就能很容易找到下载的地方。</p><p>所以，tcpdump是用来抓取数据非常方便，Wireshark则是用于分析抓取到的数据比较方便。</p><h2 id="二、tcpdump使用"><a href="#二、tcpdump使用" class="headerlink" title="二、tcpdump使用"></a>二、tcpdump使用</h2><h3 id="2-1-语法"><a href="#2-1-语法" class="headerlink" title="2.1 语法"></a>2.1 语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tcpdump --help</span><br><span class="line">Usage: tcpdump [-aAbdDefhHIJKlLnNOpqStuUvxX#] [ -B size ] [ -c count ]</span><br><span class="line">		[ -C file_size ] [ -E algo:secret ] [ -F file ] [ -G seconds ]</span><br><span class="line">		[ -i interface ] [ -j tstamptype ] [ -M secret ] [ --number ]</span><br><span class="line">		[ -Q|-P in|out|inout ]</span><br><span class="line">		[ -r file ] [ -s snaplen ] [ --time-stamp-precision precision ]</span><br><span class="line">		[ --immediate-mode ] [ -T type ] [ --version ] [ -V file ]</span><br><span class="line">		[ -w file ] [ -W filecount ] [ -y datalinktype ] [ -z postrotate-command ]</span><br><span class="line">		[ -Z user ] [ expression ]</span><br></pre></td></tr></table></figure><h4 id="2-1-1-类型的关键字"><a href="#2-1-1-类型的关键字" class="headerlink" title="2.1.1 类型的关键字"></a>2.1.1 类型的关键字</h4><blockquote><p>host(缺省类型): 指明一台主机，如：host 210.27.48.2</p><p>net: 指明一个网络地址，如：net 202.0.0.0</p><p>port: 指明端口号，如：port 23</p></blockquote><h4 id="2-1-2-确定方向的关键字"><a href="#2-1-2-确定方向的关键字" class="headerlink" title="2.1.2 确定方向的关键字"></a>2.1.2 确定方向的关键字</h4><blockquote><p>src: src 210.27.48.2, IP包源地址是210.27.48.2</p><p>dst: dst net 202.0.0.0, 目标网络地址是202.0.0.0</p><p>dst or src(缺省值)</p><p>dst and src</p></blockquote><h4 id="2-1-3-协议的关键字"><a href="#2-1-3-协议的关键字" class="headerlink" title="2.1.3 协议的关键字"></a>2.1.3 协议的关键字</h4><p>缺省值是监听所有协议的信息包</p><blockquote><p>fddi</p><p>ip</p><p>arp</p><p>rarp</p><p>tcp</p><p>udp</p></blockquote><h4 id="2-1-4-其他关键字"><a href="#2-1-4-其他关键字" class="headerlink" title="2.1.4 其他关键字"></a>2.1.4 其他关键字</h4><blockquote><p>gateway</p><p>broadcast</p><p>less</p><p>greater</p></blockquote><h4 id="2-1-5-常用表达式"><a href="#2-1-5-常用表达式" class="headerlink" title="2.1.5 常用表达式"></a>2.1.5 常用表达式</h4><p>多条件时可以用括号，但是要用\转义</p><blockquote><p>非 : ! or “not” (去掉双引号)</p><p>且 : &amp;&amp; or “and”</p><p>或 : || or “or”</p></blockquote><h3 id="2-2-选项"><a href="#2-2-选项" class="headerlink" title="2.2 选项"></a>2.2 选项</h3><blockquote><p>-A：以ASCII编码打印每个报文（不包括链路层的头），这对分析网页来说很方便；<br>-a：将网络地址和广播地址转变成名字；<br>-c&lt;数据包数目&gt;：在收到指定的包的数目后，tcpdump就会停止；<br>-C：用于判断用 -w 选项将报文写入的文件的大小是否超过这个值，如果超过了就新建文件（文件名后缀是1、2、3依次增加）；<br>-d：将匹配信息包的代码以人们能够理解的汇编格式给出；<br>-dd：将匹配信息包的代码以c语言程序段的格式给出；<br>-ddd：将匹配信息包的代码以十进制的形式给出；<br>-D：列出当前主机的所有网卡编号和名称，可以用于选项 -i；<br>-e：在输出行打印出数据链路层的头部信息；<br>-f：将外部的Internet地址以数字的形式打印出来；<br>-F&lt;表达文件&gt;：从指定的文件中读取表达式,忽略其它的表达式；<br>-i&lt;网络界面&gt;：监听主机的该网卡上的数据流，如果没有指定，就会使用最小网卡编号的网卡（在选项-D可知道，但是不包括环路接口），linux 2.2 内核及之后的版本支持 any 网卡，用于指代任意网卡；<br>-l：如果没有使用 -w 选项，就可以将报文打印到 标准输出终端（此时这是默认）；<br>-n：显示ip，而不是主机名；<br>-N：不列出域名；<br>-O：不将数据包编码最佳化；<br>-p：不让网络界面进入混杂模式；<br>-q：快速输出，仅列出少数的传输协议信息；<br>-r&lt;数据包文件&gt;：从指定的文件中读取包(这些包一般通过-w选项产生)；<br>-s&lt;数据包大小&gt;：指定抓包显示一行的宽度，-s0表示可按包长显示完整的包，经常和-A一起用，默认截取长度为60个字节，但一般ethernet MTU都是1500字节。所以，要抓取大于60字节的包时，使用默认参数就会导致包数据丢失；<br>-S：用绝对而非相对数值列出TCP关联数；<br>-t：在输出的每一行不打印时间戳；<br>-tt：在输出的每一行显示未经格式化的时间戳记；<br>-T&lt;数据包类型&gt;：将监听到的包直接解释为指定的类型的报文，常见的类型有rpc （远程过程调用）和snmp（简单网络管理协议）；<br>-v：输出一个稍微详细的信息，例如在ip包中可以包括ttl和服务类型的信息；<br>-vv：输出详细的报文信息；<br>-x/-xx/-X/-XX：以十六进制显示包内容，几个选项只有细微的差别，详见man手册；<br>-w&lt;数据包文件&gt;：直接将包写入文件中，并不分析和打印出来；<br>expression：用于筛选的逻辑表达式；</p></blockquote><h3 id="2-3-tcpdump常用抓包示例"><a href="#2-3-tcpdump常用抓包示例" class="headerlink" title="2.3 tcpdump常用抓包示例"></a>2.3 tcpdump常用抓包示例</h3><h4 id="2-3-1-默认启动"><a href="#2-3-1-默认启动" class="headerlink" title="2.3.1 默认启动"></a>2.3.1 默认启动</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump</span><br></pre></td></tr></table></figure><p>普通情况下，直接启动tcpdump将监视第一个网络接口上所有流过的数据包。</p><h4 id="2-3-2-获取指定网络接口的数据包"><a href="#2-3-2-获取指定网络接口的数据包" class="headerlink" title="2.3.2 获取指定网络接口的数据包"></a>2.3.2 获取指定网络接口的数据包</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i en0</span><br></pre></td></tr></table></figure><h4 id="2-3-3-获取指定主机的数据包"><a href="#2-3-3-获取指定主机的数据包" class="headerlink" title="2.3.3 获取指定主机的数据包"></a>2.3.3 获取指定主机的数据包</h4><p>打印所有进入或离开sundown的数据包.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump host sundown</span><br></pre></td></tr></table></figure><p>也可以指定ip,例如截获所有210.27.48.1 的主机收到的和发出的所有的数据包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump host 210.27.48.1</span><br></pre></td></tr></table></figure><p>打印helios 与 hot 或者与 ace 之间通信的数据包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump host helios and \( hot or ace \)</span><br></pre></td></tr></table></figure><p>截获主机210.27.48.1 和主机210.27.48.2 或210.27.48.3的通信</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump host 210.27.48.1 and \ (210.27.48.2 or 210.27.48.3 \)</span><br></pre></td></tr></table></figure><p>打印ace与任何其他主机之间通信的IP 数据包, 但不包括与helios之间的数据包.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump ip host ace and not helios</span><br></pre></td></tr></table></figure><p>如果想要获取主机210.27.48.1除了和主机210.27.48.2之外所有主机通信的ip包，使用命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump ip host 210.27.48.1 and ! 210.27.48.2</span><br></pre></td></tr></table></figure><p>截获主机hostname发送的所有数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 src host hostname</span><br></pre></td></tr></table></figure><p>监视所有送到主机hostname的数据包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 dst host hostname</span><br></pre></td></tr></table></figure><h4 id="2-3-4-获取指定主机和端口的数据包"><a href="#2-3-4-获取指定主机和端口的数据包" class="headerlink" title="2.3.4 获取指定主机和端口的数据包"></a>2.3.4 获取指定主机和端口的数据包</h4><p>如果想要获取主机210.27.48.1接收或发出的telnet包，使用如下命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump tcp port 23 and host 210.27.48.1</span><br></pre></td></tr></table></figure><p>对本机的udp 123 端口进行监视 123 为ntp的服务端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump udp port 123</span><br></pre></td></tr></table></figure><p>抓取主机10.37.63.3发送的所有数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i en0 src host 10.37.63.3</span><br></pre></td></tr></table></figure><p>抓取主机10.37.63.3接收的所有数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i en0 dst host 10.37.63.3</span><br></pre></td></tr></table></figure><h4 id="2-3-5-获取指定网络的数据包"><a href="#2-3-5-获取指定网络的数据包" class="headerlink" title="2.3.5 获取指定网络的数据包"></a>2.3.5 获取指定网络的数据包</h4><p>打印本地主机与Berkeley网络上的主机之间的所有通信数据包(nt: ucb-ether, 此处可理解为’Berkeley网络’的网络地址,此表达式最原始的含义可表达为: 打印网络地址为ucb-ether的所有数据包)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump net ucb-ether</span><br></pre></td></tr></table></figure><p>打印所有通过网关snup的ftp数据包(注意, 表达式被单引号括起来了, 这可以防止shell对其中的括号进行错误解析)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump &apos;gateway snup and (port ftp or ftp-data)&apos;</span><br></pre></td></tr></table></figure><p>打印所有源地址或目标地址是本地主机的IP数据包</p><p>(如果本地网络通过网关连到了另一网络, 则另一网络并不能算作本地网络.(nt: 此句翻译曲折,需补充).localnet 实际使用时要真正替换成本地网络的名字)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump ip and not net localnet</span><br></pre></td></tr></table></figure><h4 id="2-3-6-获取指定协议的数据包"><a href="#2-3-6-获取指定协议的数据包" class="headerlink" title="2.3.6 获取指定协议的数据包"></a>2.3.6 获取指定协议的数据包</h4><p>打印TCP会话中的的开始和结束数据包, 并且数据包的源或目的不是本地网络上的主机.(nt: localnet, 实际使用时要真正替换成本地网络的名字))</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump &apos;tcp[tcpflags] &amp; (tcp-syn|tcp-fin) != 0 and not src and dst net localnet&apos;</span><br></pre></td></tr></table></figure><p>打印所有源或目的端口是80, 网络层协议为IPv4, 并且含有数据,而不是SYN,FIN以及ACK-only等不含数据的数据包.(ipv6的版本的表达式可做练习)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump &apos;tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)&apos;</span><br></pre></td></tr></table></figure><p>(nt: 可理解为, ip[2:2]表示整个ip数据包的长度, (ip[0]&amp;0xf)&lt;&lt;2)表示ip数据包包头的长度(ip[0]&amp;0xf代表包中的IHL域, 而此域的单位为32bit, 要换算</p><p>成字节数需要乘以4,　即左移2.　(tcp[12]&amp;0xf0)&gt;&gt;4 表示tcp头的长度, 此域的单位也是32bit,　换算成比特数为 ((tcp[12]&amp;0xf0) &gt;&gt; 4)　&lt;&lt;　２,<br>即 ((tcp[12]&amp;0xf0)&gt;&gt;2).　((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0　表示: 整个ip数据包的长度减去ip头的长度,再减去<br>tcp头的长度不为0, 这就意味着, ip数据包中确实是有数据.对于ipv6版本只需考虑ipv6头中的’Payload Length’ 与 ‘tcp头的长度’的差值, 并且其中表达方式’ip[]’需换成’ip6[]’.)</p><p>打印长度超过576字节, 并且网关地址是snup的IP数据包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump &apos;gateway snup and ip[2:2] &gt; 576&apos;</span><br></pre></td></tr></table></figure><p>打印所有IP层广播或多播的数据包， 但不是物理以太网层的广播或多播数据报</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump &apos;ether[0] &amp; 1 = 0 and ip[16] &gt;= 224&apos;</span><br></pre></td></tr></table></figure><p>打印除’echo request’或者’echo reply’类型以外的ICMP数据包( 比如,需要打印所有非ping 程序产生的数据包时可用到此表达式 .<br>(nt: ‘echo reuqest’ 与 ‘echo reply’ 这两种类型的ICMP数据包通常由ping程序产生))</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump &apos;icmp[icmptype] != icmp-echo and icmp[icmptype] != icmp-echoreply&apos;</span><br></pre></td></tr></table></figure><p>抓取所有经过 en0，目的地址是 192.168.1.254 或 192.168.1.200 端口是 80 的 TCP 数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i en0 &apos;((tcp) and (port 80) and ((dst host 192.168.1.254) or (dst host 192.168.1.200)))&apos;</span><br></pre></td></tr></table></figure><p>抓取所有经过 en0，目标 MAC 地址是 00:01:02:03:04:05 的 ICMP 数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth1 &apos;((icmp) and ((ether dst host 00:01:02:03:04:05)))&apos;</span><br></pre></td></tr></table></figure><p>抓取所有经过 en0，目的网络是 192.168，但目的主机不是 192.168.1.200 的 TCP 数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i en0 &apos;((tcp) and ((dst net 192.168) and (not dst host 192.168.1.200)))&apos;</span><br></pre></td></tr></table></figure><p>只抓 SYN 包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i en0 &apos;tcp[tcpflags] = tcp-syn&apos;</span><br></pre></td></tr></table></figure><p>抓 SYN, ACK</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i en0 &apos;tcp[tcpflags] &amp; tcp-syn != 0 and tcp[tcpflags] &amp; tcp-ack != 0&apos;</span><br></pre></td></tr></table></figure><p>抓 DNS 请求数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i en0 udp dst port 53</span><br></pre></td></tr></table></figure><h2 id="三、tcpdump抓取TCP包分析"><a href="#三、tcpdump抓取TCP包分析" class="headerlink" title="三、tcpdump抓取TCP包分析"></a>三、tcpdump抓取TCP包分析</h2><p>TCP传输控制协议是面向连接的可靠的传输层协议，在进行数据传输之前，需要在传输数据的两端（客户端和服务器端）创建一个连接，这个连接由一对插口地址唯一标识，<strong><code>即是在IP报文首部的源IP地址、目的IP地址，以及TCP数据报首部的源端口地址和目的端口地址</code></strong>。TCP首部结构如下：</p><p><img src="/2020/08/07/tcpdump-yu-wireshark-zhua-bao-fen-xi/%E5%9B%BE%E7%89%871.jpg" alt="图片1"></p><blockquote><p>注意：通常情况下，一个正常的TCP连接，都会有三个阶段:1、TCP三次握手;2、数据传送;3、TCP四次挥手</p></blockquote><p><strong>其中在TCP连接和断开连接过程中的关键部分如下：</strong></p><blockquote><ol><li><p>源端口号：即发送方的端口号，在TCP连接过程中，对于客户端，端口号往往由内核分配，无需进程指定；</p></li><li><p>目的端口号：即发送目的的端口号；</p></li><li><p>序号：即为发送的数据段首个字节的序号；</p></li><li><p>确认序号：在收到对方发来的数据报，发送确认时期待对方下一次发送的数据序号；</p></li><li><p>SYN：同步序列编号，Synchronize Sequence Numbers；</p></li><li><p>ACK：确认编号，Acknowledgement Number；</p></li><li><p>FIN：结束标志，FINish；</p></li></ol></blockquote><h3 id="3-1-TCP三次握手"><a href="#3-1-TCP三次握手" class="headerlink" title="3.1 TCP三次握手"></a>3.1 TCP三次握手</h3><p>三次握手的过程如下</p><p><img src="/2020/08/07/tcpdump-yu-wireshark-zhua-bao-fen-xi/%E5%9B%BE%E7%89%872.png" alt="图片2"></p><blockquote><ol><li><p>由客户端向服务器端发起TCP连接请求。Client发送：同步序列编号SYN置为1，发送序号Seq为一个随机数，这里假设为X，确认序号ACK置为0；</p></li><li><p>服务器端接收到连接请求。Server响应：同步序列编号SYN置为1，并将确认序号ACK置为X+1，然后生成一个随机数Y作为发送序号Seq（因为所确认的数据报的确认序号未初始化）；</p></li><li><p>客户端对接收到的确认进行确认。Client发送：将确认序号ACK置为Y+1，然后将发送序号Seq置为X+1（即为接收到的数据报的确认序号）；</p></li></ol></blockquote><p><strong>tcpdump抓TCP三次握手抓包分析</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tcpdump -n -S -i lo0 host 10.37.63.3 and tcp port 8080</span><br></pre></td></tr></table></figure><p><strong>接着再运行</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.37.63.3:8080/atbg/doc</span><br></pre></td></tr></table></figure><p><strong>控制台输出如下：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># TCP三次握手 start</span><br><span class="line">16:00:13.486776 IP 10.37.63.3.61725 &gt; 10.37.63.3.8080: Flags [S], seq 1944916150, win 65535, options [mss 16344,nop,wscale 5,nop,nop,TS val 906474698 ecr 0,sackOK,eol], length 0</span><br><span class="line">16:00:13.486850 IP 10.37.63.3.8080 &gt; 10.37.63.3.61725: Flags [S.], seq 1119565918, ack 1944916151, win 65535, options [mss 16344,nop,wscale 5,nop,nop,TS val 906474698 ecr 906474698,sackOK,eol], length 0</span><br><span class="line">16:00:13.486860 IP 10.37.63.3.61725 &gt; 10.37.63.3.8080: Flags [.], ack 1119565919, win 12759, options [nop,nop,TS val 906474698 ecr 906474698], length 0</span><br><span class="line">16:00:13.486868 IP 10.37.63.3.8080 &gt; 10.37.63.3.61725: Flags [.], ack 1944916151, win 12759, options [nop,nop,TS val 906474698 ecr 906474698], length 0</span><br><span class="line"># TCP三次握手 end</span><br><span class="line"></span><br><span class="line"># 传输数据 start</span><br><span class="line">16:00:13.486923 IP 10.37.63.3.61725 &gt; 10.37.63.3.8080: Flags [P.], seq 1944916151:1944916238, ack 1119565919, win 12759, options [nop,nop,TS val 906474698 ecr 906474698], length 87: HTTP: GET /atbg/doc HTTP/1.1</span><br><span class="line">16:00:13.486944 IP 10.37.63.3.8080 &gt; 10.37.63.3.61725: Flags [.], ack 1944916238, win 12756, options [nop,nop,TS val 906474698 ecr 906474698], length 0</span><br><span class="line">16:00:13.489750 IP 10.37.63.3.8080 &gt; 10.37.63.3.61725: Flags [P.], seq 1119565919:1119571913, ack 1944916238, win 12756, options [nop,nop,TS val 906474701 ecr 906474698], length 5994: HTTP: HTTP/1.1 200 OK</span><br><span class="line">16:00:13.489784 IP 10.37.63.3.61725 &gt; 10.37.63.3.8080: Flags [.], ack 1119571913, win 12572, options [nop,nop,TS val 906474701 ecr 906474701], length 0</span><br><span class="line"># 传输数据 end</span><br><span class="line"></span><br><span class="line"># TCP四次挥手 start</span><br><span class="line">16:00:13.490836 IP 10.37.63.3.61725 &gt; 10.37.63.3.8080: Flags [F.], seq 1944916238, ack 1119571913, win 12572, options [nop,nop,TS val 906474702 ecr 906474701], length 0</span><br><span class="line">16:00:13.490869 IP 10.37.63.3.8080 &gt; 10.37.63.3.61725: Flags [.], ack 1944916239, win 12756, options [nop,nop,TS val 906474702 ecr 906474702], length 0</span><br><span class="line">16:00:13.490875 IP 10.37.63.3.61725 &gt; 10.37.63.3.8080: Flags [.], ack 1119571913, win 12572, options [nop,nop,TS val 906474702 ecr 906474702], length 0</span><br><span class="line">16:00:13.491004 IP 10.37.63.3.8080 &gt; 10.37.63.3.61725: Flags [F.], seq 1119571913, ack 1944916239, win 12756, options [nop,nop,TS val 906474702 ecr 906474702], length 0</span><br><span class="line">16:00:13.491081 IP 10.37.63.3.61725 &gt; 10.37.63.3.8080: Flags [.], ack 1119571914, win 12572, options [nop,nop,TS val 906474702 ecr 906474702], length 0</span><br><span class="line"># TCP四次挥手 end</span><br></pre></td></tr></table></figure><p>每一行中间都有这个包所携带的标志：</p><p>S=SYN，发起连接标志。</p><p>P=PUSH，传送数据标志。</p><p>F=FIN，关闭连接标志。</p><p>ack，表示确认包。</p><p>RST=RESET，异常关闭连接。</p><p>.，表示没有任何标志。</p><p><strong>第1行：16:00:13.486776</strong>，从10.37.63.3（client）的临时端口61725向10.37.63.3（server）的8080监听端口发起连接，client初始包序号seq为1944916150，滑动窗口大小为65535字节（滑动窗口即tcp接收缓冲区的大小，用于tcp拥塞控制），mss大小为16344（即可接收的最大包长度，通常为MTU减40字节，IP头和TCP头各20字节）。【seq=1944916150，ack=0，syn=1】</p><p><strong>第2行：16:00:13.486850</strong>，server响应连接，同时带上第一个包的ack信息，为client端的初始包序号seq加1，即1944916151，即server端下次等待接受这个包序号的包，用于tcp字节流的顺序控制。Server端的初始包序号seq为1119565918，mss也是16344。【seq=1119565918，ack=1944916151，syn=1】</p><p><strong>第3行：15:46:13.084161</strong>，client再次发送确认连接，tcp连接三次握手完成，等待传输数据包。【ack=1119565919，seq=1944916151】</p><h3 id="3-2-TCP四次挥手"><a href="#3-2-TCP四次挥手" class="headerlink" title="3.2 TCP四次挥手"></a>3.2 TCP四次挥手</h3><p>连接双方在完成数据传输之后就需要断开连接。<strong><code>由于TCP连接是属于全双工的，即连接双方可以在一条TCP连接上互相传输数据，因此在断开时存在一个半关闭状态，即有有一方失去发送数据的能力，却还能接收数据</code></strong>。因此，断开连接需要分为四次。主要过程如下：</p><p><img src="/2020/08/07/tcpdump-yu-wireshark-zhua-bao-fen-xi/%E5%9B%BE%E7%89%873.png" alt="图片3"></p><blockquote><p>step1. 主机A向主机B发起断开连接请求，之后主机A进入FIN-WAIT-1状态；</p><p>step2. 主机B收到主机A的请求后，向主机A发回确认，然后进入CLOSE-WAIT状态；</p><p>step3. 主机A收到B的确认之后，进入FIN-WAIT-2状态，此时便是半关闭状态，即主机A失去发送能力，但是主机B却还能向A发送数据，并且A可以接收数据。此时主机B占主导位置了，如果需要继续关闭则需要主机B来操作了；</p><p>step4. 主机B向A发出断开连接请求，然后进入LAST-ACK状态；</p><p>step5. 主机A接收到请求后发送确认，进入TIME-WAIT状态，等待2MSL之后进入CLOSED状态，而主机B则在接受到确认后进入CLOSED状态；</p></blockquote><p><strong>为何主机A在发送了最后的确认后没有进入CLOSED状态，反而进入了一个等待2MSL的TIME-WAIT</strong><br>主要作用有两个：</p><blockquote><p>第一，确保主机A最后发送的确认能够到达主机B。如果处于LAST-ACK状态的主机B一直收不到来自主机A的确认，它会重传断开连接请求，然后主机A就可以有足够的时间去再次发送确认。但是这也只能尽最大力量来确保能够正常断开，如果主机A的确认总是在网络中滞留失效，从而超过了2MSL，最后也无法正常断开；</p><p>第二，如果主机A在发送了确认之后立即进入CLOSED状态。假设之后主机A再次向主机B发送一条连接请求，而这条连接请求比之前的确认报文更早地到达主机B，则会使得主机B以为这条连接请求是在旧的连接中A发出的报文，并不看成是一条新的连接请求了，即使得这个连接请求失效了，增加2MSL的时间可以使得这个失效的连接请求报文作废，这样才不影响下次新的连接请求中出现失效的连接请求。</p></blockquote><blockquote><p><strong>为什么断开连接请求报文只有三个，而不是四个</strong><br>因为在TCP连接过程中，确认的发送有一个延时（即经受延时的确认），一端在发送确认的时候将等待一段时间，如果自己在这段事件内也有数据要发送，就跟确认一起发送，如果没有，则确认单独发送。而我们的抓包实验中，由服务器端先断开连接，<strong><code>之后客户端在确认的延迟时间内，也有请求断开连接需要发送</code></strong>，于是就与上次确认一起发送，因此就只有三个数据报了。</p></blockquote><h2 id="四、Wireshark分析tcpdump抓包结果"><a href="#四、Wireshark分析tcpdump抓包结果" class="headerlink" title="四、Wireshark分析tcpdump抓包结果"></a>四、Wireshark分析tcpdump抓包结果</h2><h3 id="4-1-启动8080端口，tcpdump抓包命令如下"><a href="#4-1-启动8080端口，tcpdump抓包命令如下" class="headerlink" title="4.1 启动8080端口，tcpdump抓包命令如下"></a>4.1 启动8080端口，tcpdump抓包命令如下</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i lo0 -s 0 -n -S host 10.37.63.3 and port 8080 -w ./Desktop/tcpdump_10.37.63.3_8080_20160525.cap</span><br></pre></td></tr></table></figure><p>然后再执行curl</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.37.63.3:8080/atbg/doc</span><br></pre></td></tr></table></figure><h3 id="4-2-使用Wireshark打开tcpdump-10-37-63-3-8080-20160525-cap文件"><a href="#4-2-使用Wireshark打开tcpdump-10-37-63-3-8080-20160525-cap文件" class="headerlink" title="4.2 使用Wireshark打开tcpdump_10.37.63.3_8080_20160525.cap文件"></a>4.2 使用Wireshark打开tcpdump_10.37.63.3_8080_20160525.cap文件</h3><p><img src="/2020/08/07/tcpdump-yu-wireshark-zhua-bao-fen-xi/%E5%9B%BE%E7%89%874.png" alt="图片4"></p><blockquote><p>No. 1-4 行：TCP三次握手环节；</p><p>No. 5-8 行：TCP传输数据环节；</p><p>No. 9-13 行：TCP四次挥手环节；</p></blockquote></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag"><i class="fa fa-tag"></i> 网络</a><a href="/tags/tcpdump/" rel="tag"><i class="fa fa-tag"></i> tcpdump</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2020/07/22/mysql-shu-ju-ku-biao-kong-jian-da-xiao-jian-kong/" rel="next" title="MySQL 数据库表空间大小监控"><i class="fa fa-chevron-left"></i> MySQL 数据库表空间大小监控</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2020/08/21/xxl-job-ren-wu-diao-du-ping-tai-bu-shu/" rel="prev" title="XXL-JOB 任务调度平台部署">XXL-JOB 任务调度平台部署<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"><span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a><a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/chen.png" alt="Zhongzhou Chen"><p class="site-author-name" itemprop="name">Zhongzhou Chen</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">332</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">85</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">183</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、tcpdump与Wireshark介绍"><span class="nav-text">一、tcpdump与Wireshark介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux抓包原理"><span class="nav-text">Linux抓包原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、tcpdump使用"><span class="nav-text">二、tcpdump使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-语法"><span class="nav-text">2.1 语法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-类型的关键字"><span class="nav-text">2.1.1 类型的关键字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2-确定方向的关键字"><span class="nav-text">2.1.2 确定方向的关键字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-3-协议的关键字"><span class="nav-text">2.1.3 协议的关键字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-4-其他关键字"><span class="nav-text">2.1.4 其他关键字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-5-常用表达式"><span class="nav-text">2.1.5 常用表达式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-选项"><span class="nav-text">2.2 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-tcpdump常用抓包示例"><span class="nav-text">2.3 tcpdump常用抓包示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-1-默认启动"><span class="nav-text">2.3.1 默认启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-2-获取指定网络接口的数据包"><span class="nav-text">2.3.2 获取指定网络接口的数据包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-3-获取指定主机的数据包"><span class="nav-text">2.3.3 获取指定主机的数据包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-4-获取指定主机和端口的数据包"><span class="nav-text">2.3.4 获取指定主机和端口的数据包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-5-获取指定网络的数据包"><span class="nav-text">2.3.5 获取指定网络的数据包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-6-获取指定协议的数据包"><span class="nav-text">2.3.6 获取指定协议的数据包</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、tcpdump抓取TCP包分析"><span class="nav-text">三、tcpdump抓取TCP包分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-TCP三次握手"><span class="nav-text">3.1 TCP三次握手</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-TCP四次挥手"><span class="nav-text">3.2 TCP四次挥手</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、Wireshark分析tcpdump抓包结果"><span class="nav-text">四、Wireshark分析tcpdump抓包结果</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-启动8080端口，tcpdump抓包命令如下"><span class="nav-text">4.1 启动8080端口，tcpdump抓包命令如下</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-使用Wireshark打开tcpdump-10-37-63-3-8080-20160525-cap文件"><span class="nav-text">4.2 使用Wireshark打开tcpdump_10.37.63.3_8080_20160525.cap文件</span></a></li></ol></li></ol></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Zhongzhou Chen</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">780.6k</span></div><span class="post-meta-divider"></span></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code").find(".line").map(function(t,e){return $(e).text()}).toArray().join("\n"),n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();var o=document.execCommand("copy");document.body.removeChild(n),o?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})</script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,s){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var o=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,n=document.getElementById(e),r=document.getElementById(s);n.addEventListener("input",function(){var y=n.value.trim().toLowerCase(),T=y.split(/[\s\-]+/);1<T.length&&T.push(y);var b=[];if(0<y.length&&o.forEach(function(t){function e(t,e,o,n){for(var r=n[n.length-1],s=r.position,a=r.word,i=[],c=0;s+a.length<=o&&0!=n.length;){a===y&&c++,i.push({position:s,length:a.length});var l=s+a.length;for(n.pop();0!=n.length&&(s=(r=n[n.length-1]).position,a=r.word,s<l);)n.pop()}return h+=c,{hits:i,start:e,end:o,searchTextCount:c}}function o(o,t){var n="",r=t.start;return t.hits.forEach(function(t){n+=o.substring(r,t.position);var e=t.position+t.length;n+='<b class="search-keyword">'+o.substring(t.position,e)+"</b>",r=e}),n+=o.substring(r,t.end)}var n=!1,r=0,h=0,s=t.title.trim(),a=s.toLowerCase(),i=t.content.trim().replace(/<[^>]+>/g,""),c=i.toLowerCase(),l=decodeURIComponent(t.url),p=[],u=[];if(""!=s&&(T.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());-1<(s=e.indexOf(t,r));)a.push({position:s,word:t}),r=s+n;return a}p=p.concat(e(t,a,!1)),u=u.concat(e(t,c,!1))}),(0<p.length||0<u.length)&&(n=!0,r=p.length+u.length)),n){[p,u].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var f=[];0!=p.length&&f.push(e(0,0,s.length,p));for(var d=[];0!=u.length;){var g=u[u.length-1],v=g.position,$=g.word,C=v-20,m=v+80;C<0&&(C=0),m<v+$.length&&(m=v+$.length),m>i.length&&(m=i.length),d.push(e(0,C,m,u))}d.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var x=parseInt("1");0<=x&&(d=d.slice(0,x));var w="";w+=0!=f.length?"<li><a href='"+l+"' class='search-result-title'>"+o(s,f[0])+"</a>":"<li><a href='"+l+"' class='search-result-title'>"+s+"</a>",d.forEach(function(t){w+="<a href='"+l+'\'><p class="search-result">'+o(i,t)+"...</p></a>"}),w+="</li>",b.push({item:w,searchTextCount:h,hitCount:r,id:b.length})}}),1===T.length&&""===T[0])r.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===b.length)r.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{b.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var e='<ul class="search-result-list">';b.forEach(function(t){e+=t.item}),e+="</ul>",r.innerHTML=e}}),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script type="text/javascript" src="/js/src/love.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,log:!1,model:{jsonPath:"/live2dw/assets/shizuku.model.json"},display:{position:"right"},mobile:{show:!0,scale:.2},react:{opacityDefault:.7,opacityOnHover:.2,opacity:.4}})</script></body></html>