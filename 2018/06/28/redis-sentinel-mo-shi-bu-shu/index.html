<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><script></script><meta name="theme-color" content="#222"><style>.pace .pace-progress{background:#1e92fb;height:3px}.pace .pace-progress-inner{box-shadow:0 0 10px #1e92fb,0 0 5px #1e92fb}.pace .pace-activity{border-top-color:#1e92fb;border-left-color:#1e92fb}</style><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="HGM141IpbHrSmnAmR6W_zE4bo9Z3f-yXLeHYT3bg1fk"><meta name="baidu-site-verification" content="code-5Ai1DA8e6T"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="Redis,"><link rel="alternate" href="/atom.xml" title="凡间的精灵" type="application/atom+xml"><meta name="description" content="环境：CentOS7.4 * 3，redis * 3，sentinel * 3配置一主双从，使用aof数据持久化1、安装1.1 下载redis安装包：1wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-4.0.9.tar.gz1.2 安装包推送到其它两台机器上1scp redis-4.0.9.tar.gz admin@ip地址:`pwd`1.3 解压下载好的"><meta name="keywords" content="Redis"><meta property="og:type" content="article"><meta property="og:title" content="Redis sentinel模式部署"><meta property="og:url" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2018&#x2F;06&#x2F;28&#x2F;redis-sentinel-mo-shi-bu-shu&#x2F;index.html"><meta property="og:site_name" content="凡间的精灵"><meta property="og:description" content="环境：CentOS7.4 * 3，redis * 3，sentinel * 3配置一主双从，使用aof数据持久化1、安装1.1 下载redis安装包：1wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-4.0.9.tar.gz1.2 安装包推送到其它两台机器上1scp redis-4.0.9.tar.gz admin@ip地址:`pwd`1.3 解压下载好的"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2020-04-20T09:30:50.260Z"><meta name="twitter:card" content="summary"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"always",offset:12,b2t:!0,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://chenzhonzhou.github.io/2018/06/28/redis-sentinel-mo-shi-bu-shu/"><title>Redis sentinel模式部署 | 凡间的精灵</title><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">凡间的精灵</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">凡尘落素一精灵</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://chenzhonzhou.github.io/2018/06/28/redis-sentinel-mo-shi-bu-shu/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Zhongzhou Chen"><meta itemprop="description" content=""><meta itemprop="image" content="/images/chen.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="凡间的精灵"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Redis sentinel模式部署</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-28T14:05:15+08:00">2018-06-28</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E7%BC%93%E5%AD%98/" itemprop="url" rel="index"><span itemprop="name">缓存</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E7%BC%93%E5%AD%98/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">2k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">8</span></div></div></header><div class="post-body" itemprop="articleBody"><h3 id="环境：CentOS7-4-3，redis-3，sentinel-3"><a href="#环境：CentOS7-4-3，redis-3，sentinel-3" class="headerlink" title="环境：CentOS7.4 * 3，redis * 3，sentinel * 3"></a>环境：CentOS7.4 * 3，redis * 3，sentinel * 3</h3><p>配置一主双从，使用aof数据持久化</p><h2 id="1、安装"><a href="#1、安装" class="headerlink" title="1、安装"></a>1、安装</h2><h4 id="1-1-下载redis安装包："><a href="#1-1-下载redis安装包：" class="headerlink" title="1.1 下载redis安装包："></a>1.1 下载redis安装包：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/releases/redis-4.0.9.tar.gz</span><br></pre></td></tr></table></figure><h4 id="1-2-安装包推送到其它两台机器上"><a href="#1-2-安装包推送到其它两台机器上" class="headerlink" title="1.2 安装包推送到其它两台机器上"></a>1.2 安装包推送到其它两台机器上</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp redis-4.0.9.tar.gz admin@ip地址:`<span class="built_in">pwd</span>`</span><br></pre></td></tr></table></figure><h4 id="1-3-解压下载好的安装包-以下步骤建议三台机器同时进行"><a href="#1-3-解压下载好的安装包-以下步骤建议三台机器同时进行" class="headerlink" title="1.3 解压下载好的安装包(以下步骤建议三台机器同时进行)"></a>1.3 解压下载好的安装包(以下步骤建议三台机器同时进行)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar xzvf redis-4.0.9.tar.gz</span><br></pre></td></tr></table></figure><h4 id="1-4-安装编译环境"><a href="#1-4-安装编译环境" class="headerlink" title="1.4 安装编译环境"></a>1.4 安装编译环境</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum -y install gcc gcc-c++</span><br><span class="line"></span><br><span class="line">sudo pip install supervisor</span><br></pre></td></tr></table></figure><h4 id="1-5-编译"><a href="#1-5-编译" class="headerlink" title="1.5 编译"></a>1.5 编译</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /work/admin/download/redis-4.0.9</span><br><span class="line">make -j `grep processor /proc/cpuinfo | wc -l`</span><br></pre></td></tr></table></figure><h4 id="1-6-编译完成后，copy编译好的执行文件及默认配置文件"><a href="#1-6-编译完成后，copy编译好的执行文件及默认配置文件" class="headerlink" title="1.6 编译完成后，copy编译好的执行文件及默认配置文件"></a>1.6 编译完成后，copy编译好的执行文件及默认配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /work/admin/redis/bin</span><br><span class="line">mkdir -p /work/admin/redis/etc</span><br><span class="line">mkdir -p /work/admin/redis/etc/server</span><br><span class="line">mkdir -p /work/admin/redis/etc/sentinel</span><br><span class="line">mkdir -p /work/admin/redis/<span class="built_in">log</span></span><br><span class="line">mkdir -p /work/admin/redis/<span class="built_in">log</span>/supervisor</span><br><span class="line">mkdir -p /work/admin/redis/<span class="built_in">log</span>/sentinel</span><br><span class="line">mkdir -p /work/admin/redis/<span class="built_in">log</span>/server</span><br><span class="line">mkdir -p /work/admin/redis/data</span><br><span class="line">mkdir -p /work/admin/supervisor</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /work/admin/download/redis-4.0.9/src</span><br><span class="line">cp -rf mkreleasehdr.sh redis-benchmark redis-check-aof redis-check-rdb redis-cli redis-sentinel redis-server redis-trib.rb /work/admin/redis/bin</span><br><span class="line"></span><br><span class="line">cp -rf /work/admin/download/redis-4.0.9/redis.conf /work/admin/redis/etc/server/6379.conf</span><br><span class="line">cp -rf /work/admin/download/redis-4.0.9/sentinel.conf /work/admin/redis/etc/sentinel/26379.conf</span><br></pre></td></tr></table></figure><h2 id="2、编辑配置文件"><a href="#2、编辑配置文件" class="headerlink" title="2、编辑配置文件"></a>2、编辑配置文件</h2><h3 id="2-1-编辑redis-server配置-主节点-："><a href="#2-1-编辑redis-server配置-主节点-：" class="headerlink" title="2.1 编辑redis-server配置(主节点)："></a>2.1 编辑redis-server配置(主节点)：</h3><p><strong>配置文件位置：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /work/admin/redis/etc/server/6379.conf</span><br></pre></td></tr></table></figure><p><strong>绑定ip地址</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br></pre></td></tr></table></figure><p><strong>关闭增强安全模式</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protected-mode no</span><br></pre></td></tr></table></figure><p><strong>使用指定端口</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">port 6379</span><br></pre></td></tr></table></figure><p><strong>连接队列·</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp-backlog 511</span><br></pre></td></tr></table></figure><p><strong>关闭空闲超时的连接</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timeout 0</span><br></pre></td></tr></table></figure><p><strong>keepalive超时时间</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp-keepalive 300</span><br></pre></td></tr></table></figure><p><strong>关闭后台运行模式</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">daemonize no</span><br></pre></td></tr></table></figure><p><strong>supervisor模式关闭</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervised no</span><br></pre></td></tr></table></figure><p><strong>指定pid文件位置</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pidfile <span class="string">"/var/run/redis_6379.pid"</span></span><br></pre></td></tr></table></figure><p><strong>记录日志类型</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loglevel notice</span><br></pre></td></tr></table></figure><p><strong>指定日志文件位置</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logfile <span class="string">"/work/admin/redis/log/server/6379.log"</span></span><br></pre></td></tr></table></figure><p><strong>指定databases数量</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">databases 16</span><br></pre></td></tr></table></figure><p><strong>打开redis-logo，如下图</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">always-show-logo yes</span><br></pre></td></tr></table></figure><p>![](Redis sentinel模式部署/图片1.png)</p><p><strong>bgsave遇错不执行，默认为yes</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stop-writes-on-bgsave-error yes</span><br></pre></td></tr></table></figure><p><strong>指定aof文件存放目录</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir <span class="string">"/work/admin/redis/data"</span></span><br></pre></td></tr></table></figure><p><strong>bgsave快照操作出错时停止写数据到磁盘，默认为yes</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slave-serve-stale-data yes</span><br></pre></td></tr></table></figure><p><strong>开启从库只读模式，为保护从库数据，请不要设置为no</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slave-read-only yes</span><br></pre></td></tr></table></figure><p><strong>启用无硬盘备份</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repl-diskless-sync no</span><br></pre></td></tr></table></figure><p><strong>无硬盘备份延迟时间，以秒为单位</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repl-diskless-sync-delay 5</span><br></pre></td></tr></table></figure><p><strong>禁用TCP_NODELAY，但带宽加大</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repl-disable-tcp-nodelay no</span><br></pre></td></tr></table></figure><p><strong>设置sentinel提升主库优先级，数越小优先级更高，0不能提升</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slave-priority 10</span><br></pre></td></tr></table></figure><p><strong>内存满逐出选项</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lazyfree-lazy-eviction no</span><br></pre></td></tr></table></figure><p><strong>过期key删除选项</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lazyfree-lazy-expire no</span><br></pre></td></tr></table></figure><p><strong>内部删除选项</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lazyfree-lazy-server-del no</span><br></pre></td></tr></table></figure><p><strong>slave接收完RDB文件后清空数据选项</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slave-lazy-flush no</span><br></pre></td></tr></table></figure><p><strong>开启aof持久化</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes</span><br></pre></td></tr></table></figure><p><strong>指定aof文件名称</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendfilename <span class="string">"6379.aof"</span></span><br></pre></td></tr></table></figure><p><strong>每一秒写入aof文件，并完成磁盘同步</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendfsync everysec</span><br></pre></td></tr></table></figure><p><strong>在aof rewrite期间,是否对aof新记录的append暂缓使用文件同步策略,主要考虑磁盘IO开支和请求阻塞时间。默认为no,表示”不暂缓”,新的aof记录仍然会被立即同步</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">no-appendfsync-on-rewrite no</span><br></pre></td></tr></table></figure><p><strong>当Aof log增长超过指定比例时，重写log file， 设置为0表示不自动重写Aof 日志，重写是为了使aof体积保持最小，而确保保存最完整的数据</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auto-aof-rewrite-percentage 100</span><br></pre></td></tr></table></figure><p><strong>触发aof rewrite的最小文件尺寸</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auto-aof-rewrite-min-size 64mb</span><br></pre></td></tr></table></figure><p><strong>如果aof-load-truncated是yes，会自动发布一个log给客户端然后load（默认）。如果是no，用户必须手动redis-check-aof修复AOF文件才可以</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aof-load-truncated yes</span><br></pre></td></tr></table></figure><p><strong>关闭rdb文件生成</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aof-use-rdb-preamble no</span><br></pre></td></tr></table></figure><p><strong>限制脚本的最长运行时间，毫秒单位</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lua-time-limit 5000</span><br></pre></td></tr></table></figure><p><strong>慢查询超过10000毫秒会被记录</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slowlog-log-slower-than 10000</span><br></pre></td></tr></table></figure><p><strong>记录128条慢查询日志</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slowlog-max-len 128</span><br></pre></td></tr></table></figure><p><strong>redis延时监控系统在运行时会采样一些操作，以便收集可能导致延时的数据根源,0为关闭</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">latency-monitor-threshold 0</span><br></pre></td></tr></table></figure><p><strong>发布key事件，使用过期事件（当每一个key失效时，都会生成该事件）。</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notify-keyspace-events <span class="string">""</span></span><br></pre></td></tr></table></figure><p><strong>指定在超过一定的数量或者最大的元素超过某一临界值时，采用一种特殊的哈希算法</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">hash</span>-max-ziplist-entries 512</span><br><span class="line"><span class="built_in">hash</span>-max-ziplist-value 64</span><br><span class="line">list-max-ziplist-size -2</span><br><span class="line">list-compress-depth 0</span><br><span class="line"><span class="built_in">set</span>-max-intset-entries 512</span><br></pre></td></tr></table></figure><p><strong>ziplist优化sorted set</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br></pre></td></tr></table></figure><p><strong>启用哈希刷新</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hll-sparse-max-bytes 3000</span><br></pre></td></tr></table></figure><p><strong>是否开启顶层数据结构的rehash功能,如果内存允许,请开启</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">activerehashing yes</span><br></pre></td></tr></table></figure><p><strong>缓冲区软限制，硬限制和以秒为单位的超时（类似于复制缓冲区）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">client-output-buffer-limit normal 0 0 0</span><br><span class="line">client-output-buffer-limit slave 256mb 64mb 60</span><br><span class="line">client-output-buffer-limit pubsub 32mb 8mb 60</span><br></pre></td></tr></table></figure><p><strong>执行后台任务的频率，默认10</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hz 10</span><br></pre></td></tr></table></figure><p><strong>aof rewrite过程中,是否采取增量文件同步策略,默认yes</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aof-rewrite-incremental-fsync yes</span><br></pre></td></tr></table></figure><p><strong>以上配置完成，scp分发到另外两台从库上</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r 6379.conf admin@ip地址:`<span class="built_in">pwd</span></span><br></pre></td></tr></table></figure><h3 id="2-2-从库配置"><a href="#2-2-从库配置" class="headerlink" title="2.2 从库配置"></a>2.2 从库配置</h3><p>#####根据主库配置文件基础上，增加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof 主库ip地址 端口号</span><br></pre></td></tr></table></figure><h3 id="2-3-配置sentinel"><a href="#2-3-配置sentinel" class="headerlink" title="2.3 配置sentinel"></a>2.3 配置sentinel</h3><p><strong>配置文件位置</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /work/admin/redis/etc/sentinel/26379.conf</span><br></pre></td></tr></table></figure><p><strong>关闭增强安全模式</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protected-mode no</span><br></pre></td></tr></table></figure><p><strong>绑定端口</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">port 26379</span><br></pre></td></tr></table></figure><p><strong>绑定ip地址</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br></pre></td></tr></table></figure><p><strong>关闭后台运行</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">daemonize no</span><br></pre></td></tr></table></figure><p><strong>指定log文件位置</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logfile <span class="string">"/work/admin/redis/log/sentinel/26379.log"</span></span><br></pre></td></tr></table></figure><p><strong>log文件记录等级</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loglevel debug</span><br></pre></td></tr></table></figure><p><strong>redis数据文件位置</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir <span class="string">"/work/admin/redis/data"</span></span><br></pre></td></tr></table></figure><p><strong>设置sentinel的名称、要监控的redis-server的ip地址、端口、1代表即使1个sentinel存活也进行投票提升节点</strong><br><strong>如果某个redis-server退出，1个sentinel会进行从节点提升节点</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sentinel monitor mymaster 192.168.101.83 6379 1</span><br></pre></td></tr></table></figure><p><strong>redis-server退出后5秒，开始投票提升主节点（即从节点提升为主节点）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sentinel down-after-milliseconds mymaster 5000</span><br></pre></td></tr></table></figure><p><strong>以上配置文件保存后分发另外两个节点</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r 26379.conf admin@ip地址:`<span class="built_in">pwd</span>`</span><br></pre></td></tr></table></figure><p>####4.编辑supervisor配置文件</p><p>​```bash<br>vim /work/admin/supervisor/supervisor.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#####增加以下内容：</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">[program:redis-server]</span><br><span class="line">command=/work/admin/redis/bin/redis-server /work/admin/redis/etc/server/6379.conf</span><br><span class="line">directory=/work/admin/redis</span><br><span class="line">redirect_stderr=true</span><br><span class="line"></span><br><span class="line">;[program:redis-sentinel]</span><br><span class="line">;command=/work/admin/redis/bin/redis-sentinel /work/admin/redis/etc/sentinel/26379.conf</span><br><span class="line">;directory=/work/admin/redis</span><br><span class="line">;redirect_stderr=true</span><br></pre></td></tr></table></figure><p><font color="red"><strong>注:redis-server主从测试好后再开启sentinel</strong></font></p><p><strong>分发到所有节点</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r supervisor.conf admin@ip地址:`<span class="built_in">pwd</span>`</span><br></pre></td></tr></table></figure><h3 id="2-4-系统优化"><a href="#2-4-系统优化" class="headerlink" title="2.4 系统优化"></a>2.4 系统优化</h3><p><strong>添加优化参数</strong></p><p>vim /etc/sysctl.conf<br>添加以下参数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">socket监听(listen)的backlog上限</span><br><span class="line">net.core.somaxconn= 1024</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">内存分配策略 1表示内核允许分配所有的物理内存，而不管当前的内存状态如何</span><br><span class="line">vm.overcommit_memory = 1</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">禁止使用透明大页</span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"></span><br><span class="line">vim /etc/rc.local</span><br><span class="line">加入：</span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br></pre></td></tr></table></figure><h2 id="3、启动并验证"><a href="#3、启动并验证" class="headerlink" title="3、启动并验证"></a>3、启动并验证</h2><h3 id="3-1-以supervisor启动，先启动redis-server"><a href="#3-1-以supervisor启动，先启动redis-server" class="headerlink" title="3.1 以supervisor启动，先启动redis-server"></a>3.1 以supervisor启动，先启动redis-server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisord -c /work/admim/supervisor/supervisor.conf</span><br></pre></td></tr></table></figure><h3 id="3-2-测试redis主从是否可用"><a href="#3-2-测试redis主从是否可用" class="headerlink" title="3.2 测试redis主从是否可用"></a>3.2 测试redis主从是否可用</h3><h4 id="3-2-1-在主节点上："><a href="#3-2-1-在主节点上：" class="headerlink" title="3.2.1 在主节点上："></a>3.2.1 在主节点上：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/work/admin/redis/bin/redis-cli</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt;<span class="built_in">set</span> <span class="built_in">test</span> <span class="built_in">test</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure><h4 id="3-2-2-从节点上："><a href="#3-2-2-从节点上：" class="headerlink" title="3.2.2 从节点上："></a>3.2.2 从节点上：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/work/admin/redis/bin/redis-cli</span><br><span class="line"></span><br><span class="line">get <span class="built_in">test</span></span><br><span class="line"><span class="string">"test"</span></span><br></pre></td></tr></table></figure><h3 id="3-3-测试redis-sentinel-三个节点都要做"><a href="#3-3-测试redis-sentinel-三个节点都要做" class="headerlink" title="3.3 测试redis-sentinel(三个节点都要做)"></a>3.3 测试redis-sentinel(三个节点都要做)</h3><h4 id="3-3-1-在supervisor中开启redis-sentinel配置项并保存，分发到另外两个节点上"><a href="#3-3-1-在supervisor中开启redis-sentinel配置项并保存，分发到另外两个节点上" class="headerlink" title="3.3.1 在supervisor中开启redis-sentinel配置项并保存，分发到另外两个节点上"></a>3.3.1 在supervisor中开启redis-sentinel配置项并保存，分发到另外两个节点上</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[program:redis-sentinel]</span><br><span class="line"><span class="built_in">command</span>=/work/admin/redis/bin/redis-sentinel /work/admin/redis/etc/sentinel/26379.conf</span><br><span class="line">directory=/work/admin/redis</span><br><span class="line">redirect_stderr=<span class="literal">true</span></span><br></pre></td></tr></table></figure><h4 id="3-3-2-进入supervisor命令行，执行update，自动开启redis-sentinel"><a href="#3-3-2-进入supervisor命令行，执行update，自动开启redis-sentinel" class="headerlink" title="3.3.2 进入supervisor命令行，执行update，自动开启redis-sentinel"></a>3.3.2 进入supervisor命令行，执行update，自动开启redis-sentinel</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl</span><br><span class="line"></span><br><span class="line">supervisor&gt; update</span><br><span class="line"></span><br><span class="line">supervisor&gt; status</span><br><span class="line"></span><br><span class="line">redis-sentinel                   RUNNING   pid 19669, uptime 111 days, 3:21:31</span><br><span class="line">redis-server                     RUNNING   pid 19668, uptime 111 days, 3:21:31</span><br><span class="line">supervisor&gt;</span><br></pre></td></tr></table></figure><h4 id="3-3-3-测试sentinel是否将从节点提升为主节点"><a href="#3-3-3-测试sentinel是否将从节点提升为主节点" class="headerlink" title="3.3.3 测试sentinel是否将从节点提升为主节点"></a>3.3.3 测试sentinel是否将从节点提升为主节点</h4><p><strong>关闭一台master，查看另外两台从节点</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisor&gt; stop redis-server</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/work/admin/redis/bin/redis-cli</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; info **</span><br></pre></td></tr></table></figure><p>![](Redis sentinel模式部署/图片2.png)</p><p><strong>某一台role为master即可</strong></p><p><font color="red">注：如果刚退出的主节点再次开启时，会成为从节点，不会切换。</font></p><h2 id="4、访问redis"><a href="#4、访问redis" class="headerlink" title="4、访问redis"></a>4、访问redis</h2><p><strong>因redis主从节点不固定，需要先访问redis-sentinel查询主从节点ip地址，然后再访问redis-server</strong></p><p>代码示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line">from redis.sentinel import Sentinel  <span class="comment"># 加载redis模块</span></span><br><span class="line">sentinel = Sentinel([(<span class="string">'192.168.232.134'</span>, 26379),</span><br><span class="line">                     (<span class="string">'192.168.232.134'</span>, 26380),</span><br><span class="line">                     (<span class="string">'192.168.232.134'</span>, 26381)],</span><br><span class="line">                    socket_timeout=0.1)  <span class="comment"># 连接哨兵服务器</span></span><br><span class="line">masterip = sentinel.discover_master(<span class="string">'master-business-2'</span>)  <span class="comment"># 获取主redis服务器地址</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> masterip:</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">slaveip = sentinel.discover_slaves(<span class="string">'master-business-2'</span>)  <span class="comment"># 获取从redis服务器地址</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> slaveip:</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> i:</span><br><span class="line">        <span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Redis/" rel="tag"><i class="fa fa-tag"></i> Redis</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2018/06/26/mysql-gao-ke-yong-xing-zhi-mha/" rel="next" title="MySQL 高可用性之MHA"><i class="fa fa-chevron-left"></i> MySQL 高可用性之MHA</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2018/06/29/mysql-bao-cuo-xu-hao-he-dui-ying-de-cuo-wu/" rel="prev" title="MySQL 报错序号和对应的错误">MySQL 报错序号和对应的错误<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"><span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a><a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/chen.png" alt="Zhongzhou Chen"><p class="site-author-name" itemprop="name">Zhongzhou Chen</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">314</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">84</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">180</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#环境：CentOS7-4-3，redis-3，sentinel-3"><span class="nav-text">环境：CentOS7.4 * 3，redis * 3，sentinel * 3</span></a></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#1、安装"><span class="nav-text">1、安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-下载redis安装包："><span class="nav-text">1.1 下载redis安装包：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-安装包推送到其它两台机器上"><span class="nav-text">1.2 安装包推送到其它两台机器上</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-解压下载好的安装包-以下步骤建议三台机器同时进行"><span class="nav-text">1.3 解压下载好的安装包(以下步骤建议三台机器同时进行)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-安装编译环境"><span class="nav-text">1.4 安装编译环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-编译"><span class="nav-text">1.5 编译</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-编译完成后，copy编译好的执行文件及默认配置文件"><span class="nav-text">1.6 编译完成后，copy编译好的执行文件及默认配置文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、编辑配置文件"><span class="nav-text">2、编辑配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-编辑redis-server配置-主节点-："><span class="nav-text">2.1 编辑redis-server配置(主节点)：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-从库配置"><span class="nav-text">2.2 从库配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-配置sentinel"><span class="nav-text">2.3 配置sentinel</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-系统优化"><span class="nav-text">2.4 系统优化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、启动并验证"><span class="nav-text">3、启动并验证</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-以supervisor启动，先启动redis-server"><span class="nav-text">3.1 以supervisor启动，先启动redis-server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-测试redis主从是否可用"><span class="nav-text">3.2 测试redis主从是否可用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-在主节点上："><span class="nav-text">3.2.1 在主节点上：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-从节点上："><span class="nav-text">3.2.2 从节点上：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-测试redis-sentinel-三个节点都要做"><span class="nav-text">3.3 测试redis-sentinel(三个节点都要做)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-在supervisor中开启redis-sentinel配置项并保存，分发到另外两个节点上"><span class="nav-text">3.3.1 在supervisor中开启redis-sentinel配置项并保存，分发到另外两个节点上</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-进入supervisor命令行，执行update，自动开启redis-sentinel"><span class="nav-text">3.3.2 进入supervisor命令行，执行update，自动开启redis-sentinel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-3-测试sentinel是否将从节点提升为主节点"><span class="nav-text">3.3.3 测试sentinel是否将从节点提升为主节点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、访问redis"><span class="nav-text">4、访问redis</span></a></li></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Zhongzhou Chen</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">752.6k</span></div><span class="post-meta-divider"></span></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code").find(".line").map(function(t,e){return $(e).text()}).toArray().join("\n"),n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();var o=document.execCommand("copy");document.body.removeChild(n),o?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})</script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,s){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var o=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,n=document.getElementById(e),r=document.getElementById(s);n.addEventListener("input",function(){var y=n.value.trim().toLowerCase(),T=y.split(/[\s\-]+/);1<T.length&&T.push(y);var b=[];if(0<y.length&&o.forEach(function(t){function e(t,e,o,n){for(var r=n[n.length-1],s=r.position,a=r.word,i=[],c=0;s+a.length<=o&&0!=n.length;){a===y&&c++,i.push({position:s,length:a.length});var l=s+a.length;for(n.pop();0!=n.length&&(s=(r=n[n.length-1]).position,a=r.word,s<l);)n.pop()}return h+=c,{hits:i,start:e,end:o,searchTextCount:c}}function o(o,t){var n="",r=t.start;return t.hits.forEach(function(t){n+=o.substring(r,t.position);var e=t.position+t.length;n+='<b class="search-keyword">'+o.substring(t.position,e)+"</b>",r=e}),n+=o.substring(r,t.end)}var n=!1,r=0,h=0,s=t.title.trim(),a=s.toLowerCase(),i=t.content.trim().replace(/<[^>]+>/g,""),c=i.toLowerCase(),l=decodeURIComponent(t.url),p=[],u=[];if(""!=s&&(T.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());-1<(s=e.indexOf(t,r));)a.push({position:s,word:t}),r=s+n;return a}p=p.concat(e(t,a,!1)),u=u.concat(e(t,c,!1))}),(0<p.length||0<u.length)&&(n=!0,r=p.length+u.length)),n){[p,u].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var f=[];0!=p.length&&f.push(e(0,0,s.length,p));for(var d=[];0!=u.length;){var g=u[u.length-1],v=g.position,$=g.word,C=v-20,m=v+80;C<0&&(C=0),m<v+$.length&&(m=v+$.length),m>i.length&&(m=i.length),d.push(e(0,C,m,u))}d.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var x=parseInt("1");0<=x&&(d=d.slice(0,x));var w="";w+=0!=f.length?"<li><a href='"+l+"' class='search-result-title'>"+o(s,f[0])+"</a>":"<li><a href='"+l+"' class='search-result-title'>"+s+"</a>",d.forEach(function(t){w+="<a href='"+l+'\'><p class="search-result">'+o(i,t)+"...</p></a>"}),w+="</li>",b.push({item:w,searchTextCount:h,hitCount:r,id:b.length})}}),1===T.length&&""===T[0])r.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===b.length)r.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{b.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var e='<ul class="search-result-list">';b.forEach(function(t){e+=t.item}),e+="</ul>",r.innerHTML=e}}),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script type="text/javascript" src="/js/src/love.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,log:!1,model:{jsonPath:"/live2dw/assets/shizuku.model.json"},display:{position:"right"},mobile:{show:!0,scale:.2},react:{opacityDefault:.7,opacityOnHover:.2,opacity:.4}})</script></body></html>