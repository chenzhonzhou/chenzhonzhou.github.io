<!-- build time:Tue Dec 21 2021 14:39:57 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><script></script><meta name="theme-color" content="#222"><style>.pace .pace-progress{background:#1E92FB;height:3px}.pace .pace-progress-inner{box-shadow:0 0 10px #1E92FB,0 0 5px #1E92FB}.pace .pace-activity{border-top-color:#1E92FB;border-left-color:#1E92FB}</style><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="HGM141IpbHrSmnAmR6W_zE4bo9Z3f-yXLeHYT3bg1fk"><meta name="baidu-site-verification" content="code-5Ai1DA8e6T"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="数据库,MySQL,MySQL备份与数据恢复,"><link rel="alternate" href="/atom.xml" title="凡间的精灵" type="application/atom+xml"><meta name="description" content="1、mysqldump备份结合binlog日志恢复MySQL备份一般采取全库备份加日志备份的方式，例如每天执行一次全备份，每小时执行一次二进制日志备份。这样在MySQL故障后可以使用全备份和日志备份将数据恢复到最后一个二进制日志备份前的任意位置或时间。1.1 binlog介绍mysql的二进制日志记录着该数据库的所有增删改的操作日志(前提是要在自己的服务器上开启binlog)，还包括了这些操作的执"><meta name="keywords" content="数据库,MySQL,MySQL备份与数据恢复"><meta property="og:type" content="article"><meta property="og:title" content="MySQL 备份与数据恢复"><meta property="og:url" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2018&#x2F;03&#x2F;29&#x2F;mysql-bei-fen-yu-shu-ju-hui-fu&#x2F;index.html"><meta property="og:site_name" content="凡间的精灵"><meta property="og:description" content="1、mysqldump备份结合binlog日志恢复MySQL备份一般采取全库备份加日志备份的方式，例如每天执行一次全备份，每小时执行一次二进制日志备份。这样在MySQL故障后可以使用全备份和日志备份将数据恢复到最后一个二进制日志备份前的任意位置或时间。1.1 binlog介绍mysql的二进制日志记录着该数据库的所有增删改的操作日志(前提是要在自己的服务器上开启binlog)，还包括了这些操作的执"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2018&#x2F;03&#x2F;29&#x2F;mysql-bei-fen-yu-shu-ju-hui-fu&#x2F;%E5%9B%BE%E7%89%871.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2018&#x2F;03&#x2F;29&#x2F;mysql-bei-fen-yu-shu-ju-hui-fu&#x2F;%E5%9B%BE%E7%89%872.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2018&#x2F;03&#x2F;29&#x2F;mysql-bei-fen-yu-shu-ju-hui-fu&#x2F;%E5%9B%BE%E7%89%873.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2018&#x2F;03&#x2F;29&#x2F;mysql-bei-fen-yu-shu-ju-hui-fu&#x2F;%E5%9B%BE%E7%89%874.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2018&#x2F;03&#x2F;29&#x2F;mysql-bei-fen-yu-shu-ju-hui-fu&#x2F;%E5%9B%BE%E7%89%875.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2018&#x2F;03&#x2F;29&#x2F;mysql-bei-fen-yu-shu-ju-hui-fu&#x2F;%E5%9B%BE%E7%89%876.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2018&#x2F;03&#x2F;29&#x2F;mysql-bei-fen-yu-shu-ju-hui-fu&#x2F;%E5%9B%BE%E7%89%877.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2018&#x2F;03&#x2F;29&#x2F;mysql-bei-fen-yu-shu-ju-hui-fu&#x2F;%E5%9B%BE%E7%89%878.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2018&#x2F;03&#x2F;29&#x2F;mysql-bei-fen-yu-shu-ju-hui-fu&#x2F;%E5%9B%BE%E7%89%879.png"><meta property="og:updated_time" content="2019-11-15T07:51:15.584Z"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2018&#x2F;03&#x2F;29&#x2F;mysql-bei-fen-yu-shu-ju-hui-fu&#x2F;%E5%9B%BE%E7%89%871.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"always",offset:12,b2t:!0,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://chenzhonzhou.github.io/2018/03/29/mysql-bei-fen-yu-shu-ju-hui-fu/"><title>MySQL 备份与数据恢复 | 凡间的精灵</title><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">凡间的精灵</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">凡尘落素一精灵</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://chenzhonzhou.github.io/2018/03/29/mysql-bei-fen-yu-shu-ju-hui-fu/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Zhongzhou Chen"><meta itemprop="description" content=""><meta itemprop="image" content="/images/chen.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="凡间的精灵"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">MySQL 备份与数据恢复</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-29T17:55:56+08:00">2018-03-29 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span> </a></span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">7k </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">30</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="1、mysqldump备份结合binlog日志恢复"><a href="#1、mysqldump备份结合binlog日志恢复" class="headerlink" title="1、mysqldump备份结合binlog日志恢复"></a>1、mysqldump备份结合binlog日志恢复</h2><p>MySQL备份一般采取全库备份加日志备份的方式，例如每天执行一次全备份，每小时执行一次二进制日志备份。这样在MySQL故障后可以使用全备份和日志备份将数据恢复到最后一个二进制日志备份前的任意位置或时间。</p><h3 id="1-1-binlog介绍"><a href="#1-1-binlog介绍" class="headerlink" title="1.1 binlog介绍"></a>1.1 binlog介绍</h3><p>mysql的二进制日志记录着该数据库的所有增删改的操作日志(前提是要在自己的服务器上开启binlog)，还包括了这些操作的执行时间。为了显示这些二进制内容，我们可以使用mysqlbinlog命令来查看。</p><h4 id="1-1-1-Binlog的用途"><a href="#1-1-1-Binlog的用途" class="headerlink" title="1.1.1 Binlog的用途"></a>1.1.1 Binlog的用途</h4><ol><li><p>主从同步</p></li><li><p>恢复数据库</p></li></ol><h4 id="1-1-2-开启binary-log功能"><a href="#1-1-2-开启binary-log功能" class="headerlink" title="1.1.2 开启binary log功能"></a>1.1.2 开启binary log功能</h4><p>通过编辑<strong>my.cnf</strong>中的<strong>log-bin</strong>选项可以开启二进制日志；形式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log-bin [=DIR/[filename]]</span><br></pre></td></tr></table></figure><p>其中，DIR参数指定二进制文件的存储路径；filename参数指定二级制文件的文件名，其形式为filename.number，number的形式为000001、000002等。每次重启mysql服务或运行mysql&gt; flush logs;都会生成一个新的二进制日志文件，这些日志文件的number会不断地递增。除了生成上述的文件外还会生成一个名为filename.index的文件。这个文件中存储所有二进制日志文件的清单又称为二进制文件的索引</p><p>配置保存以后重启mysql的服务器，用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &apos;log_bin&apos;;</span><br></pre></td></tr></table></figure><p>查看bin-log是否开启，如图：</p><p><img src="/2018/03/29/mysql-bei-fen-yu-shu-ju-hui-fu/%E5%9B%BE%E7%89%871.png" alt="image-20191115144947549"></p><p>查看产生的binary log 注：查看binlog内容是为了恢复数据<br>bin-log因为是二进制文件，不能通过文件内容查看命令直接打开查看，mysql提供两种方式查看方式，在介绍之前，我们先对数据库进行一下增删改的操作，否则log里边数据有点空。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#mysql -uroot -p -e &quot;reset master&quot;</span><br><span class="line">#mysql -uroot -p -e &quot;create database test&quot;</span><br><span class="line">#mysql -uroot -p -e &quot;use test;create table tb1(id int primary key auto_increment,name varchar(20))&quot;</span><br><span class="line">#mysql -uroot -p -e &quot;insert into test.tb1(name) values(&apos;lisi&apos;)&quot;</span><br><span class="line">#mysql -uroot -p -e &quot;insert into test.tb1(name) values(&apos;zhangsan&apos;)&quot;</span><br></pre></td></tr></table></figure><p>重新开始一个新的日志文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#mysql -uroot -p -e &quot;flush logs&quot;</span><br><span class="line">#mysql -uroot -p -e &quot;delete from test.tb1 where id=2&quot;</span><br><span class="line">#mysql -uroot -p -e &quot;insert into test.tb1(name) values(&apos;tom&apos;)&quot;</span><br><span class="line"># mysql -uroot -p -e &quot;select * from test.tb1&quot;</span><br><span class="line">Enter password: </span><br><span class="line">+----+------+</span><br><span class="line">| id | name |</span><br><span class="line">+----+------+</span><br><span class="line">|  1 | lisi |</span><br><span class="line">|  3 | tom  |</span><br><span class="line">+----+------+</span><br></pre></td></tr></table></figure><p>查看MySQL Server上的二进制日志</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show binary logs;</span><br><span class="line">+------------------+-----------+</span><br><span class="line">| Log_name         | File_size |</span><br><span class="line">+------------------+-----------+</span><br><span class="line">| mysql-bin.000001 |      1087 |</span><br><span class="line">| mysql-bin.000002 |       673 |</span><br><span class="line">+------------------+-----------+</span><br></pre></td></tr></table></figure><h4 id="1-1-3-查看二进制日志信息"><a href="#1-1-3-查看二进制日志信息" class="headerlink" title="1.1.3 查看二进制日志信息"></a>1.1.3 查看二进制日志信息</h4><p>查看二进制日志信息的命令：</p><p>语法格式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW BINLOG EVENTS[IN &apos;log_name&apos;] [FROM pos] [LIMIT [offset,] row_count]</span><br></pre></td></tr></table></figure><p>查看二进制日志中的事件</p><p>默认显示<strong>可找到的第一个二进制日志文件中的事件</strong>，包含了日志文件名、事件的开始位置、事件类型、结束位置、信息等内容</p><blockquote><p>+——————+——+—————-+———–+————-+———————————————————————————-+</p><p>| Log_name | Pos | Event_type | Server_id | End_log_pos | Info |</p><p>+——————+——+—————-+———–+————-+———————————————————————————-+</p><p>| mysql-bin.000001 | 4 | <font color="red">Format_desc</font> | 1 | 123 | Server ver: 5.7.13-log, Binlog ver: 4 | //此事件为格式描述事件</p><p>| mysql-bin.000001 | 123 | Previous_gtids | 1 | 154 | |</p><p>| mysql-bin.000001 | 154 | Anonymous_Gtid | 1 | 219 | SET @@SESSION.GTID_NEXT= ‘ANONYMOUS’ |</p><p>| mysql-bin.000001 | 219 | <font color="red">Query</font> | 1 | 313 | create database test | //为查询事件</p><p>| mysql-bin.000001 | 313 | Anonymous_Gtid | 1 | 378 | SET @@SESSION.GTID_NEXT= ‘ANONYMOUS’ |</p><p>| mysql-bin.000001 | 378 | <font color="red">Query</font> | 1 | 520 | use <code>test</code>; create table tb1(id int primary key auto_increment,name varchar(20)) |</p><p>| mysql-bin.000001 | 520 | Anonymous_Gtid | 1 | 585 | SET @@SESSION.GTID_NEXT= ‘ANONYMOUS’ |</p><p>| mysql-bin.000001 | 585 | <font color="red">Query</font> | 1 | 653 | <font color="red">BEGIN</font> | //为查询事件，事务开始</p><p>| mysql-bin.000001 | 653 | <font color="red">Table_map</font> | 1 | 702 | table_id: 110 (test.tb1) | //为表映射事件</p><p>| mysql-bin.000001 | 702 | <font color="red">Write_rows</font> | 1 | 747 | table_id: 110 flags: STMT_END_F | //为我们执行的insert事件</p><p>| mysql-bin.000001 | 747 | <font color="red">Xid</font> | 1 | 778 | COMMIT /* xid=2052 */ | //Xid时间是自动提交事务的动作</p><p>| mysql-bin.000001 | 778 | Anonymous_Gtid | 1 | 843 | SET @@SESSION.GTID_NEXT= ‘ANONYMOUS’ |</p><p>| mysql-bin.000001 | 843 | <font color="red">Query</font> | 1 | 911 | BEGIN |</p><p>| mysql-bin.000001 | 911 | <font color="red">Table_map</font> | 1 | 960 | table_id: 110 (test.tb1) |</p><p>| mysql-bin.000001 | 960 | <font color="red">Write_rows</font> | 1 | 1009 | table_id: 110 flags: STMT_END_F |</p><p>| mysql-bin.000001 | 1009 | <font color="red">Xid</font> | 1 | 1040 | COMMIT /* xid=2055 */ |</p><p>| mysql-bin.000001 | 1040 | <font color="red">Rotate</font> | 1 | 1087 | mysql-bin.000002;pos=4 | //为日志轮换事件，是我们执行flush logs开启新日志文件引起的。</p></blockquote><p>查看指定的二进制日志中的事件</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show binlog events in &apos;mysql-bin.000002&apos;;</span><br></pre></td></tr></table></figure><p>+——————+—–+—————-+———–+————-+—————————————+</p><p>| Log_name | Pos | Event_type | Server_id | End_log_pos | Info |</p><p>+——————+—–+—————-+———–+————-+—————————————+</p><p>| mysql-bin.000002 | 4 | Format_desc | 1 | 123 | Server ver: 5.7.13-log, Binlog ver: 4 |</p><p>| mysql-bin.000002 | 123 | Previous_gtids | 1 | 154 | |</p><p>| mysql-bin.000002 | 154 | Anonymous_Gtid | 1 | 219 | SET @@SESSION.GTID_NEXT= ‘ANONYMOUS’ |</p><p>| mysql-bin.000002 | 219 | <font color="red">Query</font> | 1 | 287 | BEGIN |</p><p>| mysql-bin.000002 | 287 | <font color="red">Table_map</font> | 1 | 336 | table_id: 110 (test.tb1) |</p><p>| mysql-bin.000002 | 336 | <font color="red">Delete_rows</font> | 1 | 385 | table_id: 110 flags: STMT_END_F |</p><p>| mysql-bin.000002 | 385 | <font color="red">Xid</font> | 1 | 416 | COMMIT /* xid=2068 */ |</p><p>| mysql-bin.000002 | 416 | Anonymous_Gtid | 1 | 481 | SET @@SESSION.GTID_NEXT= ‘ANONYMOUS’ |</p><p>| mysql-bin.000002 | 481 | <font color="red">Query</font> | 1 | 549 | BEGIN |</p><p>| mysql-bin.000002 | 549 | <font color="red">Table_map</font> | 1 | 598 | table_id: 110 (test.tb1) |</p><p>| mysql-bin.000002 | 598 | <font color="red">Write_rows</font> | 1 | 642 | table_id: 110 flags: STMT_END_F |</p><p>| mysql-bin.000002 | 642 | <font color="red">Xid</font> | 1 | 673 | COMMIT /* xid=2071 */ |</p></blockquote><p>该命令还包含其他选项以便灵活查看</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show binlog events in &apos;mysql-bin.000002&apos; from 219 limit 1,3;</span><br><span class="line">+------------------+-----+-------------+-----------+-------------+---------------------------------+</span><br><span class="line">| Log_name         | Pos | Event_type  | Server_id | End_log_pos | Info                            |</span><br><span class="line">+------------------+-----+-------------+-----------+-------------+---------------------------------+</span><br><span class="line">| mysql-bin.000002 | 287 | Table_map   |         1 |         336 | table_id: 110 (test.tb1)        |</span><br><span class="line">| mysql-bin.000002 | 336 | Delete_rows |         1 |         385 | table_id: 110 flags: STMT_END_F |</span><br><span class="line">| mysql-bin.000002 | 385 | Xid         |         1 |         416 | COMMIT /* xid=2068 */           |</span><br></pre></td></tr></table></figure><p>SHOW BINARY LOGS 等价于 SHOW MASTER LOGS<br>PURGE BINARY LOGS用于删除二进制日志，如：<br>PURGE BINARY LOGS TO ‘mysql-bin.00010’; //把这个文件之前的其他文件都删除掉<br>PURGE BINARY LOGS BEFORE ‘2016-08-28 22:46:26’;//把指定时间之前的二进制文件删除了<br>RESET MASTER 与 RESET SLAVE<br>前者清空index文件中列出的所有二进制日志，重置index文件为空，并创建一个新的二进制日志文件，一般用于MASTER首次启动时。后者使SLAVE忘记其在MASTER二进制日志文件中的复制位置，它会删除master.info、relay-log.info 和所有中继日志文件并开始一个新的中继日志文件，以便于开始一个干净的复制。在使用RESET SLAVE前需先关闭 SLAVE复制线程。</p><p>上述方式可以查看到服务器上存在的二进制日志文件及文件中的事件，但是想查看到文件中具体的内容并应于恢复场景还得借助mysqlbinlog这个工具。</p><p>语法格式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [options] log_file ...</span><br></pre></td></tr></table></figure><p>输出内容会因日志文件的格式以及mysqlbinlog工具使用的选项不同而略不同。</p><p>mysqlbinlog的可用选项可参考man手册。</p><p>二进制日志文件的格式包含行模式、语句模式和混合模式（也即有服务器决定在什么情况下记录什么类型的日志），基于语句的日志中事件信息包含执行的语句等，基于行的日志中事件信息包含的是行的变化信息等。混合模式的日志中两种类型的事件信息都会记录。</p><p>为了便于查看记录了行变化信息的事件在当时具体执行了什么样的SQL语句可以使用mysqlbinlog工具的-v（–verbose）选项，该选项会将行事件重构成被注释掉的伪SQL语句，如果想看到更详细的信息可以将该选项给两次如-vv，这样可以包含一些数据类型和元信息的注释内容，如</p><p>先切换到binlog所在的目录下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#mysqlbinlog mysql-bin.000001</span><br><span class="line">#mysqlbinlog -v mysql-bin.000001 </span><br><span class="line">#mysqlbinlog -vv mysql-bin.000001</span><br></pre></td></tr></table></figure><p>另外mysqlbinlog和可以通过–read-from-remote-server选项从远程服务器读取二进制日志文件，这时需要一些而外的连接参数，如-h，-P，-p，-u等，这些参数仅在指定了–read-from-remote-server后有效。<br>无论是本地二进制日志文件还是远程服务器上的二进制日志文件，无论是行模式、语句模式还是混合模式的二进制日志文件，被mysqlbinlog工具解析后都可直接应用与MySQL Server进行基于时间点、位置或数据库的恢复。</p><h4 id="1-1-4-数据恢复"><a href="#1-1-4-数据恢复" class="headerlink" title="1.1.4 数据恢复"></a>1.1.4 数据恢复</h4><p><strong>下面我们就来演示如何使用binlog恢复之前删除数据（id=2那条记录）</strong></p><p><strong>注意：</strong>在实际生产环境中，如果遇到需要恢复数据库的情况，不要让用户能访问到数据库，以避免新的数据插入进来，以及在主从的环境下，关闭主从。</p><p>查看binlog文件，从中找出delete from test.tb1 where id=2</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cd /usr/local/mysql/data/</span><br><span class="line"># mysqlbinlog  -v mysql-bin.000002</span><br></pre></td></tr></table></figure><p>显示结果</p><blockquote><p># at 219</p><p>#160913 20:59:51 server id 1 end_log_pos <font color="red">287</font> CRC32 0x1a97741b Query thread_id=42 exec_time=0 error_code=0</p><p>SET TIMESTAMP=1473771591/<em>!</em>/;</p><p>SET @@session.pseudo_thread_id=42/<em>!</em>/;</p><p>SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/<em>!</em>/;</p><p>SET @@session.sql_mode=1075838976/<em>!</em>/;</p><p>SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/<em>!</em>/;</p><p>/<em>!\C utf8 *//</em>!*/;</p><p>SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=33/<em>!</em>/;</p><p>SET @@session.lc_time_names=0/<em>!</em>/;</p><p>SET @@session.collation_database=DEFAULT/<em>!</em>/;</p><p>BEGIN</p><p>/<em>!</em>/;</p><p># <font color="red">at 287</font></p><p>#160913 20:59:51 server id 1 end_log_pos 336 CRC32 0x930ab248 Table_map: <code>test</code>.<code>tb1</code> mapped to number 125</p><p>#at 336</p><p>#160910 23:17:43 server id 1 <font color="red">end_log_pos 385</font> CRC32 0xdede3eb7 <font color="red">Delete_rows</font>: table id 110 flags: STMT_END_F</p><p>BINLOG ‘</p><p>FyTUVxMBAAAAMQAAAFABAAAAAG4AAAAAAAEABHRlc3QAA3RiMQACAw8CPAAC2t7UdQ==</p><p>FyTUVyABAAAAMQAAAIEBAAAAAG4AAAAAAAEAAgAC//wCAAAACHpoYW5nc2Futz7e3g==</p><p>‘/<em>!</em>/;</p><p>### DELETE FROM <code>test</code>.<code>tb1</code></p><p>### WHERE</p><p>### @1=2</p><p>### @2=’zhangsan’</p><p># <font color="red">at 385</font></p><p>#160910 23:17:43 server id 1 <font color="red">end_log_pos 416</font> CRC32 0x7881c9da <font color="red">Xid = 2068</font></p><p>COMMIT/<em>!</em>/;</p></blockquote><p>从中可以看出delete事件发生position是287，事件结束position是416</p><p><strong>恢复流程：</strong></p><p>直接用bin-log日志将数据库恢复到删除位置287前,然后跳过故障点,再进行恢复下面所有的操作,命令如下</p><p>由于之前没有做过全库备份，所以要使用所有binlog日志恢复，所以生产环境中需要很长时间恢复，导出相关binlog文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#mysqlbinlog /usr/local/mysql/data/mysql-bin.000001 &gt; /opt/mysql-bin.000001.sql</span><br><span class="line">#mysqlbinlog --stop-position=287 /usr/local/mysql/data/mysql-bin.000002 &gt; /opt/287.sql</span><br><span class="line">#mysqlbinlog --start-position=416 /usr/local/mysql/data/mysql-bin.000002 &gt; /opt/416.sql</span><br></pre></td></tr></table></figure><p>删除test数据库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;drop database test;</span><br></pre></td></tr></table></figure><p>利用binlog恢复数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#mysql -uroot -p123456&lt; /opt/mysql-bin.000001.sql </span><br><span class="line"></span><br><span class="line">#mysql -uroot -p123456&lt; /opt/287.sql </span><br><span class="line"></span><br><span class="line">#mysql -uroot -p123456&lt; /opt/416.sql</span><br></pre></td></tr></table></figure><p>恢复完成后，我们检查下表的数据是否完整</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from test.tb1;</span><br><span class="line">+----+----------+</span><br><span class="line">| id | name     |</span><br><span class="line">+----+----------+</span><br><span class="line">|  1 | lisi     |</span><br><span class="line">|  2 | zhangsan |</span><br><span class="line">|  3 | tom      |</span><br><span class="line">+----+----------+</span><br></pre></td></tr></table></figure><p>Ok完整的都恢复过来了</p><p>mysqlbinlog 选项示例</p><p>常见的选项有以下几个：</p><table><thead><tr><th>选项</th><th>描述</th></tr></thead><tbody><tr><td>–start-datetime</td><td>从二进制日志中读取指定时间戳或者本地计算机时间之后的日志事件。</td></tr><tr><td>–stop-datetime</td><td>从二进制日志中读取指定时间戳或者本地计算机时间之前的日志事件。</td></tr><tr><td>–start-position</td><td>从二进制日志中读取指定position 事件位置作为开始。</td></tr><tr><td>–stop-position</td><td>从二进制日志中读取指定position 事件位置作为事件截至。</td></tr></tbody></table><h3 id="1-2-mysqldump介绍"><a href="#1-2-mysqldump介绍" class="headerlink" title="1.2 mysqldump介绍"></a>1.2 mysqldump介绍</h3><p><strong>mysqldump</strong>是<strong>mysql</strong>用于备份和数据转移的一个工具。它主要产生一系列的<strong>SQL</strong>语句，可以封装到文件，该文件包含有所有重建你的数据库所需要的 <strong>SQL</strong>命令如<strong>CREATE</strong> <strong>DATABASE</strong>，<strong>CREATE</strong> <strong>TABLE</strong>，<strong>INSERT</strong>等等。可以用来实现轻量级的快速迁移或恢复数据库。</p><p><strong>mysqldump</strong> 是将数据表导成 <strong>SQL</strong> 脚本文件，在不同的 <strong>MySQL</strong> 版本之间升级时相对比较合适，这也是最常用的备份方法。</p><p><strong>mysqldump</strong>一般在数据量很小的时候（几个G）可以用于备份。当数据量比较大的情况下，就不建议用<strong>mysqldump</strong>工具进行备份了。</p><p><strong>数据库的导出</strong></p><p>导出对象说明：</p><p>mysqldump可以针对单个表、多个表、单个数据库、多个数据库、所有数据库进行导出的操作</p><blockquote><p>#mysqldump [options] db_name [tbl_name …] //导出指定数据库或单个表</p><p>#mysqldump [options] –databases db_name … //导出多个数据库</p><p>#mysqldump [options] –all-databases //导出所有</p></blockquote><p><strong>导出数据库test</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mysqldump -uroot -p --flush-logs test &gt; /opt/test.sql</span><br></pre></td></tr></table></figure><p>–flush-logs这个选项就会完整备份的时候重新开启一个新binlog</p><p><strong>数据库的导入</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mysql -uroot -p test &lt; /opt/test.sql</span><br></pre></td></tr></table></figure><p><font face="黑体" color="green" size="4"><strong>在前面我们介绍了mysql的binlog和mysqldump工具，下面我们来学习如何实现mysqldump全库备份+binlog的数据恢复</strong></font></p><p>环境准备与备份还原：<br>检查开启binlog<br>先创建一些原始数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; reset master;</span><br><span class="line">mysql&gt; create database test_db;</span><br><span class="line">mysql&gt; use test_db;</span><br><span class="line">mysql&gt; create table tb1(id int primary key auto_increment,name varchar(20));</span><br><span class="line">mysql&gt; insert into tb1(name) values(&apos;tom1&apos;);</span><br><span class="line">mysql&gt; insert into tb1(name) values(&apos;tom2&apos;);</span><br><span class="line">mysql&gt; commit;</span><br><span class="line">mysql&gt; select * from tb1;</span><br><span class="line">+----+------+</span><br><span class="line">| id | name |</span><br><span class="line">+----+------+</span><br><span class="line">|  1 | tom1 |</span><br><span class="line">|  2 | tom2 |</span><br><span class="line">+----+------+</span><br></pre></td></tr></table></figure><h4 id="1-2-1-方案：mysqldump全库备份-binlog还原"><a href="#1-2-1-方案：mysqldump全库备份-binlog还原" class="headerlink" title="1.2.1 方案：mysqldump全库备份+binlog还原"></a>1.2.1 方案：mysqldump全库备份+binlog还原</h4><h5 id="1-2-1-1-mysqldump备份方案"><a href="#1-2-1-1-mysqldump备份方案" class="headerlink" title="1.2.1.1 mysqldump备份方案"></a>1.2.1.1 mysqldump备份方案</h5><p>每周一凌晨1点全库备份</p><h5 id="1-2-1-2-备份步骤"><a href="#1-2-1-2-备份步骤" class="headerlink" title="1.2.1.2 备份步骤"></a>1.2.1.2 备份步骤</h5><p><strong>①创建备份目录</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># mkdir /opt/mysqlbackup</span><br><span class="line"># mkdir /opt/mysqlbackup/daily</span><br></pre></td></tr></table></figure><p><strong>②全库备份</strong></p><p>这里我们模拟周一的完整备份数据库任务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost data]# mysqldump -uroot -p --flush-logs test_db &gt; /opt/mysqlbackup/test_db_2016_09_12.sql</span><br><span class="line"></span><br><span class="line">[root@localhost data]# ls -l /opt/mysqlbackup/</span><br><span class="line">-rw-r--r--. 1 root root 1871 Sep 13 21:06 test_db_2016_09_12.sql</span><br></pre></td></tr></table></figure><p>备份mysqldump全库备份之前的binlog日志文（注：生产环境中可能不只一个binlog文件）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cp /usr/local/mysql/data/mysql-bin.000001 /opt/mysqlbackup/daily/</span><br><span class="line"># mysql -uroot -p -e &quot;purge binary logs to &apos;mysql-bin.000002&apos;&quot;</span><br></pre></td></tr></table></figure><p><strong>模拟下操作失误,将数据修改错误了。</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use test_db;</span><br><span class="line">mysql&gt; delete from tb1 where id=1;</span><br><span class="line">mysql&gt; commit;</span><br><span class="line">mysql&gt; insert into tb1(name) values(&apos;tom3&apos;);</span><br><span class="line">mysql&gt; commit;</span><br></pre></td></tr></table></figure><p>备份自mysqldump之后的binlog日志文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/mysql/data/mysql-bin.000002 /opt/mysqlbackup/daily/</span><br></pre></td></tr></table></figure><p>上面的模拟的误操作是删除了id=1的记录</p><p><strong>③现在我们使用mysqldump的全库备份和binlog来恢复数据</strong></p><p>使用mysqldump的备份进行全库恢复</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mysql -uroot -p test_db &lt; /opt/mysqlbackup/test_db_2016_09_12.sql</span><br></pre></td></tr></table></figure><p>查询一下数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql -uroot -p -e &quot;select * from test_db.tb1&quot;</span><br><span class="line">Enter password: </span><br><span class="line">+----+------+</span><br><span class="line">| id | name |</span><br><span class="line">+----+------+</span><br><span class="line">|  1 | tom1 |</span><br><span class="line">|  2 | tom2 |</span><br><span class="line">+----+------+</span><br></pre></td></tr></table></figure><p>从显示结果可以看到使用mysqldump备份将数据还原到了备份时的状态，刚才删除的数据（id=2）恢复回来了，但备份后产生的数据却丢失了所以还得利用binlog进一步不原</p><p>因为删除是在全库备份后发生的，而mysqldump全库备份时使用–flush-logs选项，所以只需要分析全库备份后的binlog即mysql-bin.000002。</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show binary logs;</span><br></pre></td></tr></table></figure><p>+——————+———–+</p><p>| Log_name | File_size |</p><p>+——————+———–+</p><p>| <font color="red">mysql-bin.000002 | 1853</font> |</p><p>+——————+———–+</p></blockquote><p>查看mysql-bin.000002中的事件，可以看到有删除事件</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show binlog events in &apos;mysql-bin.000002&apos;;</span><br></pre></td></tr></table></figure><p>| mysql-bin.000002 | <font color="red">219</font> | Query | 1 | 294 | BEGIN |</p><p>| mysql-bin.000002 | 294 | Table_map | 1 | 346 | table_id: 118 (test_db.tb1) |</p><p>| mysql-bin.000002 | 346 | Delete_rows | 1 | 391 | table_id: 118 flags: STMT_END_F |</p><p>| mysql-bin.000002 | 391 | Xid | 1 | <font color="red">422</font> | COMMIT /* xid=2739 */</p></blockquote><p>使用mysqlbinlog 命令可以查看备份的binlog文件的详细事件。</p><p>恢复流程：我们直接用bin-log日志将数据库恢复到删除位置前,然后跳过故障点,再进行恢复删除后的所有操作。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mysqlbinlog -v /opt/mysqlbackup/daily/mysql-bin.000002</span><br></pre></td></tr></table></figure><p>我们先用mysqlbinlog命令找到delete那条语句的位置</p><blockquote><p>#<strong><font color="red">at 219</font></strong></p><p>#160911 17:19:55 server id 1 end_log_pos 294 CRC32 0x84590493 Query thread_id=66 exec_time=0 error_code=0</p><p>SET TIMESTAMP=1473585595/<em>!</em>/;</p><p>SET @@session.pseudo_thread_id=66/<em>!</em>/;</p><p>SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/<em>!</em>/;</p><p>SET @@session.sql_mode=1075838976/<em>!</em>/;</p><p>SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/<em>!</em>/;</p><p>/<em>!\C utf8 *//</em>!*/;</p><p>SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=33/<em>!</em>/;</p><p>SET @@session.lc_time_names=0/<em>!</em>/;</p><p>SET @@session.collation_database=DEFAULT/<em>!</em>/;</p><p>BEGIN</p><p>/<em>!</em>/;</p><p># at 294</p><p>#160911 17:19:55 server id 1 end_log_pos 346 CRC32 0x5cdccf9e Table_map: <code>test_db</code>.<code>tb1</code> mapped to number 118</p><p># at 346</p><p>#160911 17:19:55 server id 1 end_log_pos 391 CRC32 0x320c4935 Delete_rows: table id 118 flags: STMT_END_F</p><p>BINLOG ‘</p><p>uyHVVxMBAAAANAAAAFoBAAAAAHYAAAAAAAEAB3Rlc3RfZGIAA3RiMQACAw8CPAACns/cXA==</p><p>uyHVVyABAAAALQAAAIcBAAAAAHYAAAAAAAEAAgAC//wBAAAABHRvbTE1SQwy</p><p>‘/<em>!</em>/;</p><p>### DELETE FROM <code>test_db</code>.<code>tb1</code></p><p>### WHERE</p><p>### @1=1</p><p>### @2=’tom1’</p><p># at 391</p><p>#160911 17:19:55 server id 1 end_log_pos <strong><font color="red">422</font></strong> CRC32 0x5e4a6699 Xid = 2739</p><p>COMMIT/<em>!</em>/;</p></blockquote><p>通过mysqlbinlog命令所显示的结果可以看到误操作delete的开始postion为<strong>219</strong>，结束position是<strong>422</strong>。</p><p>从二进制日志中读取指定position=219事件位置作为截至，即把数据恢复到delete删除前</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mysqlbinlog --stop-position=219 /opt/mysqlbackup/daily/mysql-bin.000002 | mysql -u root -p</span><br></pre></td></tr></table></figure><p>从二进制日志中读取指定position=422事件位置作为开始，即跳过删除事件，恢复删除事件之后对数据的正常操作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mysqlbinlog --start-position=422 /opt/mysqlbackup/daily/mysql-bin.000002 | mysql -u root -p</span><br></pre></td></tr></table></figure><p>查看恢复结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># mysql -uroot -p -e &quot;select * from test_db.tb1&quot;</span><br><span class="line">Enter password: </span><br><span class="line">+----+------+</span><br><span class="line">| id | name |</span><br><span class="line">+----+------+</span><br><span class="line">|  1 | tom1 |</span><br><span class="line">|  2 | tom2 |</span><br><span class="line">|  3 | tom3 |</span><br><span class="line">+----+------+</span><br></pre></td></tr></table></figure><p>从上面显示可以看出数据恢复到正常状态</p><p>生产环境中Mysql数据库的备份是周期性重复的操作，所以通常是要编写脚本实现，通过crond计划任务周期性执行备份脚本</p><h5 id="1-2-1-3-mysqldump备份方案："><a href="#1-2-1-3-mysqldump备份方案：" class="headerlink" title="1.2.1.3 mysqldump备份方案："></a>1.2.1.3 mysqldump备份方案：</h5><p>周日凌晨1点全库备份<br>周一到周六凌晨每隔4个小时增量备份一次<br>设置<strong>crontab</strong>任务，每天执行备份脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab–e</span><br></pre></td></tr></table></figure><p>#每个星期日凌晨1:00执行完全备份脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 1 * * 0 /root/mysqlfullbackup.sh &gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>#周一到周六每隔4个小时增量备份一次</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 */4 * * 1-6 /root/mysqldailybackup.sh &gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p><strong>mysqlfullbackup.sh脚本内容：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat mysqlfullbackup.sh </span><br><span class="line">#!/bin/sh</span><br><span class="line"># Name:mysqlFullBackup.sh</span><br><span class="line"></span><br><span class="line"># 定义数据库目录</span><br><span class="line">mysqlDir=/usr/local/mysql</span><br><span class="line"></span><br><span class="line"># 定义用于备份数据库的用户名和密码</span><br><span class="line">user=root</span><br><span class="line">userpwd=123456</span><br><span class="line">dbname=test_db</span><br><span class="line"></span><br><span class="line"># 定义备份目录</span><br><span class="line">databackupdir=/opt/mysqlbackup</span><br><span class="line">[ ! -d $databackupdir ]&amp;&amp; mkdir $databackupdir</span><br><span class="line"></span><br><span class="line"># 定义邮件正文文件</span><br><span class="line">emailfile=$databackupdir/email.txt</span><br><span class="line"></span><br><span class="line"># 定义邮件地址</span><br><span class="line">email=root@localhost.localdomain</span><br><span class="line"></span><br><span class="line"># 定义备份日志文件</span><br><span class="line">logfile=$databackupdir/mysqlbackup.log</span><br><span class="line">DATE=`date -I`</span><br><span class="line"></span><br><span class="line">echo &quot;&quot; &gt; $emailfile</span><br><span class="line">echo $(date +&quot;%y-%m-%d %H:%M:%S&quot;) &gt;&gt; $emailfile</span><br><span class="line">cd $databackupdir</span><br><span class="line"></span><br><span class="line"># 定义备份文件名</span><br><span class="line">dumpfile=mysql_$DATE.sql</span><br><span class="line">gzdumpfile=mysql_$DATE.sql.tar.gz</span><br><span class="line"></span><br><span class="line"># 使用mysqldump备份数据库，请根据具体情况设置参数</span><br><span class="line">$mysqlDir/bin/mysqldump -u$user -p$userpwd --flush-logs -x $dbname &gt; $dumpfile</span><br><span class="line"></span><br><span class="line"># 压缩备份文件</span><br><span class="line">if [ $? -eq 0 ]; then</span><br><span class="line">tar czf $gzdumpfile $dumpfile &gt;&gt; $emailfile 2&gt;&amp;1</span><br><span class="line">echo &quot;BackupFileName:$gzdumpfile&quot; &gt;&gt; $emailfile</span><br><span class="line">echo &quot;DataBase Backup Success!&quot; &gt;&gt; $emailfile</span><br><span class="line">rm -f $dumpfile</span><br><span class="line">else</span><br><span class="line">echo &quot;DataBase Backup Fail!&quot; &gt;&gt; $emailfile</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 写日志文件</span><br><span class="line">echo &quot;--------------------------------------------------------&quot; &gt;&gt; $logfile</span><br><span class="line">cat $emailfile &gt;&gt; $logfile</span><br><span class="line"></span><br><span class="line"># 发送邮件通知</span><br><span class="line">cat $emailfile | mail -s &quot;MySQL Backup&quot; $email</span><br></pre></td></tr></table></figure><p><strong>mysqldailybackup.sh增量备份脚本内容：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat mysqldailybackup.sh </span><br><span class="line">#!/bin/sh</span><br><span class="line"># Name:mysqlDailyBackup.sh</span><br><span class="line"></span><br><span class="line"># 定义数据库目录和数据目录</span><br><span class="line">mysqldir=/usr/local/mysql</span><br><span class="line">datadir=$mysqldir/data</span><br><span class="line"></span><br><span class="line"># 定义用于备份数据库的用户名和密码</span><br><span class="line">user=root</span><br><span class="line">userpwd=123456</span><br><span class="line"></span><br><span class="line"># 定义备份目录，每日备份文件备份到$dataBackupDir/daily</span><br><span class="line">databackupdir=/opt/mysqlbackup</span><br><span class="line">dailybackupdir=$databackupdir/daily</span><br><span class="line">[ ! -d $dailybackupdir ]&amp;&amp; mkdir -p $databackupdir/daily</span><br><span class="line"></span><br><span class="line"># 定义邮件正文文件</span><br><span class="line">emailfile=$databackupdir/email.txt</span><br><span class="line"></span><br><span class="line"># 定义邮件地址</span><br><span class="line">email=root@localhost.localdomain</span><br><span class="line"></span><br><span class="line"># 定义日志文件</span><br><span class="line">logfile=$databackupdir/mysqlbackup.log</span><br><span class="line">echo &quot;&quot; &gt; $emailfile</span><br><span class="line">echo $(date +&quot;%y-%m-%d %H:%M:%S&quot;) &gt;&gt; $emailfile</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># 刷新日志，使数据库使用新的二进制日志文件</span><br><span class="line">$mysqldir/bin/mysqladmin -u$user -p$userpwd flush-logs</span><br><span class="line">cd $datadir</span><br><span class="line"></span><br><span class="line"># 得到二进制日志列表</span><br><span class="line">filelist=`cat mysql-bin.index`</span><br><span class="line">icounter=0</span><br><span class="line">for file in $filelist</span><br><span class="line">do</span><br><span class="line">icounter=`expr $icounter + 1`</span><br><span class="line">done</span><br><span class="line">nextnum=0</span><br><span class="line">ifile=0</span><br><span class="line">for file in $filelist</span><br><span class="line">do</span><br><span class="line">binlogname=`basename $file`</span><br><span class="line">nextnum=`expr $nextnum + 1`</span><br><span class="line"></span><br><span class="line"># 跳过最后一个二进制日志（数据库当前使用的二进制日志文件）</span><br><span class="line">if [ $nextnum -eq $icounter ]; then</span><br><span class="line">echo &quot;Skip lastest!&quot; &gt; /dev/null</span><br><span class="line">else</span><br><span class="line">dest=$dailybackupdir/$binlogname</span><br><span class="line"></span><br><span class="line"># 跳过已经备份的二进制日志文件</span><br><span class="line">if [ -e $dest ]; then</span><br><span class="line">echo &quot;Skip exist $binlogname!&quot; &gt; /dev/null</span><br><span class="line">else</span><br><span class="line"># 备份日志文件到备份目录</span><br><span class="line">cp $binlogname $dailybackupdir</span><br><span class="line">if [ $? -eq 0 ]; then</span><br><span class="line">ifile=`expr $ifile + 1`</span><br><span class="line">echo &quot;$binlogname backup success!&quot; &gt;&gt; $emailfile</span><br><span class="line">fi</span><br><span class="line">fi</span><br><span class="line">fi</span><br><span class="line">done</span><br><span class="line">if [ $ifile -eq 0 ];then</span><br><span class="line">echo &quot;No Binlog Backup!&quot; &gt;&gt; $emailfile</span><br><span class="line">else</span><br><span class="line">echo &quot;Backup $ifile File(s).&quot; &gt;&gt; $emailfile</span><br><span class="line">echo &quot;Backup MySQL Binlog OK!&quot; &gt;&gt; $emailfile</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 发送邮件通知</span><br><span class="line">cat $emailfile | mail -s &quot;MySQL Backup&quot; $email</span><br><span class="line"></span><br><span class="line"># 写日志文件</span><br><span class="line">echo &quot;--------------------------------------------------------&quot; &gt;&gt; $logfile</span><br><span class="line">cat $emailfile &gt;&gt; $logfile</span><br></pre></td></tr></table></figure><h2 id="2、使用xtrabackup进行MySQL数据库备份"><a href="#2、使用xtrabackup进行MySQL数据库备份" class="headerlink" title="2、使用xtrabackup进行MySQL数据库备份"></a>2、使用xtrabackup进行MySQL数据库备份</h2><p>前面介绍mysqldump备份方式是采用逻辑备份，其最大的缺陷就是备份和恢复速度都慢，对于一个小于50G的数据库而言，这个速度还是能接受的，但如果数据库非常大，那再使用mysqldump备份就不太适合了。</p><p>这时就需要一种好用又高效的工具，xtrabackup就是其中一款，号称免费版的InnoDB HotBackup。</p><p>Xtrabackup实现是物理备份，而且是物理热备</p><p>目前主流的有两个工具可以实现物理热备：ibbackup和xtrabackup；ibbackup是商业软件，需要授权，非常昂贵。而xtrabackup功能比ibbackup还要强大，但却是开源的。因此我们这里就来介绍xtrabackup的使用。</p><p>Xtrabackup提供了两种命令行工具：</p><p>xtrabackup：专用于备份InnoDB和XtraDB引擎的数据；</p><p>innobackupex：这是一个perl脚本，在执行过程中会调用xtrabackup命令，这样用该命令即可以实现备份InnoDB，也可以备份MyISAM引擎的对象。</p><p><strong>Xtrabackup是由percona提供的mysql数据库备份工具，特点：</strong></p><blockquote><ol><li><p>备份过程快速、可靠；</p></li><li><p>备份过程不会打断正在执行的事务；</p></li><li><p>能够基于压缩等功能节约磁盘空间和流量；</p></li><li><p>自动实现备份检验；</p></li><li><p>还原速度快。</p></li></ol></blockquote><p>官方链接地址：<a href="http://www.percona.com/software/percona-xtrabackup" target="_blank" rel="noopener">http://www.percona.com/software/percona-xtrabackup</a> ；可以下载源码编译安装，也可以下载适合的RPM包或使用yum进行安装或者下载二进制源码包。</p><h3 id="2-1-安装xtrabackup"><a href="#2-1-安装xtrabackup" class="headerlink" title="2.1 安装xtrabackup"></a>2.1 安装xtrabackup</h3><h4 id="2-1-1-下载xtrabackup"><a href="#2-1-1-下载xtrabackup" class="headerlink" title="2.1.1 下载xtrabackup"></a>2.1.1 下载xtrabackup</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.percona.com/downloads/XtraBackup/Percona-XtraBackup-2.4.4/binary/tarball/percona-xtrabackup-2.4.4-Linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure><h4 id="2-1-2-解压"><a href="#2-1-2-解压" class="headerlink" title="2.1.2 解压"></a>2.1.2 解压</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zxf percona-xtrabackup-2.4.4-Linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure><h4 id="2-1-3-进入解压目录"><a href="#2-1-3-进入解压目录" class="headerlink" title="2.1.3 进入解压目录"></a>2.1.3 进入解压目录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd percona-xtrabackup-2.4.4-Linux-x86_64/</span><br></pre></td></tr></table></figure><h4 id="2-1-4-复制bin下的所有程序到-usr-bin"><a href="#2-1-4-复制bin下的所有程序到-usr-bin" class="headerlink" title="2.1.4 复制bin下的所有程序到/usr/bin"></a>2.1.4 复制bin下的所有程序到/usr/bin</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost percona-xtrabackup-2.4.4-Linux-x86_64]# cp bin/* /usr/bin/</span><br></pre></td></tr></table></figure><p><strong>Xtrabackup中主要包含两个工具：</strong><br><strong>xtrabackup</strong>：是用于热备份innodb, xtradb表中数据的工具，支持在线热备份，可以在不加锁的情况下备份Innodb数据表，不过此工具不能操作Myisam引擎表；<br><strong>innobackupex</strong>：是将xtrabackup进行封装的perl脚本，能同时处理Innodb和Myisam，但在处理Myisam时需要加一个读锁。<br>由于操作Myisam时需要加读锁，这会堵塞线上服务的写操作，而Innodb没有这样的限制，所以数据库中Innodb表类型所占的比例越大，则越有利。</p><h4 id="2-1-5-安装相关插件"><a href="#2-1-5-安装相关插件" class="headerlink" title="2.1.5 安装相关插件"></a>2.1.5 安装相关插件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install perl-DBI perl-DBD-MySQL perl-Time-HiRes perl-IO-Socket-SSL perl-TermReadKey.x86_64 perl-Digest-MD5 -y</span><br></pre></td></tr></table></figure><h4 id="2-1-6-下载percona-toolkit并安装"><a href="#2-1-6-下载percona-toolkit并安装" class="headerlink" title="2.1.6 下载percona-toolkit并安装"></a>2.1.6 下载percona-toolkit并安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># wget https://www.percona.com/downloads/percona-toolkit/2.2.19/RPM/percona-toolkit-2.2.19-1.noarch.rpm</span><br><span class="line"></span><br><span class="line"># rpm -vih percona-toolkit-2.2.19-1.noarch.rpm</span><br></pre></td></tr></table></figure><p>下面就可以启动备份了</p><h3 id="2-2-使用xtrabackup备份"><a href="#2-2-使用xtrabackup备份" class="headerlink" title="2.2 使用xtrabackup备份"></a>2.2 使用xtrabackup备份</h3><p><strong>方案：xtrabackup完全备份+binlog增量备份</strong></p><p><strong>创建备份目录</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/mysqlbackup/&#123;full,inc&#125;</span><br></pre></td></tr></table></figure><p><strong>full：</strong>全备存放的目录；inc：增量备份存放的目录</p><h4 id="2-2-1-完全备份"><a href="#2-2-1-完全备份" class="headerlink" title="2.2.1 完全备份"></a>2.2.1 完全备份</h4><p>基本语法：</p><blockquote><p>innobackupex –user=DBUSER –password=DBUSERPASS /path/to/BACKUP-DIR/</p></blockquote><p>执行下面的命令进行完全备份：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innobackupex  --user=root --password=123456 /opt/mysqlbackup/full</span><br></pre></td></tr></table></figure><p><strong>注：</strong> –defaults-file=/etc/my.cnf 指定mysql的配置文件my.cfg，如果指定则必须是第一个参数。<br>/path/to/BACKUP-DIR/指定备份所存放的目标目录，备份过程会创建一个以当时备份时间命名的目录存放备份文件。<br>出现如下提示。表示成功</p><p><img src="/2018/03/29/mysql-bei-fen-yu-shu-ju-hui-fu/%E5%9B%BE%E7%89%872.png" alt="image-20191115153855673"></p><p><strong>备份后的文件：</strong></p><p>在备份的同时，备份数据会在备份目录下创建一个以当前日期时间为名字的目录存放备份文件：</p><p><img src="/2018/03/29/mysql-bei-fen-yu-shu-ju-hui-fu/%E5%9B%BE%E7%89%873.png" alt="img"></p><p><strong>各文件说明：</strong></p><p>(1)xtrabackup_checkpoints ——备份类型（如完全或增量）、备份状态（如是否已经为prepared状态）和LSN(日志序列号)范围信息；</p><p>每个InnoDB页(通常为16k大小)都会包含一个日志序列号，即LSN。LSN是整个数据库系统的系统版本号，每个页面相关的LSN能够表明此页面最近是如何发生改变的。</p><p>(2)xtrabackup_binlog_info —— mysql服务器当前正在使用的二进制日志文件及至备份这一刻为止二进制日志事件的位置。</p><p>(3)xtrabackup_binlog_pos_innodb ——二进制日志文件及用于InnoDB或XtraDB表的二进制日志文件的当前position。</p><p>(4)xtrabackup_binary ——备份中用到的xtrabackup的可执行文件；</p><p>(5)backup-my.cnf ——备份命令用到的配置选项信息；</p><p>在使用innobackupex进行备份时，还可以使用–no-timestamp选项来阻止命令自动创建一个以时间命名的目录；如此一来，innobackupex命令将会创建一个BACKUP-DIR目录来存储备份数据</p><p><strong>注意：</strong>相关选项说明：</p><p>–user指定连接数据库的用户名，</p><p>–password指定连接数据库的密码，</p><p>–defaults-file指定数据库的配置文件，innobackupex要从其中获取datadir等信息；</p><p>–database指定要备份的数据库，这里指定的数据库只对MyISAM表有效，对于InnoDB 数据来说都是全备（所有数据库中的InnoDB数据都进行了备份，不是只备份指定的数据库，恢复时也一样）；</p><p>/opt/mysqlbackup/full是备份文件的存放位置。</p><p><strong>注意：</strong>备份数据库的用户需要具有相应权限，如果要使用一个最小权限的用户进行备份，则可基于如下命令创建此类用户：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create user &apos;bkpuser&apos;@&apos;localhost&apos; identified by &apos;123456&apos;;</span><br><span class="line"></span><br><span class="line">mysql&gt; revoke all privileges,grant option from &apos;bkpuser&apos;@&apos;localhost&apos;;</span><br><span class="line"></span><br><span class="line">mysql&gt; grant reload,lock tables,replication client, process on *.* to &apos;bkpuser&apos;@&apos;localhost&apos;;</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure><p>至此全备完全成功，然后向mysql某个库插入几条数据，然后进行增量备份</p><p>对完全备份的后数据库更改进行二进制日志增量备份：</p><p>查看完全备份时binlog日志位置(position)：</p><p><img src="/2018/03/29/mysql-bei-fen-yu-shu-ju-hui-fu/%E5%9B%BE%E7%89%874.png" alt="image-20191115154126742"></p><p>模拟数据库修改：</p><p><img src="/2018/03/29/mysql-bei-fen-yu-shu-ju-hui-fu/%E5%9B%BE%E7%89%875.png" alt="image-20191115154140688"></p><h4 id="2-2-2-增量备份二进制文件"><a href="#2-2-2-增量备份二进制文件" class="headerlink" title="2.2.2 增量备份二进制文件"></a>2.2.2 增量备份二进制文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mysqlbinlog --start-position=2378 /usr/local/mysql/data/mysql-bin.000023 &gt; /opt/mysqlbackup/inc/`date +%F`.sql</span><br></pre></td></tr></table></figure><h3 id="2-3-xtrabackup还原数据库"><a href="#2-3-xtrabackup还原数据库" class="headerlink" title="2.3 xtrabackup还原数据库"></a>2.3 xtrabackup还原数据库</h3><p>模拟数据库损坏：</p><p>我这里直接使用删除数据目录文件来模拟损坏。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># rm -fr /usr/local/mysql/data/*</span><br></pre></td></tr></table></figure><h4 id="2-3-1-还原完全备份"><a href="#2-3-1-还原完全备份" class="headerlink" title="2.3.1 还原完全备份"></a>2.3.1 还原完全备份</h4><p><strong>①准备(prepare)一个完全备份</strong></p><p>一般情况下，在备份完成后，数据尚且不能用于恢复操作，因为备份的数据中可能会包含尚未提交的事务或已经提交但尚未同步至数据文件中的事务。因此，此时数据文件仍处理不一致状态。“准备”的主要作用正是通过回滚未提交的事务及同步已经提交的事务至数据文件也使得数据文件处于一致性状态。</p><p>在准备（prepare）过程结束后，InnoDB表数据已经前滚到整个备份结束的点，而不是回滚到xtrabackup刚开始时的点。</p><p>innobakupex命令的–apply-log选项可用于实现上述功能。如下面的命令：</p><p>–apply-log指明是将日志应用到数据文件上，完成之后将备份文件中的数据恢复到数据库中：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># innobackupex --apply-log /opt/mysqlbackup/full/2016-09-12_11-29-55/</span><br></pre></td></tr></table></figure><p>注：/opt/mysqlbackup/full/2016-09-12_11-29-55/备份文件所在目录名称</p><p>如果执行正确，其最后输出的几行信息通常如下：</p><p><img src="/2018/03/29/mysql-bei-fen-yu-shu-ju-hui-fu/%E5%9B%BE%E7%89%876.png" alt="image-20191115154411068"></p><p>在实现“准备”的过程中，innobackupex通常还可以使用–use-memory选项来指定其可以使用的内存的大小，默认通常为100M。如果有足够的内存可用，可以多划分一些内存给prepare的过程，以提高其完成速度。</p><p>innobackupex命令的–copy-back选项用于执行恢复操作，其通过复制所有数据相关的文件至mysql服务器DATADIR目录中来执行恢复过程。innobackupex通过backup-my.cnf来获取DATADIR目录的相关信息。</p><p><strong>②还原数据库语法</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># innobackupex --copy-back /opt/mysqlbackup/full/2016-09-12_11-29-55/</span><br></pre></td></tr></table></figure><p>这里的–copy-back指明是进行数据恢复。数据恢复完成之后，需要修改相关文件的权限mysql数据库才能正常启动。</p><p>如果执行正确，其输出信息的最后几行通常如下：</p><p><img src="/2018/03/29/mysql-bei-fen-yu-shu-ju-hui-fu/%E5%9B%BE%E7%89%877.png" alt="img"></p><p>请确保如上信息的最行一行出现“completed OK!”。</p><p><strong>③修改还原后的数据目录权限</strong></p><p><img src="/2018/03/29/mysql-bei-fen-yu-shu-ju-hui-fu/%E5%9B%BE%E7%89%878.png" alt="img"></p><p>当数据恢复至DATADIR目录以后，还需要确保所有数据文件的属主和属组均为正确的用户，如mysql，否则，在启动mysqld之前还需要事先修改数据文件的属主和属组。如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># chown -R mysql:mysql /usr/local/mysql/data/</span><br></pre></td></tr></table></figure><p><strong>④重启动MySQL</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl restart mysqld</span><br></pre></td></tr></table></figure><p><strong>⑤验证还原后的数据</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from tb1;</span><br><span class="line">+----+------+</span><br><span class="line">| id | name |</span><br><span class="line">+----+------+</span><br><span class="line">|  1 | tom1 |</span><br><span class="line">|  2 | tom2 |</span><br><span class="line">+----+------+</span><br></pre></td></tr></table></figure><h4 id="2-3-2-还原增量备份"><a href="#2-3-2-还原增量备份" class="headerlink" title="2.3.2 还原增量备份"></a>2.3.2 还原增量备份</h4><p>为了防止还原时产生大量的二进制日志，在还原时可临时关闭二进制日志后再还原：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set sql_log_bin=0;</span><br><span class="line">mysql&gt; source /opt/mysqlbackup/inc/2016-09-12.sql</span><br></pre></td></tr></table></figure><p>重新启动二进制日志并验证还原数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set sql_log_bin=1;</span><br></pre></td></tr></table></figure><p>验证数据是否恢复回来</p><p><img src="/2018/03/29/mysql-bei-fen-yu-shu-ju-hui-fu/%E5%9B%BE%E7%89%879.png" alt="image-20191115154903575"></p><h4 id="2-3-3-Xtrabackup的“流”及“备份压缩”功能"><a href="#2-3-3-Xtrabackup的“流”及“备份压缩”功能" class="headerlink" title="2.3.3 Xtrabackup的“流”及“备份压缩”功能"></a>2.3.3 Xtrabackup的“流”及“备份压缩”功能</h4><p>Xtrabackup对备份的数据文件支持“流”功能，即可以将备份的数据通过<strong>STDOUT</strong>传输给<strong>tar</strong>程序进行归档，而不是默认的直接保存至某备份目录中。要使用此功能，仅需要使用<strong>–stream</strong>选项即可。如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># innobackupex --user=root --password=&quot;123456&quot; --stream=tar /opt/mysqlbackup/full/ | gzip &gt;/opt/mysqlbackup/full/full_`date +%F_%H%M%S`.tar.gz</span><br></pre></td></tr></table></figure></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"><i class="fa fa-tag"></i> 数据库</a> <a href="/tags/MySQL/" rel="tag"><i class="fa fa-tag"></i> MySQL</a> <a href="/tags/MySQL%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D/" rel="tag"><i class="fa fa-tag"></i> MySQL备份与数据恢复</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2018/03/24/jumpserver-bao-lei-ji-bu-shu/" rel="next" title="Jumpserver堡垒机部署"><i class="fa fa-chevron-left"></i> Jumpserver堡垒机部署</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2018/04/18/linux-dmesg-ming-ling-yong-fa/" rel="prev" title="Linux dmesg命令用法">Linux dmesg命令用法 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"><span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a> <a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/chen.png" alt="Zhongzhou Chen"><p class="site-author-name" itemprop="name">Zhongzhou Chen</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">312</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">84</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">180</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、mysqldump备份结合binlog日志恢复"><span class="nav-text">1、mysqldump备份结合binlog日志恢复</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-binlog介绍"><span class="nav-text">1.1 binlog介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-1-Binlog的用途"><span class="nav-text">1.1.1 Binlog的用途</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-2-开启binary-log功能"><span class="nav-text">1.1.2 开启binary log功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-3-查看二进制日志信息"><span class="nav-text">1.1.3 查看二进制日志信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-4-数据恢复"><span class="nav-text">1.1.4 数据恢复</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-mysqldump介绍"><span class="nav-text">1.2 mysqldump介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-1-方案：mysqldump全库备份-binlog还原"><span class="nav-text">1.2.1 方案：mysqldump全库备份+binlog还原</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-1-1-mysqldump备份方案"><span class="nav-text">1.2.1.1 mysqldump备份方案</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-1-2-备份步骤"><span class="nav-text">1.2.1.2 备份步骤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-1-3-mysqldump备份方案："><span class="nav-text">1.2.1.3 mysqldump备份方案：</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、使用xtrabackup进行MySQL数据库备份"><span class="nav-text">2、使用xtrabackup进行MySQL数据库备份</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-安装xtrabackup"><span class="nav-text">2.1 安装xtrabackup</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-下载xtrabackup"><span class="nav-text">2.1.1 下载xtrabackup</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2-解压"><span class="nav-text">2.1.2 解压</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-3-进入解压目录"><span class="nav-text">2.1.3 进入解压目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-4-复制bin下的所有程序到-usr-bin"><span class="nav-text">2.1.4 复制bin下的所有程序到/usr/bin</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-5-安装相关插件"><span class="nav-text">2.1.5 安装相关插件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-6-下载percona-toolkit并安装"><span class="nav-text">2.1.6 下载percona-toolkit并安装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-使用xtrabackup备份"><span class="nav-text">2.2 使用xtrabackup备份</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-完全备份"><span class="nav-text">2.2.1 完全备份</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-增量备份二进制文件"><span class="nav-text">2.2.2 增量备份二进制文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-xtrabackup还原数据库"><span class="nav-text">2.3 xtrabackup还原数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-1-还原完全备份"><span class="nav-text">2.3.1 还原完全备份</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-2-还原增量备份"><span class="nav-text">2.3.2 还原增量备份</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-3-Xtrabackup的“流”及“备份压缩”功能"><span class="nav-text">2.3.3 Xtrabackup的“流”及“备份压缩”功能</span></a></li></ol></li></ol></li></ol></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Zhongzhou Chen</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">738.6k</span></div><span class="post-meta-divider"></span></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code").find(".line").map(function(t,e){return $(e).text()}).toArray().join("\n"),n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();var o=document.execCommand("copy");document.body.removeChild(n),o?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})</script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><script type="text/javascript" src="/js/src/love.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,log:!1,model:{jsonPath:"/live2dw/assets/shizuku.model.json"},display:{position:"right"},mobile:{show:!0,scale:.5},react:{opacityDefault:.7,opacityOnHover:.2}})</script></body></html><!-- rebuild by neat -->