<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><script></script><meta name="theme-color" content="#222"><style>.pace .pace-progress{background:#1e92fb;height:3px}.pace .pace-progress-inner{box-shadow:0 0 10px #1e92fb,0 0 5px #1e92fb}.pace .pace-activity{border-top-color:#1e92fb;border-left-color:#1e92fb}</style><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="HGM141IpbHrSmnAmR6W_zE4bo9Z3f-yXLeHYT3bg1fk"><meta name="baidu-site-verification" content="code-5Ai1DA8e6T"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="Hadoop,Alluxio,"><link rel="alternate" href="/atom.xml" title="凡间的精灵" type="application/atom+xml"><meta name="description" content="一、Alluxio概览1.1 什么是 AlluxioAlluxio（之前名为 Tachyon）是一个开源的具有内存级速度的虚拟分布式存储系统。它统一了数据访问的方式，为上层计算框架和底层存储系统构建了桥梁。应用只需要连接Alluxio即可访问存储在底层任意存储系统中的数据。此外，Alluxio的以内存为中心的架构使得数据的访问速度能比现有常规方案快几个数量级。在大数据生态系统中，Alluxio 位"><meta name="keywords" content="Hadoop,Alluxio"><meta property="og:type" content="article"><meta property="og:title" content="Alluxio 分布式内存虚拟文件系统"><meta property="og:url" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;index.html"><meta property="og:site_name" content="凡间的精灵"><meta property="og:description" content="一、Alluxio概览1.1 什么是 AlluxioAlluxio（之前名为 Tachyon）是一个开源的具有内存级速度的虚拟分布式存储系统。它统一了数据访问的方式，为上层计算框架和底层存储系统构建了桥梁。应用只需要连接Alluxio即可访问存储在底层任意存储系统中的数据。此外，Alluxio的以内存为中心的架构使得数据的访问速度能比现有常规方案快几个数量级。在大数据生态系统中，Alluxio 位"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%871.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%873.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%874.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%875.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%876.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%872.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%877.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%878.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%879.gif"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%8710.gif"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%8711.gif"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%8712.gif"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%8713.gif"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%8714.gif"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%8715.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%8716.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%8717.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%8718.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%8719.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%8721.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%8722.png"><meta property="og:updated_time" content="2021-12-14T03:39:37.959Z"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;12&#x2F;11&#x2F;alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong&#x2F;%E5%9B%BE%E7%89%871.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"always",offset:12,b2t:!0,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://chenzhonzhou.github.io/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/"><title>Alluxio 分布式内存虚拟文件系统 | 凡间的精灵</title><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">凡间的精灵</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">凡尘落素一精灵</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://chenzhonzhou.github.io/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Zhongzhou Chen"><meta itemprop="description" content=""><meta itemprop="image" content="/images/chen.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="凡间的精灵"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Alluxio 分布式内存虚拟文件系统</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-12-11T14:56:08+08:00">2021-12-11</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Hadoop/" itemprop="url" rel="index"><span itemprop="name">Hadoop</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">12.4k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">47</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="一、Alluxio概览"><a href="#一、Alluxio概览" class="headerlink" title="一、Alluxio概览"></a>一、Alluxio概览</h2><h3 id="1-1-什么是-Alluxio"><a href="#1-1-什么是-Alluxio" class="headerlink" title="1.1 什么是 Alluxio"></a>1.1 什么是 Alluxio</h3><p><strong><a href="https://docs.alluxio.io/os/user/stable/cn/Overview.html" target="_blank" rel="noopener">Alluxio</a>（之前名为 Tachyon）是一个开源的具有内存级速度的虚拟分布式存储系统。</strong>它统一了数据访问的方式，为上层计算框架和底层存储系统构建了桥梁。应用只需要连接Alluxio即可访问存储在底层任意存储系统中的数据。此外，Alluxio的以内存为中心的架构使得数据的访问速度能比现有常规方案快几个数量级。</p><p>在大数据生态系统中，Alluxio 位于数据驱动框架或应用（如 Apache Spark、Presto、Tensorflow、Apache HBase、Apache Hive 或 Apache Flink）和各种持久化存储系统（如 Amazon S3、Google Cloud Storage、OpenStack Swift、HDFS、GlusterFS、IBM Cleversafe、EMC ECS、Ceph、NFS 、Minio和 Alibaba OSS）之间。 Alluxio 统一了存储在这些不同存储系统中的数据，为其上层数据驱动型应用提供统一的客户端 API 和全局命名空间。用户可以以独立集群方式(如Amazon EC2)运行Alluxio，也可以从Apache Mesos或Apache YARN上启动Alluxio。</p><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%871.png" alt="图片1"></p><blockquote><p>Alluxio作为一个内存级的虚拟分布式存储系统有几个常见的使用场景：</p><ul><li>计算层需要反复访问远程（比如在云端，或跨机房）的数据；</li><li>计算层需要同时访问多个独立的持久化数据源（比如同时访问S3和HDFS中的数据）；</li><li>多个独立的大数据应用（比如不同的Spark Job）需要高速有效的共享数据；</li><li>当计算层有着较为严重的内存资源、以及JVM GC压力，或者较高的任务失败率时，Alluxio作为输入输出数据的Off heap存储可以极大缓解这一压力，并使计算消耗的时间和资源更可控可预测。</li></ul><blockquote><p>Alluixo利用的是堆内内存，如果不符合典型场景，用起来就是鸡肋！<br>Ignite是堆外内存，真正加速任务</p></blockquote><p>以上引用原文：<a href="https://www.cnblogs.com/liugh/articles/7324488.html" target="_blank" rel="noopener">https://www.cnblogs.com/liugh/articles/7324488.html</a></p></blockquote><h3 id="1-2-Alluxio的优势"><a href="#1-2-Alluxio的优势" class="headerlink" title="1.2 Alluxio的优势"></a>1.2 Alluxio的优势</h3><p>通过简化应用程序访问其数据的方式（无论数据是什么格式或位置），Alluxio能够帮助克服从数据中提取信息所面临的困难。Alluxio的优势包括：</p><h4 id="1-2-1-内存速度-I-O"><a href="#1-2-1-内存速度-I-O" class="headerlink" title="1.2.1 内存速度 I/O"></a>1.2.1 内存速度 I/O</h4><p>Alluxio 能够用作分布式共享缓存服务，这样与 Alluxio 通信的计算应用程序可以透明地缓存频繁访问的数据（尤其是从远程位置），以提供内存级 I/O 吞吐率。此外，Alluxio的层次化存储机制能够充分利用内存、固态硬盘或者磁盘，降低具有弹性扩张特性的数据驱动型应用的成本开销。</p><h4 id="1-2-2-统一数据访问接口"><a href="#1-2-2-统一数据访问接口" class="headerlink" title="1.2.2 统一数据访问接口"></a>1.2.2 统一数据访问接口</h4><p>Alluxio 能够屏蔽底层持久化存储系统在API、客户端及版本方面的差异，从而使整个系统易于扩展和管理。</p><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%873.png" alt="图片3"></p><ul><li>能够将多个数据源中的数据挂载到Alluxio中</li><li>多个数据源使用统一的命名空间</li><li>用户使用统一的路径访问</li></ul><h4 id="1-2-3-提升远程存储读写性能"><a href="#1-2-3-提升远程存储读写性能" class="headerlink" title="1.2.3 提升远程存储读写性能"></a>1.2.3 提升远程存储读写性能</h4><p>以Hadoop为代表的存储计算紧耦合的传统架构具有优良的计算本地性。通过在邻近所需数据的节点上来部署运行计算任务，可以尽量减少通过网络传输数据，从而有效地提升性能。然而，维持这种紧耦合结构所需要付出的成本代价正逐渐让性能优势带来的意义变得微乎其微。</p><p>Alluxio通过在当前主流的存储计算分离解耦的架构中，提供与紧耦合架构相似甚至更优的性能，来解决解耦后性能降低的难题。推荐把Alluxio与集群的计算框架并置部署（co-locate），从而能够提供靠近计算的跨存储缓存来实现高效本地性。</p><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%874.png" alt="图片4">与传统的架构方案相比，用户需要注意采用Alluxio架构带来的两个关键区别。</p><blockquote><ol><li>Alluxio存储中<strong>不需要保存底层存储中的所有数据</strong>，它只需要保存工作集（WorkingSet）。即使全体数据的规模非常大，Alluxio也不需要大量存储空间来存储所有数据，而是可以在有限的存储空间中只缓存作业所需要的数据。</li><li>Alluxio<strong>存储采用了一种弹性的缓存机制来管理</strong>、使用存储资源。<strong>访问热度越高的数据</strong>（如被很多作业读取的数据表），<strong>会产生越多的副本</strong>，而请求很少甚至没有复用的数据则会被逐渐替换出Alluxio存储层（其在远端存储系统中的副本不会被清除）。而以HDFS为代表的存储系统通常是采用一个固定的副本数目（如3副本），很难根据具体的数据访问热度动态调节存储资源的使用。</li></ol></blockquote><h4 id="1-2-4-数据快速复用与共性"><a href="#1-2-4-数据快速复用与共性" class="headerlink" title="1.2.4 数据快速复用与共性"></a>1.2.4 数据快速复用与共性</h4><p>Alluxio可以帮助实现跨计算、作业间的数据快速复用和共享。</p><p>对于用户应用程序和大数据计算框架来说，Alluxio存储通常与计算框架并置。这种部署方式使Alluxio可以提供快速存储，促进作业之间的数据共享，无论它们是否在同一计算平台上运行。</p><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%875.png" alt="图片5"></p><h4 id="1-2-5-集成机器学习和深度学习"><a href="#1-2-5-集成机器学习和深度学习" class="headerlink" title="1.2.5 集成机器学习和深度学习"></a>1.2.5 集成机器学习和深度学习</h4><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%876.png" alt="图片6"></p><p>机器学习和深度学习框架往往需要从Hadoop或对象存储中提取大规模数据，这通常是手动且非常耗时的过程。通过Alluxio POSIX API克服该问题。</p><p>Alluxio的FUSE功能支持POSIX兼容的API，因此通过Alluxio，TensorFlow、 Caffe等框架以及其他基于Python的模型可以使用传统文件系统的访问方式直接访问任何存储系统中的数据。</p><h3 id="1-3-技术创新"><a href="#1-3-技术创新" class="headerlink" title="1.3 技术创新"></a>1.3 技术创新</h3><p>Alluxio将三个关键领域的创新结合在一起，提供了一套独特的功能。</p><ol><li><strong>全局命名空间</strong>: Alluxio 能够对多个独立存储系统提供单点访问，无论这些存储系统的物理位置在何处。这提供了所有数据源的统一视图和应用程序的标准接口。有关详细信息，请参阅命名空间管理。</li><li><strong>智能多层级缓存</strong>: Alluxio 集群能够充当底层存储系统中数据的读写缓存。可配置自动优化数据放置策略，以实现跨内存和磁盘（SSD/HDD）的性能和可靠性。缓存对用户是透明的，使用缓冲来保持与持久存储的一致性。有关详细信息，请参阅 Alluxio存储管理。</li><li><strong>服务器端 API 翻译转换</strong>: Alluxio支持工业界场景的API接口，例如HDFS API, S3 API, FUSE API, REST API。它能够透明地从标准客户端接口转换到任何存储接口。Alluxio 负责管理应用程序和文件或对象存储之间的通信，从而消除了对复杂系统进行配置和管理的需求。文件数据可以看起来像对象数据，反之亦然。</li></ol><h3 id="1-4-功能简介"><a href="#1-4-功能简介" class="headerlink" title="1.4 功能简介"></a>1.4 功能简介</h3><ul><li>灵活的API</li><li>兼容Haddop 的HDFS文件系统接口</li><li>分级存储，自定义分配和回收策略</li><li>统一命名空间</li><li>完整的命令行</li><li>Web UI</li></ul><h2 id="二、系统架构"><a href="#二、系统架构" class="headerlink" title="二、系统架构"></a>二、系统架构</h2><h3 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h3><p>Alluxio作为大数据和机器学习生态系统中的一个新的数据访问层，配置在任何持久性存储系统(如Amazon S3、Microsoft Azure对象存储、Apache HDFS或OpenStack Swift)和计算框架(如Apache Spark、Presto或Hadoop MapReduce)之间。<strong>请注意，Alluxio不是一个持久化存储系统。</strong>使用Alluxio作为数据访问层有如下好处：</p><ul><li>对于用户应用程序和计算框架，Alluxio提供了快速存储，促进了作业之间的数据共享和局部性，而不管使用的是哪种计算引擎。因此，当数据位于本地时，Alluxio可以以内存速度提供数据;当数据位于Alluxio时，Alluxio可以以计算集群网络的速度提供数据。第一次访问数据时，只从存储系统上读取一次数据。为了得到更好的性能，Alluxio推荐部署在计算集群上。</li><li>对于存储系统，Alluxio弥补了大数据应用与传统存储系统之间的差距，扩大了可用的数据工作负载集。当同时挂载多个数据源时，Alluxio可以作为任意数量的不同数据源的统一层。</li></ul><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%872.png" alt="图片2"></p><p>Alluxio可以分为三个组件：<strong>masters</strong>、<strong>worker</strong>和<strong>clients</strong>。一个典型的集群由一个单一的主要主节点<code>leading masters</code>、备用主节点<code>job master</code>、一个作业主节点<code>standby job masters</code>、备用作业主节点<code>standby job masters</code>、工作节点<code>workers</code>和作业工作节点<code>job workers</code>组成。master 和 worker 进程构成了 Alluxio 服务器，它们是系统管理员需要维护的组件。客户端用于通过 Spark 或 MapReduce 作业、Alluxio CLI 或 Alluxio FUSE 层等应用程序与 Alluxio 服务器通信。</p><p>Alluxio Job Masters 和 Job Workers 可以分离成一个单独的功能，称为 <strong>Job Service</strong>。Alluxio Job Service 是一个轻量级的任务调度框架，负责为 Job Workers 分配许多不同类型的操作。这些任务包括</p><ul><li>从 UFS 加载数据到 Alluxio</li><li>将数据持久化到 UFS</li><li>在 Alluxio 中复制文件</li><li>在 UFS 或 Alluxio 位置之间移动或复制数据</li></ul><p><strong>Job Service</strong>的设计使得所有与作业相关的进程不一定需要位于 Alluxio 集群的其余部分。但是，我们确实建议job worker 与相应的 Alluxio worker 位于同一位置，因为它为 RPC 和数据传输提供了更低的延迟。</p><h3 id="2-2-Mstaers"><a href="#2-2-Mstaers" class="headerlink" title="2.2 Mstaers"></a>2.2 Mstaers</h3><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%877.png" alt="图片7"></p><p>Alluxio 包含两种不同类型的主进程。<strong>Alluxio Master</strong> 为所有用户请求和日志文件系统元数据更改提供服务。<strong>Alluxio Job Master</strong>是作为文件系统操作的轻量级调度程序。</p><p>为了<strong>容错，Alluxio Master</strong>可以部署为一个主master和多个备用master。当主master节点宕机时，会选举一个备用master节点成为新的主master节点。</p><h4 id="2-2-1-主master"><a href="#2-2-1-主master" class="headerlink" title="2.2.1 主master"></a>2.2.1 主master</h4><p>Alluxio中只有一个master进程为主master。主master用于管理全局的元数据。这里面包含文件系统元数据（文件系统 inode 树）、数据块元数据（数据块位置）、以及worker的容量元数据（空闲或已占用空间）。Alluxio clients与主master通信用来读取或修改元数据。所有的worker都会定期的向主master发送心跳。主master会在一个分布式的持久化系统上记录所有的文件系统事务，这样可以恢复主master的信息。这组日志被称为journal。</p><h4 id="2-2-2-备用master"><a href="#2-2-2-备用master" class="headerlink" title="2.2.2 备用master"></a>2.2.2 备用master</h4><p>备用master读取主master写入的journal日志，以保持与主master的状态同步。它们会对journal日志写入检查点，用于快速恢复。它们不处理来自Alluxio组件的任何请求。</p><h4 id="2-2-3-Secondary-Masters-for-UFS-journal"><a href="#2-2-3-Secondary-Masters-for-UFS-journal" class="headerlink" title="2.2.3 Secondary Masters (for UFS journal)"></a>2.2.3 Secondary Masters (for UFS journal)</h4><p>当使用 UFS 日志在没有 HA 模式的情况下运行单个 Alluxio master 时，可以在与主要 master 相同的服务器上启动辅助 master 来写入日志检查点。请注意，辅助 master 并非旨在提供高可用性，而是从主要 master 卸载工作以实现快速恢复。与备用 Master 不同，从属 Master 永远无法升级为领先的 Master。</p><h4 id="2-2-4-Job-Masters"><a href="#2-2-4-Job-Masters" class="headerlink" title="2.2.4 Job Masters"></a>2.2.4 Job Masters</h4><p>Alluxio Job Master 是一个独立的进程，负责在 Alluxio 中异步调度多个重量级文件系统操作。通过分离领先的 Alluxio Master 在同一进程中执行这些操作，Alluxio Master 使用更少的资源，并能够在更短的时间内为更多的客户端提供服务。此外，它还为将来添加更复杂的操作提供了一个可扩展的框架。</p><h3 id="2-3-Workers"><a href="#2-3-Workers" class="headerlink" title="2.3 Workers"></a>2.3 Workers</h3><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%878.png" alt="图片8"></p><h4 id="2-3-1-Alluxio-Workers"><a href="#2-3-1-Alluxio-Workers" class="headerlink" title="2.3.1 Alluxio Workers"></a>2.3.1 Alluxio Workers</h4><p>Alluxio Workers 负责管理分配给 Alluxio 的用户可配置的本地资源（例如内存、SSD、HDD）。Alluxio Worker将数据存储为块，并通过在其本地资源中读取或创建新块来响应 client 请求。Workers 只用于管理数据块；从文件到块的实际映射仅由 master 存储。</p><p>Worker 在底层存储上执行数据操作。这带来了两个重要的好处：</p><ul><li>从底层存储读取的数据可以存储在 worker 中，并立即可供其他 client 使用。</li><li>client 可以是轻量级的，并且不依赖于底层存储连接器。</li></ul><p>由于 RAM 通常提供的容量有限，因此当空间已满时，可以逐出 worker 中的块。工作人员采用驱逐策略来决定将哪些数据保留在 Alluxio 空间中。有关此主题的更多信息，请查看<a href="https://docs.alluxio.io/os/user/stable/en/core-services/Caching.html#multiple-tier-storage" target="_blank" rel="noopener">分层存储</a>的文档。</p><h4 id="2-3-2-Alluxio-Job-Workers"><a href="#2-3-2-Alluxio-Job-Workers" class="headerlink" title="2.3.2 Alluxio Job Workers"></a>2.3.2 Alluxio Job Workers</h4><p>Alluxio Job Workers 是 Alluxio 文件系统的客户端。他们负责运行 Alluxio Job Master 交给他们的任务。Job Workers 接收指令以在任何给定的文件系统位置上运行加载、持久化、复制、移动或复制操作。</p><p>Alluxio job workers 不一定要与普通 workers 位于同一位置，但建议两者在同一个物理节点上。</p><h3 id="2-4-Client"><a href="#2-4-Client" class="headerlink" title="2.4 Client"></a>2.4 Client</h3><p>Alluxio Client 为用户提供了一个与 Alluxio 服务器交互的网关。它发起与 leading master 通信以执行元数据操作，并与 worker 通信以读取和写入存储在 Alluxio 中的数据。Alluxio 支持 Java 中的本机文件系统 API 和多种语言（包括 REST、Go 和 Python）。Alluxio 还支持与 HDFS API 和 Amazon S3 API 兼容的 API。</p><p>请注意，Alluxio Client 从不直接访问底层存储系统。数据通过 Alluxio Workers 传输。</p><p><strong>alluxio服务的几个组件功能总结</strong></p><blockquote><table><thead><tr><th>组件名称</th><th>作用</th></tr></thead><tbody><tr><td>Master</td><td>1.管理全局的元数据信息（包括目录树(inode tree)，块信息(block)，worker的容量信息)；2.worker发送心跳；3.client获取元数据</td></tr><tr><td>SecondaryMaster</td><td>1.读取主master写入的journal日志，以保持与主master的状态同步；2.对journal日志写入检查点，用于快速恢复；3.不处理来自Alluxio组件的任何请求</td></tr><tr><td>JobMaster</td><td>1.负责在Alluxio中异步调度许多重量级文件系统操作，提高master吞吐量；2.为后期复杂操作提供扩展性</td></tr><tr><td>Worker</td><td>1.底层数据存储在worker中供客户端使用；2.alluxio客户端不依赖底层存储</td></tr><tr><td>JobWorker</td><td>执行job master分配的任务，建议与worker放在同一节点上</td></tr><tr><td>Client</td><td>集成到其他计算框架中，调用Alluxio leading master以执行元数据操作，与 workers 通信以读取和写入存储在 Alluxio 中的数据</td></tr></tbody></table></blockquote><h3 id="2-5-读数据流"><a href="#2-5-读数据流" class="headerlink" title="2.5 读数据流"></a>2.5 读数据流</h3><p>Alluxio 位于底层存储和计算框架之间，充当数据读取的缓存层。</p><h4 id="2-5-1-本地缓存命中"><a href="#2-5-1-本地缓存命中" class="headerlink" title="2.5.1 本地缓存命中"></a>2.5.1 本地缓存命中</h4><p>本地缓存命中发生在请求数据位于本地Alluxio worker。举例说明，如果一个应用通过Alluxio client请求数据，client向Alluxio master请求数据所在的worker。如果数据在本地可用，Alluxio client使用<code>短路</code>读取来绕过Alluxio worker，并直接通过本地文件系统读取文件。短路读取避免通过TCP套接字传输数据，并提供数据的直接访问。</p><p>还要注意，Alluxio可以管理除了内存之外还可以管理其他存储介质（例如SSD、HDD），因此本地数据访问速度可能会因本地存储介质的不同而有所不同。</p><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%879.gif" alt="图片9"></p><h4 id="2-5-2-远程缓存命中"><a href="#2-5-2-远程缓存命中" class="headerlink" title="2.5.2 远程缓存命中"></a>2.5.2 远程缓存命中</h4><p>当请求的数据存储在Alluxio中，而不是存储在client的本地worker上时，client将对具有数据的worker进行远程读取。client完成读取后，会要求本地的worker（如果存在）创建一个copy，这样以后读取的时候可以在本地读取相同的数据。远程缓存命中提供了网络级别速度的数据读取。Alluxio优先从远程worker读取数据，而不是从底层存储，因为Alluxio workers之间的速度一般会快过Alluxio workers和底层存储的速度。</p><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%8710.gif" alt="图片10"></p><h4 id="2-5-3-缓存Miss"><a href="#2-5-3-缓存Miss" class="headerlink" title="2.5.3 缓存Miss"></a>2.5.3 缓存Miss</h4><p>如果数据在 Alluxio 中找不到，则会发生缓存未命中，应用程序将不得不从底层存储中读取数据。Alluxio client 将读取从 UFS 委托给worker（有限本地worker）。该worker从底层存储中读取和缓存数据。缓存未命中通常会导致最大的延迟，因为必须从底层存储中获取数据。首次读取数据时预计会发生缓存未命中。</p><p>当 client 仅读取块的一部分或非顺序读取块时，client 将指示worker异步缓存完整个块。这称为异步缓存。异步缓存不会阻塞client，但如果 Alluxio 和底层存储系统之间的网络带宽成为瓶颈，仍然可能会影响性能。您可以通过<code>alluxio.worker.network.async.cache.manager.threads.max</code>对worker进行设置来调整异步缓存的影响 。默认值为<code>8</code>。</p><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%8711.gif" alt="图片11"></p><h4 id="2-5-4-缓存跳过"><a href="#2-5-4-缓存跳过" class="headerlink" title="2.5.4 缓存跳过"></a>2.5.4 缓存跳过</h4><p>可以通过将<a href="https://docs.alluxio.io/os/user/stable/en/reference/Properties-List.html#alluxio.user.file.readtype.default" target="_blank" rel="noopener"><code>alluxio.user.file.readtype.default</code></a> client中的属性设置为 <code>NO_CACHE</code> 来关闭 Alluxio 中的缓存。</p><h3 id="2-6-写数据流"><a href="#2-6-写数据流" class="headerlink" title="2.6 写数据流"></a>2.6 写数据流</h3><p>用户可以通过选择不同的写入类型来配置数据的写入方式。写入类型可以通过 Alluxio API 或通过配置属性 <a href="https://docs.alluxio.io/os/user/stable/en/reference/Properties-List.html#alluxio.user.file.writetype.default" target="_blank" rel="noopener"><code>alluxio.user.file.writetype.default</code></a> 来设置写入类型。</p><h4 id="2-6-1-仅写入-Alluxio-MUST-CACHE"><a href="#2-6-1-仅写入-Alluxio-MUST-CACHE" class="headerlink" title="2.6.1 仅写入 Alluxio ( MUST_CACHE)"></a>2.6.1 仅写入 Alluxio ( <code>MUST_CACHE</code>)</h4><p>当写类型设置为MUST_CACHE，Alluxio client将数据写入本地Alluxio worker，而不会写入到底层存储。如果<code>短路</code>写可用，Alluxio client直接写入到本地RAM的文件，绕过Alluxio worker 避免网络传输。由于数据没有持久存储在under storage中，因此如果机器崩溃或需要释放数据以进行更新的写操作，数据可能会丢失。当可以容忍数据丢失时，MUST_CACHE 设置可用于写入临时数据。</p><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%8712.gif" alt="图片12"></p><h4 id="2-6-2-直写到-UFS-CACHE-THROUGH"><a href="#2-6-2-直写到-UFS-CACHE-THROUGH" class="headerlink" title="2.6.2 直写到 UFS ( CACHE_THROUGH)"></a>2.6.2 直写到 UFS ( <code>CACHE_THROUGH</code>)</h4><p>使用CACHE_THROUGH写类型，数据同步写入Alluxio worker和底层存储系统。Alluxio client将写操作委托给本地worker，而worker同时将对本地内存和底层存储。由于底层存储的写入速度通常比本地存储慢，所以client的写入速度将与底层存储的速度相匹配。当需要数据持久化时，建议使用CACHE_THROUGH写类型。在本地还存了一份副本，以便可以直接从本地内存中读取数据。</p><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%8713.gif" alt="图片13"></p><h4 id="2-6-3-写回-UFS-ASYNC-THROUGH"><a href="#2-6-3-写回-UFS-ASYNC-THROUGH" class="headerlink" title="2.6.3 写回 UFS ( ASYNC_THROUGH)"></a>2.6.3 写回 UFS ( <code>ASYNC_THROUGH</code>)</h4><p>Alluxio 提供了一种写类型<code>ASYNC_THROUGH</code>. 使用<code>ASYNC_THROUGH</code>，数据首先被同步写入一个 Alluxio worker，并在后台持久化到 under storage。<code>ASYNC_THROUGH</code>可以以接近 <code>MUST_CACHE</code> 的速度提供数据写入，同时仍然能够持久保存数据。从 Alluxio 2.0 开始， <code>ASYNC_THROUGH</code>是默认的写入类型。</p><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%8714.gif" alt="图片14"></p><p>为了提供容错，使用的一个重要属性<code>ASYNC_THROUGH</code>是 <code>alluxio.user.file.replication.durable</code> 该属性设置了Alluxio在写入完成后数据持久化到under storage之前的新数据的目标复制级别，默认值为1。Alluxio将在后台持久化进程完成之前保持文件的目标复制级别，并且之后回收Alluxio中的空间，因此数据只会写入UFS一次。</p><p>如果您正在写入副本<code>ASYNC_THROUGH</code>并且所有具有副本的worker在您保存数据之前崩溃，那么您将导致数据丢失。</p><h4 id="2-6-4-仅写入-UFS-THROUGH"><a href="#2-6-4-仅写入-UFS-THROUGH" class="headerlink" title="2.6.4 仅写入 UFS ( THROUGH)"></a>2.6.4 仅写入 UFS ( <code>THROUGH</code>)</h4><p>使用<code>THROUGH</code>，数据被同步写入under storage，而不会缓存到Alluxio worker。这种写类型保证了写完成后数据会持久化，但是速度受限于under storage的吞吐量。</p><h4 id="2-6-5-数据一致性"><a href="#2-6-5-数据一致性" class="headerlink" title="2.6.5 数据一致性"></a>2.6.5 数据一致性</h4><p>无论写入类型如何，<strong>Alluxio 空间</strong>中的文件/目录始终是强一致的，因为所有这些写入操作都将首先通过 Alluxio master 并在将成功返回给客户端/应用程序之前修改 Alluxio 文件系统。因此，只要其对应的写操作成功完成，不同的 Alluxio 客户端将始终看到最新的更新。</p><p>但是，对于考虑 UFS 中状态的用户或应用程序，它可能因写入类型而异：</p><ul><li><code>MUST_CACHE</code> 不向 UFS 写入数据，因此 Alluxio 空间永远不会与 UFS 保持一致。</li><li>CACHE_THROUGH 在将成功返回给应用程序之前，将数据同步写入 Alluxio 和 UFS。<ul><li>如果写入UFS也是强一致性（例如HDFS），如果UFS中没有其他带外更新，Alluxio空间将始终与UFS一致；</li><li>如果写入 UFS 最终一致（例如 S3），则文件可能成功写入 Alluxio，但稍后会显示在 UFS 中。在这种情况下，Alluxio 客户端仍然会看到一致的文件系统，因为他们总是会咨询强一致性的 Alluxio master；因此，尽管不同的 Alluxio 客户端仍然在 Alluxio 空间中看到一致的状态，但在数据最终传播到 UFS 之前可能会有一个不一致的窗口。</li></ul></li><li><code>ASYNC_THROUGH</code>将数据写入 Alluxio 并返回到应用程序，让 Alluxio 将数据异步传播到 UFS。从用户的角度来看，该文件可以成功写入Alluxio，但稍后会在UFS中持久化。</li><li><code>THROUGH</code>直接将数据写入 UFS，无需在 Alluxio 中缓存数据，但是，Alluxio 知道文件及其状态。因此元数据仍然是一致的。</li></ul><blockquote><table><thead><tr><th>策略</th><th>注释</th></tr></thead><tbody><tr><td>MUST_CACHE</td><td>只写入缓存</td></tr><tr><td>CACHE_THROUGH</td><td>同步写入缓存和底层存储系统</td></tr><tr><td>ASYNC_THROUGH</td><td>异步写入缓存和底层存储系统，调用jobmaster和jobworker完成</td></tr><tr><td>THROUGH</td><td>只写入底层存储</td></tr></tbody></table></blockquote><h2 id="三、核心功能"><a href="#三、核心功能" class="headerlink" title="三、核心功能"></a>三、核心功能</h2><h3 id="3-1-Alluxio存储概述"><a href="#3-1-Alluxio存储概述" class="headerlink" title="3.1 Alluxio存储概述"></a>3.1 Alluxio存储概述</h3><p>Alluxio在帮助统一跨各种平台用户数据的同时还有助于为用户提升总体I/O吞吐量。 Alluxio是通过把存储分为两个不同的类别来实现这一目标的。</p><ul><li><strong>UFS（底层文件存储，也称为底层存储）</strong>该存储空间代表不受Alluxio管理的空间。 UFS存储可能来自外部文件系统，包括如HDFS或S3。 Alluxio可能连接到一个或多个UFS并在一个命名空间中统一呈现这类底层存储。 -通常，UFS存储旨在相当长一段时间持久存储大量数据。</li><li>Alluxio存储<ul><li>Alluxio做为一个分布式缓存来管理Alluxio workers本地存储，包括内存。这个在用户应用程序与各种底层存储之间的快速数据层带来的是显著提高的I/O性能；</li><li>Alluxio存储主要用于存储热数据，暂态数据，而不是长期持久数据存储；</li><li>每个Alluxio节点要管理的存储量和类型由用户配置决定；</li><li>即使数据当前不在Alluxio存储中，通过Alluxio连接的UFS中的文件仍然对Alluxio客户可见。当客户端尝试读取仅可从UFS获得的文件时数据将被复制到Alluxio存储中。</li></ul></li></ul><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%8715.png" alt="图片15"></p><p>Alluxio存储通过将数据存储在计算节点内存中来提高性能。 Alluxio存储中的数据可以被复制来形成“热”数据，更易于I/O并行操作和使用。</p><p>Alluxio中的数据副本独立于UFS中可能已存在的副本。 Alluxio存储中的数据副本数是由集群活动动态决定的。 由于Alluxio依赖底层文件存储来存储大部分数据， Alluxio不需要保存未使用的数据副本。</p><p>Alluxio还支持让系统存储软件可感知的分层存储，使类似L1/L2 CPU缓存一样的数据存储优化成为可能。</p><h3 id="3-2-配置Alluxio存储"><a href="#3-2-配置Alluxio存储" class="headerlink" title="3.2 配置Alluxio存储"></a>3.2 配置Alluxio存储</h3><h4 id="3-2-1-单层存储"><a href="#3-2-1-单层存储" class="headerlink" title="3.2.1 单层存储"></a>3.2.1 单层存储</h4><p>配置Alluxio存储的最简单方法是使用默认的单层模式。</p><p>请注意，此部分是讲本地存储，诸如<code>mount</code>之类的术语指在本地存储文件系统上挂载，不要与Alluxio的外部底层存储的<code>mount</code>概念混淆。</p><p>在启动时，Alluxio将在每个worker节点上发放一个ramdisk并占用一定比例的系统的总内存。 此ramdisk将用作分配给每个Alluxio worker的唯一存储介质。</p><p>通过Alluxio配置中的<code>alluxio-site.properties</code>来配置Alluxio存储。 详细信息见<a href="https://docs.alluxio.io/os/user/stable/en/operation/Configuration.html" target="_blank" rel="noopener">configuration settings</a>。</p><p>对默认值的常见修改是明确设置ramdisk的大小。 例如，设置每个worker的ramdisk大小为16GB：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">alluxio.worker.ramdisk.size</span>=<span class="string">16GB</span></span><br></pre></td></tr></table></figure><p>另一个常见更改是指定多个存储介质，例如ramdisk和SSD。 需要 更新<code>alluxio.worker.tieredstore.level0.dirs.path</code>以指定想用的每个存储介质 为一个相应的存储目录。 例如，要使用ramdisk(挂载在<code>/mnt/ramdisk</code>上)和两个SSD(挂载在<code>/mnt/ssd1</code>和<code>/mnt/ssd2</code>):</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">alluxio.worker.tieredstore.level0.dirs.path</span>=<span class="string">/mnt/ramdisk,/mnt/ssd1,/mnt/ssd2</span></span><br><span class="line"><span class="meta">alluxio.worker.tieredstore.level0.dirs.mediumtype</span>=<span class="string">MEM,SSD,SSD</span></span><br></pre></td></tr></table></figure><p>请注意，介质类型的顺序必须与路径的顺序相符。 MEM和SSD是Alluxio中的两种预配置存储类型。 <code>alluxio.master.tieredstore.global.mediumtype</code>是包含所有可用的介质类型的配置参数，默认情况下设置为<code>MEM，SSD，HDD</code>。 如果用户有额外存储介质类型可以通过修改这个配置来增加。</p><p>提供的路径应指向挂载适当存储介质的本地文件系统中的路径。 为了实现短路操作，对于这些路径，应允许客户端用户在这些路径上进行读取，写入和执行。 例如，对于与启动Alluxio服务的用户组同组用户应给予<code>770</code>权限。</p><p>更新存储介质后，需要指出每个存储目录分配了多少存储空间。 例如，如果要在ramdisk上使用16 GB，在每个SSD上使用100 GB：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">alluxio.worker.tieredstore.level0.dirs.quota</span>=<span class="string">16GB,100GB,100GB</span></span><br></pre></td></tr></table></figure><p>注意存储空间配置的顺序一定与存储目录的配置相符。</p><p>Alluxio在通过<code>Mount</code>或<code>SudoMount</code>选项启动时，配置并挂载ramdisk。 这个ramdisk大小是由<code>alluxio.worker.ramdisk.size</code>确定的。 默认情况下，tier 0设置为MEM并且管理整个ramdisk。 此时<code>alluxio.worker.tieredstore.level0.dirs.quota</code>的值同<code>alluxio.worker.ramdisk.size</code>一样。 如果tier0要使用除默认的ramdisk以外的设备，应该显式地设置<code>alluxio.worker.tieredstore.level0.dirs.quota</code>选项。</p><h4 id="3-2-2-多层存储"><a href="#3-2-2-多层存储" class="headerlink" title="3.2.2 多层存储"></a>3.2.2 多层存储</h4><p>通常建议异构存储介质也使用单个存储层。 在特定环境中，工作负载将受益于基于I/O速度存储介质明确排序。 Alluxio假定根据按I/O性能从高到低来对多层存储进行排序。 例如，用户经常指定以下层：</p><ul><li>MEM(内存)</li><li>SSD(固态存储)</li><li>HDD(硬盘存储)</li></ul><h5 id="3-2-2-1-写数据"><a href="#3-2-2-1-写数据" class="headerlink" title="3.2.2.1 写数据"></a>3.2.2.1 写数据</h5><p>用户写新的数据块时，默认情况下会将其写入顶层存储。如果顶层没有足够的可用空间， 则会尝试下一层存储。如果在所有层上均未找到存储空间，因Alluxio的设计是易失性存储，Alluxio会释放空间来存储新写入的数据块。 根据块注释策略，空间释放操作会从work中释放数据块。 <a href="https://docs.alluxio.io/os/user/stable/cn/core-services/Caching.html#block-annotation-policies" target="_blank" rel="noopener">块注释策略</a>。 如果空间释放操作无法释放新空间，则写数据将失败。</p><p><strong>注意：</strong>新的释放空间模型是同步模式并会代表要求为其要写入的数据块释放新空白存储空间的客户端来执行释放空间操作。 在块注释策略的帮助下，同步模式释放空间不会引起性能下降，因为总有已排序的数据块列表可用。 然而，可以将<code>alluxio.worker.tieredstore.free.ahead.bytes</code>(默认值：0)配置为每次释放超过释放空间请求所需字节数来保证有多余的已释放空间满足写数据需求。</p><p>用户还可以通过<a href="https://docs.alluxio.io/os/user/stable/cn/core-services/Caching.html#configuring-tiered-storage" target="_blank" rel="noopener">configuration settings</a>来指定写入数据层。</p><h5 id="3-2-2-2-读取数据"><a href="#3-2-2-2-读取数据" class="headerlink" title="3.2.2.2 读取数据"></a>3.2.2.2 读取数据</h5><p>如果数据已经存在于Alluxio中，则客户端将简单地从已存储的数据块读取数据。 如果将Alluxio配置为多层，则不一定是从顶层读取数据块， 因为数据可能已经透明地挪到更低的存储层。</p><p>用<code>ReadType.CACHE_PROMOTE</code>读取数据将在从worker读取数据前尝试首先将数据块挪到顶层存储。也可以将其用作为一种数据管理策略 明确地将热数据移动到更高层存储读取。</p><h5 id="3-2-2-3-配置分层存储"><a href="#3-2-2-3-配置分层存储" class="headerlink" title="3.2.2.3 配置分层存储"></a>3.2.2.3 配置分层存储</h5><p>可以使用以下方式在Alluxio中启用分层存储 <a href="https://docs.alluxio.io/os/user/stable/en/operation/Configuration.html" target="_blank" rel="noopener">配置参数</a>。 为Alluxio指定额外存储层，使用以下配置参数：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">alluxio.worker.tieredstore.levels</span></span><br><span class="line"><span class="attr">alluxio.worker.tieredstore.level&#123;x&#125;.alias</span></span><br><span class="line"><span class="attr">alluxio.worker.tieredstore.level&#123;x&#125;.dirs.quota</span></span><br><span class="line"><span class="attr">alluxio.worker.tieredstore.level&#123;x&#125;.dirs.path</span></span><br><span class="line"><span class="attr">alluxio.worker.tieredstore.level&#123;x&#125;.dirs.mediumtype</span></span><br></pre></td></tr></table></figure><p>例如，如果计划将Alluxio配置为具有两层存储，内存和硬盘存储， 可以使用类似于以下的配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># configure 2 tiers in Alluxio</span></span><br><span class="line"><span class="meta">alluxio.worker.tieredstore.levels</span>=<span class="string">2</span></span><br><span class="line"><span class="comment"># the first (top) tier to be a memory tier</span></span><br><span class="line"><span class="meta">alluxio.worker.tieredstore.level0.alias</span>=<span class="string">MEM</span></span><br><span class="line"><span class="comment"># defined `/mnt/ramdisk` to be the file path to the first tier</span></span><br><span class="line"><span class="meta">alluxio.worker.tieredstore.level0.dirs.path</span>=<span class="string">/mnt/ramdisk</span></span><br><span class="line"><span class="comment"># defined MEM to be the medium type of the ramdisk directory</span></span><br><span class="line"><span class="meta">alluxio.worker.tieredstore.level0.dirs.mediumtype</span>=<span class="string">MEM</span></span><br><span class="line"><span class="comment"># set the quota for the ramdisk to be `100GB`</span></span><br><span class="line"><span class="meta">alluxio.worker.tieredstore.level0.dirs.quota</span>=<span class="string">100GB</span></span><br><span class="line"><span class="comment"># configure the second tier to be a hard disk tier</span></span><br><span class="line"><span class="meta">alluxio.worker.tieredstore.level1.alias</span>=<span class="string">HDD</span></span><br><span class="line"><span class="comment"># configured 3 separate file paths for the second tier</span></span><br><span class="line"><span class="meta">alluxio.worker.tieredstore.level1.dirs.path</span>=<span class="string">/mnt/hdd1,/mnt/hdd2,/mnt/hdd3</span></span><br><span class="line"><span class="comment"># defined HDD to be the medium type of the second tier</span></span><br><span class="line"><span class="meta">alluxio.worker.tieredstore.level1.dirs.mediumtype</span>=<span class="string">HDD,HDD,HDD</span></span><br><span class="line"><span class="comment"># define the quota for each of the 3 file paths of the second tier</span></span><br><span class="line"><span class="meta">alluxio.worker.tieredstore.level1.dirs.quota</span>=<span class="string">2TB,5TB,500GB</span></span><br></pre></td></tr></table></figure><p>可配置层数没有限制 但是每个层都必须使用唯一的别名进行标识。 典型的配置将具有三层，分别是内存，SSD和HDD。 要在HDD层中使用多个硬盘存储，需要在配置<code>alluxio.worker.tieredstore.level{x}.dirs.path</code>时指定多个路径。</p><h4 id="3-2-3-块注释策略"><a href="#3-2-3-块注释策略" class="headerlink" title="3.2.3 块注释策略"></a>3.2.3 块注释策略</h4><p>Alluxio从v2.3开始使用块注释策略来维护存储中数据块的严格顺序。 注释策略定义了跨层块的顺序，并在以下操作过程中进行用来参考: -释放空间 -<a href="https://docs.alluxio.io/os/user/stable/cn/core-services/Caching.html#block-aligning-dynamic-block-placement" target="_blank" rel="noopener">动态块放置</a>。</p><p>与写操作同步发生的释放空间操作将尝试根据块注释策略强制顺序删除块并释放其空间给写操作。注释顺序的最后一个块是第一个释放空间候选对象，无论它位于哪个层上。</p><p>开箱即用的注释策略实施包括:</p><ul><li><strong>LRUAnnotator：</strong>根据最近最少使用的顺序对块进行注释和释放。 <strong>这是Alluxio的默认注释策略</strong>。</li><li><strong>LRFUAnnotator：</strong>根据配置权重的最近最少使用和最不频繁使用的顺序对块进行注释。<ul><li>如果权重完全偏设为最近最少使用，则行为将 与LRUAnnotator相同。</li><li>适用的配置属性包括<code>alluxio.worker.block.annotator.lrfu.step.factor</code> <code>alluxio.worker.block.annotator.lrfu.attenuation.factor</code>。</li></ul></li></ul><p>workers选择使用的注释策略由Alluxio属性 <a href="https://docs.alluxio.io/os/user/stable/en/reference/Properties-List.html#alluxio.worker.block.annotator.class" target="_blank" rel="noopener">alluxio.worker.block.annotator.class</a>决定。 该属性应在配置中指定完全验证的策略名称。当前可用的选项有:</p><ul><li><code>alluxio.worker.block.annotator.LRUAnnotator</code></li><li><code>alluxio.worker.block.annotator.LRFUAnnotator</code></li></ul><h5 id="3-2-3-1-释放空间模拟"><a href="#3-2-3-1-释放空间模拟" class="headerlink" title="3.2.3.1 释放空间模拟"></a>3.2.3.1 释放空间模拟</h5><p>旧的释放空间策略和Alluxio提供的实施现在已去掉了，并用适当的注释策略替换。 配置旧的Alluxio释放空间策略将导致worker启动失败，并报错<code>java.lang.ClassNotFoundException</code>。 同样，旧的基于水位标记配置已失效。因此，以下配置选项是无效的:</p><ul><li><code>alluxio.worker.tieredstore.levelX.watermark.low.ratio</code></li><li><code>alluxio.worker.tieredstore.levelX.watermark.high.ratio</code></li></ul><p>然而，Alluxio支持基于自定义释放空间实施算法数据块注释的仿真模式。该仿真模式假定已配置的释放空间策略创建一个基于某种顺序释放空间的计划，并通过定期提取这种自定义顺序来支持块注释活动。</p><p>旧的释放空间配置应进行如下更改。 (由于旧的释放空间实施已删除，如未能更改基于旧实施的以下配置就会导致class加载错误。)</p><p>-LRUEvictor-&gt; LRUAnnotator -GreedyEvictor-&gt; LRUAnnotator -PartialLRUEvictor-&gt; LRUAnnotator -LRFUEvictor-&gt; LRFUAnnotator</p><h4 id="3-2-4-分层存储管理"><a href="#3-2-4-分层存储管理" class="headerlink" title="3.2.4 分层存储管理"></a>3.2.4 分层存储管理</h4><p>因为块分配/释放不再强制新的写入必须写到特定存储层，新数据块可能最终被写到任何已配置的存储层中。这样允许写入超过Alluxio存储容量的数据。但是，这就需要Alluxio动态管理块放置。 为了确保层配置为从最快到最慢的假设，Alluxio会基于块注释策略在各层存储之间移动数据块。</p><p>每个单独层管理任务都遵循以下配置:</p><ul><li><code>alluxio.worker.management.task.thread.count</code>:管理任务所用线程数。 (默认值:CPU核数)</li><li><code>alluxio.worker.management.block.transfer.concurrency.limit</code>:可以同时执行多少个块传输。 (默认:<code>CPU核数</code>/2)</li></ul><h5 id="3-2-4-1-块对齐-动态块放置"><a href="#3-2-4-1-块对齐-动态块放置" class="headerlink" title="3.2.4.1 块对齐(动态块放置)"></a>3.2.4.1 块对齐(动态块放置)</h5><p>Alluxio将动态地跨层移动数据块，以使块组成与配置的块注释策略一致。</p><p>为辅助块对齐，Alluxio会监视I/O模式并会跨层重组数据块，以确保 <strong>较高层的最低块比下面层的最高块具有更高的次序</strong>。</p><p>这是通过“对齐”这个管理任务来实现的。此管理任务在检测到层之间 顺序已乱时，会通过在层之间交换块位置来有效地将各层与已配置的注释策略对齐以消除乱序。 有关如何控制这些新的后台任务对用户I/O的影响，参见<a href="https://docs.alluxio.io/os/user/stable/cn/core-services/Caching.html#management-task-back-off" target="_blank" rel="noopener">管理任务推后</a>部分。</p><p>用于控制层对齐:</p><ul><li><code>alluxio.worker.management.tier.align.enabled</code>:是否启用层对齐任务。 (默认: <code>true</code>)</li><li><code>alluxio.worker.management.tier.align.range</code>:单个任务运行中对齐多少个块。 (默认值:<code>100</code>)</li><li><code>alluxio.worker.management.tier.align.reserved.bytes</code>:配置多层时，默认情况下在所有目录上保留的空间大小。 (默认:1GB) 用于内部块移动。</li><li><code>alluxio.worker.management.tier.swap.restore.enabled</code>:控制一个特殊任务，该任务用于在内部保留空间用尽时unblock层对齐。 (默认:true) 由于Alluxio支持可变的块大小，因此保留空间可能会用尽，因此，当块大小不匹配时在块对齐期间在层之间块交换会导致一个目录保留空间的减少。</li></ul><h5 id="3-2-4-2-块升级"><a href="#3-2-4-2-块升级" class="headerlink" title="3.2.4.2 块升级"></a>3.2.4.2 块升级</h5><p>当较高层具有可用空间时，低层的块将向上层移动，以便更好地利用较快的磁盘介质，因为假定较高的层配置了较快的磁盘介质。</p><p>用于控制动态层升级:</p><ul><li><code>alluxio.worker.management.tier.promote.enabled</code>:是否启用层升级任务。 (默认: <code>true</code>)</li><li><code>alluxio.worker.management.tier.promote.range</code>:单个任务运行中升级块数。 (默认值:<code>100</code>)</li><li><code>alluxio.worker.management.tier.promote.quota.percent</code>:每一层可以用于升级最大百分比。 一旦其已用空间超过此值，向此层升级将停止。 (0表示永不升级，100表示总是升级。)</li></ul><h5 id="3-2-4-3-管理任务推后"><a href="#3-2-4-3-管理任务推后" class="headerlink" title="3.2.4.3 管理任务推后"></a>3.2.4.3 管理任务推后</h5><p>层管理任务(对齐/升级)会考虑用户I/O并在worker/disk重载情况下推后运行。 这是为了确保内部管理任务不会对用户I/O性能产生负面影响。</p><p>可以在<code>alluxio.worker.management.backoff.strategy</code>属性中设置两种可用的推后类型，分别是Any和DIRECTORY。</p><ul><li><code>ANY</code>; 当有任何用户I/O时，worker管理任务将推后。 此模式将确保较低管理任务开销，以便提高即时用户I/O性能。 但是，管理任务要取得进展就需要在worker上花更长的时间。</li><li><code>DIRECTORY</code>; 管理任务将从有持续用户I/O的目录中推后。 此模式下管理任务更易取得进展。 但是，由于管理任务活动的增加，可能会降低即时用户I/O吞吐量。</li></ul><p>影响这两种推后策略的另一个属性是<code>alluxio.worker.management.load.detection.cool.down.time</code>，控制多长时间的用户I/O计为在目标directory/worker上的一个负载。</p><h3 id="3-3-Alluxio中数据生命周期管理"><a href="#3-3-Alluxio中数据生命周期管理" class="headerlink" title="3.3 Alluxio中数据生命周期管理"></a>3.3 Alluxio中数据生命周期管理</h3><p>用户需要理解以下概念，以正确利用可用资源:</p><ul><li><strong>free：</strong>释放数据是指从Alluxio缓存中删除数据，而不是从底层UFS中删除数据。 释放操作后，数据仍然可供用户使用，但对Alluxio释放文件后尝试访问该文件 的客户端来讲性能可能会降低。</li><li><strong>load：</strong>加载数据意味着将其从UFS复制到Alluxio缓存中。如果Alluxio使用基于内存的存储，加载后用户可能会看到I/O性能的提高。</li><li><strong>persist：</strong>持久数据是指将Alluxio存储中可能被修改过或未被修改过的数据写回UFS。 通过将数据写回到UFS，可以保证如果Alluxio节点发生故障数据还是可恢复的。</li><li><strong>TTL(Time to Live)：</strong>TTL属性设置文件和目录的生存时间，以在数据超过其生存时间时将它们从Alluxio空间中删除。还可以配置 TTL来删除存储在UFS中的相应数据。</li></ul><h4 id="3-3-1-从Alluxio存储中释放数据"><a href="#3-3-1-从Alluxio存储中释放数据" class="headerlink" title="3.3.1 从Alluxio存储中释放数据"></a>3.3.1 从Alluxio存储中释放数据</h4><p>为了在Alluxio中手动释放数据，可以使用<code>./bin/alluxio</code>文件系统命令 行界面。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./bin/alluxio fs free <span class="variable">$&#123;PATH_TO_UNUSED_DATA&#125;</span></span></span><br></pre></td></tr></table></figure><p>这将从Alluxio存储中删除位于给定路径的数据。如果数据是持久存储到UFS的则仍然可以访问该数据。有关更多信息，参考 <a href="https://docs.alluxio.io/os/user/stable/en/operation/User-CLI.html#free" target="_blank" rel="noopener">命令行界面文档</a></p><p>注意，用户通常不需要手动从Alluxio释放数据，因为配置的<a href="https://docs.alluxio.io/os/user/stable/cn/core-services/Caching.html#block-annotation-policies" target="_blank" rel="noopener">注释策略</a>将负责删除未使用或旧数据。</p><h4 id="3-3-2-将数据加载到Alluxio存储中"><a href="#3-3-2-将数据加载到Alluxio存储中" class="headerlink" title="3.3.2 将数据加载到Alluxio存储中"></a>3.3.2 将数据加载到Alluxio存储中</h4><p>如果数据已经在UFS中，使用 <a href="https://docs.alluxio.io/os/user/stable/en/operation/User-CLI.html#load" target="_blank" rel="noopener"><code>alluxio fs load</code></a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./bin/alluxio fs load <span class="variable">$&#123;PATH_TO_FILE&#125;</span></span></span><br></pre></td></tr></table></figure><p>要从本地文件系统加载数据，使用命令 <a href="https://docs.alluxio.io/os/user/stable/en/operation/User-CLI.html#copyfromlocal" target="_blank" rel="noopener"><code>alluxio fs copyFromLocal</code></a>。 这只会将文件加载到Alluxio存储中，而不会将数据持久保存到UFS中。 将写入类型设置为<code>MUST_CACHE</code>写入类型将不会将数据持久保存到UFS， 而设置为<code>CACHE</code>和<code>CACHE_THROUGH</code>将会持久化保存。不建议手动加载数据，因为，当首次使用文件时Alluxio会自动将数据加载到Alluxio缓存中。</p><h4 id="3-3-3-在Alluxio中持久化保留数据"><a href="#3-3-3-在Alluxio中持久化保留数据" class="headerlink" title="3.3.3 在Alluxio中持久化保留数据"></a>3.3.3 在Alluxio中持久化保留数据</h4><p>命令<a href="https://docs.alluxio.io/os/user/stable/en/operation/User-CLI.html#persist" target="_blank" rel="noopener"><code>alluxio fs persist</code></a> 允许用户将数据从Alluxio缓存推送到UFS。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./bin/alluxio fs persist <span class="variable">$&#123;PATH_TO_FILE&#125;</span></span></span><br></pre></td></tr></table></figure><p>如果您加载到Alluxio的数据不是来自已配置的UFS，则上述命令很有用。 在大多数情况下，用户不必担心手动来持久化保留数据。</p><h4 id="3-3-4-设置生存时间-TTL"><a href="#3-3-4-设置生存时间-TTL" class="headerlink" title="3.3.4 设置生存时间(TTL)"></a>3.3.4 设置生存时间(TTL)</h4><p>Alluxio支持命名空间中每个文件和目录的”生存时间(TTL)”设置。此功能可用于有效地管理Alluxio缓存，尤其是在严格保证数据访问模式的环境中。例如，如果对上一周提取数据进行分析， 则TTL功能可用于明确刷新旧数据，从而为新文件释放缓存空间。</p><p>Alluxio具有与每个文件或目录关联的TTL属性。这些属性将保存为日志的一部分，所以集群重启后也能持久保持。活跃master节点负责当Alluxio提供服务时将元数据保存在内存中。在内部，master运行一个后台线程，该线程定期检查文件是否已达到其TTL到期时间。</p><p><strong>注意：</strong>后台线程按配置的间隔运行，默认设置为一个小时。 在检查后立即达到其TTL期限的数据不会马上删除， 而是等到一个小时后下一个检查间隔才会被删除。</p><p>如将间隔设置为10分钟，在<code>alluxio-site.properties</code>添加以下配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">alluxio.master.ttl.checker.interval</span>=<span class="string">10m</span></span><br></pre></td></tr></table></figure><p>请参考<a href="https://docs.alluxio.io/os/user/stable/cn/operation/Configuration.html" target="_blank" rel="noopener">配置页</a> CN以获取有关设置Alluxio配置的更多详细信息。</p><h5 id="3-3-4-1-API"><a href="#3-3-4-1-API" class="headerlink" title="3.3.4.1 API"></a>3.3.4.1 API</h5><p>有两种设置路径的TTL属性的方法。</p><blockquote><ol><li>通过Alluxio shell命令行</li><li>每个元数据加载或文件创建被动设置</li></ol></blockquote><p>TTL API如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SetTTL(path，duration，action)</span><br><span class="line">`path` 		Alluxio命名空间中的路径</span><br><span class="line">`duration`	TTL动作生效前的毫秒数，这会覆盖任何先前的设置</span><br><span class="line">`action`	生存时间过去后要执行的`action`。</span><br><span class="line"> 		`FREE` 	将导致文件从Alluxio存储中删除释放，无论其目前的状态如何。</span><br><span class="line"> 		`DELETE` 将导致文件从Alluxio命名空间和底层存储中删除。注意:`DELETE`是某些命令的默认设置，它将导致文件被永久删除。</span><br></pre></td></tr></table></figure><h5 id="3-3-4-2-命令行用法"><a href="#3-3-4-2-命令行用法" class="headerlink" title="3.3.4.2 命令行用法"></a>3.3.4.2 命令行用法</h5><p>了解如何使用<code>setTtl</code>命令在Alluxio shell中修改TTL属性参阅详细的 <a href="https://docs.alluxio.io/os/user/stable/cn/operation/User-CLI.html#setttl" target="_blank" rel="noopener">命令行文档</a>。</p><h5 id="3-3-4-3-Alluxio中文件上的被动TTL设置"><a href="#3-3-4-3-Alluxio中文件上的被动TTL设置" class="headerlink" title="3.3.4.3 Alluxio中文件上的被动TTL设置"></a>3.3.4.3 Alluxio中文件上的被动TTL设置</h5><p>Alluxio客户端可以配置为只要在Alluxio命名空间添加新文件时就添加TTL属性。 当预期用户是临时使用文件情况下，被动TTL很有用 ，但它不灵活，因为来自同一客户端的所有请求将继承 相同的TTL属性。</p><p>被动TTL通过以下选项配置:</p><ul><li><code>alluxio.user.file.create.ttl</code>：在Alluxio中文件上设置的TTL持续时间。 默认情况下，未设置TTL持续时间。</li><li><code>alluxio.user.file.create.ttl.action</code>：对文件设置的TTL到期后的操作 在Alluxio中。<strong>注意：默认情况下，此操作为“DELETE”，它将导致文件永久被删除。</strong></li></ul><p>TTL默认情况下处于不使用状态，仅当客户有严格数据访问模式才启用。</p><p>例如，要3分钟后删除由<code>runTests</code>创建的文件:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./bin/alluxio runTests -Dalluxio.user.file.create.ttl=3m \</span></span><br><span class="line">  -Dalluxio.user.file.create.ttl.action=DELETE</span><br></pre></td></tr></table></figure><p>对于这个例子，确保<code>alluxio.master.ttl.checker.interval</code>被设定为短间隔，例如一分钟，以便master能快速识别过期文件。</p><h3 id="3-4-在Alluxio中管理数据复制"><a href="#3-4-在Alluxio中管理数据复制" class="headerlink" title="3.4 在Alluxio中管理数据复制"></a>3.4 在Alluxio中管理数据复制</h3><h4 id="3-4-1-被动复制"><a href="#3-4-1-被动复制" class="headerlink" title="3.4.1 被动复制"></a>3.4.1 被动复制</h4><p>与许多分布式文件系统一样，Alluxio中的每个文件都包含一个或多个分布在集群中存储的存储块。默认情况下，Alluxio可以根据工作负载和存储容量自动调整不同块的复制级别。例如，当更多的客户以类型<code>CACHE</code>或<code>CACHE_PROMOTE</code>请求来读取此块时Alluxio可能会创建此特定块更多副本。当较少使用现有副本时，Alluxio可能会删除一些不常用现有副来为经常访问的数据征回空间(<a href="https://docs.alluxio.io/os/user/stable/cn/core-services/Caching.html#block-annotation-policies" target="_blank" rel="noopener">块注释策略</a>)。 在同一文件中不同的块可能根据访问频率不同而具有不同数量副本。</p><p>默认情况下，此复制或征回决定以及相应的数据传输对访问存储在Alluxio中数据的用户和应用程序完全透明。</p><h4 id="3-4-2-主动复制"><a href="#3-4-2-主动复制" class="headerlink" title="3.4.2 主动复制"></a>3.4.2 主动复制</h4><p>除了动态复制调整之外，Alluxio还提供API和命令行 界面供用户明确设置文件的复制级别目标范围。 尤其是，用户可以在Alluxio中为文件配置以下两个属性:</p><ol><li><code>alluxio.user.file.replication.min</code>是此文件的最小副本数。 默认值为0，即在默认情况下，Alluxio可能会在文件变冷后从Alluxio管理空间完全删除该文件。 通过将此属性设置为正整数，Alluxio 将定期检查此文件中所有块的复制级别。当某些块的复制数不足时，Alluxio不会删除这些块中的任何一个，而是主动创建更多副本以恢复其复制级别。</li><li><code>alluxio.user.file.replication.max</code>是最大副本数。一旦文件该属性设置为正整数，Alluxio将检查复制级别并删除多余的副本。将此属性设置为-1为不设上限(默认情况)，设置为0以防止在Alluxio中存储此文件的任何数据。注意，<code>alluxio.user.file.replication.max</code>的值必须不少于<code>alluxio.user.file.replication.min</code>。</li></ol><p>例如，用户可以最初使用至少两个副本将本地文件<code>/path/to/file</code>复制到Alluxio:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./bin/alluxio fs -Dalluxio.user.file.replication.min=2 \</span></span><br><span class="line">copyFromLocal /path/to/file /file</span><br></pre></td></tr></table></figure><p>接下来，设置<code>/file</code>的复制级别区间为3到5。需要注意的是，在后台进程中完成新的复制级别范围设定后此命令将马上返回，实现复制目标是异步完成的。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./bin/alluxio fs setReplication --min 3 --max 5 /file</span></span><br></pre></td></tr></table></figure><p>设置<code>alluxio.user.file.replication.max</code>为无上限。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./bin/alluxio fs setReplication --max -1 /file</span></span><br></pre></td></tr></table></figure><p>重复递归复制目录<code>/dir</code>下所有文件复制级别(包括其子目录）使用<code>-R</code>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./bin/alluxio fs setReplication --min 3 --max -5 -R /dir</span></span><br></pre></td></tr></table></figure><p>要检查的文件的目标复制水平，运行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./bin/alluxio fs <span class="built_in">stat</span> /foo</span></span><br></pre></td></tr></table></figure><p>并在输出中查找<code>replicationMin</code>和<code>replicationMax</code>字段。</p><h3 id="3-5-检查Alluxio缓存容量和使用情况"><a href="#3-5-检查Alluxio缓存容量和使用情况" class="headerlink" title="3.5 检查Alluxio缓存容量和使用情况"></a>3.5 检查Alluxio缓存容量和使用情况</h3><p>Alluxio shell命令<code>fsadmin report</code>提供可用空间的简短摘要以及其他有用的信息。输出示例如下:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./bin/alluxio fsadmin report</span></span><br><span class="line">Alluxio cluster summary:</span><br><span class="line">    Master Address: hadoop2:19998</span><br><span class="line">    Web Port: 19999</span><br><span class="line">    Rpc Port: 19998</span><br><span class="line">    Started: 12-10-2021 18:34:50:977</span><br><span class="line">    Uptime: 2 day(s), 16 hour(s), 47 minute(s), and 46 second(s)</span><br><span class="line">    Version: 2.6.2</span><br><span class="line">    Safe Mode: false</span><br><span class="line">    Zookeeper Enabled: true</span><br><span class="line">    Zookeeper Addresses:</span><br><span class="line">        hadoop1:2181</span><br><span class="line">        hadoop2:2181</span><br><span class="line">        hadoop3:2181</span><br><span class="line">    Live Workers: 3</span><br><span class="line">    Lost Workers: 0</span><br><span class="line">    Total Capacity: 7.40GB</span><br><span class="line">        Tier: MEM  Size: 7.40GB</span><br><span class="line">    Used Capacity: 1804B</span><br><span class="line">        Tier: MEM  Size: 1804B</span><br><span class="line">    Free Capacity: 7.40GB</span><br></pre></td></tr></table></figure><p><strong>Alluxio shell还允许用户检查Alluxio缓存中多少空间可用和在用。</strong></p><p>获得Alluxio缓存总使用字节数运行:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./bin/alluxio fs getUsedBytes</span></span><br></pre></td></tr></table></figure><p>获得Alluxio缓存以字节为单位的总容量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./bin/alluxio fs getCapacityBytes</span></span><br></pre></td></tr></table></figure><p>Alluxio master web界面为用户提供了集群的可视化总览包括已用多少存储空间。可以在<code>http:/{MASTER_IP}:${alluxio.master.web.port}/</code>中找到。 有关Alluxio Web界面的更多详细信息可以在 <a href="https://docs.alluxio.io/os/user/stable/en/operation/Web-Interface.html" target="_blank" rel="noopener">相关文档</a> 中找到。</p><h2 id="四、Alluxio-高可用集群部署"><a href="#四、Alluxio-高可用集群部署" class="headerlink" title="四、Alluxio 高可用集群部署"></a>四、Alluxio 高可用集群部署</h2><p><strong>服务规划</strong></p><table><thead><tr><th>主机名</th><th>Alluxio 角色</th><th>依赖服务</th></tr></thead><tbody><tr><td>hadoop1</td><td>master、worker</td><td>JDK1.8、zookeeper</td></tr><tr><td>hadoop2</td><td>master、worker</td><td>JDK1.8、zookeeper</td></tr><tr><td>hadoop3</td><td>worker</td><td>JDK1.8、zookeeper</td></tr></tbody></table><p><strong>前置条件</strong></p><blockquote><p>服务器免密登录（确保master可以免密登录到worker节点）<br>zk环境是可用的</p><p>Hadoop HDFS是可用的，保存master检查点信息用于HA快速恢复</p></blockquote><h3 id="4-1-安装-jdk"><a href="#4-1-安装-jdk" class="headerlink" title="4.1 安装 jdk"></a>4.1 安装 jdk</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop1 ~]$ tar xf downloads/jdk-8u301-linux-x64.tar.gz</span><br><span class="line">[hadoop@hadoop1 ~]$ vim .bash_profile</span><br><span class="line">export JAVA_HOME=/home/hadoop/jdk1.8.0_301</span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib</span><br><span class="line"></span><br><span class="line">[hadoop@hadoop1 ~]$ source .bash_profile</span><br></pre></td></tr></table></figure><h3 id="4-2-配置-Alluxio"><a href="#4-2-配置-Alluxio" class="headerlink" title="4.2 配置 Alluxio"></a>4.2 配置 Alluxio</h3><p><strong>准备Alluxio</strong> ，在各节点分别下载</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop1 ~/downloads]$ wget https://downloads.alluxio.io/downloads/files/2.6.2/alluxio-2.6.2-bin.tar.gz</span><br><span class="line">[hadoop@hadoop1 ~]$ tar xf downloads/alluxio-2.6.2-bin.tar.gz</span><br><span class="line">[hadoop@hadoop1 ~]$ cd alluxio-2.6.2/</span><br></pre></td></tr></table></figure><p><strong>编辑 alluxio-site.properties 配置文件</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop1 ~/alluxio-2.6.2]$ cp conf/alluxio-site.properties.template conf/alluxio-site.properties</span><br><span class="line">[hadoop@hadoop1 ~/alluxio-2.6.2]$ vim conf/alluxio-site.properties</span><br><span class="line"><span class="meta">#</span><span class="bash"> 主节点名称</span></span><br><span class="line">alluxio.master.hostname=hadoop1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 高可用配置</span></span><br><span class="line">alluxio.zookeeper.enabled=true</span><br><span class="line">alluxio.zookeeper.address=hadoop1:2181,hadoop2:2181,hadoop3:2181</span><br><span class="line">alluxio.master.journal.type=UFS</span><br><span class="line">alluxio.master.journal.folder=hdfs://hadoop2:8020/alluxio/journal/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Worker properties <span class="comment">#有几个层级的存储就写几，比如我们要配置的只有level0一层，就写1</span></span></span><br><span class="line">alluxio.worker.ramdisk.size=16GB</span><br><span class="line">alluxio.worker.tieredstore.levels=1</span><br><span class="line">alluxio.worker.tieredstore.level0.alias=MEM</span><br><span class="line">alluxio.worker.tieredstore.level0.dirs.path=/home/hadoop/alluxio-2.6.2/ramdisk</span><br></pre></td></tr></table></figure><p><strong>编辑 masters 配置文件</strong></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop2 ~/alluxio-2.6.2]<span class="formula">$ vim conf/masters</span></span><br><span class="line"><span class="formula">hadoop1</span></span><br><span class="line"><span class="formula">hadoop2</span></span><br></pre></td></tr></table></figure><p><strong>编辑 masters 配置文件</strong></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop2 ~/alluxio-2.6.2]<span class="formula">$ vim conf/workers</span></span><br><span class="line"><span class="formula">hadoop1</span></span><br><span class="line"><span class="formula">hadoop2</span></span><br><span class="line"><span class="formula">hadoop3</span></span><br></pre></td></tr></table></figure><p><strong>编辑 alluxio-env.sh 配置文件</strong>，添加java环境变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop1 ~/alluxio-2.6.2]$ vim conf/alluxio-env.sh</span><br><span class="line"></span><br><span class="line">JAVA_HOME=/home/hadoop/jdk1.8.0_301</span><br></pre></td></tr></table></figure><p><strong>将配置颁发到其它alluxio节点上</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop1 ~/alluxio-2.6.2]$ scp conf/* hadoop@hadoop2:~/alluxio-2.6.2/conf/</span><br><span class="line">[hadoop@hadoop1 ~/alluxio-2.6.2]$ scp conf/* hadoop@hadoop3:~/alluxio-2.6.2/conf/</span><br></pre></td></tr></table></figure><blockquote><p>确保master节点的 <code>alluxio.master.hostname</code> 配置为该节点的本机地址（hadoop2节点的 <code>alluxio.master.hostname=hadoop2</code>）</p></blockquote><h3 id="4-3-启动-Alluxio-HA-集群"><a href="#4-3-启动-Alluxio-HA-集群" class="headerlink" title="4.3 启动 Alluxio HA 集群"></a>4.3 启动 Alluxio HA 集群</h3><p><strong>格式 Alluxio</strong>，Alluxio 集群在其中一个主节点中使用以下命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop1 ~/alluxio-2.6.2]$ ./bin/alluxio format</span><br></pre></td></tr></table></figure><p><strong>启动 Alluixo</strong>，在可以进行免密登录的机器上执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop1 ~/alluxio-2.6.2]$ ./bin/alluxio-start.sh all SudoMount</span><br></pre></td></tr></table></figure><blockquote><p>参数<code>SudoMount</code>表示使用<code>sudo</code>特权将 RamFS 挂载到每个 worker 上（如果尚未挂载）</p></blockquote><p><strong>验证 Alluxio 集群</strong></p><p>要验证 Alluxio 是否正在运行，您可以访问主master 的 web UI。要确定主master可在任意节点使用 <code>alluxio fs masterInfo</code> 查询</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop3 ~/alluxio-2.6.2]$ ./bin/alluxio fs masterInfo</span><br><span class="line">Current leader master: hadoop1:19998</span><br><span class="line">All masters: [hadoop1:19998, hadoop2:19998]</span><br></pre></td></tr></table></figure><p><strong>访问 web UI</strong>，master和worker都拥有各自的Web UI页面。master Web界面的默认 端口是19999，worker的端口是30000。</p><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%8716.png" alt="图片16"></p><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%8717.png" alt="图片17"></p><h3 id="4-4-挂载-HDFS-存储"><a href="#4-4-挂载-HDFS-存储" class="headerlink" title="4.4 挂载 HDFS 存储"></a>4.4 挂载 HDFS 存储</h3><h4 id="4-4-1-配置文件挂载"><a href="#4-4-1-配置文件挂载" class="headerlink" title="4.4.1 配置文件挂载"></a>4.4.1 配置文件挂载</h4><p><strong>编辑Master节点的 alluxio-site.properties 配置文件</strong>，添加以下配置</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop2 ~/alluxio-2.6.2]<span class="formula">$ vim conf/alluxio-site.properties</span></span><br><span class="line"><span class="formula">alluxio.master.mount.table.root.ufs=hdfs://hadoop2:8020/alluxio</span></span><br></pre></td></tr></table></figure><blockquote><p>Alluxio默认使用本地文件作为文件系统 <code>alluxio.master.mount.table.root.ufs=${alluxio.work.dir}/underFSStorage</code></p></blockquote><p><strong>重启 Master 服务</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop1 ~/alluxio-2.6.2]$ ./bin/alluxio-stop.sh master</span><br><span class="line">[hadoop@hadoop2 ~/alluxio-2.6.2]$ ./bin/alluxio-stop.sh master</span><br><span class="line"></span><br><span class="line">[hadoop@hadoop1 ~/alluxio-2.6.2]$ ./bin/alluxio-start.sh master</span><br><span class="line">[hadoop@hadoop2 ~/alluxio-2.6.2]$ ./bin/alluxio-start.sh master</span><br></pre></td></tr></table></figure><p><strong>查看挂载的hdfs存储</strong></p><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%8718.png" alt="图片18"></p><p>现在已经把hdfs的alluxio目录挂载为alluxio的根目录，接下来我们运行alluxio自带的示例程序</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop2 ~/alluxio-2.6.2]$ ./bin/alluxio runTests</span><br></pre></td></tr></table></figure><p>创建完示例文件后可以在alluxio和hdfs查看到了</p><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%8719.png" alt="图片19"></p><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%8721.png" alt="图片21"></p><h4 id="4-4-2-命令行挂载"><a href="#4-4-2-命令行挂载" class="headerlink" title="4.4.2 命令行挂载"></a>4.4.2 命令行挂载</h4><p>配置文件挂载，只能挂载到<code>/</code>根目录，如果需要挂载多个hdfs目录或多个hdfs集群，只能通过命令行进行挂载了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 挂载多个hdfs目录</span></span><br><span class="line">[hadoop@hadoop2 ~/alluxio-2.6.2]$ ./bin/alluxio fs mount /hdfs2 hdfs://hadoop2:8020/hbase</span><br><span class="line">[hadoop@hadoop2 ~/alluxio-2.6.2]$ ./bin/alluxio fs mount /hive hdfs://hadoop2:8020/hive</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 挂载多个hdfs集群需要指定hdfs-site.xml,core-site.xml配置文件</span></span><br><span class="line">[hadoop@hadoop2 ~/alluxio-2.6.2]$ ./bin/alluxio fs mount /alluxio hdfs://hadoop2:8020/alluxio \</span><br><span class="line">--option alluxio.underfs.hdfs.configuration=/home/hadoop/hadoop-2.7.2/etc/hadoop/core-site.xml:/home/hadoop/hadoop-2.7.2/etc/hadoop/hdfs-site.xml</span><br><span class="line">[hadoop@hadoop2 ~/alluxio-2.6.2]$ ./bin/alluxio fs mount /druid hdfs://mycluster/druid \</span><br><span class="line">--option alluxio.underfs.hdfs.configuration=/home/hadoop/hadoop-2.7.2/etc/hadoop/core-site.xml:/home/hadoop/hadoop-2.7.2/etc/hadoop/hdfs-site.xml</span><br></pre></td></tr></table></figure><p><strong>查看挂载的hdfs存储</strong></p><p><img src="/2021/12/11/alluxio-fen-bu-shi-nei-cun-wen-jian-xi-tong/%E5%9B%BE%E7%89%8722.png" alt="图片22"></p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Hadoop/" rel="tag"><i class="fa fa-tag"></i> Hadoop</a><a href="/tags/Alluxio/" rel="tag"><i class="fa fa-tag"></i> Alluxio</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2021/12/07/apache-doris-he-clickhouse-shen-du-dui-bi/" rel="next" title="Apache Doris和 ClickHouse深度对比"><i class="fa fa-chevron-left"></i> Apache Doris和 ClickHouse深度对比</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2022/02/16/k8s-helm-bu-shu-he-shi-yong/" rel="prev" title="k8s Helm3部署和使用">k8s Helm3部署和使用<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"><span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a><a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/chen.png" alt="Zhongzhou Chen"><p class="site-author-name" itemprop="name">Zhongzhou Chen</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">320</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">84</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">182</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、Alluxio概览"><span class="nav-text">一、Alluxio概览</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-什么是-Alluxio"><span class="nav-text">1.1 什么是 Alluxio</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-Alluxio的优势"><span class="nav-text">1.2 Alluxio的优势</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-1-内存速度-I-O"><span class="nav-text">1.2.1 内存速度 I/O</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-2-统一数据访问接口"><span class="nav-text">1.2.2 统一数据访问接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-3-提升远程存储读写性能"><span class="nav-text">1.2.3 提升远程存储读写性能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-4-数据快速复用与共性"><span class="nav-text">1.2.4 数据快速复用与共性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-5-集成机器学习和深度学习"><span class="nav-text">1.2.5 集成机器学习和深度学习</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-技术创新"><span class="nav-text">1.3 技术创新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-功能简介"><span class="nav-text">1.4 功能简介</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、系统架构"><span class="nav-text">二、系统架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-概述"><span class="nav-text">2.1 概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-Mstaers"><span class="nav-text">2.2 Mstaers</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-主master"><span class="nav-text">2.2.1 主master</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-备用master"><span class="nav-text">2.2.2 备用master</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-Secondary-Masters-for-UFS-journal"><span class="nav-text">2.2.3 Secondary Masters (for UFS journal)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-4-Job-Masters"><span class="nav-text">2.2.4 Job Masters</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-Workers"><span class="nav-text">2.3 Workers</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-1-Alluxio-Workers"><span class="nav-text">2.3.1 Alluxio Workers</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-2-Alluxio-Job-Workers"><span class="nav-text">2.3.2 Alluxio Job Workers</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-Client"><span class="nav-text">2.4 Client</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-读数据流"><span class="nav-text">2.5 读数据流</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-1-本地缓存命中"><span class="nav-text">2.5.1 本地缓存命中</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-2-远程缓存命中"><span class="nav-text">2.5.2 远程缓存命中</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-3-缓存Miss"><span class="nav-text">2.5.3 缓存Miss</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-4-缓存跳过"><span class="nav-text">2.5.4 缓存跳过</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-写数据流"><span class="nav-text">2.6 写数据流</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-1-仅写入-Alluxio-MUST-CACHE"><span class="nav-text">2.6.1 仅写入 Alluxio ( MUST_CACHE)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-2-直写到-UFS-CACHE-THROUGH"><span class="nav-text">2.6.2 直写到 UFS ( CACHE_THROUGH)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-3-写回-UFS-ASYNC-THROUGH"><span class="nav-text">2.6.3 写回 UFS ( ASYNC_THROUGH)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-4-仅写入-UFS-THROUGH"><span class="nav-text">2.6.4 仅写入 UFS ( THROUGH)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-5-数据一致性"><span class="nav-text">2.6.5 数据一致性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、核心功能"><span class="nav-text">三、核心功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-Alluxio存储概述"><span class="nav-text">3.1 Alluxio存储概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-配置Alluxio存储"><span class="nav-text">3.2 配置Alluxio存储</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-单层存储"><span class="nav-text">3.2.1 单层存储</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-多层存储"><span class="nav-text">3.2.2 多层存储</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-2-1-写数据"><span class="nav-text">3.2.2.1 写数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-2-2-读取数据"><span class="nav-text">3.2.2.2 读取数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-2-3-配置分层存储"><span class="nav-text">3.2.2.3 配置分层存储</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-块注释策略"><span class="nav-text">3.2.3 块注释策略</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-3-1-释放空间模拟"><span class="nav-text">3.2.3.1 释放空间模拟</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-分层存储管理"><span class="nav-text">3.2.4 分层存储管理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-4-1-块对齐-动态块放置"><span class="nav-text">3.2.4.1 块对齐(动态块放置)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-4-2-块升级"><span class="nav-text">3.2.4.2 块升级</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-4-3-管理任务推后"><span class="nav-text">3.2.4.3 管理任务推后</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-Alluxio中数据生命周期管理"><span class="nav-text">3.3 Alluxio中数据生命周期管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-从Alluxio存储中释放数据"><span class="nav-text">3.3.1 从Alluxio存储中释放数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-将数据加载到Alluxio存储中"><span class="nav-text">3.3.2 将数据加载到Alluxio存储中</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-3-在Alluxio中持久化保留数据"><span class="nav-text">3.3.3 在Alluxio中持久化保留数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-4-设置生存时间-TTL"><span class="nav-text">3.3.4 设置生存时间(TTL)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-4-1-API"><span class="nav-text">3.3.4.1 API</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-4-2-命令行用法"><span class="nav-text">3.3.4.2 命令行用法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-4-3-Alluxio中文件上的被动TTL设置"><span class="nav-text">3.3.4.3 Alluxio中文件上的被动TTL设置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-在Alluxio中管理数据复制"><span class="nav-text">3.4 在Alluxio中管理数据复制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-1-被动复制"><span class="nav-text">3.4.1 被动复制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-2-主动复制"><span class="nav-text">3.4.2 主动复制</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-检查Alluxio缓存容量和使用情况"><span class="nav-text">3.5 检查Alluxio缓存容量和使用情况</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、Alluxio-高可用集群部署"><span class="nav-text">四、Alluxio 高可用集群部署</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-安装-jdk"><span class="nav-text">4.1 安装 jdk</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-配置-Alluxio"><span class="nav-text">4.2 配置 Alluxio</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-启动-Alluxio-HA-集群"><span class="nav-text">4.3 启动 Alluxio HA 集群</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-挂载-HDFS-存储"><span class="nav-text">4.4 挂载 HDFS 存储</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-1-配置文件挂载"><span class="nav-text">4.4.1 配置文件挂载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-2-命令行挂载"><span class="nav-text">4.4.2 命令行挂载</span></a></li></ol></li></ol></li></ol></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Zhongzhou Chen</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">758.4k</span></div><span class="post-meta-divider"></span></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code").find(".line").map(function(t,e){return $(e).text()}).toArray().join("\n"),n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();var o=document.execCommand("copy");document.body.removeChild(n),o?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})</script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,s){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var o=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,n=document.getElementById(e),r=document.getElementById(s);n.addEventListener("input",function(){var y=n.value.trim().toLowerCase(),T=y.split(/[\s\-]+/);1<T.length&&T.push(y);var b=[];if(0<y.length&&o.forEach(function(t){function e(t,e,o,n){for(var r=n[n.length-1],s=r.position,a=r.word,i=[],c=0;s+a.length<=o&&0!=n.length;){a===y&&c++,i.push({position:s,length:a.length});var l=s+a.length;for(n.pop();0!=n.length&&(s=(r=n[n.length-1]).position,a=r.word,s<l);)n.pop()}return h+=c,{hits:i,start:e,end:o,searchTextCount:c}}function o(o,t){var n="",r=t.start;return t.hits.forEach(function(t){n+=o.substring(r,t.position);var e=t.position+t.length;n+='<b class="search-keyword">'+o.substring(t.position,e)+"</b>",r=e}),n+=o.substring(r,t.end)}var n=!1,r=0,h=0,s=t.title.trim(),a=s.toLowerCase(),i=t.content.trim().replace(/<[^>]+>/g,""),c=i.toLowerCase(),l=decodeURIComponent(t.url),p=[],u=[];if(""!=s&&(T.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());-1<(s=e.indexOf(t,r));)a.push({position:s,word:t}),r=s+n;return a}p=p.concat(e(t,a,!1)),u=u.concat(e(t,c,!1))}),(0<p.length||0<u.length)&&(n=!0,r=p.length+u.length)),n){[p,u].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var f=[];0!=p.length&&f.push(e(0,0,s.length,p));for(var d=[];0!=u.length;){var g=u[u.length-1],v=g.position,$=g.word,C=v-20,m=v+80;C<0&&(C=0),m<v+$.length&&(m=v+$.length),m>i.length&&(m=i.length),d.push(e(0,C,m,u))}d.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var x=parseInt("1");0<=x&&(d=d.slice(0,x));var w="";w+=0!=f.length?"<li><a href='"+l+"' class='search-result-title'>"+o(s,f[0])+"</a>":"<li><a href='"+l+"' class='search-result-title'>"+s+"</a>",d.forEach(function(t){w+="<a href='"+l+'\'><p class="search-result">'+o(i,t)+"...</p></a>"}),w+="</li>",b.push({item:w,searchTextCount:h,hitCount:r,id:b.length})}}),1===T.length&&""===T[0])r.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===b.length)r.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{b.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var e='<ul class="search-result-list">';b.forEach(function(t){e+=t.item}),e+="</ul>",r.innerHTML=e}}),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script type="text/javascript" src="/js/src/love.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,log:!1,model:{jsonPath:"/live2dw/assets/shizuku.model.json"},display:{position:"right"},mobile:{show:!0,scale:.2},react:{opacityDefault:.7,opacityOnHover:.2,opacity:.4}})</script></body></html>