<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><script></script><meta name="theme-color" content="#222"><style>.pace .pace-progress{background:#1e92fb;height:3px}.pace .pace-progress-inner{box-shadow:0 0 10px #1e92fb,0 0 5px #1e92fb}.pace .pace-activity{border-top-color:#1e92fb;border-left-color:#1e92fb}</style><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="HGM141IpbHrSmnAmR6W_zE4bo9Z3f-yXLeHYT3bg1fk"><meta name="baidu-site-verification" content="code-5Ai1DA8e6T"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="Hadoop,HBase,"><link rel="alternate" href="/atom.xml" title="凡间的精灵" type="application/atom+xml"><meta name="description" content="一、简介NoSQL是Not Only SQL的缩写，泛指用来解决大数据相关问题而创建的数据库技术，NoSQL技术不会完全替代关系型数据库，而是关系型数据的一种补充。HBase是建立在Hadoop文件系统之上的分布式面向列的NoSQL数据库。它是一个开源项目，可横向扩展。HBase的数据模型，类似于谷歌的BigTable设计，可以快速随机访问海量半结构化数据，并利用了Hadoop的文件系统HDFS提"><meta name="keywords" content="Hadoop,HBase"><meta property="og:type" content="article"><meta property="og:title" content="Hadoop NoSQL数据库HBase"><meta property="og:url" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;10&#x2F;18&#x2F;hadoop-nosql-shu-ju-ku-hbase&#x2F;index.html"><meta property="og:site_name" content="凡间的精灵"><meta property="og:description" content="一、简介NoSQL是Not Only SQL的缩写，泛指用来解决大数据相关问题而创建的数据库技术，NoSQL技术不会完全替代关系型数据库，而是关系型数据的一种补充。HBase是建立在Hadoop文件系统之上的分布式面向列的NoSQL数据库。它是一个开源项目，可横向扩展。HBase的数据模型，类似于谷歌的BigTable设计，可以快速随机访问海量半结构化数据，并利用了Hadoop的文件系统HDFS提"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;10&#x2F;18&#x2F;hadoop-nosql-shu-ju-ku-hbase&#x2F;%E5%9B%BE%E7%89%871.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;10&#x2F;18&#x2F;hadoop-nosql-shu-ju-ku-hbase&#x2F;%E5%9B%BE%E7%89%872.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;10&#x2F;18&#x2F;hadoop-nosql-shu-ju-ku-hbase&#x2F;%E5%9B%BE%E7%89%873.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;10&#x2F;18&#x2F;hadoop-nosql-shu-ju-ku-hbase&#x2F;%E5%9B%BE%E7%89%874.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;10&#x2F;18&#x2F;hadoop-nosql-shu-ju-ku-hbase&#x2F;%E5%9B%BE%E7%89%875.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;10&#x2F;18&#x2F;hadoop-nosql-shu-ju-ku-hbase&#x2F;%E5%9B%BE%E7%89%876.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;10&#x2F;18&#x2F;hadoop-nosql-shu-ju-ku-hbase&#x2F;%E5%9B%BE%E7%89%877.png"><meta property="og:updated_time" content="2021-12-29T09:22:57.201Z"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;10&#x2F;18&#x2F;hadoop-nosql-shu-ju-ku-hbase&#x2F;%E5%9B%BE%E7%89%871.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"always",offset:12,b2t:!0,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://chenzhonzhou.github.io/2021/10/18/hadoop-nosql-shu-ju-ku-hbase/"><title>Hadoop NoSQL数据库HBase | 凡间的精灵</title><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">凡间的精灵</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">凡尘落素一精灵</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://chenzhonzhou.github.io/2021/10/18/hadoop-nosql-shu-ju-ku-hbase/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Zhongzhou Chen"><meta itemprop="description" content=""><meta itemprop="image" content="/images/chen.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="凡间的精灵"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Hadoop NoSQL数据库HBase</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-10-18T15:48:57+08:00">2021-10-18</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Hadoop/" itemprop="url" rel="index"><span itemprop="name">Hadoop</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">5.8k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">23</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h2><p><strong>NoSQL</strong>是<strong><code>Not Only SQL</code></strong>的缩写，泛指用来解决大数据相关问题而创建的数据库技术，NoSQL技术不会完全替代关系型数据库，而是关系型数据的一种补充。HBase是建立在Hadoop文件系统之上的分布式面向列的NoSQL数据库。它是一个开源项目，可横向扩展。HBase的数据模型，类似于谷歌的<strong>BigTable</strong>设计，可以快速随机访问海量半结构化数据，并利用了Hadoop的文件系统HDFS提供的容错能力。</p><h2 id="二、HBase-原理"><a href="#二、HBase-原理" class="headerlink" title="二、HBase 原理"></a>二、HBase 原理</h2><p><a href="https://hbase.apache.org/" target="_blank" rel="noopener">HBase</a> 是NoSQL数据库的一种，与传统关系型数据库有很多区别，既可以存储结构化数据，也可以存储非结构化数据或半结构化数据。</p><h3 id="2-1-HBase-概述"><a href="#2-1-HBase-概述" class="headerlink" title="2.1 HBase 概述"></a>2.1 HBase 概述</h3><p>如果需要实时随机地访问超大规模数据集，就可以使用HBase这一Hadoop应用。HBase是一个在HDFS上开发的面向列的分布式数据库。<br>虽然数据库存储和检索的实现可以选择很多不同的策略，但是绝大多数解决办法，特别是关系型数据库技术的变种，不是为大规模可伸缩的分布式处理设计的。很多厂商提供了复制（replication）和分区（partitioning）解决方案，让数据库能够从单个节点上扩展出去，但是这些附加的技术大都属于<strong>事后</strong>的解决办法，而且非常难以安装和维护，并且这些解决办法常常要牺牲一些重要的关系型数据库管理系统（RDBMS）特性。<br>在一个<strong>扩展的</strong>RDBMS上，连接、复杂查询、触发器、视图以及外键约束这些功能或运行开销大，或根本无法用。HBase从另一个方向来解决可伸缩性的问题，它自底向上地进行构建，能够简单地通过增加节点来达到线性扩展的目的。<br>HBase并不是关系型数据库，它不支持SQL。但在特定的问题空间里，它能够做RDBMS不能做的事：在廉价硬件构成的集群上管理超大规模的稀疏表。<br>HBase是Apache的顶级开源项目，本质上是谷歌BigTable的开源山寨版本。建立的HDFS之上，提供高可靠性、高性能、列存储、可伸缩、实时读写的数据库系统，它介于NoSQL和RDBMS之间，仅能通过主键（row key）和主键的范围（range）来检索数据，仅支持单行事务（可通过Hive支持来实现多表join等复杂操作）。主要用来存储非结构化和半结构化的松散数据。</p><h3 id="2-2-HBase-核心概念"><a href="#2-2-HBase-核心概念" class="headerlink" title="2.2 HBase 核心概念"></a>2.2 HBase 核心概念</h3><p>HBase的数据存放在带标签的表中。表由行和列组成。表格的<strong>单元格</strong>（cell）由行和列的坐标交叉决定，是有版本的。默认情况下，版本号是自动分配的，为HBase插入单元格时的时间戳。单元格的内容是未解释的字节数组。HBase是一个稀疏、长期存储、多维度、排序的映射表。这张表的索引是行关键字、列关键字和时间戳。每个值是一个二进制的字节数组。</p><ol><li>行关键字<br>row key保存为字节数组，是用来检索记录的主键。可以是任意字符串（最大长度是64KB）。存储时，数据按照row key的字典序（byte order）排序存储。设计row key时，要充分利用排序存储这个特性，将经常一起读取的行存储放到一起。</li><li>列关键字<br>列关键字由列族column family和列qualifier两部分组成。列族是表的schema元数据的一部分（而列不是），必须在使用表之前定义。列名都以列族作为前缀。例如courses:history、courses:math都属于courses这个列族。有关联的数据应都放在一个列族里，否则将降低读写效率。目前HBase并不能很好地处理多个列族，建议最多使用两个列族。</li><li>时间戳<br>HBase中通过row和columns确定的一个存储单元称为cell。每个cell都保存着同一份数据的多个版本。版本通过时间戳来索引。时间戳的类型是64位整型。时间戳可以由HBase在数据写入时自动赋值，此时时间戳是精确到毫秒的当前系统时间。时间戳也可以由客户显式赋值。如果应用程序要避免数据版本冲突，就必须自己生成具有唯一性的时间戳。每个cell中，不同版本的数据按照时间倒序排序，即最新的数据排在最前面。为了避免数据存在过多版本造成管理（包括存储和索引）负担，HBase提供了两种数据版本回收方式。一是保存数据的最后N个版本（比如3个），二是保存最近一段时间内的版本（比如最近7天）。用户可以针对每个列族进行设置。</li><li>cell<br>由{row key, column(=&lt;family&gt; + &lt;label&gt;), version}唯一确定的单元，cell中的数据是没有类型的，全部以字节码形式存储。</li></ol><p>与NoSQL数据库一样，row key是用来检索记录的主键。访问HBase表中的行，只有3种方式。<br>（1）通过单个row key访问单条记录。<br>（2）通过row key的range指定检索范围。<br>（3）全表扫描。<br>物理上，所有的列族成员都一起存放在文件系统中。所以，虽然把HBase描述为一个面向列的存储器，但实际上更准确的说法是，HBase是个面向列族的存储器。由于调优和存储都是在列族这个层次进行的，所以最好使所有列族成员都有相同的<strong>访问模式</strong>（access pattern）和大小特征。简而言之，HBase表和RDBMS中的表类似，单元格有版本，行是排序的，而只要列族预先存在，客户端随时可以把列添加到列族中去。</p><p>HBase存储格式如下图所示<br><img src="/2021/10/18/hadoop-nosql-shu-ju-ku-hbase/%E5%9B%BE%E7%89%871.png" alt="图片1"></p><p>一个典型的RDBMS二维表格式如下所示<br><img src="/2021/10/18/hadoop-nosql-shu-ju-ku-hbase/%E5%9B%BE%E7%89%872.png" alt="图片2"></p><p>对应的数据在HBase中的存储格式如下所示<br><img src="/2021/10/18/hadoop-nosql-shu-ju-ku-hbase/%E5%9B%BE%E7%89%873.png" alt="图片3"></p><p>HBase自动把表水平划分成<strong>区域</strong>（region）。每个区域由表中行的子集构成。每个区域由它所属的表、它所包含的第一行及最后一行（不包括这行）来表示。<br>一开始，一个表只有一个区域。但是随着区域变大，等到它的大小超出设定的阈值时，便会在某行的边界上把表分成两个大小基本相同的新分区。在第一次划分之前，所有加载的数据都放在原始区域所在的服务器上。<br>随着表变大，区域的个数也会增加。区域是在HBase集群上分布数据的最小单位。用这种方式，一个因为太大而无法放在单台服务器上的表会被放到服务器集群上，其中每个节点都负责管理表所在区域的一个子集。表的加载也是使用这种方法把数据分布到各个节点。在线的所有区域按次序排列就构成了表的所有内容。</p><p>常规的HBase服务器部署结构如下图所示<br><img src="/2021/10/18/hadoop-nosql-shu-ju-ku-hbase/%E5%9B%BE%E7%89%874.png" alt="图片4"></p><p>各个角色的功能如下：<br>（1）Region：表中一部分数据组成的子集，当Region内的数据过多时能够自动分裂，过少时会合并。<br>（2）RegionServer：维护Master分配给它的Region，处理对这些Region的IO请求，负责切分在运行过程中变得过大的Region。<br>（3）Master：为RegionServer分配Region，负责RegionServer的负载均衡，发现失效的RegionServer并重新分配其上的Region，执行HDFS上的垃圾文件回收。<br>（4）ZooKeeper：保证任何时候集群中只有一个Master存储所有Region的寻址入口。实时监控RegionServer的状态，将RegionServer的上线和下线信息实时通知给Master。存储HBase的Schema，包括有哪些table、每个table有哪些column family，处理Region和Master的失效。</p><p>以下是HBase与RMDBS的主要差异<br><img src="/2021/10/18/hadoop-nosql-shu-ju-ku-hbase/%E5%9B%BE%E7%89%875.png" alt="图片5"></p><h3 id="2-3-HBase-的关键流程"><a href="#2-3-HBase-的关键流程" class="headerlink" title="2.3 HBase 的关键流程"></a>2.3 HBase 的关键流程</h3><p>HBase客户端会将查询过的HRegion的位置信息进行缓存，如果客户端没有缓存一个HRegion的位置或者位置信息是不正确的，客户端会重新获取位置信息。如果客户端的缓存全部失效，则需要进行多次网络访问才能定位到正确的位置。</p><h4 id="2-3-1-Region的分配"><a href="#2-3-1-Region的分配" class="headerlink" title="2.3.1 Region的分配"></a>2.3.1 Region的分配</h4><p>任何时刻，一个Region只能分配给一个RegionServer。Master跟踪当前有哪些可用的RegionServer，以及当前哪些Region分配给了哪些RegionServer，哪些Region还没有分配。当存在未分配的Region且有一个RegionServer上有可用空间时，Master就给这个RegionServer发送一个装载请求，把Region分配给这个RegionServer。RegionServer得到请求后，就开始对此Region提供服务。</p><h4 id="2-3-2-RegionServer上线"><a href="#2-3-2-RegionServer上线" class="headerlink" title="2.3.2 RegionServer上线"></a>2.3.2 RegionServer上线</h4><p>Master使用ZooKeeper来跟踪RegionServer状态。当某个RegionServer启动时，会首先在ZooKeeper上的rs目录下建立代表自己的文件，并获得该文件的独占锁。由于Master订阅了rs目录上的变更消息，当rs目录下的文件出现新增或删除操作时，Master可以得到来自ZooKeeper的实时通知。因此一旦RegionServer上线，Master能马上得到消息。</p><h4 id="2-3-3-RegionServer下线"><a href="#2-3-3-RegionServer下线" class="headerlink" title="2.3.3 RegionServer下线"></a>2.3.3 RegionServer下线</h4><p>当RegionServer下线时，它和ZooKeeper的会话断开，ZooKeeper会自动释放代表这台Server的文件上的独占锁，而Master不断轮询rs目录下文件的锁状态。如果Master发现某个RegionServer丢失了它自己的独占锁，Master就会尝试去获取代表这个RegionServer的读写锁，一旦获取成功，就可以确定：<br>（1）RegionServer和ZooKeeper之间的网络断开了；<br>（2）RegionServer失效了。<br>只要这两种情况中的一种情况发生了，无论哪种情况，RegionServer都无法继续为它的Region提供服务，此时Master会删除Server目录下代表这台RegionServer的文件，并将这台RegionServer的Region分配给其他还<strong>活着</strong>的机器。<br>如果网络短暂出现问题导致RegionServer丢失了它的锁，那么RegionServer重新连接到ZooKeeper之后，只要代表它的文件还在，它就会不断尝试获取这个文件上的锁，一旦获取到了，就可以继续提供服务。</p><h4 id="2-3-4-Master上线"><a href="#2-3-4-Master上线" class="headerlink" title="2.3.4 Master上线"></a>2.3.4 Master上线</h4><p>Master启动上线包括以下步骤。<br>（1）从ZooKeeper上获取唯一代表Master的锁，用来阻止其他节点成为Master。<br>（2）扫描ZooKeeper上的Server目录，获得当前可用的RegionServer列表。<br>（3）与每个RegionServer通信，获得当前已分配的Region和RegionServer的对应关系。<br>（4）扫描.META.region的集合，计算得到当前还未分配的Region，将它们放入待分配Region列表。</p><h4 id="2-3-5-Master下线"><a href="#2-3-5-Master下线" class="headerlink" title="2.3.5 Master下线"></a>2.3.5 Master下线</h4><p>（1）由于Master只维护表和Region的元数据，而不参与表数据IO的过程，所以Master下线仅导致所有元数据的修改被冻结。此时无法创建、删除表，无法修改表的schema，无法进行Region的负载均衡，无法处理Region上下线，无法进行Region的合并，唯一例外的是Region的split可以正常进行，因为只有RegionServer参与，表的数据读写还可以正常进行。因此Master下线短时间内对整个HBase集群没有影响。<br>（2）Master下线，启用Zookeeper的选举机制，确定新的Master，新的Master执行上线流程</p><p>从上线过程可以看到，Master保存的信息全是冗余信息，都可以从系统其他地方收集或者计算出来。因此，一般HBase集群中总是有一个Master在提供服务，还有一个以上的<strong>Master</strong>在等待时机抢占它的位置。<br>当客户端要修改HBase的数据时，首先创建一个action（比如put、delete、incr等操作），这些action都会被包装成Key-Value对象，然后通过RPC将其传输到HRegionServer上。HRegionServer将其分配给相应的HRegion，HRegion先将数据写入Hlog中，然后将其写入MemStore。MemStore中的数据是排序的，当MemStore累计到一定阈值时，就会创建一个新的MemStore，并且将老的MemStore添加到flush队列，由单独的线程flush到磁盘上，成为一个StoreFile。与此同时，系统会在ZooKeeper中记录一个redo point，表示这个时刻之前的变更已经持久化了。当系统出现意外时，可能导致内存（MemStore）中的数据丢失，此时使用Log（WAL log）来恢复redo point之后的数据。<br>StoreFile是只读的，一旦创建后就不可以再修改，因此HBase的更新其实是不断追加的操作。当一个Store中的StoreFile达到一定的阈值后，就会进行一次合并，将对同一个key的修改合并到一起，形成一个大的StoreFile。<br>由于对表的更新是不断追加的，处理读请求时，需要访问Store中全部的StoreFile和MemStore，将它们的数据按照row key进行合并，由于StoreFile和MemStore都是经过排序的，并且StoreFile带有内存中索引，所以合并的过程还是比较快的。</p><h4 id="2-3-6-读请求处理过程"><a href="#2-3-6-读请求处理过程" class="headerlink" title="2.3.6 读请求处理过程"></a>2.3.6 读请求处理过程</h4><p>（1）客户端通过 ZooKeeper 以及-ROOT-表和.META.表找到目标数据所在的 RegionServer(就是数据所在的 Region 的主机地址)；<br>（2）zk返回结果给客户端；<br>（3）联系 RegionServer 查询目标数据；<br>（4）RegionServer 定位到目标数据所在的 Region，发出查询请求；<br>（5）Region 先在 Memstore 中查找，命中则返回；<br>（6）如果在 Memstore 中找不到，则在 Storefile 中扫描，为了能快速的判断要查询的数据在不在这个 StoreFile 中，应用了 BloomFilter；<br>（BloomFilter，布隆过滤器：迅速判断一个元素是不是在一个庞大的集合内，但是他有一个 <strong>弱点</strong>：它有一定的误判率）；<br>（误判率：原本不存在与该集合的元素，布隆过滤器有可能会判断说它存在，但是，如果布隆过滤器，判断说某一个元素不存在该集合，那么该元素就一定不在该集合内）。</p><h4 id="2-3-7-写请求处理过程"><a href="#2-3-7-写请求处理过程" class="headerlink" title="2.3.7 写请求处理过程"></a>2.3.7 写请求处理过程</h4><p>写请求处理过程如下：<br>（1）Client向RegionServer提交写请求；<br>（2）RegionServer找到目标Region；<br>（3）Region检查数据是否与schema一致；<br>（4）如果客户端没有指定版本，则获取当前系统时间作为数据版本；<br>（5）将更新写入WAL log；<br>（6）将更新写入Memstore；<br>（7）判断Memstore的数据是否需要flush为StoreFile。</p><h2 id="三、HBase-集群部署"><a href="#三、HBase-集群部署" class="headerlink" title="三、HBase 集群部署"></a>三、HBase 集群部署</h2><p>官网下载HBase：<a href="https://hbase.apache.org/downloads.html" target="_blank" rel="noopener">https://hbase.apache.org/downloads.html</a></p><p><strong>服务规则</strong></p><table><thead><tr><th>主机名</th><th>运行HBase服务</th></tr></thead><tbody><tr><td>hadoop1</td><td>Master、RegionServer</td></tr><tr><td>hadoop2</td><td>Backup_Master、RegionServer</td></tr><tr><td>hadoop3</td><td>Backup_Master、RegionServer</td></tr></tbody></table><h3 id="3-1-修改-HBase配置文件"><a href="#3-1-修改-HBase配置文件" class="headerlink" title="3.1 修改 HBase配置文件"></a>3.1 修改 HBase配置文件</h3><p><strong>下载 hbase</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop1 ~/downloads]$ wget https://archive.apache.org/dist/hbase/2.3.6/hbase-2.3.6-bin.tar.gz</span><br><span class="line">[hadoop@hadoop1 ~]$ tar xf downloads/hbase-2.3.6-bin.tar.gz</span><br></pre></td></tr></table></figure><p><strong>复制 hdfs-site.xml 配置文件</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop1 ~]$ cp hadoop-2.7.2/etc/hadoop/hdfs-site.xml hbase-2.3.6/conf/</span><br></pre></td></tr></table></figure><p>复制<code>$HADOOP_HOME/etc/hadoop/hdfs-site.xml</code>到<code>$HBASE_HOME/conf</code>目录下，这样以保证<strong>hdfs</strong>与<strong>hbase</strong>两边一致，这也是官网所推荐的方式。在官网中提到一个例子，例如hdfs中配置的副本数量为5，而默认为3，如果没有将最新的<code>hdfs-site.xml</code>复制到<code>$HBASE_HOME/conf</code>目录下，则hbase将会按3份备份，从而两边不一致，导致会出现异常</p><p><strong>修改 hbase-site.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop1 ~]$ vim hbase-2.3.6/conf/hbase-site.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>此项用于配置HBase的部署模式，false表示单机或者伪分布式模式，true表示完全分布式模式。</span><br><span class="line">    <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span> hbase.rootdir <span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://mycluster:8020/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span> hbase.rootdir是RegionServer的共享目录，用于持久化存储HBase数据，默认写入/tmp中。如果不修改此配置，在HBase重启时，数&gt;据会丢失。此处一般设置的是hdfs的文件目录。hdfs端口可以查看hdfs-site.xml里的dfs.namenode.rpc-address.hdfscluster.nn1配置。</span><br><span class="line">    <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop1:2181,hadoop2:2181,hadoop3:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>此项用于配置ZooKeeper集群所在的主机地址，我这里zk跟hadoop运行在一起。</span><br><span class="line">    <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.dataDir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop/zookeeper-3.4.8/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>此项用于设置存储ZooKeeper的元数据，如果不设置默认存在/tmp下，重启时数据会丢失。这里的zookeeper数据目录与hadoop ha的共</span><br><span class="line">用，也即要与 zoo.cfg 中配置的一致。</span><br><span class="line">    <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>修改 hbase-env.sh</strong> 添加 Java 运行环境</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop1 ~]$ vim hbase-2.3.6/conf/hbase-env.sh</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/home/hadoop/jdk1.8.0_301</span><br></pre></td></tr></table></figure><p><strong>修改 regionserver</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop1 ~]$ vim hbase-2.3.6/conf/regionservers</span><br><span class="line">hadoop1</span><br><span class="line">hadoop2</span><br><span class="line">hadoop3</span><br></pre></td></tr></table></figure><p><strong>创建 backup-masters</strong> 备用master配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop1 ~]$ vim hbase-2.3.6/conf/backup-masters</span><br><span class="line">hadoop2</span><br><span class="line">hadoop3</span><br></pre></td></tr></table></figure><p><strong>同步hbase节点配置</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop1 ~]$ rsync -av hbase-2.3.6 hadoop@hadoop2:~/</span><br><span class="line">[hadoop@hadoop1 ~]$ rsync -av hbase-2.3.6 hadoop@hadoop3:~/</span><br></pre></td></tr></table></figure><h3 id="3-2-启动-HBase"><a href="#3-2-启动-HBase" class="headerlink" title="3.2 启动 HBase"></a>3.2 启动 HBase</h3><p><strong>启动所有服务</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop1 ~]$ <span class="built_in">cd</span> hbase-2.3.6/bin/</span><br><span class="line">[hadoop@hadoop1 ~/hbase-2.3.6/bin]$ ./start-hbase.sh</span><br></pre></td></tr></table></figure><p>也可以只启动单个服务</p><blockquote><p>#启动hbase master<br>hbase-daemon.sh start master</p><p>#启动hbase regionserver<br>hbase-daemon.sh start regionserver</p></blockquote><p><strong>查看 hbase 服务进程</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop1 ~]$ jps</span><br><span class="line">16883 HRegionServer</span><br><span class="line">18197 Jps</span><br><span class="line">1656 QuorumPeerMain</span><br><span class="line">23208 NameNode</span><br><span class="line">23560 JournalNode</span><br><span class="line">24234 NodeManager</span><br><span class="line">24109 ResourceManager</span><br><span class="line">16685 HMaster</span><br><span class="line">23342 DataNode</span><br><span class="line">23886 DFSZKFailoverController</span><br><span class="line"></span><br><span class="line">[hadoop@hadoop2 ~]$ jps</span><br><span class="line">577 DFSZKFailoverController</span><br><span class="line">17537 HMaster</span><br><span class="line">1138 ResourceManager</span><br><span class="line">17315 HRegionServer</span><br><span class="line">18378 Jps</span><br><span class="line">13403 QuorumPeerMain</span><br><span class="line">32765 DataNode</span><br><span class="line">429 JournalNode</span><br><span class="line">32622 NameNode</span><br><span class="line">878 NodeManager</span><br><span class="line"></span><br><span class="line">[hadoop@hadoop3 ~]$ jps</span><br><span class="line">26432 JournalNode</span><br><span class="line">11332 QuorumPeerMain</span><br><span class="line">26699 NodeManager</span><br><span class="line">3259 Jps</span><br><span class="line">2348 HMaster</span><br><span class="line">2125 HRegionServer</span><br><span class="line">26286 DataNode</span><br></pre></td></tr></table></figure><h3 id="3-3-访问-HBase-Web-UI"><a href="#3-3-访问-HBase-Web-UI" class="headerlink" title="3.3 访问 HBase Web UI"></a>3.3 访问 HBase Web UI</h3><p>HBase Web UI使用的HTTP端口Master的16010和RegionServer的16030。<br>如果一切设置正确，能够使用 Web 浏览器连接到 Master，或辅助Master 的 UI</p><p><strong>Master Web UI</strong><br><img src="/2021/10/18/hadoop-nosql-shu-ju-ku-hbase/%E5%9B%BE%E7%89%876.png" alt="图片6"></p><p><strong>RegionServer Web UI</strong><br><img src="/2021/10/18/hadoop-nosql-shu-ju-ku-hbase/%E5%9B%BE%E7%89%877.png" alt="图片7"></p><h2 id="四、HBase-Shell"><a href="#四、HBase-Shell" class="headerlink" title="四、HBase Shell"></a>四、HBase Shell</h2><h3 id="4-1-HBase-Shell-常用命令"><a href="#4-1-HBase-Shell-常用命令" class="headerlink" title="4.1 HBase Shell 常用命令"></a>4.1 HBase Shell 常用命令</h3><table><thead><tr><th>命名</th><th>描述</th><th>语法</th></tr></thead><tbody><tr><td><strong>通用命令</strong></td><td></td><td></td></tr><tr><td>help ‘命令名’</td><td>查看命令的使用描述</td><td>help <code>&#39;命令名&#39;</code></td></tr><tr><td>whoami</td><td>我是谁</td><td>whoami</td></tr><tr><td>version</td><td>返回hbase版本信息</td><td>version</td></tr><tr><td>status</td><td>返回hbase集群的状态信息</td><td>status</td></tr><tr><td>table_help</td><td>查看如何操作表</td><td>table_help</td></tr><tr><td>tools</td><td>列出hbase所支持的工具</td><td>tools</td></tr><tr><td>shutdown</td><td>关闭hbase集群（与exit不同）</td><td>shutdown</td></tr><tr><td>exit</td><td>退出hbase shell</td><td>exit</td></tr><tr><td><strong>数据定义语言 DDL</strong></td><td></td><td></td></tr><tr><td>create</td><td>创建表</td><td>create <code>&#39;表名&#39;,&#39;列族名1&#39;,&#39;列族名2&#39;,&#39;列族名N&#39;</code></td></tr><tr><td>alter</td><td>修改列族</td><td>添加一个列族：alter <code>&#39;表名&#39;,&#39;列族名&#39;</code><br>删除列族：alter <code>&#39;表名&#39;,{NAME=&gt; &#39;列族名&#39;,METHOD=&gt; &#39;delete&#39;}</code></td></tr><tr><td>describe</td><td>显示表相关的详细信息</td><td>describe <code>&#39;表名&#39;</code></td></tr><tr><td>list</td><td>列出hbase中存在的所有表</td><td>list</td></tr><tr><td>exists</td><td>测试表是否存在</td><td>exists <code>&#39;表名&#39;</code></td></tr><tr><td>enable</td><td>使表有效</td><td>enable <code>&#39;表名&#39;</code></td></tr><tr><td>is_enabled</td><td>是否启用</td><td>is_enabled <code>&#39;表名&#39;</code></td></tr><tr><td>disable</td><td>使表无效</td><td>disable <code>&#39;表名&#39;</code></td></tr><tr><td>is_disabled</td><td>是否无效</td><td>is_disabled <code>&#39;表名&#39;</code></td></tr><tr><td>drop</td><td>删除表</td><td>drop的表必须是disable的 <code>&#39;disable&#39;</code> 表名,<code>&#39;drop&#39;</code> 表名</td></tr><tr><td>drop_all</td><td>删除满足正则表达式的所有表</td><td>drop_all <code>&#39;正则表达式&#39;</code></td></tr><tr><td>truncate</td><td>重新创建指定表</td><td>truncate <code>&#39;表名&#39;</code></td></tr><tr><td><strong>数据操纵语言 DML</strong></td><td></td><td></td></tr><tr><td>delete</td><td>删除指定对象的值（可以为表，行，列对应的值，另外也可以指定时间戳的值）</td><td>删除列族的某个列： delete <code>&#39;表名&#39;,&#39;行键&#39;,&#39;列族名:列名&#39;</code></td></tr><tr><td>deleteall</td><td>删除指定行的所有元素值</td><td>deleteall <code>&#39;表名&#39;,&#39;行键&#39;</code></td></tr><tr><td>get_counter</td><td>获取计数器</td><td>get_counter <code>&#39;表名&#39;,&#39;行键&#39;,&#39;列族:列名&#39;</code></td></tr><tr><td>put</td><td>添加或修改的表的值</td><td>put <code>&#39;表名&#39;,&#39;行键&#39;,&#39;列族名&#39;,&#39;列值&#39;</code><br>put <code>&#39;表名&#39;,&#39;行键&#39;,&#39;列族名:列名&#39;,&#39;列值&#39;</code></td></tr><tr><td>scan</td><td>通过对表的扫描来获取对用的值</td><td>scan <code>&#39;表名&#39;</code><br>扫描某个列族： scan <code>&#39;表名&#39;, {COLUMN=&gt;&#39;列族名&#39;}</code><br>扫描列族的某个列： scan <code>&#39;表名&#39;, {COLUMN=&gt;&#39;列族名:列名&#39;}</code><br>查询同一个列族的多个列： scan <code>&#39;表名&#39;, {COLUMNS =&gt; [&#39;列族名1:列名1&#39;,&#39;列族名1:列名2&#39;, …]}</code></td></tr><tr><td>get</td><td>获取行或单元（cell）的值</td><td>get <code>&#39;表名&#39;, &#39;行键&#39;</code><br>get <code>&#39;表名&#39;, &#39;行键&#39;, &#39;列族名&#39;</code></td></tr><tr><td>count</td><td>统计表中行的数量</td><td>count <code>&#39;表名&#39;</code></td></tr><tr><td>incr</td><td>增加指定表行或列的值</td><td>incr <code>&#39;表名&#39;, &#39;行键&#39;,&#39;列族:列名&#39;,步长值</code></td></tr></tbody></table><style>table th:first-of-type{width:130px}table th:nth-of-type(2){width:200px}</style><h3 id="4-2-HBase-Shell-常用操作"><a href="#4-2-HBase-Shell-常用操作" class="headerlink" title="4.2 HBase Shell 常用操作"></a>4.2 HBase Shell 常用操作</h3><p><strong>使用shell登录</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hbase shell</span><br></pre></td></tr></table></figure><p><strong>create 创建一个表</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):006:0&gt; create 'member','member_id','address','info'</span><br></pre></td></tr></table></figure><p><strong>describe 查看表的描述</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):008:0&gt; describe 'member'</span><br></pre></td></tr></table></figure><p><strong>对表添加一个列族</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):009:0&gt; alter 'member','id'</span><br></pre></td></tr></table></figure><p><strong>删除一个列族</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):010:0&gt; alter 'member', &#123;NAME =&gt; 'member_id', METHOD =&gt; 'delete'&#125;</span><br></pre></td></tr></table></figure><p><strong>删除列</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通过delete命令，我们可以删除id为某个值的‘info:age’字段</span></span><br><span class="line">hbase(main):011:0&gt; delete 'member','debugo','info:age'</span><br><span class="line">hbase(main):012:0&gt; get 'member','debugo','info:age'</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除整行的值：deleteall</span></span><br><span class="line">hbase(main):014:0&gt; deleteall 'member','debugo'</span><br></pre></td></tr></table></figure><p><strong>启动/禁用表</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通过enable和disable来启用/禁用这个表,相应的可以通过is_enabled和is_disabled来检查表是否被禁用</span></span><br><span class="line">hbase(main):016:0&gt; is_enabled 'member'</span><br><span class="line">true</span><br><span class="line">Took 0.0427 seconds</span><br><span class="line">=&gt; true</span><br><span class="line"></span><br><span class="line">hbase(main):017:0&gt; disable 'member'</span><br><span class="line">hbase(main):018:0&gt; is_enabled 'member'</span><br><span class="line">false</span><br><span class="line">Took 0.0155 seconds</span><br><span class="line">=&gt; false</span><br><span class="line"></span><br><span class="line">hbase(main):019:0&gt; enable 'member'</span><br><span class="line">hbase(main):020:0&gt; is_enabled 'member'</span><br><span class="line">true</span><br><span class="line">Took 0.0150 seconds</span><br><span class="line">=&gt; true</span><br></pre></td></tr></table></figure><p><strong>exists 检查表是否存在</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):021:0&gt; exists 'member'</span><br><span class="line">Table member does exist</span><br><span class="line">Took 0.0117 seconds</span><br><span class="line">=&gt; true</span><br></pre></td></tr></table></figure><p><strong>drop 删除表</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除表需要先将表disable</span></span><br><span class="line">hbase(main):025:0&gt; disable 'test'</span><br><span class="line">hbase(main):026:0&gt; drop 'test'</span><br></pre></td></tr></table></figure><p><strong>put 推送数据到HBase表</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):030:0&gt; create 'table1','id','address','info'</span><br><span class="line">hbase(main):032:0&gt; put 'table1', 'zhangsan','id','11'</span><br><span class="line">hbase(main):033:0&gt; put 'table1', 'zhangsan','info:age','20'</span><br><span class="line">hbase(main):034:0&gt; put 'table1', 'zhangsan','info:birthday','2001-01-11'</span><br><span class="line">hbase(main):035:0&gt; put 'table1', 'zhangsan','info:industry', 'it'</span><br><span class="line">hbase(main):036:0&gt; put 'table1', 'zhangsan','address:city','beijing'</span><br><span class="line">hbase(main):037:0&gt; put 'table1', 'zhangsan','address:country','china'</span><br></pre></td></tr></table></figure><p><strong>count</strong><br>查询表中有多少行</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):043:0&gt; count 'table1'</span><br></pre></td></tr></table></figure><p><strong>get</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取一个id的所有数据</span></span><br><span class="line">hbase(main):046:0&gt; get 'table1','zhangsan'</span><br><span class="line">COLUMN                             CELL</span><br><span class="line"> address:city                      timestamp=2021-10-21T14:48:51.493, value=beijing</span><br><span class="line"> address:country                   timestamp=2021-10-21T14:49:07.554, value=china</span><br><span class="line"> id:                               timestamp=2021-10-21T14:47:23.091, value=11</span><br><span class="line"> info:age                          timestamp=2021-10-21T14:47:31.087, value=20</span><br><span class="line"> info:birthday                     timestamp=2021-10-21T14:48:09.703, value=2001-01-11</span><br><span class="line"> info:industry                     timestamp=2021-10-21T14:48:33.678, value=it</span><br><span class="line">1 row(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">#获得一个id，在一个列簇（一个列）中的所有数据</span></span><br><span class="line">hbase(main):047:0&gt; get 'table1','zhangsan','info'</span><br><span class="line">COLUMN                             CELL</span><br><span class="line"> info:age                          timestamp=2021-10-21T14:47:31.087, value=20</span><br><span class="line"> info:birthday                     timestamp=2021-10-21T14:48:09.703, value=2001-01-11</span><br><span class="line"> info:industry                     timestamp=2021-10-21T14:48:33.678, value=it</span><br><span class="line">1 row(s)</span><br></pre></td></tr></table></figure><p><strong>scan</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查询整表数据</span></span><br><span class="line">hbase(main):048:0&gt; scan 'table1'</span><br><span class="line">ROW                                COLUMN+CELL</span><br><span class="line"> zhangsan                          column=address:city, timestamp=2021-10-21T14:48:51.493, value=beijing</span><br><span class="line"> zhangsan                          column=address:country, timestamp=2021-10-21T14:49:07.554, value=china</span><br><span class="line"> zhangsan                          column=id:, timestamp=2021-10-21T14:47:23.091, value=11</span><br><span class="line"> zhangsan                          column=info:age, timestamp=2021-10-21T14:47:31.087, value=20</span><br><span class="line"> zhangsan                          column=info:birthday, timestamp=2021-10-21T14:48:09.703, value=2001-01-11</span><br><span class="line"> zhangsan                          column=info:industry, timestamp=2021-10-21T14:48:33.678, value=it</span><br><span class="line">1 row(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">#扫描整个列簇</span></span><br><span class="line">hbase(main):049:0&gt; scan 'table1',&#123;COLUMN=&gt;'info'&#125;</span><br><span class="line">ROW                                COLUMN+CELL</span><br><span class="line"> zhangsan                          column=info:age, timestamp=2021-10-21T14:47:31.087, value=20</span><br><span class="line"> zhangsan                          column=info:birthday, timestamp=2021-10-21T14:48:09.703, value=2001-01-11</span><br><span class="line"> zhangsan                          column=info:industry, timestamp=2021-10-21T14:48:33.678, value=it</span><br><span class="line">1 row(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定扫描其中的某个列</span></span><br><span class="line">hbase(main):050:0&gt; scan 'table1',&#123;COLUMNS=&gt;'info:age'&#125;</span><br><span class="line">ROW                                COLUMN+CELL</span><br><span class="line"> debugo                            column=info:age, timestamp=2021-10-21T14:47:31.087, value=20</span><br><span class="line">1 row(s)</span><br></pre></td></tr></table></figure></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Hadoop/" rel="tag"><i class="fa fa-tag"></i> Hadoop</a><a href="/tags/HBase/" rel="tag"><i class="fa fa-tag"></i> HBase</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2021/10/15/hadoop-shell-chang-yong-ming-ling/" rel="next" title="Hadoop Shell常用命令"><i class="fa fa-chevron-left"></i> Hadoop Shell常用命令</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2021/10/21/hadoop-fen-bu-shi-shu-ju-cang-ku-hive/" rel="prev" title="Hadoop 分布式数据仓库Hive">Hadoop 分布式数据仓库Hive<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"><span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a><a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/chen.png" alt="Zhongzhou Chen"><p class="site-author-name" itemprop="name">Zhongzhou Chen</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">314</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">84</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">180</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、简介"><span class="nav-text">一、简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、HBase-原理"><span class="nav-text">二、HBase 原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-HBase-概述"><span class="nav-text">2.1 HBase 概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-HBase-核心概念"><span class="nav-text">2.2 HBase 核心概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-HBase-的关键流程"><span class="nav-text">2.3 HBase 的关键流程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-1-Region的分配"><span class="nav-text">2.3.1 Region的分配</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-2-RegionServer上线"><span class="nav-text">2.3.2 RegionServer上线</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-3-RegionServer下线"><span class="nav-text">2.3.3 RegionServer下线</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-4-Master上线"><span class="nav-text">2.3.4 Master上线</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-5-Master下线"><span class="nav-text">2.3.5 Master下线</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-6-读请求处理过程"><span class="nav-text">2.3.6 读请求处理过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-7-写请求处理过程"><span class="nav-text">2.3.7 写请求处理过程</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、HBase-集群部署"><span class="nav-text">三、HBase 集群部署</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-修改-HBase配置文件"><span class="nav-text">3.1 修改 HBase配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-启动-HBase"><span class="nav-text">3.2 启动 HBase</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-访问-HBase-Web-UI"><span class="nav-text">3.3 访问 HBase Web UI</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、HBase-Shell"><span class="nav-text">四、HBase Shell</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-HBase-Shell-常用命令"><span class="nav-text">4.1 HBase Shell 常用命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-HBase-Shell-常用操作"><span class="nav-text">4.2 HBase Shell 常用操作</span></a></li></ol></li></ol></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Zhongzhou Chen</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">752.6k</span></div><span class="post-meta-divider"></span></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code").find(".line").map(function(t,e){return $(e).text()}).toArray().join("\n"),n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();var o=document.execCommand("copy");document.body.removeChild(n),o?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})</script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,s){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var o=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,n=document.getElementById(e),r=document.getElementById(s);n.addEventListener("input",function(){var y=n.value.trim().toLowerCase(),T=y.split(/[\s\-]+/);1<T.length&&T.push(y);var b=[];if(0<y.length&&o.forEach(function(t){function e(t,e,o,n){for(var r=n[n.length-1],s=r.position,a=r.word,i=[],c=0;s+a.length<=o&&0!=n.length;){a===y&&c++,i.push({position:s,length:a.length});var l=s+a.length;for(n.pop();0!=n.length&&(s=(r=n[n.length-1]).position,a=r.word,s<l);)n.pop()}return h+=c,{hits:i,start:e,end:o,searchTextCount:c}}function o(o,t){var n="",r=t.start;return t.hits.forEach(function(t){n+=o.substring(r,t.position);var e=t.position+t.length;n+='<b class="search-keyword">'+o.substring(t.position,e)+"</b>",r=e}),n+=o.substring(r,t.end)}var n=!1,r=0,h=0,s=t.title.trim(),a=s.toLowerCase(),i=t.content.trim().replace(/<[^>]+>/g,""),c=i.toLowerCase(),l=decodeURIComponent(t.url),p=[],u=[];if(""!=s&&(T.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());-1<(s=e.indexOf(t,r));)a.push({position:s,word:t}),r=s+n;return a}p=p.concat(e(t,a,!1)),u=u.concat(e(t,c,!1))}),(0<p.length||0<u.length)&&(n=!0,r=p.length+u.length)),n){[p,u].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var f=[];0!=p.length&&f.push(e(0,0,s.length,p));for(var d=[];0!=u.length;){var g=u[u.length-1],v=g.position,$=g.word,C=v-20,m=v+80;C<0&&(C=0),m<v+$.length&&(m=v+$.length),m>i.length&&(m=i.length),d.push(e(0,C,m,u))}d.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var x=parseInt("1");0<=x&&(d=d.slice(0,x));var w="";w+=0!=f.length?"<li><a href='"+l+"' class='search-result-title'>"+o(s,f[0])+"</a>":"<li><a href='"+l+"' class='search-result-title'>"+s+"</a>",d.forEach(function(t){w+="<a href='"+l+'\'><p class="search-result">'+o(i,t)+"...</p></a>"}),w+="</li>",b.push({item:w,searchTextCount:h,hitCount:r,id:b.length})}}),1===T.length&&""===T[0])r.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===b.length)r.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{b.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var e='<ul class="search-result-list">';b.forEach(function(t){e+=t.item}),e+="</ul>",r.innerHTML=e}}),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script type="text/javascript" src="/js/src/love.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,log:!1,model:{jsonPath:"/live2dw/assets/shizuku.model.json"},display:{position:"right"},mobile:{show:!0,scale:.2},react:{opacityDefault:.7,opacityOnHover:.2,opacity:.4}})</script></body></html>