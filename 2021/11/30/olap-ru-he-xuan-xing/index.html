<!-- build time:Tue Dec 21 2021 14:39:49 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><script></script><meta name="theme-color" content="#222"><style>.pace .pace-progress{background:#1E92FB;height:3px}.pace .pace-progress-inner{box-shadow:0 0 10px #1E92FB,0 0 5px #1E92FB}.pace .pace-activity{border-top-color:#1E92FB;border-left-color:#1E92FB}</style><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="HGM141IpbHrSmnAmR6W_zE4bo9Z3f-yXLeHYT3bg1fk"><meta name="baidu-site-verification" content="code-5Ai1DA8e6T"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="Hadoop,OLAP,"><link rel="alternate" href="/atom.xml" title="凡间的精灵" type="application/atom+xml"><meta name="description" content="一、OLAP 简介OLAP，也叫联机分析处理（Online Analytical Processing）系统，有的时候也叫DSS决策支持系统，就是我们说的数据仓库。与此相对的是OLTP（on-line transaction processing）联机事务处理系统。联机分析处理 (OLAP) 的概念最早是由关系数据库之父E.F.Codd于1993年提出的。OLAP的提出引起了很大的反响，OLAP作"><meta name="keywords" content="Hadoop,OLAP"><meta property="og:type" content="article"><meta property="og:title" content="OLAP 如何选型"><meta property="og:url" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;11&#x2F;30&#x2F;olap-ru-he-xuan-xing&#x2F;index.html"><meta property="og:site_name" content="凡间的精灵"><meta property="og:description" content="一、OLAP 简介OLAP，也叫联机分析处理（Online Analytical Processing）系统，有的时候也叫DSS决策支持系统，就是我们说的数据仓库。与此相对的是OLTP（on-line transaction processing）联机事务处理系统。联机分析处理 (OLAP) 的概念最早是由关系数据库之父E.F.Codd于1993年提出的。OLAP的提出引起了很大的反响，OLAP作"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;11&#x2F;30&#x2F;olap-ru-he-xuan-xing&#x2F;%E5%9B%BE%E7%89%871.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;11&#x2F;30&#x2F;olap-ru-he-xuan-xing&#x2F;%E5%9B%BE%E7%89%872.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;11&#x2F;30&#x2F;olap-ru-he-xuan-xing&#x2F;%E5%9B%BE%E7%89%873.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;11&#x2F;30&#x2F;olap-ru-he-xuan-xing&#x2F;%E5%9B%BE%E7%89%874.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;11&#x2F;30&#x2F;olap-ru-he-xuan-xing&#x2F;%E5%9B%BE%E7%89%875.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;11&#x2F;30&#x2F;olap-ru-he-xuan-xing&#x2F;%E5%9B%BE%E7%89%877.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;11&#x2F;30&#x2F;olap-ru-he-xuan-xing&#x2F;%E5%9B%BE%E7%89%876.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;11&#x2F;30&#x2F;olap-ru-he-xuan-xing&#x2F;%E5%9B%BE%E7%89%878.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;11&#x2F;30&#x2F;olap-ru-he-xuan-xing&#x2F;%E5%9B%BE%E7%89%879.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;11&#x2F;30&#x2F;olap-ru-he-xuan-xing&#x2F;%E5%9B%BE%E7%89%8710.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;11&#x2F;30&#x2F;olap-ru-he-xuan-xing&#x2F;%E5%9B%BE%E7%89%8711.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;11&#x2F;30&#x2F;olap-ru-he-xuan-xing&#x2F;%E5%9B%BE%E7%89%8712.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;11&#x2F;30&#x2F;olap-ru-he-xuan-xing&#x2F;%E5%9B%BE%E7%89%8713.png"><meta property="og:updated_time" content="2021-12-01T08:05:21.040Z"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2021&#x2F;11&#x2F;30&#x2F;olap-ru-he-xuan-xing&#x2F;%E5%9B%BE%E7%89%871.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"always",offset:12,b2t:!0,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://chenzhonzhou.github.io/2021/11/30/olap-ru-he-xuan-xing/"><title>OLAP 如何选型 | 凡间的精灵</title><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">凡间的精灵</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">凡尘落素一精灵</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://chenzhonzhou.github.io/2021/11/30/olap-ru-he-xuan-xing/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Zhongzhou Chen"><meta itemprop="description" content=""><meta itemprop="image" content="/images/chen.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="凡间的精灵"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">OLAP 如何选型</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-30T15:22:53+08:00">2021-11-30 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Hadoop/" itemprop="url" rel="index"><span itemprop="name">Hadoop</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">9.5k </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">34</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="一、OLAP-简介"><a href="#一、OLAP-简介" class="headerlink" title="一、OLAP 简介"></a>一、OLAP 简介</h2><p><strong>OLAP</strong>，也叫<strong>联机分析处理（Online Analytical Processing）</strong>系统，有的时候也叫DSS决策支持系统，就是我们说的数据仓库。与此相对的是<strong>OLTP（on-line transaction processing）联机事务处理</strong>系统。</p><p>联机分析处理 (OLAP) 的概念最早是由关系数据库之父<strong>E.F.Codd</strong>于1993年提出的。OLAP的提出引起了很大的反响，OLAP作为一类产品同联机事务处理 (OLTP) 明显区分开来。</p><p>Codd认为联机事务处理（OLTP）已不能满足终端用户对数据库查询分析的要求，SQL对大数据库的简单查询也不能满足用户分析的需求。用户的决策分析需要对关系数据库进行大量计算才能得到结果，而查询的结果并不能满足决策者提出的需求。因此，Codd提出了多维数据库和多维分析的概念，即OLAP。</p><p>OLAP委员会对联机分析处理的定义为：从原始数据中转化出来的、能够真正为用户所理解的、并真实反映企业多维特性的数据称为信息数据，使分析人员、管理人员或执行人员能够从多种角度对信息数据进行快速、一致、交互地存取，从而获得对数据的更深入了解的一类软件技术。OLAP的目标是满足决策支持或多维环境特定的查询和报表需求，它的技术核心是”维”这个概念，因此OLAP也可以说是多维数据分析工具的集合。</p><h2 id="二、OLAP-的准则和特性"><a href="#二、OLAP-的准则和特性" class="headerlink" title="二、OLAP 的准则和特性"></a>二、OLAP 的准则和特性</h2><p><strong>E.F.Codd提出了关于OLAP的12条准则</strong></p><ol><li>准则1 OLAP模型必须提供多维概念视图</li><li>准则2 透明性准则</li><li>准则3 存取能力准则</li><li>准则4 稳定的报表能力</li><li>准则5 客户/服务器体系结构</li><li>准则6 维的等同性准则</li><li>准则7 动态的稀疏矩阵处理准则</li><li>准则8 多用户支持能力准则</li><li>准则9 非受限的跨维操作</li><li>准则10 直观的数据操纵</li><li>准则11 灵活的报表生成</li><li>准则12 不受限的维与聚集层次</li></ol><p><strong>OLAP场景的关键特征</strong></p><ol><li>大多数是读请求</li><li>数据总是以相当大的批(&gt; 1000 rows)进行写入</li><li>不修改已添加的数据</li><li>每次查询都从数据库中读取大量的行，但是同时又仅需要少量的列</li><li>宽表，即每个表包含着大量的列</li><li>较少的查询(通常每台服务器每秒数百个查询或更少)</li><li>对于简单查询，允许延迟大约50毫秒</li><li>列中的数据相对较小：数字和短字符串(例如，每个URL 60个字节)</li><li>处理单个查询时需要高吞吐量（每个服务器每秒高达数十亿行）</li><li>事务不是必须的</li><li>对数据一致性要求低</li><li>每一个查询除了一个大表外都很小</li><li>查询结果明显小于源数据，换句话说，数据被过滤或聚合后能够被盛放在单台服务器的内存中</li></ol><blockquote><p>OLTP系统强调数据库内存效率，强调内存各种指标的命令率，强调绑定变量，强调并发操作，强调事务性；<br>OLAP系统则强调数据分析，强调SQL执行时长，强调磁盘I/O，强调分区。</p></blockquote><h2 id="三、OLAP-开源引擎"><a href="#三、OLAP-开源引擎" class="headerlink" title="三、OLAP 开源引擎"></a>三、OLAP 开源引擎</h2><p>目前市面上主流的开源OLAP引擎包含不限于：Hive、Hawq、Presto、Kylin、Impala、Sparksql、Druid、Clickhouse、Greeplum等，可以说目前没有一个引擎能在数据量，灵活程度和性能上做到完美，用户需要根据自己的需求进行选型。</p><p>开源大数据OLAP组件，可以分为MOLAP和ROLAP两类。ROLAP中又可细分为MPP数据库和SQL引擎两类。对于SQL引擎又可以再细分为基于MPP架构的SQL引擎和基于通用计算框架的SQL引擎。</p><p><img src="/2021/11/30/olap-ru-he-xuan-xing/%E5%9B%BE%E7%89%871.png" alt="图片1"></p><p>MOLAP一般对数据存储有优化，并且进行部分预计算，因此查询性能最高。但通常对查询灵活性有限制。</p><p>MPP数据库是个完整的数据库，通常数据需要导入其中才能完成OLAP功能。MPP数据库在数据入库时对数据分布可以做优化，虽然入库效率有一定下降，但是对后期查询性能的提高有很大帮助。MPP数据库可以提供灵活的即席查询能力，但一般对查询数据量有一定限制，无法支撑特别大的数据量的查询。</p><p>SQL引擎只提供SQL执行的能力，本身一般不负责数据存储，通常可以对接多种数据储存，如HDFS、HBase、MySQL等。有的还支持联邦查询能力，可以对多个异构数据源进行联合分析。SQL引擎中，基于MPP架构的SQL引擎，一般对在线查询场景有特殊优化，所以端到端查询性能一般要高于基于通用计算框架的SQL引擎；但是在容错性和数据量方面又会逊于基于通用计算框架的SQL引擎。</p><h3 id="3-1-Kylin"><a href="#3-1-Kylin" class="headerlink" title="3.1 Kylin"></a>3.1 Kylin</h3><p>Apache <a href="https://kylin.apache.org/cn/" target="_blank" rel="noopener">Kylin</a> 是一个开源的分布式分析引擎，提供 Hadoop/Spark 之上的 SQL 查询接口及多维分析（OLAP）能力以支持超大规模数据，它能在亚秒内查询巨大的 Hive 表。Kylin的核心思想是预计算，理论基础是：以空间换时间。即将多维分析可能用到的度量进行预计算，将计算好的结果保存成Cube并存储到HBase中，供查询时直接访问。把高复杂度的聚合运算，多表连接等操作转换成对预计算结果的查询。</p><p>Kylin的主要特点是预计算，提前计算好各个cube，这样的优点是查询快速，秒级延迟；缺点也非常明显，灵活性不足，无法做一些探索式的，关联性的数据分析。</p><p><img src="/2021/11/30/olap-ru-he-xuan-xing/%E5%9B%BE%E7%89%872.png" alt="图片2"></p><p><strong>Kylin的核心模块</strong>：</p><blockquote><p><strong>REST Server：</strong>提供 Restful 接口，例如创建、构建、刷新、合并等 Cube 相关操作，Kylin 的 Projects、Tables 等元数据管理，用户访问权限控制，SQL 的查询等；<br><strong>Query Engine：</strong>使用开源的 Apache Calcite 框架来实现 SQL 解析，可以理解为 SQL 引擎层；<br><strong>Routing：</strong>负责将解析 SQL 生成的执行计划转换成 Cube 缓存的查询，这部分查询是可以在秒级甚至毫秒级完成；<br><strong>Metadata：</strong>Kylin 中有大量的元数据信息，包括 Cube 的定义、星型模型的定义、Job 和执行 Job 的输出信息、模型的维度信息等等，Kylin 的元数据和 Cube 都存储在 HBase 中，存储的格式是 json 字符串；<br><strong>Cube Build Engine：</strong>所有模块的基础，它主要负责 Kylin 预计算中创建 Cube，创建的过程是首先通过 Hive 读取原始数据，然后通过一些 MapReduce 或 Spark 计算生成 Htable，最后将数据 load 到 HBase 表中。</p></blockquote><p><strong>整个系统分为两部分：</strong></p><ol><li><p>离线构建：</p><blockquote><p>1）数据源在左侧，目前主要是 Hadoop Hive，保存着待分析的用户数据；<br>2）根据元数据的定义，下方构建引擎从数据源抽取数据，并构建 Cube；<br>3）数据以关系表的形式输入，支持星形模型和雪花模型；<br>4）2.5 开始 Spark 是主要的构建技术（以前是MapReduce）；<br>5）构建后的 Cube 保存在右侧的存储引擎中，一般选用 HBase 作为存储。</p></blockquote></li><li><p>在线查询</p><blockquote><p>1）用户可以从上方查询系统（Rest API、JDBC/ODBC）发送 SQL 进行查询分析；<br>2）无论从哪个接口进入，SQL 最终都会来到 Rest 服务层，再转交给查询引擎进行处理；<br>3）查询引擎解析 SQL，生成基于关系表的逻辑执行计划；<br>4）然后将其转译为基于 Cube 的物理执行计划；<br>5）最后查询预计算生成的 Cube 并产生结果。</p></blockquote></li></ol><p><strong>优点</strong>：</p><blockquote><p>1）亚秒级查询响应；<br>2）支持百亿、千亿甚至万亿级别交互式分析；<br>3）无缝与 BI 工具集成；<br>4）支持增量刷新；</p></blockquote><p><strong>缺点</strong>：</p><blockquote><p>1）由于 Kylin 是一个分析引擎，只读，不支持 insert, update, delete 等 SQL 操作，用户修改数据的话需要重新批量导入（构建）；<br>2）需要预先建立模型后加载数据到 Cube 后才可进行查询；<br>3）使用 Kylin 的建模人员需要了解一定的数据仓库知识。</p></blockquote><h3 id="3-2-Druid"><a href="#3-2-Druid" class="headerlink" title="3.2 Druid"></a>3.2 Druid</h3><p><a href="https://druid.apache.org/" target="_blank" rel="noopener">Druid</a> 是一个高效的数据查询系统，主要解决的是对于大量的基于时序的数据进行聚合查询。数据可以实时摄入，进入到Druid后立即可查，同时数据是几乎是不可变。</p><p><img src="/2021/11/30/olap-ru-he-xuan-xing/%E5%9B%BE%E7%89%873.png" alt="图片3"></p><p>Druid是专为海量数据集上的做高性能 OLAP而设计的数据存储和分析系统。</p><p>Druid 采用了shared-nothing架构与lambda架构。</p><p>Druid的核心设计结合了数据仓库，时间序列数据库和搜索系统的思想，以创建一个统一的系统，用于针对各种用例的实时分析。Druid将这三个系统中每个系统的关键特征合并到其接收层，存储格式，查询层和核心体系结构中。</p><p>目前 Druid 的去重都是非精确的，Druid 适合处理星型模型的数据，不支持关联操作。也不支持数据的更新。</p><p>Druid有几种进程类型，简要描述如下：</p><blockquote><p><strong>Coordinators协调器进程：</strong>负责监控数据服务器上的Historicals进程，将Segments分配给特定的服务器，并负责确保Segments在多个Historicals之间保持平衡。<br><strong>Overlords进程：</strong>负责监控数据服务器上的MiddleManager进程，并控制数据获取任务的分配。<br><strong>Broker代理进程：</strong>处理来自外部客户端的查询，将查询转发给数据服务器去执行，并合并来自多个数据服务器的结果，返回给最终用户。<br><strong>Routers进程：</strong>是个可选进程，提供统一的API Gateway，可以将请求路由到Brokers、Overlords和Coordinators。<br><strong>Historicals进程：</strong>负责处理“历史数据”的查询。 它会从Deep Storage下载查询需要的Segments以加速查询。它不负责写入。<br><strong>MiddleManager进程：</strong>负责处理获取到新数据，从外部数据源读取数据并转换成Segments进行存储。</p></blockquote><p>Druid进程可以按照任何方式进行部署，但是为了易于部署，一般建议将它们组织为三种服务器类型：</p><blockquote><p><strong>主服务器：</strong>运行Coordinatos和Overlords进程，负责管理数据获取和数据可用性。<br><strong>查询服务器：</strong>运行Brokers和可选的Routers进程，处理来自外部客户端的查询。<br><strong>数据服务器：</strong>运行Historicals和MiddleManagers进程，负责执行数据获取任务并存储所有可查询的数据。</p></blockquote><p><strong>特点：</strong></p><blockquote><p><strong>面向列的存储：</strong>Druid 单独存储和压缩每一列，只需要读取特定查询所需的列，支持快速扫描、排名和 groupBys。<br><strong>本地搜索索引：</strong>Druid 为字符串值创建倒排索引以进行快速搜索和过滤。<br><strong>流式传输和批量摄取：</strong>适用于 Apache Kafka、HDFS、AWS S3、流处理器等的开箱即用连接器。<br><strong>灵活的模式：</strong>Druid 优雅地处理不断变化的模式和<a href="https://druid.apache.org/docs/latest/ingestion/flatten-json" target="_blank" rel="noopener">嵌套数据</a>。<br><strong>时间优化分区：</strong>Druid根据时间对数据进行智能分区，基于时间的查询速度明显快于传统数据库。<br><strong>SQL 支持：</strong>除了其原生的<a href="https://druid.apache.org/docs/latest/querying/querying" target="_blank" rel="noopener">基于 JSON 的语言外</a>，Druid 还通过 HTTP 或 JDBC 使用<a href="https://druid.apache.org/docs/latest/querying/sql" target="_blank" rel="noopener">SQL</a>。<br><strong>水平扩展性：</strong>Druid 已<a href="https://druid.apache.org/druid-powered" target="_blank" rel="noopener">在生产中</a>用于每秒摄取数百万个事件、保留多年数据并提供亚秒级查询。<br><strong>操作简单：</strong>只需添加或删除服务器即可扩大或缩小规模，Druid 会自动重新平衡。容错架构围绕服务器故障进行路由。</p></blockquote><p><strong>使用场景</strong>：</p><blockquote><p>1）需要实时分析，查询延迟为100毫秒到几秒钟；<br>2）插入率非常高，但更新不常见；<br>3）大多数查询都是聚合和报告查询；<br>4）数据有一个时间组件；<br>5）每个查询只能访问一个大的分布式表；<br>6）有高基数数据列，对它们进行快速计数和排名；<br>7）需要交互式和快速探究大量数据。</p></blockquote><p><strong>缺点：</strong></p><blockquote><p>1）灵活性适中，虽然维度之间随意组合，但不支持adhoc查询，不能自由组合查询，且丢失了明细数据（不采用roll-up情况下可以进行明细查询）；<br>2）易用性较差，不支持join，不支持更新，sql支持很弱(有些插件类似于pinot的PQL语言)，只能JSON格式查询，对于去重操作不能精准去重；<br>3）处理方式复杂，需要流处理引擎将数据join成宽表，维护相对复杂；对内存要求较高。</p></blockquote><h3 id="3-3-Greenplum"><a href="#3-3-Greenplum" class="headerlink" title="3.3 Greenplum"></a>3.3 Greenplum</h3><p><a href="https://greenplum.org/" target="_blank" rel="noopener">Greenplum</a> 是基于PostgreSQL的开源MPP数据库，具有良好的线性扩展能力，具有高效的并行运算和并行存储特性。</p><p><img src="/2021/11/30/olap-ru-he-xuan-xing/%E5%9B%BE%E7%89%874.png" alt="图片4"></p><p>Greenplum的系统架构实际上是多台PostgreSQL数据库服务器组成的矩阵，采用无共享(no shareing)的MPP架构：</p><blockquote><p><strong>Master节点：</strong>作为数据库的入口，负责客服端连接；对客服端的请求生成查询计划，分发给某个或者所有的Segment节点；<br><strong>Standby节点 :</strong> 作为master节点的备库，提供高可用性；<br><strong>Interconnect：</strong>是GreenPlum的网络层；负责每个节点之间的通信；<br><strong>Segment节点：</strong>为数据节点；接收master分发下来的查询计划；执行返回结果给master节点；<br><strong>Mirror Segment节点：</strong> 作为Segment节点的备库，提供高可用性；通常跟对应的segment节点不在同一台机器上。</p></blockquote><p><strong>优点</strong>：</p><blockquote><p>1）支持多态数据存储，允许用户根据应用定义数据分布方式，可提高查询性能；<br>2）具有高效的SQL优化器，针对OLAP查询进行优化。</p></blockquote><p><strong>缺点：</strong></p><blockquote><p>1）存在<strong><code>木桶效应</code></strong>，单机故障会导致性能严重下降，因此集群规模不能太大；<br>2）并发性能不高，通常无法支持超过30个并发。</p></blockquote><h3 id="3-4-ClickHouse"><a href="#3-4-ClickHouse" class="headerlink" title="3.4 ClickHouse"></a>3.4 ClickHouse</h3><p><a href="https://clickhouse.yandex/" target="_blank" rel="noopener">ClickHouse</a> 的全称是<strong>Click Stream，Data WareHouse</strong>，简称ClickHouse，是俄罗斯 Yandex 公司于2016年开源的列式存储数据库（DBMS)，主要用于联机分析处理查询（OLAP），能够使用SQL 查询实时生成分析数据报告。<br>目前ClickHouse公开的资料相对匮乏，比如在架构设计层面就很难找到完整的资料，甚至连一张整体的架构图都没有。</p><p>ClickHouse为什么性能这么好？</p><blockquote><p><strong>着眼硬件：</strong>基于将硬件功效最大化的目的，ClickHouse会在内存中进行GROUP BY；与此同时，他们非常在意CPU L3级别的缓存，因为一次L3的缓存失效会带来70～100ns的延迟，意味着在单核CPU上，它会浪费4000万次/秒的运算。正因为注意了这些细节，所以ClickHouse在基准查询中能做到1.75亿次/秒的数据扫描性能。</p><p><strong>注重算法：</strong>例如，在字符串搜索方面，针对不同的场景，ClickHouse选择了多种算法：对于常量，使用Volnitsky算法；对于非常量，使用CPU的向量化执行SIMD，暴力优化；正则匹配使用re2和hyperscan算法。除了字符串之外，其余的场景也与它类似，ClickHouse会使用最合适、最快的算法。如果世面上出现了号称性能强大的新算法，ClickHouse团队会立即将其纳入并进行验证。</p><p><strong>特定场景，特殊优化：</strong>针对同一个场景的不同状况，选择使用不同的实现方式，尽可能将性能最大化。对于数据结构比较清晰的场景，会通过代码生成技术实现循环展开，以减少循环次数。</p><p><strong>向量化执行：</strong>SIMD被广泛地应用于文本转换、数据过滤、数据解压和JSON转换等场景。相较于单纯地使用CPU，利用寄存器暴力优化也算是一种降维打击了。</p></blockquote><p><strong>优点</strong>：</p><blockquote><p>1）为了高效的使用CPU，数据不仅仅按列存储，同时还按向量进行处理；<br>2）数据压缩空间大，减少IO；处理单查询高吞吐量每台服务器每秒最多数十亿行；<br>3）索引非B树结构，不需要满足最左原则；只要过滤条件在索引列中包含即可；即使在使用的数据不在索引中，由于各种并行处理机制ClickHouse全表扫描的速度也很快；<br>4）写入速度非常快，50-200M/s，对于大量的数据更新非常适用。</p></blockquote><p><strong>缺点：</strong></p><blockquote><p>1）不支持事务，不支持真正的删除/更新；<br>2）不支持高并发，官方建议qps为100，可以通过修改配置文件增加连接数，但是在服务器足够好的情况下；<br>3）SQL满足日常使用80%以上的语法，join写法比较特殊；最新版已支持类似SQL的join，但性能不好；<br>4）尽量做1000条以上批量的写入，避免逐行insert或小批量的insert，update，delete操作，因为ClickHouse底层会不断的做异步的数据合并，会影响查询性能，这个在做实时数据写入的时候要尽量避开；<br>5）Clickhouse快是因为采用了并行处理机制，即使一个查询，也会用服务器一半的CPU去执行，所以ClickHouse不能支持高并发的使用场景，默认单查询使用CPU核数为服务器核数的一半，安装时会自动识别服务器核数，可以通过配置文件修改该参数。</p></blockquote><h3 id="3-5-Impala"><a href="#3-5-Impala" class="headerlink" title="3.5 Impala"></a>3.5 Impala</h3><p><a href="https://impala.apache.org/" target="_blank" rel="noopener">Impala</a> 是Cloudera 公司推出，提供对 HDFS、Hbase 数据的高性能、低延迟的交互式 SQL 查询功能。</p><p>Impala 使用 Hive的元数据, 完全在内存中计算。是CDH 平台首选的 PB 级大数据实时查询分析引擎。</p><p><img src="/2021/11/30/olap-ru-he-xuan-xing/%E5%9B%BE%E7%89%875.png" alt="图片5"></p><p>Impala采用MPP架构，与存储引擎解耦：</p><blockquote><p><strong>Impalad进程：</strong>是核心进程，负责接收查询请求并向多个数据节点分发任务。<br><strong>statestored进程：</strong>负责监控所有Impalad进程，并向集群中的节点报告各个Impalad进程的状态。<br><strong>catalogd进程：</strong>负责广播通知元数据的最新信息。</p></blockquote><p><strong>Impala的特性包括：</strong></p><blockquote><p>1）支持Parquet、Avro、Text、RCFile、SequenceFile等多种文件格式；<br>2）支持存储在HDFS、HBase、Amazon S3上的数据操作；<br>3）支持多种压缩编码方式：Snappy、Gzip、Deflate、Bzip2、LZO；<br>4）支持UDF和UDAF；<br>5）自动以最有效的顺序进行表连接；<br>6）允许定义查询的优先级排队策略；<br>7）支持多用户并发查询；<br>8）支持数据缓存；<br>9）提供计算统计信息（COMPUTE STATS）；<br>10）提供窗口函数（聚合 OVER PARTITION, RANK, LEAD, LAG, NTILE等等）以支持高级分析功能；<br>11）支持使用磁盘进行连接和聚合，当操作使用的内存溢出时转为磁盘操作；<br>12）允许在where子句中使用子查询；<br>13）允许增量统计——只在新数据或改变的数据上执行统计计算；<br>14）支持maps、structs、arrays上的复杂嵌套查询；<br>15）可以使用impala插入或更新HBase。</p></blockquote><p><strong>优点：</strong></p><blockquote><p>1）支持SQL查询，快速查询大数据；<br>2）可以对已有数据进行查询，减少数据的加载，转换；<br>3）多种存储格式可以选择（Parquet, Text, Avro, RCFile, SequeenceFile）；<br>4）可以与Hive配合使用。</p></blockquote><p><strong>缺点：</strong></p><blockquote><p>1）不支持用户定义函数UDF；<br>2）不支持text域的全文搜索；<br>3）不支持Transforms；<br>4）不支持查询期的容错；<br>5）对内存要求高。</p></blockquote><h3 id="3-6-Hawq"><a href="#3-6-Hawq" class="headerlink" title="3.6 Hawq"></a>3.6 Hawq</h3><p><a href="http://hawq.apache.org" target="_blank" rel="noopener">HAWQ</a> 是Pivotal公司开源的一个Hadoop原生大规模并行SQL分析引擎，针对的是分析型应用。Apache HAWQ 采用主从（Master-Slave）的改进MPP架构，通过将MPP与批处理系统有效的结合，克服了MPP的一些关键的限制问题，如短板效应、并发限制、扩展性等。其整体架构与Pivotal另一开源MPP数据库Greenplum比较相似。</p><p>下图提供了典型 HAWQ 部署的高级架构视图<br><img src="/2021/11/30/olap-ru-he-xuan-xing/%E5%9B%BE%E7%89%877.png" alt="图片7"></p><p>下图提供了构成 HAWQ 的软件组件的另一种视图<br><img src="/2021/11/30/olap-ru-he-xuan-xing/%E5%9B%BE%E7%89%876.png" alt="图片6"></p><p>HAWQ Master节点内部有以下几个重要组件：</p><blockquote><p>1）<strong>查询解析器（Parser/Analyzer）</strong>，负责解析查询，并检查语法及语义。最终生成查询树传递给优化器。<br>2）<strong>优化器（Optimizer）</strong>，负责接受查询树，生成查询计划。针对一个查询，可能有数亿个可能的等价的查询计划，但执行性能差异很大。优化器的做用是找出优化的查询计划。<br>3）<strong>资源管理器（Resource Manager）</strong>，资源管理器经过资源代理向全局资源管理器（好比YARN）动态申请资源。并缓存资源。在不须要的时候返回资源。<br>4）<strong>HDFS元数据缓存（HDFS Catalog Cache）</strong>，用于HAWQ确定哪些Segment扫描表的哪些部分。HAWQ是把计算派发到数据所在的地方。因此要匹配计算和数据的局部性。如果每一个查询都访问HDFS NameNode会形成NameNode的瓶颈。因此在HAWQ Master节点上创建了HDFS元数据缓存。<br>5）<strong>容错服务（Fault Tolerance Service）</strong>，负责检测哪些节点可用，哪些节点不可用。不可用的机器会被排除出资源池。<br>6）<strong>查询派遣器（Dispatcher）</strong>，优化器优化完查询之后，查询派遣器派遣计划到各个节点上执行，并协调查询执行的整个过程。查询派遣器是整个并行系统的粘合剂。<br>7）<strong>元数据服务（Catalog Service）</strong>，负责存储HAWQ的各类元数据，包括数据库和表信息，以及访问权限信息等。另外，元数据服务也是实现分布式事务的关键。<br>8）其余节点为Slave节点，每一个Slave节点上部署有HDFS DataNode，YARN NodeManager以及一个HAWQ Segment。HAWQ Segment在执行查询的时候会启动多个QE (Query Executor, 查询执行器)。查询执行器运行在资源容器里面。节点间数据交换经过Interconnect（高速互联网络）进行。</p></blockquote><p><strong>优点：</strong></p><blockquote><p>1）对SQL标准的完善支持：ANSI SQL标准，OLAP扩展，标准JDBC/ODBC支持；<br>2）支持ACID事务特性：这是很多现有基于Hadoop的SQL引擎做不到的，对保证数据一致性很重要；<br>3）动态数据流引擎：基于UDP的高速互联网络；<br>4）多种UDF（用户自定义函数）语言支持：java, python, c/c++, perl, R等；<br>5）动态扩容：动态按需扩容，按照存储大小或者计算需求，秒级添加节点；<br>6）支持MADlib机器学习。</p></blockquote><p><strong>缺点：</strong></p><blockquote><p>1）基于GreenPlum实现，技术实现复杂，包含多个组件。比如对于外部数据源，需要通过PXF单独进行处理；<br>2）C++实现，对内存的控制比较复杂，如果出现segmentfault直接导致当前node挂掉；<br>3）安装配置复杂。</p></blockquote><h3 id="3-7-Presto"><a href="#3-7-Presto" class="headerlink" title="3.7 Presto"></a>3.7 Presto</h3><p><a href="https://prestodb.io/" target="_blank" rel="noopener">Presto</a> 是由 Facebook 推出的一个基于Java开发的开源分布式SQL查询引擎，数据量支持GB到TB字节，presto本身不存数据，但是可以接入很多数据源，它使得用SQL访问任何数据源成为可能，而且支持跨数据源的级联查询。你可以使用Presto通过水平扩展查询处理的方式来查询大型数据集。</p><p>Presto相比ClickHouse优点主要是多表join效果好。相比ClickHouse的支持功能简单，场景支持单一，Presto支持复杂的查询，应用范围更广。</p><p><img src="/2021/11/30/olap-ru-he-xuan-xing/%E5%9B%BE%E7%89%878.png" alt="图片8"></p><p>Presto采用典型的Master-Slave架构：</p><blockquote><p>1）<strong>coordinator</strong>：是presto集群的master节点。负责解析SQL语句，生成执行计划，分发执行任务给Worker节点执行；<br>2）<strong>worker</strong>：是执行任务的节点。负责实际查询任务的计算和读写；<br>3）<strong>discovery service</strong>：是将coordinator和worker结合在一起服务。worker节点启动后向discovery service服务注册，coordinator通过discovery service获取注册的worker节点；<br>4）<strong>connector</strong>：presto以插件形式对数据存储层进行了抽象，即connector。可通过connector连接多种数据源，提取数据。</p></blockquote><p>discovery service 将coordinator和worker结合在一起服务； worker节点启动后向discovery service服务注册 coordinator通过discovery service获取注册的worker节点。</p><p><strong>优点：</strong></p><blockquote><p>1）基于内存运算，减少没必要的硬盘IO；<br>2）都能够处理PB级别的海量数据分析；（虽然能够处理PB级别的海量数据分析，但不是代表Presto把PB级别都放在内存中计算的。而是根据场景，如count，avg等聚合运算，是边读数据边计算，再清内存，再读数据再计算，这种耗的内存并不高。）<br>3）能够连接多个数据源，跨数据源关联查询；<br>4）清晰的架构，是一个能够独立运行的系统，不依赖于任何其他外部系统。部署简单。</p></blockquote><p><strong>缺点：</strong></p><blockquote><p>1）不适合多个大表的join操作，因为presto是基于内存的，太多数据内存放不下的；<br>2）Presto的一个权衡是不关心中间查询容错。如果其中一个Presto工作节点出现故障（例如，关闭），则大多数情况下正在进行的查询将中止并需要重新启动。</p></blockquote><h3 id="3-8-Drill"><a href="#3-8-Drill" class="headerlink" title="3.8 Drill"></a>3.8 Drill</h3><p><a href="https://drill.apache.org/" target="_blank" rel="noopener">Drill</a> 是MapR开源的一个低延迟的大数据集的分布式SQL查询引擎，是谷歌Dremel的开源实现。它支持对本地文件、HDFS、HBASE等数据进行数据查询，也支持对如JSON等schema-free的数据进行查询。</p><p><img src="/2021/11/30/olap-ru-he-xuan-xing/%E5%9B%BE%E7%89%879.png" alt="图片9"></p><p>从架构上看，与同是源自Dremel的Impala比较类似。Drill的核心是DrillBit，它主要负责接收客户端的请求，处理查询，并将结果返回给客户端。 Drill的查询流程包括以下步骤：</p><blockquote><p>1）Drill客户端发起查询，任意DrilBit都可以接受来自客户端的查询；<br>2）收到请求的DrillBit成为<strong>驱动节点（Foreman）</strong>，对查询进行分析优化生成执行计划，之后将执行计划划分成各个<strong>片段（Fragment）</strong>，并确定合适的节点来执行；<br>3）各个节点执行查询片段（Fragment），并将结果返回给驱动节点；<br>4）驱动节点将结果返回给客户端。</p></blockquote><p><strong>优点：</strong></p><blockquote><p>1）几乎可以查询任何类型的NoSQL数据库（包含 Hbase、MongoDB、ElasticSearch、Cassandra、Druid、Kudu、Kafka、OpenTSDB、HDFS、Amazon S3、Azure Blob Storage、Google Cloud Storage、Swift、NAS和本地文件。可以在单次查询中组合多个数据源（联邦查询）。）；<br>2）在处理数据之前，无需加载数据、创建和维护模式或转换数据。相反，只需在 SQL 查询中包含 Hadoop 目录、MongoDB 集合或 S3 存储桶的路径；<br>3）Drill 是唯一支持复杂数据的列式查询引擎。它具有用于复杂数据的内存切碎柱状表示，这使 Drill 能够通过内部 JSON 文档模型的灵活性实现柱状速度；<br>4）可以使用 Tableau、Qlik、MicroStrategy、Spotfire、SAS 和 Excel 等标准 BI/分析工具；<br>5）Drill 的对称架构（所有节点都相同）和简单的安装使得部署和扩展集群变得容易；<br>6）Drill 不是世界上第一个查询引擎，但它是第一个兼具灵活性和速度的查询引擎。为了实现这一点，Drill 具有完全不同的架构，可以在不牺牲 JSON 文档模型提供的灵活性的情况下实现破纪录的性能。</p></blockquote><p><strong>缺点：</strong></p><blockquote><p>1） drill语法和常规sql有区别,一般是如 <code>select * from 插件名.表名</code> 的形式。主要是因为drill查询不同数据源时需要切换不同的插件；<br>2）技术线太长，不容易切合到实际生产线上去；<br>3）国内使用较少，没有大型成功案例，不够大众化，出现问题可能维护起来比较困难。资料比较少。</p></blockquote><h3 id="3-9-Hive"><a href="#3-9-Hive" class="headerlink" title="3.9 Hive"></a>3.9 Hive</h3><p><a href="https://hive.apache.org/" target="_blank" rel="noopener">Hive</a> 是一个构建于Hadoop顶层的数据仓库工具。定义了简单的类似SQL 的查询语言——HiveQL，可以将HiveQL查询转换为MapReduce 的任务在Hadoop集群上执行。</p><p><img src="/2021/11/30/olap-ru-he-xuan-xing/%E5%9B%BE%E7%89%8710.png" alt="图片10"></p><p>hdfs可以将结构化的数据文件映射为一张数据库表，并提供完整的sql查询功能，可以将sql语句转换为MapReduce任务进行运行。其优点是学习成本低，可以通过类SQL语句快速实现简单的MapReduce统计，不必开发专门的MapReduce应用，十分适合数据仓库的统计分析。</p><p>对于Hive主要针对的是OLAP应用，其底层是HDFS分布式文件系统，HDFS一般只用于查询分析统计，而不能是常见的CUD操作，Hive需要从已有的数据库或日志进行同步最终入到HDFS文件系统中，当前要做到增量实时同步都相当困难。</p><p><strong>优点：</strong></p><blockquote><p>1）<strong>高可靠、高容错：</strong>HiveServer采用集群模式，双MetaStor，超时重试机制；<br>2）<strong>类SQL：</strong>类似SQL语法，内置大量函数；<br>3）<strong>可扩展：</strong>自定义存储格式，自定义函数；<br>4）<strong>多接口：</strong>Beeline，JDBC，ODBC，Python，Thrift。</p></blockquote><p><strong>缺点：</strong></p><blockquote><p>1）<strong>延迟较高：</strong>默认MR为执行引擎，MR延迟较高；<br>2）<strong>不支持物化视图：</strong>Hive支持普通视图，不支持物化视图。Hive不能再视图上更新、插入、删除数据；<br>3）<strong>不适用OLTP：</strong>暂不支持列级别的数据添加、更新、删除操作。</p></blockquote><h3 id="3-10-Spark-SQL"><a href="#3-10-Spark-SQL" class="headerlink" title="3.10 Spark SQL"></a>3.10 Spark SQL</h3><p><a href="https://spark.apache.org/sql/" target="_blank" rel="noopener">Spark SQL</a> 的前身是Shark，它将 SQL 查询与 Spark 程序无缝集成，可以将结构化数据作为 Spark 的 RDD 进行查询。Spark SQL作为Spark生态的一员继续发展，而不再受限于Hive，只是兼容Hive。</p><p>Spark SQL提供了sql访问和API访问的接口。支持访问各式各样的数据源，包括Hive, Avro, Parquet, ORC, JSON 和 JDBC。</p><p>Spark SQL与传统 DBMS 的查询优化器 + 执行器的架构较为类似，只不过其执行器是在分布式环境中实现，并采用的 Spark 作为执行引擎：</p><p><img src="/2021/11/30/olap-ru-he-xuan-xing/%E5%9B%BE%E7%89%8711.png" alt="图片11"></p><p>SparkSQL的架构图如下：</p><p><img src="/2021/11/30/olap-ru-he-xuan-xing/%E5%9B%BE%E7%89%8712.png" alt="图片12"></p><p><strong>优点：</strong></p><blockquote><p>1）支持多种数据源；<br>2）易整合，有各种API；<br>3）兼容HiveQL。</p></blockquote><p><strong>缺点：</strong></p><blockquote><p>1）查询性能不高；<br>2）以thrift server方式提供的SparkSQL服务不支持多种数据源，必须使用DataFrame API。</p></blockquote><h2 id="四、各组件性能对比"><a href="#四、各组件性能对比" class="headerlink" title="四、各组件性能对比"></a>四、各组件性能对比</h2><p>测试数据来源于：<a href="http://www.clickhouse.com.cn/topic/5c453371389ad55f127768ea" target="_blank" rel="noopener">开源OLAP引擎测评报告</a>。通过测试以及相关调研编写了各组件各个方面的综合对比分析表，这里采用5分为满分来比较，如下表所示：</p><p><img src="/2021/11/30/olap-ru-he-xuan-xing/%E5%9B%BE%E7%89%8713.png" alt="图片13"></p><ol><li>SparkSQL是Hadoop中另一个著名的SQL引擎，它以Spark作为底层计算框架，Spark使用RDD作为分布式程序的工作集合，它提供一种分布式共享内存的受限形式。在分布式共享内存系统中，应用可以向全局地址空间的任意位置进行读写作，而RDD是只读的，对其只能进行创建、转化和求值等作。这种内存操作大大提高了计算速度。SparkSql的性能相对其他的组件要差一些，多表单表查询性能都不突出。</li><li>Impala官方宣传其计算速度是一大优点，在实际测试中我们也发现它的多表查询性能和presto差不多，但是单表查询方面却不如presto好。而且Impala有很多不支持的地方，例如：不支持update、delete操作，不支持Date数据类型，不支持ORC文件格式等等，所以我们查询时采用parquet格式进行查询，而且Impala在查询时占用的内存很大。</li><li>Presto综合性能比起来要比其余组件好一些，无论是查询性能还是支持的数据源和数据格式方面都要突出一些，在单表查询时性能靠前，多表查询方面性能也很突出。由于Presto是完全基于内存的并行计算，所以presto在查询时占用的内存也不少，但是发现要比Impala少一些，比如多表join需要很大的内存，Impala占用的内存比presto要多。</li><li>HAWQ 吸收了先进的基于成本的 SQL 查询优化器，自动生成执行计划，可优化使用hadoop 集群资源。HAWQ 采用 Dynamic pipelining 技术解决这一关键问题。Dynamic pipelining 是一种并行数据流框架，利用线性可扩展加速Hadoop查询，数据直接存储在HDFS上，并且其SQL查询优化器已经为基于HDFS的文件系统性能特征进行过细致的优化。但是我们发现HAWQ在多表查询时比Presto、Impala差一些；而且不适合单表的复杂聚合操作，单表测试性能方面要比其余四种组件差很多，hawq环境搭建也遇到了诸多问题。</li><li>ClickHouse 作为目前所有开源MPP计算框架中计算速度最快的，它在做多列的表，同时行数很多的表的查询时，性能是很让人兴奋的，但是在做多表的join时，它的性能是不如单宽表查询的。性能测试结果表明ClickHouse在单表查询方面表现出很大的性能优势，但是在多表查询中性能却比较差，不如presto、impala、hawq的效果好。</li><li>GreenPlum作为关系型数据库产品，它的特点主要就是查询速度快，数据装载速度快，批量DML处理快。而且性能可以随着硬件的添加，呈线性增加，拥有非常良好的可扩展性。因此，它主要适用于面向分析的应用。比如构建企业级ODS/EDW，或者数据集市等，GREENPLUM都是不错的选择。</li></ol><p><strong>OLAP大混战对比分析：</strong> 仅供参考</p><table><thead><tr><th>引擎/对比项目</th><th>Kylin</th><th>Presto</th><th>Impala</th><th>Druid</th><th>SpaqkSql</th><th>ElasticSearch</th><th>Kudu</th><th>ClickHouse</th><th>Doris</th><th>TiDB</th><th>Hive</th><th>Greenplum</th><th>SnappyData</th><th>Hawq</th></tr></thead><tbody><tr><td>亚秒级响应</td><td>Y</td><td>N</td><td>Y</td><td>Y</td><td>N</td><td>N</td><td>Y（据说可以到达秒级）</td><td>单表查询Y，多表查询N</td><td>Y（ms-s性能高于Kylin‘）</td><td>N</td><td>N</td><td>Y</td><td>Y</td><td>N</td></tr><tr><td>高并发</td><td>Y</td><td>N</td><td>Y</td><td>Y</td><td>N</td><td>N</td><td>Y</td><td>N</td><td>N</td><td>Y</td><td>Y</td><td>N</td><td>Y</td><td>Y</td></tr><tr><td>百亿数据集</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td></td><td>Y</td><td>Y</td><td>N</td><td>N</td><td>Y</td><td></td></tr><tr><td>SQL支持</td><td>Y</td><td>Y</td><td>Y</td><td>N（开发中）</td><td>Y</td><td>N</td><td>Y（结合Impala可支持SQL查询）</td><td>Y（支持Sql中基本语法对于开窗函数还不支持）</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>离线</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>实时</td><td>N（开发中，目前主要支持Kafka 流构建 Cube）</td><td>N</td><td>N</td><td>Y</td><td>N</td><td>Y</td><td>Y（Spark Streaming）</td><td>Y（实时数据分析领域的黑马）</td><td>Y</td><td>Y</td><td>N</td><td>N</td><td>Y</td><td>N</td></tr><tr><td>精准去重能力</td><td>Y</td><td>Y</td><td>Y</td><td>N</td><td>Y</td><td>N</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>是否支持明细查询</td><td>N</td><td>Y</td><td>N</td><td>N</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>多表join</td><td>Y</td><td>Y</td><td>Y</td><td>N</td><td>Y</td><td>N</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>能否更改模型</td><td>N</td><td>Y</td><td>N</td><td>N</td><td>Y</td><td>N</td><td>Y</td><td>Y（更换表引擎）</td><td>N</td><td>Y</td><td>Y</td><td>N</td><td>Y</td><td>未知</td></tr><tr><td>JDBC/ODBC for BI集成</td><td>Y</td><td>Y</td><td>N</td><td>N</td><td>Y</td><td>N</td><td>Y</td><td>N</td><td>Y</td><td>Y</td><td>Y</td><td>N</td><td>Y</td><td>Y</td></tr><tr><td>WEB GUI</td><td>Y</td><td>Y</td><td>Y</td><td>N</td><td>N</td><td>N</td><td>Y</td><td>Y</td><td>N</td><td>Y</td><td>N</td><td>未知</td><td>未知</td><td>Y</td></tr><tr><td>REST API</td><td>Y</td><td>N</td><td>Y</td><td>N</td><td>N</td><td>Y</td><td>N</td><td>N</td><td>N</td><td>N</td><td>N</td><td>未知</td><td>N</td><td>N</td></tr><tr><td>社区活跃度</td><td>活跃</td><td>活跃</td><td>活跃</td><td>活跃</td><td>活跃</td><td>活跃</td><td>较活跃</td><td>不太活跃</td><td>Doris社区刚刚起步，目前核心用户只有Baidu；</td><td>较活跃</td><td>活跃</td><td>活跃</td><td>较活跃</td><td>较活跃</td></tr><tr><td>存储能力</td><td>shared nothing</td><td>shared nothing</td><td>纯计算</td><td>shared nothing</td><td>无</td><td>计算+存储</td><td>列式存储</td><td>计算+存储</td><td>计算+存储</td><td>计算+存储</td><td>存储到HDFS</td><td>计算+存储</td><td>shared</td><td>noting</td></tr><tr><td>成本</td><td>中</td><td>中</td><td>中（CDH据说要收费收费以后可能会提高）</td><td>中</td><td>低</td><td>中</td><td>中</td><td>高</td><td>中</td><td>中</td><td>低</td><td>未知</td><td>高</td><td>中</td></tr><tr><td>易用性</td><td>安装简单快捷，轻量级，简单，选择维度表和度量即可构建Cube</td><td>安装简单，基于内存，查询代价较大</td><td>部署简单，基于内存，查询代价较大</td><td>部署简单，基于内存</td><td>部署简单</td><td>部署较简单，但是难用目前发展趋向于专人专岗</td><td>部署简单，需要开发门槛较高，基于磁盘</td><td>简单易用</td><td>按装复杂</td><td>安装部署较为复杂</td><td>部署较简单</td><td>未知</td><td>未知</td><td>部署比较复杂</td></tr><tr><td>监控成本</td><td>自带监控组件、运维成本低</td><td>有公共web监控管理</td><td>自带监控组件，运维成本低</td><td>自带监控可配置，有web页面</td><td>自带监控</td><td>可以使用Kibana实现，成本较高</td><td>已经集成到CDH中，便于监控</td><td>自身具有简单的监控组件，可以联合其他的监控工具进行监控</td><td>监控的集中到Prometheus</td><td>使用开源的 metric 分析及可视化系统Grafana 进行监控</td><td>没有自带的监控，但是在阿里云有配合hive的监控，成本高</td><td>未知</td><td>运维成本高</td><td>支持多种工具监控</td></tr></tbody></table><h2 id="五、选型的一些建设"><a href="#五、选型的一些建设" class="headerlink" title="五、选型的一些建设"></a>五、选型的一些建设</h2><p>上面给出了常用的一些OLAP引擎，它们各自有各自的特点，我们将其分组：</p><ul><li>Hive，Hawq，Impala - 基于SQL on Hadoop；</li><li>Presto和Spark SQL类似 - 基于内存解析SQL生成执行计划；</li><li>Kylin 用空间换时间，预计算；</li><li>Druid 一个支持数据的实时摄入；</li><li>ClickHouse OLAP领域的Hbase，单表查询性能优势巨大；</li><li>Greenpulm OLAP领域的Postgresql。</li></ul><p>如果你的场景是基于HDFS的离线计算任务，那么Hive，Hawq和Imapla就是你的调研目标；<br>如果你的场景解决分布式查询问题，有一定的实时性要求，那么Presto和Spark SQL可能更符合你的期望；<br>如果你的汇总维度比较固定，实时性要求较高，可以通过用户配置的维度+指标进行预计算，那么不妨尝试Kylin和Druid；<br>ClickHouse则在单表查询性能上独领风骚，远超过其他的OLAP数据库；<br>Greenpulm作为关系型数据库产品，性能可以随着集群的扩展线性增长，更加适合进行数据分析。</p><p>就像美团在调研Kylin的报告中所说的：</p><p>目前还没有一个OLAP系统能够满足各种场景的查询需求。<br>其本质原因是，没有一个系统能同时在数据量、性能、和灵活性三个方面做到完美，每个系统在设计时都需要在这三者间做出取舍。</p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Hadoop/" rel="tag"><i class="fa fa-tag"></i> Hadoop</a> <a href="/tags/OLAP/" rel="tag"><i class="fa fa-tag"></i> OLAP</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2021/11/24/apache-druid-lian-ji-fen-xi-chu-li-olap/" rel="next" title="Apache Druid 联机分析处理(OLAP)"><i class="fa fa-chevron-left"></i> Apache Druid 联机分析处理(OLAP)</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2021/12/02/superset-yi-kuan-qing-liang-ji-bi-gong-ju/" rel="prev" title="Superset 一款轻量级BI工具">Superset 一款轻量级BI工具 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"><span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a> <a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/chen.png" alt="Zhongzhou Chen"><p class="site-author-name" itemprop="name">Zhongzhou Chen</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">312</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">84</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">180</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、OLAP-简介"><span class="nav-text">一、OLAP 简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、OLAP-的准则和特性"><span class="nav-text">二、OLAP 的准则和特性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、OLAP-开源引擎"><span class="nav-text">三、OLAP 开源引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-Kylin"><span class="nav-text">3.1 Kylin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-Druid"><span class="nav-text">3.2 Druid</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-Greenplum"><span class="nav-text">3.3 Greenplum</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-ClickHouse"><span class="nav-text">3.4 ClickHouse</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-Impala"><span class="nav-text">3.5 Impala</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-Hawq"><span class="nav-text">3.6 Hawq</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-7-Presto"><span class="nav-text">3.7 Presto</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-8-Drill"><span class="nav-text">3.8 Drill</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-9-Hive"><span class="nav-text">3.9 Hive</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-10-Spark-SQL"><span class="nav-text">3.10 Spark SQL</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、各组件性能对比"><span class="nav-text">四、各组件性能对比</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五、选型的一些建设"><span class="nav-text">五、选型的一些建设</span></a></li></ol></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Zhongzhou Chen</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">738.6k</span></div><span class="post-meta-divider"></span></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code").find(".line").map(function(t,e){return $(e).text()}).toArray().join("\n"),n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();var o=document.execCommand("copy");document.body.removeChild(n),o?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})</script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><script type="text/javascript" src="/js/src/love.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,log:!1,model:{jsonPath:"/live2dw/assets/shizuku.model.json"},display:{position:"right"},mobile:{show:!0,scale:.5},react:{opacityDefault:.7,opacityOnHover:.2}})</script></body></html><!-- rebuild by neat -->