<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><script></script><meta name="theme-color" content="#222"><style>.pace .pace-progress{background:#1e92fb;height:3px}.pace .pace-progress-inner{box-shadow:0 0 10px #1e92fb,0 0 5px #1e92fb}.pace .pace-activity{border-top-color:#1e92fb;border-left-color:#1e92fb}</style><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="HGM141IpbHrSmnAmR6W_zE4bo9Z3f-yXLeHYT3bg1fk"><meta name="baidu-site-verification" content="code-5Ai1DA8e6T"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="数据库,MySQL,"><link rel="alternate" href="/atom.xml" title="凡间的精灵" type="application/atom+xml"><meta name="description" content="1、MySQL Server 简介什么是MySQLMySQL 是由MySQL AB 公司（目前已经被SUN 公司收归麾下）自主研发的，目前IT行业最流行的开放源代码的数据库管理系统之一，它同时也是一个支持多线程高并发多用户的关系型数据库管理系统。MySQL 数据库以其简单高效可靠的特点，在最近短短几年的时间就从一个名不见经传的数据库系统，变成一个在IT 行业几乎是无人不知的开源数据库管理系统。从小"><meta name="keywords" content="数据库,MySQL"><meta property="og:type" content="article"><meta property="og:title" content="MySQL 架构组成之物理文件组成"><meta property="og:url" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;index.html"><meta property="og:site_name" content="凡间的精灵"><meta property="og:description" content="1、MySQL Server 简介什么是MySQLMySQL 是由MySQL AB 公司（目前已经被SUN 公司收归麾下）自主研发的，目前IT行业最流行的开放源代码的数据库管理系统之一，它同时也是一个支持多线程高并发多用户的关系型数据库管理系统。MySQL 数据库以其简单高效可靠的特点，在最近短短几年的时间就从一个名不见经传的数据库系统，变成一个在IT 行业几乎是无人不知的开源数据库管理系统。从小"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%871.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%872.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%873.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%874.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%875.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%876.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%877.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%878.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%879.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8710.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8711.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8712.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8713.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8714.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8715.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8716.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8717.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8718.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8719.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8720.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8721.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8722.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8723.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8724.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8725.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8726.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8727.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8728.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8729.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8730.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8731.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8732.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8733.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8734.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8735.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8736.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8737.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8738.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8739.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8740.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8741.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8742.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8743.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8744.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8745.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8746.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8747.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8748.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8749.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8750.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8751.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8752.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8753.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8754.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8755.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8756.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%8757.png"><meta property="og:updated_time" content="2019-11-21T09:19:36.438Z"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;24&#x2F;mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng&#x2F;%E5%9B%BE%E7%89%871.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"always",offset:12,b2t:!0,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://chenzhonzhou.github.io/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/"><title>MySQL 架构组成之物理文件组成 | 凡间的精灵</title><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">凡间的精灵</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">凡尘落素一精灵</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://chenzhonzhou.github.io/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Zhongzhou Chen"><meta itemprop="description" content=""><meta itemprop="image" content="/images/chen.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="凡间的精灵"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">MySQL 架构组成之物理文件组成</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-24T17:55:56+08:00">2017-09-24</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">10.6k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">38</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="1、MySQL-Server-简介"><a href="#1、MySQL-Server-简介" class="headerlink" title="1、MySQL Server 简介"></a>1、MySQL Server 简介</h2><h3 id="什么是MySQL"><a href="#什么是MySQL" class="headerlink" title="什么是MySQL"></a>什么是MySQL</h3><p><strong>MySQL</strong> 是由<strong>MySQL AB</strong> 公司（目前已经被<strong>SUN</strong> 公司收归麾下）自主研发的，目前<strong>IT</strong>行业最流行的开放源代码的数据库管理系统之一，它同时也是一个支持多线程高并发多用户的关系型数据库管理系统。</p><p><strong>MySQL</strong> 数据库以其简单高效可靠的特点，在最近短短几年的时间就从一个名不见经传的数据库系统，变成一个在IT 行业几乎是无人不知的开源数据库管理系统。从小型的<strong>web</strong> 网站，至大型的企业级应用，到处都可见其身影的存在。</p><h3 id="MySQL-与其他数据库的简单比较"><a href="#MySQL-与其他数据库的简单比较" class="headerlink" title="MySQL 与其他数据库的简单比较"></a>MySQL 与其他数据库的简单比较</h3><p><strong>1）功能比较：</strong></p><p>作为一个成熟的数据库管理系统，要满足各种各样的商业需求，功能肯定是重点参考对象的。MySQL经过多年的改进和完善之后，已经基本具备了所有通用数据库管理系统所需要的相关功能。</p><p>MySQL 基本实现了ANSI SQL 92 的大部分标准，仅有少部分并不经常被使用的部分没有实现。比如在字段类型支持方面，另一个著名的开源数据库PostGreSQL支持的类型是最完整的，而Oracle 和其他一些商业数据库，比如DB2、Sybase 等，较MySQL 来说也要相对少一些。在事务支持方面，虽然MySQL 自己的存储引擎并没有提供，但是已经通过第三方插件式存储引擎Innodb实现了SQL 92 标准所定义的四个事务隔离级别的全部。</p><p>不过在可编程支持方面，MySQL 和其他数据库相比还有一定的差距，虽然最新版的MySQL已经开始提供一些简单的可编程支持，如开始支持Procedure，Function，Trigger 等，但是所支持的功能还比较有限，和其他几大商用数据库管理系统相比，还存在较大的不足。如Oracle 有强大的PL/SQL，SQL Server 有T-SQL，PostGreSQL也有功能很完善的PL/PGSQL的支持。</p><p>整体来说，MySQL的功能完全可以满足我们的通用商业需求，提供足够强大的服务。而且不管是哪一种数据库在功能方面都不敢声称自己比其他任何一款商用通用数据库管理系统都强，甚至都不敢声称能够自己拥有某一数据库产品的所有功能。因为每一款数据库管理系统都有起自身的优势，也有起自身的限制，这只能代表每一款产品所倾向的方向不一样。</p><p><strong>2）易用性比较：</strong></p><p>从系统易用性方面来比较，每一个使用过MySQL 的用户都能够明显地感觉出MySQL 在这方面与其他通用数据库管理系统之间的优势所在。尤其是相对于一些大型的商业数据库管理系统如Oracle、DB2 以及Sybase 来说，对于普通用户来说，操作的难易程度明显不处于一个级别。MySQL 一直都奉行简单易用的原则，也正是靠这一特性，吸引了大量的初级数据库用户最终选择了MySQL。</p><p>从安装方面来说，MySQL 安装包大小仅仅只有100MB 左右，这与几大商业数据库完全不在一个数量级。安装难易程度也要比Oracle 等商业数据库简单很多，不论是通过已经编译好的二进制分发包还是源码编译安装，都非常简单。</p><p>再从数据库创建来比较，MySQL 仅仅只需要一个简单的CREATE DATABASE 命令，即可在瞬间完成建库的动作，而Oracle 数据库与之相比，创建一个数据库简直就是一个非常庞大的工程。当然，二者数据库的概念存在一定差别。</p><p><strong>3）性能比较</strong></p><p>性能方面，一直是MySQL 引以为自豪的一个特点。在权威的第三方评测机构多次测试较量各种数据库TPCC 值的过程中，MySQL 一直都有非常优异的表现，而且在其他所有商用的通用数据库管理系统中，仅仅只有Oracle 数据库能够与其一较高下。</p><p><strong>4）可靠性</strong></p><p>关于可靠性的比较，MySQL 也有非常优异的表现，从当前最火的Facebook 这样大型的网站都是使用MySQL 数据库，就可以看出，MySQL 在稳定可靠性方面，而且排在全球前10 位的大型网站里面，大部分都有部分业务是运行在MySQL数据库环境上，如Yahoo，Google 等。</p><p>总的来说，MySQL 数据库在发展过程中一直有自己的三个原则：简单、高效、可靠。</p><h3 id="MySQL-的主要适用场景"><a href="#MySQL-的主要适用场景" class="headerlink" title="MySQL 的主要适用场景"></a>MySQL 的主要适用场景</h3><p>MySQL是目前最为流行的开源数据库管理系统软件了。那么MySQL 主要用于什么场景下</p><p><strong>1）Web 网站系统</strong></p><p>Web 站点，是MySQL 最大的客户群，MySQL 之所以能成为Web 站点开发者们最青睐的数据库管理系统，是因为MySQL 数据库的安装配置都非常简单，使用过程中的维护也不像很多大型商业数据库管理系统那么复杂，而且性能出色。还有一个非常重要的原因就是MySQL 是开放源代码的，完全可以免费使用。</p><p><strong>2）日志记录系统</strong></p><p>MySQL 数据库的插入和查询性能都非常的高效，如果设计地较好，在使用MyISAM存储引擎的时候，两者可以做到互不锁定，达到很高的并发性能。所以，对需要大量的插入和查询日志记录的系统来说，MySQL 是非常不错的选择。比如处理用户的登录日志，操作日志等是非常适合的应用场景。</p><p><strong>3）数据仓库系统</strong></p><p>随着现在数据仓库数据量的飞速增长，我们需要的存储空间越来越大。数据量的不断增长，使数据的统计分析变得越来越低效，也越来越困难。怎么办？这里有几个主要的解决思路，一个是采用昂贵的高性能主机以提高计算性能，用高端存储设备提高I/O 性能，效果理想，但是成本非常高；第二个就是通过将数据复制到多台使用大容量硬盘的廉价pc server上，以提高整体计算性能和I/O 能力，效果尚可，存储空间有一定限制，成本低廉；第三个，通过将数据水平拆分，使用多台廉价的pc server 和本地磁盘来存放数据，每台机器上面都只有所有数据的一部分，解决了数据量的问题，所有pc server 一起并行计算，也解决了计算能力问题，通过中间代理程序调配各台机器的运算任务，既可以解决计算性能问题又可以解决I/O 性能问题，成本也很低廉。在上面的三个方案中，第二和第三个的实现，MySQL 都</p><p>有较大的优势。通过MySQL 的简单复制功能，可以很好的将数据从一台主机复制到另外一台，</p><p>不仅仅在局域网内可以复制，在广域网同样可以。当然，其他的数据库同样也可以做到，不是只有MySQL 有这样的功能。但是MySQL是免费的，其他数据库大多都是按照主机数量或者cpu数量来收费，当我们使用大量的pcserver 的时候，license 费用相当惊人。第一个方案，基本上所有数据库系统都能够实现，但是其高昂的成本并不是每一个公司都能够承担的。</p><h2 id="2、MySQL-架构组成"><a href="#2、MySQL-架构组成" class="headerlink" title="2、MySQL 架构组成"></a>2、MySQL 架构组成</h2><h3 id="Mysql物理文件组成"><a href="#Mysql物理文件组成" class="headerlink" title="Mysql物理文件组成"></a>Mysql物理文件组成</h3><h4 id="日志文件"><a href="#日志文件" class="headerlink" title="日志文件"></a>日志文件</h4><p>主要包含：错误日志、查询日志、慢查询日志、事务日志、二进制日志<br>日志是mysql数据库的重要组成部分。日志文件中记录着mysql数据库运行期间发生的变化；也就是说用来记录mysql数据库的客户端连接状况、SQL语句的执行情况和错误信息等。当数据库遭到意外的损坏时，可以通过日志查看文件出错的原因，并且可以通过日志文件进行数据恢复。</p><h5 id="错误日志：Error-Log"><a href="#错误日志：Error-Log" class="headerlink" title="错误日志：Error Log"></a>错误日志：Error Log</h5><p>在mysql数据库中，错误日志功能是默认开启的。默认情况下，错误日志存储在mysql数据库的数据目录中。错误日志文件通常的名称为hostname.err。其中，hostname表示服务器主机名。<br>错误日志信息可以自己进行配置的，错误日志所记录的信息是可以通过log-error和log-warnings来定义的，其中log-error是定义是否启用错误日志的功能和错误日志的存储位置，log-warnings是定义是否将警告信息也定义至错误日志中。默认情况下错误日志大概记录以下几个方面的信息：服务器启动和关闭过程中的信息（未必是错误信息，如mysql如何启动InnoDB的表空间文件的、如何初始化自己的存储引擎的等等）、服务器运行过程中的错误信息、事件调度器运行一个事件时产生的信息、在从服务器上启动服务器进程时产生的信息<br><strong>注1：</strong>MySQL有很多系统变量可以设置，系统变量设置不同，会导致系统运行状态的不同。因此mysql提供两组命令，分别查看系统设置和运行状态。<br><strong>1、查看系统设置：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SHOW [GLOBAL | SESSION] VARIABLES [like_or_where] </span><br><span class="line">SHOW VARIABLES：shows the values of MySQL system variables.</span><br></pre></td></tr></table></figure><p><strong>2、运行状态：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SHOW [GLOBAL | SESSION] STATUS [like_or_where] </span><br><span class="line">SHOW STATUS：provides server status information.</span><br></pre></td></tr></table></figure><p>如何修改系统配置<br>方法1：配置文件设置my.cnf<br>如：binlog_cache_size = 1M<br>方法2：set globalbinlog_cache_size = 1048576;<br><strong>注2：</strong>查看mysql的版本</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%871.png" alt="img"></p><p>或</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%872.png" alt="img"></p><p>或</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%873.png" alt="img"></p><p>一般而言，日志级别的定义没有会话变量都只是在全局级别下进行定义</p><p><strong>错误日志的状态：</strong></p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%874.png" alt="img"></p><p>其中</p><blockquote><p>log_error定义为错误日志文件路径<br>log_error_verbosity:<br>The MySQL error log has received some attention in MySQL 5.7, with a new setting called log_error_verbosity.<br>There are three possible values, as documented in <a href="#sysvar_log_error_verbosity">the manual</a>:</p></blockquote><table><thead><tr><th>Verbosity Value</th><th>Message Types Logged</th></tr></thead><tbody><tr><td>1</td><td>Errors only</td></tr><tr><td>2</td><td>Errors and warnings</td></tr><tr><td>3</td><td>Errors, warnings, and notes (default)</td></tr></tbody></table><p>更改错误日志位置可以使用log-error来设置形式如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#vi  /etc/my.cnf</span><br><span class="line">log-error = /usr/local/mysql/data/mysqld.err</span><br></pre></td></tr></table></figure><p><strong>查看mysql错误日志：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#tail  /usr/local/mysql/data/mysqld.err</span><br></pre></td></tr></table></figure><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%875.png" alt="img"></p><p>为了方便维护需要，有时候会希望将错误日志中的内容做备份并重新开始记录，这时候</p><p>就可以利用MySQL 的FLUSH LOGS 命令来告诉MySQL 备份旧日志文件并生成新的日志文件。备份文件名以“.old”结尾。</p><p><strong>删除错误日志：</strong></p><p>在mysql5.5.7之前：数据库管理员可以删除很长时间之前的错误日志，以保证mysql服务器上的硬盘空间。mysql数据库中，可以使用mysqladmin命令开启新的错误日志。mysqladmin命令的语法如下：mysqladmin –u root –pflush-logs也可以登录mysql数据库中使用FLUSHLOGS语句来开启新的错误日志。</p><p>在mysql5.5.7之后：服务器将关闭此项功能。只能使用重命名原来的错误日志文件，手动冲洗日志创建一个新的：方式如下：</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%876.png" alt="img"></p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%877.png" alt="img"></p><p>更多信息请查阅官方文档：<br><a href="http://dev.mysql.com/doc/refman/5.5/en/error-log.html" target="_blank" rel="noopener">http://dev.mysql.com/doc/refman/5.5/en/error-log.html</a><br><a href="http://dev.mysql.com/doc/refman/5.6/en/error-log.html" target="_blank" rel="noopener">http://dev.mysql.com/doc/refman/5.6/en/error-log.html</a><br><a href="http://dev.mysql.com/doc/refman/5.7/en/error-log.html" target="_blank" rel="noopener">http://dev.mysql.com/doc/refman/5.7/en/error-log.html</a></p><h5 id="二进制日志：Binary-Log-amp-Binary-Log-Index"><a href="#二进制日志：Binary-Log-amp-Binary-Log-Index" class="headerlink" title="二进制日志：Binary Log &amp; Binary Log Index"></a>二进制日志：Binary Log &amp; Binary Log Index</h5><p>二进制日志，也就是我们常说的binlog，也是MySQL Server 中最为重要的日志之一，主要用于记录修改数据或有可能引起数据改变的mysql语句，并且记录了语句发生时间、执行时长、操作的数据等等。所以说通过二进制日志可以查询mysql数据库中进行了哪些变化。一般大小体积上限为1G。</p><p>当我们通过“log-bin=file_name”打开了记录的功能之后，MySQL 会将所有修改数据库数据的query 以二进制形式记录到日志文件中。当然，日志中并不仅限于query 语句这么简单，还包括每一条query 所执行的时间，所消耗的资源，以及相关的事务信息，所以binlog是事务安全的。</p><p>和错误日志一样，binlog记录功能同样需要“log-bin=file_name”参数的显式指定才能开启，如果未指定file_name，则会在数据目录下记录为mysql-bin.<strong>**</strong>（*代表0～9 之间的某一个数字，来表示该日志的序号）。</p><p><strong>二进制开启状态：</strong></p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%878.png" alt="img"></p><p><strong>binlog还有其他一些附加选项参数：</strong></p><p>“max_binlog_size”设置binlog的最大存储上限，一般设置为512M或1G,一般不能超过1G当日志达到该上限时，MySQL 会重新创建一个日志开始继续记录。不过偶尔也有超出该设置的binlog产生，一般都是因为在即将达到上限时，产生了一个较大的事务，为了保证事务安全，MySQL 不会将同一个事务分开记录到两个binlog中。</p><p>“binlog-do-db=db_name”参数明确告诉MySQL，需要对某个（db_name）数据库记录binlog，如果有了“binlog-do-db=db_name”参数的显式指定，MySQL 会忽略针对其他数据库执行的query，而仅仅记录针对指定数据库执行的query。</p><p>“binlog-ignore-db=db_name”与“binlog-do-db=db_name”完全相反，它显式指定忽略某个（db_name）数据库的binlog记录，当指定了这个参数之后，MySQL 会记录指定数据库以外所有的数据库的binlog。</p><p>“binlog-ignore-db=db_name”与“binlog-do-db=db_name”两个参数有一个共同的概念需要大家理解清楚，参数中的db_name不是指query 语句更新的数据所在的数据库，而是执行query 的时候当前所处的数据库。不论更新哪个数据库的数据，MySQL 仅仅比较当前连接所处的数据库（通过use db_name切换后所在的数据库）与参数设置的数据库名，而不会分析query 语句所更新数据所在的数据库。</p><p>mysql-bin.index文件（binary log index）的功能是记录所有Binary Log 的绝对路径，保证MySQL 各种线程能够顺利的根据它找到所有需要的Binary Log 文件。</p><p>binlog_cache_size =32768 #默认值32768 binlog_cache_size：一个事务，在没有提交（uncommitted）的时候，产生的日志，记录到Cache中；等到事务提交（committed）需要提交的时候，则把日志持久化到磁盘。一般来说，如果我们的数据库中没有什么大事务，写入也不是特别频繁，2MB～4MB是一个合适的选择。但是如果我们的数据库大事务较多，写入量比较大，可与适当调高binlog_cache_size。同时，我们可以通过binlog_cache_use 以及 binlog_cache_disk_use来分析设置的binlog_cache_size是否足够，是否有大量的binlog_cache由于内存大小不够而使用临时文件（binlog_cache_disk_use）来缓存了。</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%879.png" alt="img"></p><p>binlog_stmt_cache_size= 32768 #当非事务语句使用二进制日志缓存，但是超出binlog_stmt_cache_size时，使用一个临时文件来存放这些语句。</p><p><strong>概念解释：</strong></p><p>事务表支持将批处理当做一个完整的任务统一提交或回滚，即对包含在事务中的多条语句要么全执行，要么全部不执行<br>非事务表则不支持此种操作，批处理中的语句如果遇到错误，在错误前的语句执行成功，之后的则不执行。</p><p>log-bin = mysql-bin#指定binlog的位置，默认在数据目录下。</p><p>binlog-format= {ROW|STATEMENT|MIXED}#指定二进制日志的类型，默认为MIXED。</p><p>概念解释：mysql复制主要有三种方式：基于SQL语句的复制(statement-based replication, SBR)，基于行的复制(row-based replication, RBR)，混合模式复制(mixed-based replication, MBR)。对应的，binlog的格式也有三种：STATEMENT，ROW，MIXED。</p><p><strong>① STATEMENT模式（SBR）</strong><br>每一条会修改数据的sql语句会记录到binlog中。优点是并不需要记录每一行的数据变化，减少了binlog日志量，节约IO，提高性能。缺点是在某些情况下会导致master-slave中的数据不一致(如sleep()函数，last_insert_id()，以及user-defined functions(udf)等会出现问题)<br><strong>② ROW模式（RBR）</strong><br>不记录每条sql语句的信息，仅需记录哪条数据被修改了，修改成什么样了。缺点是会产生大量的日志，让日志暴涨。<br><strong>③ MIXED模式（MBR）</strong><br>以上两种模式的混合使用，一般的复制使用STATEMENT模式保存binlog，对于STATEMENT模式无法复制的操作使用ROW模式保存binlog，MySQL会根据执行的SQL语句选择日志保存方式。即交替使用行和语句、由mysql服务器自行判断。<br>其中基于行的定义格式数据量会大一些但是可以保证数据的精确性</p><p>sync_binlog = 10#设定多久同步一次二进制日志至磁盘文件中，0表示不同步，任何正数值都表示对二进制每多少次写操作之后同步一次。当autocommit的值为1时，每条语句的执行都会引起二进制日志同步，否则，每个事务的提交会引起二进制日志同步</p><p>通过编辑my.cnf中的log-bin选项可以开启二进制日志；形式如下：<br>log-bin [=DIR/[filename]]<br>其中，DIR参数指定二进制文件的存储路径；filename参数指定二级制文件的文件名，其形式为filename.number，number的形式为000001、000002等。每次重启mysql服务或运行mysql&gt; flush logs;都会生成一个新的二进制日志文件，这些日志文件的number会不断地递增。除了生成上述的文件外还会生成一个名为filename.index的文件。这个文件中存储所有二进制日志文件的清单又称为二进制文件的索引</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8710.png" alt="img"></p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8711.png" alt="img"></p><p><strong>查看二进制日志：</strong></p><p>二进制日志的定义方式为二进制格式；使用此格式可以存储更多的信息，并且可以使写入二进制日志的效率更高。但是不能直接使用查看命令打开并查看二进制日志。</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8712.png" alt="img"></p><p>当前使用的二进制文件及所处位置</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8713.png" alt="img"></p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8714.png" alt="img"></p><p><strong>查看当前二进制文件的信息：</strong></p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8715.png" alt="img"></p><p><strong>查看二进制日志信息的命令：</strong></p><p>语法格式：</p><blockquote><p>SHOW BINLOG EVENTS[IN ‘log_name’] [FROM pos] [LIMIT [offset,] row_count]</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#查看所有的二进制信息</span><br><span class="line">mysql&gt; show binlog events\G;</span><br><span class="line"></span><br><span class="line">#查看指定日志的二进制信息</span><br><span class="line">mysql&gt; show binlog events in &apos;mysql-bin.000016&apos;\G;</span><br><span class="line"></span><br><span class="line">#从指定的事件位置开始</span><br><span class="line">mysql&gt; showbinlogevents in &apos;mysql-bin.000016&apos; from727;</span><br></pre></td></tr></table></figure><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8716.png" alt="img"></p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8717.png" alt="img"></p><p>注：二进制日志的记录位置：通常为上一个事件执行结束时间的位置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#指定偏移量(不是语句，是事件)</span><br><span class="line">mysql&gt; show binlog events in &apos;mysql-bin.000017&apos; from 154 limit 3;</span><br></pre></td></tr></table></figure><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8718.png" alt="img"></p><p><strong>命令行下查看二进制日志：</strong></p><p>由于无法使用cat等方式直接打开并查看二进制日志；所以必须使用mysqlbinlog命令。但是当正在执行mysql读写操作时建议不要使用此打开正在使用的二进制日志文件；若非要打开可flush logs。<strong>mysqlbinlog命令的使用方式：</strong></p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8719.png" alt="img"></p><blockquote><p>/<em>!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1</em>/;</p><p>/<em>!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0</em>/;</p><p>DELIMITER /<em>!</em>/;</p><h1 id="at-219-事件开始处"><a href="#at-219-事件开始处" class="headerlink" title="at 219 #事件开始处"></a>at 219 <font color="#008000">#事件开始处</font></h1><p>#160829 0:23:22 server id 1 end_log_pos 296 CRC32 0xc81eb3b9 Query thread_id=2 exec_time=0 error_code=0</p><p><font color="#008000">#160829 0:23:22年月日的简写方式；end_log_pos事件结束处；thread_id=2 哪个会话线程创建的此语句；exec_time=0 执行时长单位为秒；error_code=0 错误代码0表示没有</font></p><p>SET TIMESTAMP=1472401402/<em>!</em>/;</p><p>SET @@session.pseudo_thread_id=2/<em>!</em>/;</p><p>SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/<em>!</em>/;</p><p>SET @@session.sql_mode=1075838976/<em>!</em>/;</p><p>SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/<em>!</em>/;</p><p>/<em>!\C utf8 *//</em>!*/;</p><p>SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=33/<em>!</em>/;</p><p>SET @@session.lc_time_names=0/<em>!</em>/;</p><p>SET @@session.collation_database=DEFAULT/<em>!</em>/;</p><p>BEGIN</p><p>/<em>!</em>/;</p><h1 id="at-296"><a href="#at-296" class="headerlink" title="at 296"></a>at 296</h1><p>#160829 0:23:22 server id 1 end_log_pos 393 CRC32 0xbc94b235 Query thread_id=2 exec_time=0 error_code=0</p><p>use <code>db2</code>/<em>!</em>/;</p><p>SET TIMESTAMP=1472401402/<em>!</em>/;</p><p>insert into tb1 values(3)</p></blockquote><p><strong>删除二进制日志信息：</strong></p><p>二进制日志会记录大量的信息（其中包含一些无用的信息）。如果很长时间不清理二进制日志，将会浪费很多的磁盘空间。但是，删除之后可能导致数据库崩溃时无法进行恢复，所以若要删除二进制日志首先将其和数据库备份一份，其中也只能删除备份前的二进制日志，新产生的日志信息不可删。也不可在关闭mysql服务器之后直接删除因为这样可能会给数据库带来错误的。若非要删除二进制日志需要做如下操作：导出备份数据库和二进制日志文件进行压缩归档存储。删除二进制文件的方法如下：</p><p><strong>方法1：</strong>根据文件或时间点来删除二进制日志：</p><p>语法形式：</p><blockquote><p>mysql&gt; PURGE { BINARY | MASTER } LOGS {TO ‘log_name’ | BEFORE datetime_expr }</p></blockquote><p>其中TO’log_name’表示把这个文件之前的其他文件都删除掉，也可使用BEFORE datetime_expr指定把哪个时间之前的二进制文件删除了。</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8720.png" alt="img"></p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8721.png" alt="img"></p><p>或者用ls查看</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8722.png" alt="img"></p><p><strong>方法2：</strong>删除所有的二进制日志（慎用）：</p><p>使用RESET MASTER语句可以删除所有的二进制日志。该语句的形式如下：</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8723.png" alt="image-20191116104033038"></p><p>不建议在生产环境下使用此操作；删除所有的二进制日志后，<strong>Mysql</strong>将会重新创建新的二进制日志。新二进制日志的编号从<strong>000001</strong>开始。</p><h5 id="事务日志-或称redo日志"><a href="#事务日志-或称redo日志" class="headerlink" title="事务日志(或称redo日志)"></a>事务日志(或称redo日志)</h5><p>事务日志（InnoDB特有的日志）可以帮助提高事务的效率。使用事务日志，存储引擎在修改表的数据时只需要修改其内存拷贝，再把修改行为记录到持久在硬盘上的事务日志中，而不用每次都将修改的数据本身持久到磁盘。事务日志采用追加的方式，因此写日志的操作是磁盘上一小块区域内的顺序I/O，而不像随机I/O需要在磁盘的多个地方移动磁头，所以采用事务日志的方式相对来说要快得多。事务日志持久以后，内存中被修改的数据在后台可以慢慢的刷回到磁盘。目前大多数的存储引擎都是这样实现的。</p><p>如果数据的修改已经记录到事务日志并持久化，但数据本身还没有写回磁盘，此时系统崩溃，存储引擎在重启时能够自动恢复这部分修改的数据。具有的恢复方式则视存储引擎而定。</p><p>一般情况下，mysql会默认提供多种存储引擎,你可以通过下面的查看:<br>查看你的mysql现在已提供什么存储引擎:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show engines;</span><br></pre></td></tr></table></figure><p>看你的mysql当前默认的存储引擎:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &apos;%storage_engine%&apos;;</span><br></pre></td></tr></table></figure><p>你要看某个表用了什么引擎(在显示结果里参数engine后面的就表示该表当前用的存储引擎):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show create table 表名;</span><br></pre></td></tr></table></figure><p><strong>注：</strong></p><p>create table 库名.表名 engine = innodb;<br>这样就可以将表的引擎变更为innodb引擎了。<br>也可以在创建表之后通过下面语句来变更：<br>alter table库名.表名engine =innodb;</p><p><strong>查看事务日志的定义：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show global variables like &apos;%log%&apos;;</span><br></pre></td></tr></table></figure><p>显示结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">| innodb_flush_log_at_timeout| 1   |</span><br><span class="line">| innodb_flush_log_at_trx_commit  | 1</span><br></pre></td></tr></table></figure><p>在事务提交时innodb是否同步日志从缓冲区到文件中，当这个值为1（默认值）之时，在每个事务提交时，日志缓冲被写到日志文件，对日志文件做到磁盘操作的刷新，性能会很差造成大量的磁盘I/O但这种方式最安全；如果设为2,每次提交事务都会写日志，但并不会执行刷的操作。每秒定时会刷到日志文件。要注意的是，并不能保证100%每秒一定都会刷到磁盘，这要取决于进程的调度。每次事务提交的时候将数据写入事务日志，而这里的写入仅是调用了文件系统的写入操作，而文件系统是有 缓存的，所以这个写入并不能保证数据已经写入到物理磁盘。设置为0，日志缓冲每秒一次地被写到日志文件，并且对日志文件做到磁盘操作的刷新，但是在一个事务提交不做任何操作。</p><p><strong>注：</strong>刷写的概念<br>刷写其实是两个操作，刷（flush）和写（write），区分这两个概念是很重要的。在大多数的操作系统中，把Innodb的log buffer（内存）写入日志（调用系统调用write），只是简单的把数据移到操作系统缓存中，操作系统缓存同样指的是内存。并没有实际的持久化数据。<br>所以，通常设为0和2的时候，在崩溃或断电的时候会丢失最后一秒的数据，因为这个时候数据只是存在于操作系统缓存。之所以说“通常”，可能会有丢失不只1秒的数据的情况，比如说执行flush操作的时候阻塞了。<br>总结<br>设为1当然是最安全的，但性能页是最差的（相对其他两个参数而言，但不是不能接受）。如果对数据一致性和完整性要求不高，完全可以设为2,如果只最求性能，例如高并发写的日志服务器，设为0来获得更高性能</p><blockquote><p>| innodb_locks_unsafe_for_binlog| OFF |</p><p>| innodb_log_buffer_size| 16777216 |</p><p>| innodb_log_checksums | ON |</p><p>| innodb_log_compressed_pages| ON |</p><p>| innodb_log_file_size| 50331648 <font color="red">#日志文件大小</font> |</p><p>| innodb_log_files_in_group| 2 <font color="red">#DB中设置几组事务日志，默认是2</font> |</p><p>| innodb_log_group_home_dir| ./ <font color="red">#定义innodb事务日志组的位置,此位置设置默认为MySQL的datadir</font> |</p></blockquote><p>每个事务日志都是大小为50兆的文件（不同版本的mysql有差异）：<br>在mysql中默认以ib_logfile0,ib_logfile1名称存在</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8724.png" alt="img"></p><h5 id="慢查询日志：slow-query-log"><a href="#慢查询日志：slow-query-log" class="headerlink" title="慢查询日志：slow query log"></a>慢查询日志：slow query log</h5><p>顾名思义，慢查询日志中记录的是执行时间较长的query，也就是我们常说的slowquery。慢查询日志采用的是简单的文本格式，可以通过各种文本编辑器查看其中的内容。其中记录了语句执行的时刻，执行所消耗的时间，执行用户，连接主机等相关信息。</p><p><strong>慢查询日志的作用：</strong><br>慢查询日志是用来记录执行时间超过指定时间的查询语句。通过慢查询日志，可以查找出哪些查询语句的执行效率很低，以便进行优化。一般建议开启，它对服务器性能的影响微乎其微，但是可以记录mysql服务器上执行了很长时间的查询语句。可以帮助我们定位性能问题的。MySQL 还提供了专门用来分析满查询日志的工具程序mysqldumpslow，用来帮助数据库管理人员解决可能存在的性能问题。</p><p><strong>查看慢查询日志的定义：</strong><br><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8725.png" alt="img"></p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8726.png" alt="img"></p><p><strong>启动和设置慢查询日志：</strong></p><p><strong>方法1：</strong>通过配置文件my.cnf开启慢查询日志：</p><p>注：在不同的mysql版本中，开启慢查询日志参数不太一样，不过都可以通过 <strong>show variables like “%slow%”</strong> 和 <strong>show variables like “%long%”</strong> 查看出来。</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8727.png" alt="img"></p><p>其中：<br>slow_query_log： off关闭状态 on开启状态<br>slow_query_log_file 慢查询日志存放地点<br>long_query_time选项来设置一个时间值，时间以秒为单位，可以精确到微秒。如果查询时间超过了这个时间值（默认为10秒），这个查询语句将被记录到慢查询日志中,设置为0的话表示记录所有的查询。<br>slow_launch_time 表示如果建立线程花费了比这个值更长的时间,slow_launch_threads 计数器将增加</p><p><strong>注：</strong>如果不指定存储路径，慢查询日志默认存储到mysql数据库的数据文件下，如果不指定文件名，默认文件名为hostname-slow.log</p><p><strong>修改my.cnf文件：</strong></p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8728.png" alt="img"></p><p>重启mysqld服务</p><p><strong>再次查询慢查询日志定义：</strong></p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8729.png" alt="img"></p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8730.png" alt="img"></p><p><strong>方法2：</strong>通过登录mysql服务器直接定义，方式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;set global slow_query_log=1;  #开启慢查询日志</span><br><span class="line">Query OK, 0 rowsaffected (0.35 sec)</span><br><span class="line">mysql&gt;set session long_query_time=0.0001; #更改时间（当前session中，退出则重置）</span><br><span class="line">Query OK, 0 rowsaffected (0.00 sec)</span><br><span class="line">mysql&gt;set global long_query_time=0.0001; #更改时间（全局中，重启服务则重置）</span><br><span class="line">mysql&gt;SHOW  VARIABLES  LIKE &apos;%long%&apos;;  #查询定义时间</span><br><span class="line"></span><br><span class="line">#查看慢查询日志</span><br><span class="line">mysql&gt;use mysql</span><br><span class="line">mysql&gt;select user,host from user where user=&quot;root&quot;;</span><br></pre></td></tr></table></figure><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8731.png" alt="img"></p><p>或用系统查看文件内容命令如cat直接查看慢日志文件</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8732.png" alt="img"></p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8733.png" alt="img"></p><p>第一行表示记录日志时的时间。其格式是 YYYY-MM-DD HH:MM:SS。我们可以看出上面的查询记录于 2016年8月29日下午 15:47：24 - 注意：这个是服务器时间.</p><p>MySql用户、服务器以及主机名第三行表示总的查询时间、锁定时间、”发送”或者返回的行数</p><p>Query_time: 0.000304表示用了0.000304秒</p><p>Lock_time: 0.000128表示锁了0.000128秒</p><p>Rows_sent: 4表示返回4行</p><p>Rows_examined: 4表示一共查了4行</p><p>SET timestamp=UNIXTIME; 这是查询实际发生的时间</p><p>何将其变成一个有用的时间，将 Unix 时间转成一个可读的时间，可以使用 date –d@日志中的时间戳</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8734.png" alt="img"></p><p>以看到查询进行的同时记录了该日志，但是对于一台超负载的服务器常常并非如此。因此记住：SET timestamp= value 才是实际的查询的执行时间。</p><p><strong>慢查询分析mysqldumpslow</strong></p><p>们可以通过打开log文件查看得知哪些SQL执行效率低下。从日志中，可以发现查询时间超过long_query_time时间的query为慢查询，而小于long_query_time时间的没有出现在此日志中。</p><p>如果慢查询日志中记录内容很多，可以使用mysqldumpslow工具（MySQL客户端安装自带）来对慢查询日志进行分类汇总。mysqldumpslow对日志文件进行了分类汇总，显示汇总后摘要结果</p><p>进入log的存放目录，运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost data]# mysqldumpslow mysqld-slow.log</span><br></pre></td></tr></table></figure><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8735.png" alt="img"></p><p><strong>注：</strong></p><blockquote><p>mysqldumpslow-s c -t 10 /database/mysql/slow-query.log</p></blockquote><p>这会输出记录次数最多的10条SQL语句，其中：</p><p>-s, 是表示按照何种方式排序，c、t、l、r分别是按照记录数、查询时间、锁定时间、返回行数来排序；</p><p>-t, 是top n的意思，即为返回前面多少条的数据；</p><p>-g, 后边可以写一个正则匹配模式，大小写不敏感的；</p><p>详细选项查看帮助：#mysqldumpslow –help</p><p><strong>例如</strong>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/path/mysqldumpslow -s r -t 10 /database/mysql/slow-log</span><br></pre></td></tr></table></figure><p>得到返回记录集最多的10个查询。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/path/mysqldumpslow -s t -t 10 -g “left join” /database/mysql/slow-log</span><br></pre></td></tr></table></figure><p>得到按照时间排序的前10条里面含有左连接的查询语句。</p><h4 id="数据文件"><a href="#数据文件" class="headerlink" title="数据文件"></a>数据文件</h4><p>在MySQL 中每一个数据库都会在定义好（或者默认）的数据目录下存在一个以数据库名字命名的文件夹，用来存放该数据库中各种表数据文件。不同的MySQL 存储引擎有各自不同的数据文件。如MyISAM用“.MYD”作为扩展名，Innodb用“.ibd”，Archive 用“.arc”，CSV 用“.csv”，等等。</p><p>如何查看你的mysql现在已提供什么存储引擎:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show engines;</span><br></pre></td></tr></table></figure><p>看你的mysql当前默认的存储引擎:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &apos;%storage_engine%&apos;;</span><br></pre></td></tr></table></figure><p>你要看某个表用了什么引擎(在显示结果里参数engine后面的就表示该表当前用的存储引擎):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show create table 表名;</span><br></pre></td></tr></table></figure><p><strong>注：</strong><br>create table 库名.表名 engine = innodb;这样就可以将表的引擎变更为innodb引擎了。<br>登录mysql，创建一个数据库如testdb，并在数据库中创建一个表，如下图所示：</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8736.png" alt="img"></p><p>查看数据库所在目录会发现数据目录下存在一个以数据库名字命名的文件夹</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8737.png" alt="img"></p><p>查看testdb目录的文件列表</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8738.png" alt="img"></p><p>从上图可以看出表使用的是innodb存储引擎。</p><p>以myisam存储引擎创建一个测试表tb2</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8739.png" alt="img"></p><p>查看数据库目录</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8740.png" alt="img"></p><p><strong>注：修改mysql的默认存储引擎</strong></p><p>1、查看mysql存储引擎命令，在mysql&gt;提示符下搞入show engines;字段 Support为:Default表示默认存储引擎<br>2、设置InnoDB为默认引擎：在配置文件my.cnf中的 [mysqld] 下面加入default-storage-engine=INNODB 一句<br>3、重启mysql服务器：mysqladmin -u root -p shutdown或者service mysqld restart 登录mysql数据库，</p><p>1、“.frm”文件</p><p>与表相关的元数据（meta）信息都存放在“.frm”文件中，包括表结构的定义信息等。不论是什么存储引擎（MySQL常用的两个存储引擎是MyISAM和InnoDB），每一个表都会有一个以表名命名的“.frm”文件。所有的“.frm”文件都存放在所属数据库的文件夹下面。</p><p>MyISAM数据库表文件：.MYD文件：表数据文件；.MYI文件：索引文件</p><p>2、“.MYD”文件</p><p>“.MYD”文件是MyISAM存储引擎专用，存放MyISAM表的数据。每一个MyISAM表都会有一个“.MYD”文件与之对应，同样存放于所属数据库的文件夹下，和“.frm”文件在一起。</p><p>3、“.MYI”文件</p><p>“.MYI”文件也是专属于MyISAM存储引擎的，主要存放MyISAM表的索引相关信息。对于MyISAM存储来说，可以被cache 的内容主要就是来源于“.MYI”文件中。每一个MyISAM表对应一个“.MYI”文件，存放于位置和“.frm”以及“.MYD”一样。</p><p>InnoDB采用表空间（tablespace）来管理数据，存储表数据和索引。</p><p>.ibd文件：单表表空间文件，每个表使用一个表空间文件（file per table），存放用户数据库表数据和索引。</p><p>InnoDB共享表空间（即InnoDB文件集，ib-file set）：ibdata1、ibdata2等，存储InnoDB系统信息和用户数据库表数据和索引，所有表共用。</p><p>4、“.ibd”文件和ibdata文件</p><p>这两种文件都是存放Innodb数据的文件，之所以有两种文件来存放Innodb的数据（包括索引），是因为Innodb的数据存储方式能够通过配置来决定是使用共享表空间存放存储数据，还是独享表空间存放存储数据。独享表空间存储方式使用“.ibd”文件来存放数据，且每个表一个“.ibd”文件，文件存放在和MyISAM数据相同的位置。如果选用共享存储表空间来存放数据，则会使用ibdata文件来存放，所有表共同使用一个（或者多个，可自行配置）ibdata文件。</p><p>ibdata文件可以通过innodb_data_home_dir和innodb_data_file_path两个参数共同配置组成，innodb_data_home_dir配置数据存放的总目录，而innodb_data_file_path配置每一个文件的名称。</p><p>innodb_data_file_path中可以一次配置多个ibdata文件。文件可以是指定大小，也可以是自动扩展的，但是Innodb限制了仅仅只有最后一个ibdata文件能够配置成自动扩展类型。当我们需要添加新的ibdata文件的时候，只能添加在innodb_data_file_path配置的最后，而且必须重启MySQL 才能完成ibdata的添加工作。不过如果我们使用独享表空间存储方式的话，就不会有这样的问题。</p><p><strong>总结：</strong></p><p>共享表空间以及独占表空间都是针对数据的存储方式而言的。<br>共享表空间: 某一个数据库的所有的表数据，索引文件全部放在一个文件中。<br>独占表空间: 每一个表都将会生成以独立的文件方式来进行存储，每一个表都有一个.frm表描述文件，还有一个.ibd文件。其中这个文件包括了单独一个表的数据内容以及索引内容。</p><p><strong>两者之间的优缺点</strong><br>共享表空间：<br><strong>优点：</strong><br>可以放表空间分成多个文件存放到各个磁盘上。数据和文件放在一起方便管理。<br><strong>缺点：</strong><br>所有的数据和索引存放到一个文件中，多个表及索引在表空间中混合存储，这样对于一个表做了大量删除操作后表空间中将会有大量的空隙，特别是对于统计分析，日值系统这类应用最不适合用共享表空间。</p><p><strong>独立表空间：</strong><br><strong>优点：</strong><br>1．每个表都有自已独立的表空间。<br>2．每个表的数据和索引都会存在自已的表空间中。<br>3．可以实现单表在不同的数据库中移动。<br>4．空间可以回收<br>a) Drop table操作自动回收表空间，如果对于统计分析或是日值表，删除大量数据后可以通过:alter table TableName engine=innodb;回缩不用的空间。<br>b)对于使用独立表空间的表，不管怎么删除，表空间的碎片不会太严重的影响性能，而且还有机会处理。<br><strong>缺点：</strong><br>单表增加过大，如超过100个G。</p><p>相比较之下，使用独占表空间的效率以及性能会更高一点</p><p>查看当前数据库的表空间管理类型</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8741.png" alt="img"></p><p>ON代表独立表空间管理，OFF代表共享表空间管理；（查看单表的表空间管理方式，需要查看每个表是否有单独的数据文件）</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8742.png" alt="img"></p><p><strong>Innodb共享表空间配置：</strong></p><p>修改my.cnf文件：</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8743.png" alt="img"></p><p><strong>参数解释：</strong></p><p>innodb_data_home_dir = “/path/“ 数据库文件所存放的目录</p><p>innodb_log_group_home_dir = “/path/“ 日志存放目录</p><p>innodb_data_file_path=ibdata1:10M:autoextend 设置一个可扩展大小的尺寸为10MB的数据文件（共享数据文件），名为ibdata1。没有给出文件的位置，所以默认的是在MySQL的数据目录内。</p><p>innodb_file_per_table=1｜0 //1为使用独占表空间，0 为使用共享表空间</p><p>注：InnoDB不创建目录，所以在启动服务器之前请确认”所配置的路径目录”的确存在。</p><p>重启mysqld服务</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8744.png" alt="img"></p><p>mysqld启动失败,查看错误日志</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># tail  -20  /usr/local/mysql/data/mysqld.err</span><br></pre></td></tr></table></figure><p><strong>显示内容如下：</strong></p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8745.png" alt="img"></p><p><strong>注：</strong>不同版本的mysql报错略有不同，注意看错误日志的内容。<br>从错误日志中显示可以看出<br>在/etc/my.cnf文件中设置6400页而当前ibdata1为768页<br>需要计算768/64=12<br>修改配置为</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8746.png" alt="img"></p><p>重启mysqld服务</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8747.png" alt="img"></p><p>启动mysql，成功！<br><strong>注：</strong>计算公式：64pages相当于1M，1page是16KB<br>如果不清楚默认文件page大小，可以先 du -h ibdata1 查看下，再去设置；</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8748.png" alt="img"></p><p>这说明mysql5.7.13中ibdata初始化为12M</p><p>登录mysql执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &apos;%innodb_file_per_table%&apos;;</span><br></pre></td></tr></table></figure><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8749.png" alt="img"></p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8750.png" alt="img"></p><p>这时新建的表就会使用共享表空间了。</p><p>创建一个数据库testdb并新建一个表</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8751.png" alt="img"></p><p>向表中插入若干行数据</p><p>这里定义一个存储过程向表中插入100000行数据</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8752.png" alt="img"></p><p>调用存储过程</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8753.png" alt="img"></p><p>查看表中行数：</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8754.png" alt="img"></p><p>如何查看表在表空间占用情况：</p><p><strong>方法1：</strong>对INNODB，你可以直接用命令show table status查看某个表的表空间占用情况。</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8755.png" alt="img"></p><p><strong>方法2：</strong></p><p>如果想知道MySQL数据库中每个表占用的空间、表记录的行数的话，可以打开MySQL的information_schema数据库。在该库中有一个 TABLES 表，这个表主要字段分别是：</p><p>TABLE_SCHEMA : 数据库名<br>TABLE_NAME：表名<br>ENGINE：所使用的存储引擎<br>TABLE_ROWS：记录数<br>DATA_LENGTH：数据大小<br>INDEX_LENGTH：索引大小</p><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8756.png" alt="img"></p><h4 id="Replication相关文件"><a href="#Replication相关文件" class="headerlink" title="Replication相关文件"></a>Replication相关文件</h4><p><strong>1）master.info 文件：</strong><br>master.info 文件存在于Slave 端的数据目录下，里面存放了该Slave 的Master 端的相关信息，包括Master 的主机地址，连接用户，连接密码，连接端口，当前日志位置，已经读取到的日志位置等信息。</p><p><strong>2）relay log 和relay log index</strong><br>mysql-relay-bin.xxxxxn文件用于存放Slave 端的I/O 线程从Master 端所读取到的Binary Log 信息，然后由Slave 端的SQL 线程从该relay log 中读取并解析相应的日志信息，转化成Master 所执行的SQL 语句，然后在Slave 端应用。<br>mysql-relay-bin.index文件的功能类似于mysql-bin.index，同样是记录日志的存放位置的绝对路径，只不过他所记录的不是Binary Log，而是Relay Log。</p><p><strong>3）relay-log.info 文件：</strong><br>类似于master.info，它存放通过Slave 的I/O 线程写入到本地的relay log 的相关信息。供Slave 端的SQL 线程以及某些管理操作随时能够获取当前复制的相关信息。</p><h4 id="其他文件"><a href="#其他文件" class="headerlink" title="其他文件"></a>其他文件</h4><p><strong>1）system config file</strong><br>MySQL 的系统配置文件一般都是my.cnf，默认存放在”/etc”目录下，my.cnf文件中包含多种参数选项组（group），每一种参数组都通过中括号给定了固定的组名，如“[mysqld]”组中包括了mysqld服务启动时候的初始化参数，“[client]”组中包含着客户端工具程序可以读取的参数。<br><strong>2）pid file</strong><br>pid file 是mysqld应用程序在Unix/Linux 环境下的一个进程文件，和许多其他<br>Unix/Linux 服务端程序一样，存放着自己的进程id。<br><strong>3）socket file</strong><br>socket 文件也是在Unix/Linux 环境下才有的，用户在Unix/Linux 环境下客户端连接可以不通过TCP/IP 网络而直接使用Unix Socket 来连接MySQL。<br>mysql有两种连接方式，常用的一般是tcp</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql–hmysql主机ip -uroot -pxxx</span><br><span class="line">mysql-S /path/mysql.sock</span><br></pre></td></tr></table></figure><p><img src="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/%E5%9B%BE%E7%89%8757.png" alt="image-20191116110235751"></p><p><strong>注：</strong>采用unix socket连接方式，比用tcp的方式更快，但只适用于mysql和应用同在一台PC上。</p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"><i class="fa fa-tag"></i> 数据库</a><a href="/tags/MySQL/" rel="tag"><i class="fa fa-tag"></i> MySQL</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/09/21/mysql-zi-dai-gong-ju-shi-yong-jie-shao/" rel="next" title="MySQL 自带工具使用介绍"><i class="fa fa-chevron-left"></i> MySQL 自带工具使用介绍</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2017/09/26/mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing/" rel="prev" title="MySQL 架构组成之存储引擎">MySQL 架构组成之存储引擎<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"><span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a><a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/chen.png" alt="Zhongzhou Chen"><p class="site-author-name" itemprop="name">Zhongzhou Chen</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">332</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">85</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">183</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、MySQL-Server-简介"><span class="nav-text">1、MySQL Server 简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是MySQL"><span class="nav-text">什么是MySQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL-与其他数据库的简单比较"><span class="nav-text">MySQL 与其他数据库的简单比较</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL-的主要适用场景"><span class="nav-text">MySQL 的主要适用场景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、MySQL-架构组成"><span class="nav-text">2、MySQL 架构组成</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Mysql物理文件组成"><span class="nav-text">Mysql物理文件组成</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#日志文件"><span class="nav-text">日志文件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#错误日志：Error-Log"><span class="nav-text">错误日志：Error Log</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#二进制日志：Binary-Log-amp-Binary-Log-Index"><span class="nav-text">二进制日志：Binary Log &amp; Binary Log Index</span></a></li></ol></li></ol></li></ol></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#at-219-事件开始处"><span class="nav-text">at 219 #事件开始处</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#at-296"><span class="nav-text">at 296</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#事务日志-或称redo日志"><span class="nav-text">事务日志(或称redo日志)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#慢查询日志：slow-query-log"><span class="nav-text">慢查询日志：slow query log</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数据文件"><span class="nav-text">数据文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Replication相关文件"><span class="nav-text">Replication相关文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#其他文件"><span class="nav-text">其他文件</span></a></li></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Zhongzhou Chen</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">780.6k</span></div><span class="post-meta-divider"></span></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code").find(".line").map(function(t,e){return $(e).text()}).toArray().join("\n"),n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();var o=document.execCommand("copy");document.body.removeChild(n),o?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})</script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,s){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var o=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,n=document.getElementById(e),r=document.getElementById(s);n.addEventListener("input",function(){var y=n.value.trim().toLowerCase(),T=y.split(/[\s\-]+/);1<T.length&&T.push(y);var b=[];if(0<y.length&&o.forEach(function(t){function e(t,e,o,n){for(var r=n[n.length-1],s=r.position,a=r.word,i=[],c=0;s+a.length<=o&&0!=n.length;){a===y&&c++,i.push({position:s,length:a.length});var l=s+a.length;for(n.pop();0!=n.length&&(s=(r=n[n.length-1]).position,a=r.word,s<l);)n.pop()}return h+=c,{hits:i,start:e,end:o,searchTextCount:c}}function o(o,t){var n="",r=t.start;return t.hits.forEach(function(t){n+=o.substring(r,t.position);var e=t.position+t.length;n+='<b class="search-keyword">'+o.substring(t.position,e)+"</b>",r=e}),n+=o.substring(r,t.end)}var n=!1,r=0,h=0,s=t.title.trim(),a=s.toLowerCase(),i=t.content.trim().replace(/<[^>]+>/g,""),c=i.toLowerCase(),l=decodeURIComponent(t.url),p=[],u=[];if(""!=s&&(T.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());-1<(s=e.indexOf(t,r));)a.push({position:s,word:t}),r=s+n;return a}p=p.concat(e(t,a,!1)),u=u.concat(e(t,c,!1))}),(0<p.length||0<u.length)&&(n=!0,r=p.length+u.length)),n){[p,u].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var f=[];0!=p.length&&f.push(e(0,0,s.length,p));for(var d=[];0!=u.length;){var g=u[u.length-1],v=g.position,$=g.word,C=v-20,m=v+80;C<0&&(C=0),m<v+$.length&&(m=v+$.length),m>i.length&&(m=i.length),d.push(e(0,C,m,u))}d.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var x=parseInt("1");0<=x&&(d=d.slice(0,x));var w="";w+=0!=f.length?"<li><a href='"+l+"' class='search-result-title'>"+o(s,f[0])+"</a>":"<li><a href='"+l+"' class='search-result-title'>"+s+"</a>",d.forEach(function(t){w+="<a href='"+l+'\'><p class="search-result">'+o(i,t)+"...</p></a>"}),w+="</li>",b.push({item:w,searchTextCount:h,hitCount:r,id:b.length})}}),1===T.length&&""===T[0])r.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===b.length)r.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{b.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var e='<ul class="search-result-list">';b.forEach(function(t){e+=t.item}),e+="</ul>",r.innerHTML=e}}),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script type="text/javascript" src="/js/src/love.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,log:!1,model:{jsonPath:"/live2dw/assets/shizuku.model.json"},display:{position:"right"},mobile:{show:!0,scale:.2},react:{opacityDefault:.7,opacityOnHover:.2,opacity:.4}})</script></body></html>