<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><script></script><meta name="theme-color" content="#222"><style>.pace .pace-progress{background:#1e92fb;height:3px}.pace .pace-progress-inner{box-shadow:0 0 10px #1e92fb,0 0 5px #1e92fb}.pace .pace-activity{border-top-color:#1e92fb;border-left-color:#1e92fb}</style><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="HGM141IpbHrSmnAmR6W_zE4bo9Z3f-yXLeHYT3bg1fk"><meta name="baidu-site-verification" content="code-5Ai1DA8e6T"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="数据库,MySQL,Mysqlslap性能测试,"><link rel="alternate" href="/atom.xml" title="凡间的精灵" type="application/atom+xml"><meta name="description" content="1、MySQL Server 系统架构在前一节中我们学习了mysql的物理文件组成，接下来我们来学习mysql的逻辑模块组成。逻辑模块组成:MySQL逻辑结构可以看成是二层架构，第一层我们通常叫做SQL Layer，在MySQL 数据库系统处理底层数据之前的所有工作都是在这一层完成的，包括权限判断，sql解析，执行计划优化，query cache 的处理等等；第二层就是存储引擎层，我们通常叫做St"><meta name="keywords" content="数据库,MySQL,Mysqlslap性能测试"><meta property="og:type" content="article"><meta property="og:title" content="MySQL 架构组成之存储引擎"><meta property="og:url" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;26&#x2F;mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing&#x2F;index.html"><meta property="og:site_name" content="凡间的精灵"><meta property="og:description" content="1、MySQL Server 系统架构在前一节中我们学习了mysql的物理文件组成，接下来我们来学习mysql的逻辑模块组成。逻辑模块组成:MySQL逻辑结构可以看成是二层架构，第一层我们通常叫做SQL Layer，在MySQL 数据库系统处理底层数据之前的所有工作都是在这一层完成的，包括权限判断，sql解析，执行计划优化，query cache 的处理等等；第二层就是存储引擎层，我们通常叫做St"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;26&#x2F;mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing&#x2F;%E5%9B%BE%E7%89%871.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;26&#x2F;mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing&#x2F;%E5%9B%BE%E7%89%872.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;26&#x2F;mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing&#x2F;%E5%9B%BE%E7%89%873.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;26&#x2F;mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing&#x2F;%E5%9B%BE%E7%89%874.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;26&#x2F;mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing&#x2F;%E5%9B%BE%E7%89%875.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;26&#x2F;mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing&#x2F;%E5%9B%BE%E7%89%876.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;26&#x2F;mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing&#x2F;%E5%9B%BE%E7%89%877.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;26&#x2F;mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing&#x2F;%E5%9B%BE%E7%89%878.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;26&#x2F;mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing&#x2F;%E5%9B%BE%E7%89%879.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;26&#x2F;mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing&#x2F;%E5%9B%BE%E7%89%8712.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;26&#x2F;mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing&#x2F;%E5%9B%BE%E7%89%8710.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;26&#x2F;mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing&#x2F;%E5%9B%BE%E7%89%8711.png"><meta property="og:updated_time" content="2019-11-16T02:23:31.314Z"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;09&#x2F;26&#x2F;mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing&#x2F;%E5%9B%BE%E7%89%871.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"always",offset:12,b2t:!0,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://chenzhonzhou.github.io/2017/09/26/mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing/"><title>MySQL 架构组成之存储引擎 | 凡间的精灵</title><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">凡间的精灵</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">凡尘落素一精灵</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://chenzhonzhou.github.io/2017/09/26/mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Zhongzhou Chen"><meta itemprop="description" content=""><meta itemprop="image" content="/images/chen.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="凡间的精灵"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">MySQL 架构组成之存储引擎</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-26T17:55:56+08:00">2017-09-26</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">4.9k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">19</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="1、MySQL-Server-系统架构"><a href="#1、MySQL-Server-系统架构" class="headerlink" title="1、MySQL Server 系统架构"></a>1、MySQL Server 系统架构</h2><p><img src="/2017/09/26/mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing/%E5%9B%BE%E7%89%871.png" alt="img"></p><p>在前一节中我们学习了mysql的物理文件组成，接下来我们来学习mysql的逻辑模块组成。</p><h3 id="逻辑模块组成"><a href="#逻辑模块组成" class="headerlink" title="逻辑模块组成:"></a>逻辑模块组成:</h3><p>MySQL逻辑结构可以看成是二层架构，第一层我们通常叫做SQL Layer，在MySQL 数据库系统处理底层数据之前的所有工作都是在这一层完成的，包括权限判断，sql解析，执行计划优化，query cache 的处理等等；第二层就是存储引擎层，我们通常叫做StorageEngine Layer，也就是底层数据存取操作实现部分，由多种存储引擎共同组成。所以，可以用如下一张最简单的架构示意图来表示MySQL 的基本架构，如图所示：</p><p><img src="/2017/09/26/mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing/%E5%9B%BE%E7%89%872.png" alt="img"></p><p>从上图看起来MySQL逻辑架构非常的简单，但实际上每一层中都含有各自的很多小模块，尤其是第一层SQL Layer，结构相当复杂的。</p><p>接下来我们来学习mysql存储引擎。</p><h2 id="2、mysql存储引擎介绍"><a href="#2、mysql存储引擎介绍" class="headerlink" title="2、mysql存储引擎介绍"></a>2、mysql存储引擎介绍</h2><p>MySQL在5.1（不包括）之前的版本中，存储引擎是需要在MySQL 安装的时候就必须和MySQL 一起被编译并同时被安装的。</p><p>但是从MySQL5.1 开始，MySQL AB 对其结构体系做了较大的改造，并引入了一个新的概念：插件式存储引擎体系结构。MySQL AB 在架构改造的时候，让存储引擎层和sqllayer各自更为独立，耦合更小，甚至可以做到在线加载新的存储引擎，也就是完全可以将一个新的存储引擎加载到一个正在运行的MySQL 中，而不影响MySQL 的正常运行。插件式存储引擎的架构，为存储引擎的加载和移出更为灵活方便，也使自行开发存储引擎更为方便简单。</p><p>MySQL的插件式存储引擎主要包括MyISAM，Innodb，NDB Cluster，Maria，Falcon，Memory，Archive等，其中最著名而且使用最为广泛的MyISAM和Innodb两种存储引擎。MyISAM是MySQL 最早的ISAM 存储引擎的升级版本，也是MySQL 默认的存储引擎。而Innodb实际上并不是MySQ公司的，而是第三方软件公司Innobase（在2005 年被Oracle 公司所收购）所开发，其最大的特点是提供了事务控制等特性，所以使用者也非常广泛。</p><p>其他的一些存储引擎相对来说使用场景要稍微少一些，都是应用于某些特定的场景，如NDB Cluster虽然也支持事务，但是主要是用于分布式高可用集群环境。Maria是MySQL最新开发的对MyISAM的升级版存储引擎，Falcon 是MySQL 公司自行研发的为了替代当前的Innodb存储引擎的一款带有事务等高级特性的数据库存储引擎。Memory 存储引擎所有数据和索引均存储于内存中，仅保存.frm文件在硬盘，所以主要是用于一些临时表，或者对性能要求极高，但是允许在Crash 的时候丢失数据的特定场景下，会消耗内存较大。Archive 是一个数据经过高比例压缩存放的存储引擎，仅支持insert，select，不支持update和delete，主要用于存放过期而且很少访问的历史信息，不支持索引。</p><h3 id="MyISAM存储引擎简介"><a href="#MyISAM存储引擎简介" class="headerlink" title="MyISAM存储引擎简介"></a>MyISAM存储引擎简介</h3><p>1、mysql5.1之前默认存储引擎。</p><p>2、MyISAM存储引擎的表在数据库中，每一个表都被存放为三个以表名命名的物理文件。首先肯定会有任何存储引擎都不可缺少的存放表结构定义信息的.frm文件，另外还有.MYD和.MYI 文件，分别存放了表的数据（.MYD）和索引数据（.MYI）。每个表都有且仅有这样三个文件做为MyISAM存储类型的表的存储，也就是说不管这个表有多少个索引，都是存放在同一个.MYI 文件中。</p><p>3、MyISAM支持以下三种类型的索引：</p><p><strong>B-Tree 索引</strong></p><p>B-Tree 索引，就是所有的索引节点都按照balance tree 的数据结构来存储，所有的索引数据节点都在叶节点。</p><p><strong>R-Tree 索引</strong></p><p>R-Tree 索引的存储方式和b-tree 索引有一些区别，主要设计用于为存储空间和多维数据的字段做索引，所以目前的MySQL 版本来说，也仅支持geometry 类型的字段作索引。</p><p><strong>Full-text 索引</strong></p><p>Full-text 索引就是全文索引，他的存储结构也是b-tree。主要是为了解决在我们需要用like 查询的低效问题。</p><p>MyISAM上面三种索引类型中，最经常使用的就是B-Tree 索引了，偶尔会使用到Fulltext，但是R-Tree 索引一般系统中都是很少用到的。另外MyISAM的B-Tree 索引有一个较大的限制，那就是参与一个索引的所有字段的长度之和不能超过1000 字节。</p><p>3、不支持事务</p><p>4、只有表锁</p><p>5、如下情况会造成表损坏：</p><p>Mysqld正在写入该表时，被kill掉</p><p>主机宕机（Crash）</p><p>磁盘硬件故障</p><p>MyISAM存储引擎的bug</p><p>6、虽然每一个MyISAM的表都是存放在一个相同后缀名的.MYD 文件中，但是每个文件的存放格式实际上可能并不是完全一样的，因为MyISAM的数据存放格式是分为静态（FIXED）固定长度、动态（DYNAMIC）可变长度以及压缩（COMPRESSED）这三种格式。当然三种格式中是否压缩是完全可以任由自己选择的，可以在创建表的时候通过ROW_FORMAT 来指定{COMPRESSED | DEFAULT}，也可以通过myisampack工具来进行压缩，默认是不压缩的。而在非压缩的情况下，是静态还是动态，就和我们表中个字段的定义相关了。只要表中有可变长度类型的字段存在，那么该表就肯定是DYNAMIC 格式的，如果没有任何可变长度的字段，则为FIXED 格式，当然，你也可以通过alter table 命令，强行将一个带有VARCHAR 类型字段的DYNAMIC 的表转换为FIXED，但是所带来的结果是原VARCHAR 字段类型会被自动转换成CHAR 类型。相反如果将FIXED 转换为DYNAMIC，也会将CHAR 类型字段转换为VARCHAR 类型，</p><p>知识点扩展：如何根据表的记录数量估算占用的磁盘空间</p><p>首先先算一个表中一行有多少个字节。</p><p>然后根据数据库中的表每天增加多少行记录，就能够算出每天要增加多少硬盘空间，这样就可根据数据量估算规划多大的空间。</p><p>例如在数据库test中创建一张tb1表</p><p><img src="/2017/09/26/mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing/%E5%9B%BE%E7%89%873.png" alt="img"></p><p>执行mysql&gt;desc test1.tb1查看tb1的表结构</p><p><img src="/2017/09/26/mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing/%E5%9B%BE%E7%89%874.png" alt="img"></p><p>10个字节+20个字节+2个字节+20字节+8字节+8字节+100个字节=168字节</p><p>Tb1表的一个行有118个字节</p><p>如果每天增加10000条记录，大约需要10000x168/1024/1024=1.6MB</p><p>这样就可以根据每天增加的记录数，合理规划好磁盘空间了</p><p>MyISAM存储引擎的某个表文件出错之后，仅影响到该表，而不会影响到其他表，更不会影响到其他的数据库。如果我们的数据库正在运行过程中发现某个MyISAM表出现问题了，则可以在线通过check table 命令来尝试校验他，并可以通过repair table 命令来尝试修复。在数据库关闭状态下，我们也可以通过myisamchk工具来对数据库中某个（或某些）表进行检测或者修复。不过强烈建议不到万不得已不要轻易对表进行修复操作，修复之前尽量做好可能的备份工作，以免带来不必要的后果。</p><h3 id="Innodb存储引擎简介"><a href="#Innodb存储引擎简介" class="headerlink" title="Innodb存储引擎简介"></a>Innodb存储引擎简介</h3><p>Innodb之所以能如此受宠，主要是在于其功能方面的较多特点：</p><p>1、支持事务</p><p>Innodb在功能方面最重要的一点就是对事务的支持，这无疑是让Innodb成为MySQL最为流行的存储引擎之一的一个非常重要原因。</p><p>2、锁定机制的改进</p><p>Innodb改变了MyISAM的锁机制，实现了行锁。</p><p>3、实现外键</p><p>Innodb实现了外键引用这一数据库的重要特性。</p><p>4、Innodb存储引擎也和MyISAM不太一样，虽然也有.frm文件来存放表结构定义相关的元数据，但是表数据和索引数据是存放在一起的。至于是每个表单独存放还是所有表存放在一起，完全由用户来决定。</p><p><strong>Innodb的物理结构分为两大部分：</strong></p><p>1、数据文件（表数据和索引数据）</p><p>存放数据表中的数据和所有的索引数据，包括主键和其他普通索引。在Innodb中，存在了表空间（tablespace）这样一个概念，但是他和Oracle 的表空间又有较大的不同。首先，Innodb的表空间分为两种形式。一种是共享表空间，也就是所有表和索引数据被存放在同一个表空间（一个或多个数据文件）中，通过innodb_data_file_path来指定，增加数据文件需要停机重启。另外一种是独享表空间，也就是每个表的数据和索引被存放在一个单独的.ibd文件中。</p><p>虽然我们可以自行设定使用共享表空间还是独享表空间来存放我们的表，但是共享表空间都是必须存在的，因为Innodb的undo 信息和其他一些元数据信息都是存放在共享表空间里面的。共享表空间的数据文件是可以设置为固定大小和可自动扩展大小两种形式的。</p><p>当我们的文件表空间快要用完的时候，我们必须要为其增加数据文件，当然，只有共享表空间有此操作。共享表空间增加数据文件的操作比较简单，只需要在innodb_data_file_path参数后面按照标准格式设置好文件路径和相关属性即可，不过这里有一点需要注意的，就是Innodb在创建新数据文件的时候是不会创建目录的，如果指定目录不存在，则会报错并无法启动。</p><p>2、日志文件</p><p>Innodb的日志文件和Oracle 的redo 日志比较类似，同样可以设置多个日志组（最少2</p><p>个），同样采用轮循策略来顺序的写入。</p><p>由于Innodb是事务的存储引擎，所以系统Crash（宕机）对他来说并不能造成非常严重的损失，由于有redo日志（即事物日志）的存在，有checkpoint 机制的保护，Innodb完全可以通过redo 日志将数据库Crash 时刻已经完成但还没有来得及将数据写入磁盘的事务恢复，也能够将所有部分完成并已经写入磁盘的未完成事务回滚并将数据还原。</p><p>Innodb不仅在功能特性方面和MyISAM存储引擎有较大区别，在配置上面也是单独处理的。在MySQL 启动参数文件（/etc/my.cnf）设置中，Innodb的所有参数基本上都带有前缀“innodb_”，不论是innodb数据和日志相关，还是其他一些性能，事务等等相关的参数都是一样。和所有Innodb相关的系统变量一样，所有的Innodb相关的系统状态值也同样全部以“Innodb_”前缀。</p><h3 id="MyISAM和InnoDB的区别"><a href="#MyISAM和InnoDB的区别" class="headerlink" title="MyISAM和InnoDB的区别"></a>MyISAM和InnoDB的区别</h3><p>1、 MyISAM不支持事务，而InnoDB支持。InnoDB的AUTOCOMMIT默认是打开的，即每条SQL语句会默认被封装成一个事务，自动提交，这样会影响速度，所以最好是把多条SQL语句显示放在begin和commit之间，组成一个事务去提交。</p><p><img src="/2017/09/26/mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing/%E5%9B%BE%E7%89%875.png" alt="img"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use test_db;</span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">mysql&gt;desc tb1;</span><br><span class="line">mysql&gt; begin;</span><br><span class="line">mysql&gt; insert into tb1 values(&apos;lisi&apos;,1);</span><br><span class="line">mysql&gt; insert into tb1 values(&apos;zhangsan&apos;,2);</span><br><span class="line">mysql&gt; commit;</span><br></pre></td></tr></table></figure><p>2、InnoDB支持数据行锁定，MyISAM不支持行锁定，只支持锁定整个表。即MyISAM同一个表上的读锁和写锁是互斥的，MyISAM并发读写时如果等待队列中既有读请求又有写请求，默认写请求的优先级高，即使读请求先到，所以MyISAM不适合于有大量查询和修改并存的情况，那样查询进程会长时间阻塞。因为MyISAM是锁表。</p><p>3、InnoDB支持外键，MyISAM不支持。</p><p>4、InnoDB不支持全文索引，而MyISAM支持。</p><h2 id="3、Mysqlslap性能测试MySQL二种存储引擎"><a href="#3、Mysqlslap性能测试MySQL二种存储引擎" class="headerlink" title="3、Mysqlslap性能测试MySQL二种存储引擎"></a>3、Mysqlslap性能测试MySQL二种存储引擎</h2><p>mysqlslap是mysql自带的基准测试工具,<strong>优点:查询数据,语法简单,灵活容易使用</strong>。该工具可以模拟多个客户端同时并发的向服务器发出查询更新,给出了性能测试数据而且提供了多种引擎的性能比较.msqlslap为mysql性能优化前后提供了直观的验证依据,建议系统运维和DBA人员应该掌握一些常见的压力测试工具,才能准确的掌握线上数据库支撑的用户流量上限及其抗压性等问题。</p><p>现在看一下这个压力测试工具mysqlslap，关于他的选项手册上以及–help介绍的很详细。<br>这里解释一下一些常用的选项。</p><table><thead><tr><th>选项</th><th>描述</th></tr></thead><tbody><tr><td>–concurrency</td><td>代表并发数量，多个可以用逗号隔开。例如：concurrency=50,100,200</td></tr><tr><td>–engines</td><td>代表要测试的引擎，可以有多个，用分隔符隔开</td></tr><tr><td>–iterations</td><td>代表要运行这些测试多少次，即运行多少次后，得到结果</td></tr><tr><td>–auto-generate-sql</td><td>代表用系统自己生成的SQL脚本来测试</td></tr><tr><td>–auto-generate-sql-load-type</td><td>代表要测试的是读还是写还是两者混合的（read,write,update,mixed）</td></tr><tr><td>–number-of-queries</td><td>代表总共要运行多少次查询。每个客户运行的查询数量可以用查询总数/并发数来计算。比如倒数第二个结果2=200/100</td></tr><tr><td>–debug-info</td><td>代表要额外输出CPU以及内存的相关信息（注：只有在MySQL用–with-debug编译时可）</td></tr><tr><td>–number-int-cols</td><td>代表测试表中的INTEGER类型的属性有几个</td></tr><tr><td>–number-char-cols</td><td>代表测试表的char类型字段的数量</td></tr><tr><td>–create-schema</td><td>代表自己定义的模式（在MySQL中也就是库即创建测试的数据库）</td></tr><tr><td>–query</td><td>代表自己的SQL脚本</td></tr><tr><td>–only-print</td><td>如果只想打印看看SQL语句是什么，可以用这个选项</td></tr><tr><td>–csv=name</td><td>生产CSV格式数据文件</td></tr></tbody></table><h3 id="3-1-修改Mysql数据库默认最大连接数"><a href="#3-1-修改Mysql数据库默认最大连接数" class="headerlink" title="3.1 修改Mysql数据库默认最大连接数"></a>3.1 修改Mysql数据库默认最大连接数</h3><p><strong>查看当前连接数</strong></p><p><img src="/2017/09/26/mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing/%E5%9B%BE%E7%89%876.png" alt="img"></p><p>可以看到mysql5.7.13默认是151，注：不同版本默认最大连接数不差别。一般生产环境是不够的，在my.cnf [mysqld]下添加 max_connections=1024 增加到1024，重启Mysql。</p><p><strong>修改my.cnf文件并重起mysqld服务</strong></p><p><img src="/2017/09/26/mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing/%E5%9B%BE%E7%89%877.png" alt="img"></p><p><strong>查看修改后的最大连接数</strong></p><p><img src="/2017/09/26/mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing/%E5%9B%BE%E7%89%878.png" alt="img"></p><h3 id="3-2-查看Mysql默认使用存储引擎"><a href="#3-2-查看Mysql默认使用存储引擎" class="headerlink" title="3.2 查看Mysql默认使用存储引擎"></a>3.2 查看Mysql默认使用存储引擎</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show engines;</span><br></pre></td></tr></table></figure><p><img src="/2017/09/26/mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing/%E5%9B%BE%E7%89%879.png" alt="img"></p><p>现在我们来看一下具体测试的例子</p><h3 id="3-3-用自带的SQL脚本来测试"><a href="#3-3-用自带的SQL脚本来测试" class="headerlink" title="3.3 用自带的SQL脚本来测试"></a>3.3 用自带的SQL脚本来测试</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysqlslap --defaults-file=/etc/my.cnf --concurrency=100,200 --iterations=1 --number-int-cols=20 --number-char-cols=30 --auto-generate-sql --auto-generate-sql-add-autoincrement --auto-generate-sql-load-type=mixed --engine=myisam,innodb --number-of-queries=2000 -uroot -p123456 --verbose</span><br></pre></td></tr></table></figure><p><strong>显示结果：</strong></p><p><img src="/2017/09/26/mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing/%E5%9B%BE%E7%89%8712.png" alt="img"></p><p>测试说明</p><p>模拟测试两次读写并发，第一次100，第二次200，自动生成SQL脚本，测试表包含20个init字段，30个char字段，每次执行2000查询请求。测试引擎分别是myisam，innodb。</p><h3 id="3-4-测试结果说明"><a href="#3-4-测试结果说明" class="headerlink" title="3.4 测试结果说明"></a>3.4 测试结果说明</h3><p>Myisam第一次100客户端同时发起增查用0.270/s,第二次200客户端同时发起增查用0.319/s</p><p>Innodb第一次100客户端同时发起增查用0.387/s,第二次200客户端同时发起增查用0.422/s</p><p>由此可见MyISAM存储引擎处理性能是最好的，也是最常用的，但不支持事务。InonDB存储引擎提供了事务型数据引擎（ACID），在事务型引擎里使用最多的。具有事务回滚，系统修复等特点。</p><p>Mysqlslap测试工具生产CSV格式数据文件并转换成图表形式：</p><p>[root@localhost ~]# mysqlslap –defaults-file=/etc/my.cnf –concurrency=100,200 –iterations=1 –number-int-cols=20 –number-char-cols=30 –auto-generate-sql –auto-generate-sql-add-autoincrement –auto-generate-sql-load-type=mixed –engine=myisam,innodb –number-of-queries=2000 -uroot -p123456 –csv=/root/a.csv</p><p><strong>执行结果：</strong></p><p><img src="/2017/09/26/mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing/%E5%9B%BE%E7%89%8710.png" alt="img"></p><p>将a.csv拷贝到windows主机上，打开并生成图表</p><p><img src="/2017/09/26/mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing/%E5%9B%BE%E7%89%8711.png" alt="img"></p><h3 id="3-5-用我们自己定义的SQL-脚本或语句来测试"><a href="#3-5-用我们自己定义的SQL-脚本或语句来测试" class="headerlink" title="3.5 用我们自己定义的SQL 脚本或语句来测试"></a>3.5 用我们自己定义的SQL 脚本或语句来测试</h3><p><strong>首先准备好要测试的数据库表</strong>，这里我们编写一个生成表的脚本去完成</p><p>脚本内容如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /root/mysql3.sh </span><br><span class="line">#!/bin/bash</span><br><span class="line">HOSTNAME=&quot;localhost&quot;</span><br><span class="line">PORT=&quot;3306&quot;</span><br><span class="line">USERNAME=&quot;root&quot;</span><br><span class="line">PASSWORD=&quot;123.abc&quot;</span><br><span class="line"></span><br><span class="line">DBNAME=&quot;test1&quot;</span><br><span class="line">TABLENAME=&quot;tb1&quot;</span><br><span class="line"></span><br><span class="line"># create database</span><br><span class="line">mysql -h $&#123;HOSTNAME&#125; -P $&#123;PORT&#125; -u $&#123;USERNAME&#125; -p$&#123;PASSWORD&#125; -e &quot;drop database if exists $&#123;DBNAME&#125;&quot;</span><br><span class="line">create_db_sql=&quot;create database if not exists $&#123;DBNAME&#125;&quot;</span><br><span class="line">mysql -h $&#123;HOSTNAME&#125; -P $&#123;PORT&#125; -u $&#123;USERNAME&#125; -p$&#123;PASSWORD&#125; -e &quot;$&#123;create_db_sql&#125;&quot;</span><br><span class="line"></span><br><span class="line"># create table</span><br><span class="line">create_table_sql=&quot;create table if not exists $&#123;DBNAME&#125;.$&#123;TABLENAME&#125;(stuid int not null primary key,stuname varchar(20) not null,stusex char(1) not null,cardid varchar(20) not null,birthday datetime,entertime datetime,address varchar(100) default null)&quot;</span><br><span class="line">mysql -h $&#123;HOSTNAME&#125; -P $&#123;PORT&#125; -u $&#123;USERNAME&#125; -p$&#123;PASSWORD&#125; $&#123;DBNAME&#125; -e &quot;$&#123;create_table_sql&#125;&quot;</span><br><span class="line"></span><br><span class="line"># insert data to table</span><br><span class="line">i=1</span><br><span class="line">while [ $i -le 20000 ]</span><br><span class="line">do</span><br><span class="line">insert_sql=&quot;insert into $&#123;DBNAME&#125;.$&#123;TABLENAME&#125; values ($i,&apos;zhangsan&apos;,&apos;1&apos;,&apos;1234567890123456&apos;,&apos;1999-10-10&apos;,&apos;2016-9-3&apos;,&apos;zhongguo beijingshichangpinqu&apos;)&quot;</span><br><span class="line">mysql -h $&#123;HOSTNAME&#125; -P $&#123;PORT&#125; -u $&#123;USERNAME&#125; -p$&#123;PASSWORD&#125; $&#123;DBNAME&#125; -e &quot;$&#123;insert_sql&#125;&quot;</span><br><span class="line">let i++</span><br><span class="line">done</span><br><span class="line"># select data</span><br><span class="line">select_sql=&quot;select count(*) from $&#123;DBNAME&#125;.$&#123;TABLENAME&#125;&quot;</span><br><span class="line">mysql -h $&#123;HOSTNAME&#125; -P $&#123;PORT&#125; -u $&#123;USERNAME&#125; -p$&#123;PASSWORD&#125; $&#123;DBNAME&#125; -e &quot;$&#123;select_sql&#125;&quot;</span><br></pre></td></tr></table></figure><p><strong>授权脚本x执行权限</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# chmod +x /root/mysql3.sh</span><br></pre></td></tr></table></figure><p><strong>执行脚本mysql3.sh</strong>生成mysqlslap工具需要的测试表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# /root/mysql3.sh</span><br></pre></td></tr></table></figure><p><strong>执行mysqlslap工具进行测试</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]#  mysqlslap --defaults-file=/etc/my.cnf --concurrency=10,20 --iterations=1 --create-schema=&apos;test1&apos; --query=&apos;select * from test1.tb1&apos; --engine=myisam,innodb --number-of-queries=2000 -uroot -p123456 –verbose</span><br></pre></td></tr></table></figure><p><strong>显示结果：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">mysqlslap: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Benchmark</span><br><span class="line">	Running for engine myisam</span><br><span class="line">	Average number of seconds to run all queries: 14.128 seconds</span><br><span class="line">	Minimum number of seconds to run all queries: 14.128 seconds</span><br><span class="line">	Maximum number of seconds to run all queries: 14.128 seconds</span><br><span class="line">	Number of clients running queries: 10</span><br><span class="line">	Average number of queries per client: 200</span><br><span class="line"></span><br><span class="line">Benchmark</span><br><span class="line">	Running for engine myisam</span><br><span class="line">	Average number of seconds to run all queries: 13.646 seconds</span><br><span class="line">	Minimum number of seconds to run all queries: 13.646 seconds</span><br><span class="line">	Maximum number of seconds to run all queries: 13.646 seconds</span><br><span class="line">	Number of clients running queries: 20</span><br><span class="line">	Average number of queries per client: 100</span><br><span class="line"></span><br><span class="line">Benchmark</span><br><span class="line">	Running for engine innodb</span><br><span class="line">	Average number of seconds to run all queries: 13.837 seconds</span><br><span class="line">	Minimum number of seconds to run all queries: 13.837 seconds</span><br><span class="line">	Maximum number of seconds to run all queries: 13.837 seconds</span><br><span class="line">	Number of clients running queries: 10</span><br><span class="line">	Average number of queries per client: 200</span><br><span class="line"></span><br><span class="line">Benchmark</span><br><span class="line">	Running for engine innodb</span><br><span class="line">	Average number of seconds to run all queries: 13.768 seconds</span><br><span class="line">	Minimum number of seconds to run all queries: 13.768 seconds</span><br><span class="line">	Maximum number of seconds to run all queries: 13.768 seconds</span><br><span class="line">	Number of clients running queries: 20</span><br><span class="line">	Average number of queries per client: 100</span><br></pre></td></tr></table></figure><p><strong>注：</strong>通过mysqlslap工具对mysql server进行压力测试，可以通过–concurrency、–number-of-queries等选项的值查看每次测试的结果，通过反复测试、优化得出mysql server的最大并发数。</p><p>如果mysqlslap工具输出结果为Segmentation fault (core dumped)基本表示走超出mysql server的负载。</p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"><i class="fa fa-tag"></i> 数据库</a><a href="/tags/MySQL/" rel="tag"><i class="fa fa-tag"></i> MySQL</a><a href="/tags/Mysqlslap%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" rel="tag"><i class="fa fa-tag"></i> Mysqlslap性能测试</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/09/24/mysql-jia-gou-zu-cheng-zhi-wu-li-wen-jian-zu-cheng/" rel="next" title="MySQL 架构组成之物理文件组成"><i class="fa fa-chevron-left"></i> MySQL 架构组成之物理文件组成</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2017/10/13/openvpn-2.3.4-bu-shu-chuang-jian-pei-zhi-ke-hu-duan-zheng-shu/" rel="prev" title="OpenVPN 2.3.4部署 创建 配置客户端证书">OpenVPN 2.3.4部署 创建 配置客户端证书<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"><span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a><a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/chen.png" alt="Zhongzhou Chen"><p class="site-author-name" itemprop="name">Zhongzhou Chen</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">332</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">85</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">183</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、MySQL-Server-系统架构"><span class="nav-text">1、MySQL Server 系统架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#逻辑模块组成"><span class="nav-text">逻辑模块组成:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、mysql存储引擎介绍"><span class="nav-text">2、mysql存储引擎介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MyISAM存储引擎简介"><span class="nav-text">MyISAM存储引擎简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Innodb存储引擎简介"><span class="nav-text">Innodb存储引擎简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MyISAM和InnoDB的区别"><span class="nav-text">MyISAM和InnoDB的区别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、Mysqlslap性能测试MySQL二种存储引擎"><span class="nav-text">3、Mysqlslap性能测试MySQL二种存储引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-修改Mysql数据库默认最大连接数"><span class="nav-text">3.1 修改Mysql数据库默认最大连接数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-查看Mysql默认使用存储引擎"><span class="nav-text">3.2 查看Mysql默认使用存储引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-用自带的SQL脚本来测试"><span class="nav-text">3.3 用自带的SQL脚本来测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-测试结果说明"><span class="nav-text">3.4 测试结果说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-用我们自己定义的SQL-脚本或语句来测试"><span class="nav-text">3.5 用我们自己定义的SQL 脚本或语句来测试</span></a></li></ol></li></ol></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Zhongzhou Chen</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">777.2k</span></div><span class="post-meta-divider"></span></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code").find(".line").map(function(t,e){return $(e).text()}).toArray().join("\n"),n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();var o=document.execCommand("copy");document.body.removeChild(n),o?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})</script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,s){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var o=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,n=document.getElementById(e),r=document.getElementById(s);n.addEventListener("input",function(){var y=n.value.trim().toLowerCase(),T=y.split(/[\s\-]+/);1<T.length&&T.push(y);var b=[];if(0<y.length&&o.forEach(function(t){function e(t,e,o,n){for(var r=n[n.length-1],s=r.position,a=r.word,i=[],c=0;s+a.length<=o&&0!=n.length;){a===y&&c++,i.push({position:s,length:a.length});var l=s+a.length;for(n.pop();0!=n.length&&(s=(r=n[n.length-1]).position,a=r.word,s<l);)n.pop()}return h+=c,{hits:i,start:e,end:o,searchTextCount:c}}function o(o,t){var n="",r=t.start;return t.hits.forEach(function(t){n+=o.substring(r,t.position);var e=t.position+t.length;n+='<b class="search-keyword">'+o.substring(t.position,e)+"</b>",r=e}),n+=o.substring(r,t.end)}var n=!1,r=0,h=0,s=t.title.trim(),a=s.toLowerCase(),i=t.content.trim().replace(/<[^>]+>/g,""),c=i.toLowerCase(),l=decodeURIComponent(t.url),p=[],u=[];if(""!=s&&(T.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());-1<(s=e.indexOf(t,r));)a.push({position:s,word:t}),r=s+n;return a}p=p.concat(e(t,a,!1)),u=u.concat(e(t,c,!1))}),(0<p.length||0<u.length)&&(n=!0,r=p.length+u.length)),n){[p,u].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var f=[];0!=p.length&&f.push(e(0,0,s.length,p));for(var d=[];0!=u.length;){var g=u[u.length-1],v=g.position,$=g.word,C=v-20,m=v+80;C<0&&(C=0),m<v+$.length&&(m=v+$.length),m>i.length&&(m=i.length),d.push(e(0,C,m,u))}d.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var x=parseInt("1");0<=x&&(d=d.slice(0,x));var w="";w+=0!=f.length?"<li><a href='"+l+"' class='search-result-title'>"+o(s,f[0])+"</a>":"<li><a href='"+l+"' class='search-result-title'>"+s+"</a>",d.forEach(function(t){w+="<a href='"+l+'\'><p class="search-result">'+o(i,t)+"...</p></a>"}),w+="</li>",b.push({item:w,searchTextCount:h,hitCount:r,id:b.length})}}),1===T.length&&""===T[0])r.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===b.length)r.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{b.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var e='<ul class="search-result-list">';b.forEach(function(t){e+=t.item}),e+="</ul>",r.innerHTML=e}}),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script type="text/javascript" src="/js/src/love.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,log:!1,model:{jsonPath:"/live2dw/assets/shizuku.model.json"},display:{position:"right"},mobile:{show:!0,scale:.2},react:{opacityDefault:.7,opacityOnHover:.2,opacity:.4}})</script></body></html>