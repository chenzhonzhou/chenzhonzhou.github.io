<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><script></script><meta name="theme-color" content="#222"><style>.pace .pace-progress{background:#1e92fb;height:3px}.pace .pace-progress-inner{box-shadow:0 0 10px #1e92fb,0 0 5px #1e92fb}.pace .pace-activity{border-top-color:#1e92fb;border-left-color:#1e92fb}</style><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="HGM141IpbHrSmnAmR6W_zE4bo9Z3f-yXLeHYT3bg1fk"><meta name="baidu-site-verification" content="code-5Ai1DA8e6T"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="VPN,OpenVPN,"><link rel="alternate" href="/atom.xml" title="凡间的精灵" type="application/atom+xml"><meta name="description" content="1.OpenVPN简介VPN直译就是虚拟专用通道，是提供给企业之间或者个人与公司之间安全数据传输的隧道，OpenVPN无疑是Linux下开源VPN的先锋，提供了良好的性能和友好的用户GUI。OpenVPN允许参与建立VPN的单点使用共享金钥，电子证书，或者用户名&#x2F;密码来进行身份验证。它大量使用了OpenSSL加密库中的SSLv3 &#x2F;TLSv1 协议函式库。OpenVPN能在Solaris、Linu"><meta name="keywords" content="VPN,OpenVPN"><meta property="og:type" content="article"><meta property="og:title" content="OpenVPN 2.3.4部署 创建 配置客户端证书"><meta property="og:url" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;10&#x2F;13&#x2F;openvpn-2.3.4-bu-shu-chuang-jian-pei-zhi-ke-hu-duan-zheng-shu&#x2F;index.html"><meta property="og:site_name" content="凡间的精灵"><meta property="og:description" content="1.OpenVPN简介VPN直译就是虚拟专用通道，是提供给企业之间或者个人与公司之间安全数据传输的隧道，OpenVPN无疑是Linux下开源VPN的先锋，提供了良好的性能和友好的用户GUI。OpenVPN允许参与建立VPN的单点使用共享金钥，电子证书，或者用户名&#x2F;密码来进行身份验证。它大量使用了OpenSSL加密库中的SSLv3 &#x2F;TLSv1 协议函式库。OpenVPN能在Solaris、Linu"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;10&#x2F;13&#x2F;openvpn-2.3.4-bu-shu-chuang-jian-pei-zhi-ke-hu-duan-zheng-shu&#x2F;%E5%9B%BE%E7%89%871.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;10&#x2F;13&#x2F;openvpn-2.3.4-bu-shu-chuang-jian-pei-zhi-ke-hu-duan-zheng-shu&#x2F;%E5%9B%BE%E7%89%872.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;10&#x2F;13&#x2F;openvpn-2.3.4-bu-shu-chuang-jian-pei-zhi-ke-hu-duan-zheng-shu&#x2F;%E5%9B%BE%E7%89%873.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;10&#x2F;13&#x2F;openvpn-2.3.4-bu-shu-chuang-jian-pei-zhi-ke-hu-duan-zheng-shu&#x2F;%E5%9B%BE%E7%89%874.png"><meta property="og:updated_time" content="2019-11-05T09:04:53.311Z"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;10&#x2F;13&#x2F;openvpn-2.3.4-bu-shu-chuang-jian-pei-zhi-ke-hu-duan-zheng-shu&#x2F;%E5%9B%BE%E7%89%871.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"always",offset:12,b2t:!0,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://chenzhonzhou.github.io/2017/10/13/openvpn-2.3.4-bu-shu-chuang-jian-pei-zhi-ke-hu-duan-zheng-shu/"><title>OpenVPN 2.3.4部署 创建 配置客户端证书 | 凡间的精灵</title><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">凡间的精灵</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">凡尘落素一精灵</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://chenzhonzhou.github.io/2017/10/13/openvpn-2.3.4-bu-shu-chuang-jian-pei-zhi-ke-hu-duan-zheng-shu/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Zhongzhou Chen"><meta itemprop="description" content=""><meta itemprop="image" content="/images/chen.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="凡间的精灵"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">OpenVPN 2.3.4部署 创建 配置客户端证书</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-13T09:39:26+08:00">2017-10-13</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/VPN/" itemprop="url" rel="index"><span itemprop="name">VPN</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/VPN/OpenVPN/" itemprop="url" rel="index"><span itemprop="name">OpenVPN</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">5.7k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">20</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="1-OpenVPN简介"><a href="#1-OpenVPN简介" class="headerlink" title="1.OpenVPN简介"></a>1.OpenVPN简介</h2><p>VPN直译就是虚拟专用通道，是提供给企业之间或者个人与公司之间安全数据传输的隧道，OpenVPN无疑是Linux下开源VPN的先锋，提供了良好的性能和友好的用户GUI。</p><p>OpenVPN允许参与建立VPN的单点使用共享金钥，电子证书，或者用户名/密码来进行身份验证。它大量使用了OpenSSL加密库中的SSLv3 /TLSv1 协议函式库。OpenVPN能在Solaris、Linux、OpenBSD、FreeBSD、NetBSD、Mac OS X与Windows 上运行，并包含了许多安全性的功能。它并不是一个基于Web的VPN软件，也不与IPsec及其他VPN软件包兼容。</p><p>虚拟私有网络(VPN)隧道是通过Internet隧道技术将两个不同地理位置的网络安全的连接起来的技术。当两个网络是使用私有IP地址的私有局域网络时，它们之间是不能相互访问的，这时使用隧道技术就可以使得两个子网内的主机进行通讯。例如，VPN隧道技术经常被用于大型机构中不同办公区域子网的连接。</p><p>有时，使用VPN隧道仅仅是因为它很安全。服务提供商与公司会使用这样一种方式架设网络，他们将重要的服务器(如，数据库，VoIP，银行服务器)放置到一个子网内，仅仅让有权限的用户通过VPN隧道进行访问。如果需要搭建一个安全的VPN隧道，通常会选用IPsec，因为IPsec VPN隧道被多重安全层所保护。</p><p>VPN (虚拟专用网)发展至今已经不在是一个单纯的经过加密的访问隧道了，它已经融合了访问控制、传输管理、加密、路由选择、可用性管理等多种功能，并在全球的信息安全体系中发挥着重要的作用。也在网络上，有关各种VPN协议优缺点的比较是仁者见仁，智者见智，很多技术人员由于出于使用目的考虑，包括访问控制、 安全和用户简单易用，灵活扩展等各方面，权衡利弊，难以取舍;尤其在VOIP语音环境中，网络安全显得尤为重要，因此现在越来越多的网络电话和语音网关支持VPN协议。</p><p><strong>原理</strong></p><p>OpenVpn的技术核心是虚拟网卡，其次是SSL协议实现：<br>虚拟网卡是使用网络底层编程技术实现的一个驱动软件，安装后在主机上多出现一个网卡，可以像其它网卡一样进行配置。服务程序可以在应用层打开虚拟网卡，如果应用软件(如IE)向虚拟网卡发送数据，则服务程序可以读取到该数据，如果服务程序写合适的数据到虚拟网卡，应用软件也可以接收得到。虚拟网卡在很多的操作系统下都有相应的实现，这也是OpenVpn能够跨平台一个很重要的理由。</p><p>在OpenVpn中，如果用户访问一个远程的虚拟地址(属于虚拟网卡配用的地址系列，区别于真实地址)，则操作系统会通过路由机制将数据包(TUN模式)或数据帧(TAP模式)发送到虚拟网卡上，服务程序接收该数据并进行相应的处理后，通过SOCKET从外网上发送出去，远程服务程序通过SOCKET从外网上接收数据，并进行相应的处理后，发送给虚拟网卡，则应用软件可以接收到，完成了一个单向传输的过程，反之亦然。</p><h2 id="2-vpn的优点与缺点"><a href="#2-vpn的优点与缺点" class="headerlink" title="2.vpn的优点与缺点"></a>2.vpn的优点与缺点</h2><p><strong>优点：</strong>成本低，vpn是一个廉价有效的构建私有网络的方式，用它可以替代昂贵的实体专线;灵活，vpn比实体专线更灵活。例如，一个公司可以在VPN站点的数量调整，根据不断变化的需求。<br><strong>缺点：</strong>搭建vpn不容易，对技术要求非常高，需要对网络和安全问题有高水平的理解以及认真地规划和配置。由于在互联网上缺乏质量服务(QoS)管理，可能会导致数据包丢失和其他性能问题。若公共网络条件发生问题，则私网的VPN管理员不能控制。出于这个原因，许多大公司一般购买使用可信VPN使用专用网络，以保证服务质量。</p><h2 id="3-VPN有什么用"><a href="#3-VPN有什么用" class="headerlink" title="3.VPN有什么用?"></a>3.VPN有什么用?</h2><p><strong>一、访问外网</strong><br>大家知道，为了社会的和谐，我们在国内是无法访问某些国外网站的，而很多人为了学习与交流，需要访问比如twitter、facebook、youtube等网站，那么你该怎么做呢? 有人会说，通过代理上网，网上有一些免费在线代理上网的服务，可以试试。我只能说这是个权益之计，因为用在线代理上网，有很大的局限性。比如说网站打开速度超慢、网页广告超多、关键网页打不开(登录页面及评论页面)等等，更重要的是安全性得不到保障。所以在线代理只能用于临时性的访问网站，想要经常性、长久性的访问，在线代理是远远满足不了要求的。</p><p>然而如果你拥有VPN的话，一切就不用那么复杂了，连接上VPN后，国外的网站任由你访问，速度快、无广告、无限制，你可以自由的打开FaceBook、Twitter、Youtube等网站。当然，有些场合中使用VPN还是出于安全的考虑(如企业分公司之间)。</p><p><strong>二、提升网速</strong><br>1、加快访问国外网站的速度：由于我国的国际出口带宽较小的原因，与国外(泛指中国大陆之外的网络)相互访速度非常慢，使用VPN便可加快出国访问网站的速度。<br>2、由于国内的电信运行商之间特殊的原因，导致南北网络互访很慢(网通和电信之间，网通和教育网之间，网通和铁通、联通之间，电信和教育网之间…)。</p><p><strong>实用案例：网游加速</strong><br>举个例子，如果你是玩网络游戏的，一定知道某款游戏在不同的地域，都会有相应服务器，而我们在选择服务器的时候，往往会选择自己所在地域的服务器，原因是自己地域的服务器对自己来说，速度肯定是最快的。然而有时候，某款游戏没有在自己所在地域放置服务器，比如说韩服、美服、台服等外服网游和部分国服网游。这时候，如果只凭我们自己上网的网络，要不连不上，要不延迟高，而且有时会掉线，而如果我们拥有VPN，就可以轻松连上我们想去的服务器。</p><h2 id="4-vpn分类"><a href="#4-vpn分类" class="headerlink" title="4.vpn分类"></a>4.vpn分类</h2><h3 id="PPTP"><a href="#PPTP" class="headerlink" title="PPTP"></a>PPTP</h3><p>点对点隧道协议 (PPTP) 是由包括微软和3Com等公司组成的PPTP论坛开发的一种点对点隧道协，基于拨号使用的PPP协议使用PAP或CHAP之类的加密算法，或者使用Microsoft的点对点加密算法MPPE。其通过跨越基于 TCP/IP 的数据网络创建 VPN 实现了从远程客户端到专用企业服务器之间数据的安全传输。PPTP 支持通过公共网络(例如 Internet)建立按需的、多协议的、虚拟专用网络。PPTP 允许加密 IP 通讯，然后在要跨越公司 IP 网络或公共 IP 网络(如 Internet)发送的 IP 头中对其进行封装。</p><p><img src="/2017/10/13/openvpn-2.3.4-bu-shu-chuang-jian-pei-zhi-ke-hu-duan-zheng-shu/%E5%9B%BE%E7%89%871.png" alt="img"></p><h3 id="L2TP"><a href="#L2TP" class="headerlink" title="L2TP"></a>L2TP</h3><p>第 2 层隧道协议 (L2TP) 是IETF基于L2F (Cisco的第二层转发协议)开发的PPTP的后续版本。是一种工业标准 Internet 隧道协议，其可以为跨越面向数据包的媒体发送点到点协议 (PPP) 框架提供封装。PPTP和L2TP都使用PPP协议对数据进行封装，然后添加附加包头用于数据在互联网络上的传输。PPTP只能在两端点间建立单一隧道。 L2TP支持在两端点间使用多隧道，用户可以针对不同的服务质量创建不同的隧道。L2TP可以提供隧道验证，而PPTP则不支持隧道验证。但是当L2TP 或PPTP与IPSEC共同使用时，可以由IPSEC提供隧道验证，不需要在第2层协议上验证隧道使用L2TP。 PPTP要求互联网络为IP网络。L2TP只要求隧道媒介提供面向数据包的点对点的连接，L2TP可以在IP(使用UDP)，桢中继永久虚拟电路 (PVCs),X.25虚拟电路(VCs)或ATM VCs网络上使用。</p><p><img src="/2017/10/13/openvpn-2.3.4-bu-shu-chuang-jian-pei-zhi-ke-hu-duan-zheng-shu/%E5%9B%BE%E7%89%872.png" alt="img"></p><h3 id="IPSec"><a href="#IPSec" class="headerlink" title="IPSec"></a>IPSec</h3><p>IPSec 的隧道是封装、路由与解封装的整个过程。隧道将原始数据包隐藏(或封装)在新的数据包内部。该新的数据包可能会有新的寻址与路由信息，从而使其能够通过网络传输。隧道与数据保密性结合使用时，在网络上窃听通讯的人将无法获取原始数据包数据(以及原始的源和目标)。封装的数据包到达目的地后，会删除封装，原始数据包头用于将数据包路由到最终目的地。</p><p><img src="/2017/10/13/openvpn-2.3.4-bu-shu-chuang-jian-pei-zhi-ke-hu-duan-zheng-shu/%E5%9B%BE%E7%89%873.png" alt="img"></p><h3 id="SSLVPN"><a href="#SSLVPN" class="headerlink" title="SSLVPN"></a>SSLVPN</h3><p>SSL协议提供了数据私密性、端点验证、信息完整性等特性。SSL协议由许多子协议组成，其中两个主要的子协议是握手协议和记录协议。握手协议允许服务器 和客户端在应用协议传输第一个数据字节以前，彼此确认，协商一种加密算法和密码钥匙。在数据传输期间，记录协议利用握手协议生成的密钥加密和解密后来交换 的数据。</p><p><img src="/2017/10/13/openvpn-2.3.4-bu-shu-chuang-jian-pei-zhi-ke-hu-duan-zheng-shu/%E5%9B%BE%E7%89%874.png" alt="img"></p><p>SSL独立于应用，因此任何一个应用程序都可以享受它的安全性而不必理会执行细节。SSL置身于网络结构体系的传输层和应用层之间。此外java培训，SSL本身就被几乎所有的Web浏览器支持。这意味着客户端不需要为了支持SSL连接安装额外的软件。这两个特征就是SSL能 应用于VPN的关键点。</p><h3 id="三种技术对比"><a href="#三种技术对比" class="headerlink" title="三种技术对比"></a>三种技术对比</h3><table><thead><tr><th></th><th>L2TP</th><th>SSL VPN</th><th>IPSec</th></tr></thead><tbody><tr><td>发起方</td><td>远端PC</td><td>远端PC</td><td>总部、分支、远端PC</td></tr><tr><td>身份验证</td><td>基于PPP认证</td><td>用户名+口令+证书</td><td>地址或名字+口令或证书</td></tr><tr><td>加密保证</td><td>无</td><td>有</td><td>有</td></tr><tr><td>地址分配</td><td>有</td><td>有</td><td>无</td></tr><tr><td>客户端</td><td>XP自带或第三方</td><td>免安装式浏览器插件</td><td>通常为厂家设备内部实现，PC使用厂家专用客户端</td></tr><tr><td>兼容互通性</td><td>优良，基本上各个厂家都兼容XP客户端</td><td>PC使用浏览器打开VPN，与浏览器相关</td><td>优良，已经达到工业化标准成都，大部分厂家能够互通</td></tr><tr><td>资源消耗</td><td>轻</td><td>重</td><td>中</td></tr><tr><td>性能加速</td><td>无</td><td>加密卡硬件加速</td><td>加密卡硬件加速</td></tr><tr><td>隧道穿越NAT</td><td>可以</td><td>可以</td><td>可以</td></tr></tbody></table><h2 id="5-什么是VPN使用的隧道技术与隧道协议"><a href="#5-什么是VPN使用的隧道技术与隧道协议" class="headerlink" title="5.什么是VPN使用的隧道技术与隧道协议"></a>5.什么是VPN使用的隧道技术与隧道协议</h2><p>VPN隧道所使用的公共网络可以是任何类型的通信网络。可以是Internet，也可以是企业内部网。为创建隧道，VPN的客户机和服务器必须使用相同的隧道协议，常用的隧道协议包括点对点隧道协议PPTP、第2层隧道协议L2TP和安全IP隧道模式IPSec。</p><p>按照开放系统互联OSI参考模型划分，隧道技术可以分为以第2层隧道协议为基础的技术和以第3层隧道协议为基础的技术。第2层隧道协议对应OSI模型中的数据链路层，使用帧作为数据传输单位。PPTP和L2TP协议属于第2层隧道协议，都是将数据封装在点对点协议(PPP)的帧中通过Internet发送。第3层隧道协议对应OSI模型中的网络层，使用包作为数据传输单位。安全IP隧道模式IPSec属于第3层隧道协议，是将数据包封装在附加了IP包头的新数据包中通过IP网络传送。</p><p>点对点隧道协议(PPTP，Point-to-PointTunnelingProtocol)将点对点协议(PPP，Point-to-PointProtocol)的数据帧封装进IP数据包中，通过TCP/IP网络进行传输。PPTP可以对IP、IPX或NetBEUI数据进行加密传递。PPTP通过PPTP控制连接来创建、维护和终止一条隧道，并使用通用路由封装(GRE，GenericRoutingEncapsulation)对PPP数据帧进行封装。封装前，PPP数据帧的有效载荷(有效传输数据)首先必须经过加密、压缩或是两者的混合处理。</p><p>第2层隧道协议(L2TP,LayerTwoTunnelingProtocol)是PPTP和第2层转发技术(L2F，LayerTwoForward)的结合。第2层转发是Cisco公司提出的隧道技术。为了避免PPTP和L2F两种互不兼容的隧道技术在市场上彼此竞争给用户造成困惑和带来不便，Internet工程任务委员会IETF要求将两种技术结合在单一隧道协议中，并在该协议中综合PPTP和L2F两者的优点，由此产生了L2TP。L2TP协议将PPP数据帧封装后，可通过TCP/IP、X.25、帧中继或ATM等网络进行传送。L2TP可以对IP、IPX或NetBEUI数据进行加密传递。目前，仅定义了基于TCP/IP网络的L2TP。L2TP隧道协议既可用于Internet，也可用于企业内部网。</p><p>为了实现在专用或公共IP网络上的安全传输，安全IP隧道模式IPSec使用安全方式封装和加密整个IP包。它首先对IP数据包进行加密，然后将密文数据包再次封装在明文IP包内，通过网络发送到接收端的VPN服务器。VPN服务器对收到的数据包进行处理，在去除明文IP包头，对内容进行解密之后，获得原始的IP数据包，再将其路由到目标网络的接收计算机。</p><p>在这三种隧道协议中，点对点隧道协议PPTP和第2层隧道协议L2TP的优点是对用微软公司操作系统的用户来说很方便学习java培训，因为微软公司已把它们作为路由软件的一部分;缺点是PPTP和L2TP将不安全的IP数据包封装在安全的IP数据包内。PPTP和L2TP适用于远程访问虚拟专用网。安全IP隧道模式IPSec的优点是它定义了一套用于认证、保护私密和数据完整性的标准协议，缺点是微软公司对IPSec的支持不够。IPSec适用于可信的局域网之间的虚拟专用网，即企业内部网VPN应用。<br><br><strong>OpenVPN</strong><br>典型的SSL VPN应用如OpenVPN，是一个比较好的开源软件。PPTP主要为那些经常外出移动或家庭办公的用户考虑;而OpenVPN主要是针对企业异地两地总分公司之间的VPN不间断按需连接，例如ERP在企业中的应用。<br>OpenVPN 允许参与建立VPN的单点使用预设的私钥，第三方证书，或者用户名/密码来进行身份验证。它大量使用了OpenSSL加密库，以及SSLv3/TLSv1 协议。OpenVPN能在Linux、xBSD、Mac OS X与Windows上运行。它并不是一个基于Web的VPN软件，也不与IPsec及其他VPN软件包兼容。</p><p><strong>隧道加密</strong><br>OpenVPN使用OpenSSL库加密数据与控制信息：它使用了OpesSSL的加密以及验证功能，意味着，它能够使用任何OpenSSL支持的算法。它提供了可选的数据包HMAC功能以提高连接的安全性。此外，OpenSSL的硬件加速也能提高它的性能。</p><p><strong>验证</strong><br>OpenVPN提供了多种身份验证方式，用以确认参与连接双方的身份，包括：预享私钥，第三方证书以及用户名/密码组合。预享密钥最为简单，但同时它 只能用于建立点对点的VPN;基于PKI的第三方证书提供了最完善的功能，但是需要额外的精力去维护一个PKI证书体系。OpenVPN2.0后引入了用 户名/口令组合的身份验证方式，它可以省略客户端证书，但是仍有一份服务器证书需要被用作加密.</p><p><strong>网络</strong><br>OpenVPN所有的通信都基于一个单一的IP端口，默认且推荐使用UDP协议通讯，同时TCP也被支持。OpenVPN连接能通过大多数的代理服务 器，并且能够在NAT的环境中很好地工作。服务端具有向客户端“推送”某些网络配置信息的功能，这些信息包括：IP地址、路由设置等。OpenVPN提供 了两种虚拟网络接口：通用Tun/Tap驱动，通过它们，可以建立三层IP隧道，或者虚拟二层以太网，后者可以传送任何类型的二层以太网络数据。传送的数 据可通过LZO算法压缩。IANA(Internet Assigned Numbers Authority)指定给OpenVPN的官方端口为1194。OpenVPN 2.0以后版本每个进程可以同时管理数个并发的隧道。<br>OpenVPN使用通用网络协议(TCP与UDP)的特点使它成为IPsec等协议的理想替代，尤其是在ISP(Internet service provider)过滤某些特定VPN协议的情况下。在选择协议时候，需要注意2个加密隧道之间的网络状况，如有高延迟或者丢包较多的情况下，请选择 TCP协议作为底层协议，UDP协议由于存在无连接和重传机制，导致要隧道上层的协议进行重传，效率非常低下。</p><p><strong>安全</strong><br>OpenVPN与生俱来便具备了许多安全特性：java培训在用户空间运行，无须对内核及网络协议栈作修改; 初始完毕后以chroot方式运行，放弃root权限;使用mlockall以防止敏感数据交换到磁盘。<br>OpenVPN通过PKCS#11支持硬件加密标识，如智能卡。</p><p><strong>根据企业生产场景需求选择VPN方案建议</strong></p><p>1、如果领导愿意花钱，可以选择相关硬件产品，不错的成熟的很多，例如：<br>防火墙、负载均衡等硬件产品都附带VPN功能。<br>2、对于多数互联网公司，为了体现我们运维架构师的价值，我们应该建议老板<br>选择开源产品，优势就是省钱，可扩展性更强(每个机房可以有高可用)，例如：二次开发，相应的改动。<br>3、对于开源的产品建议：</p><ul><li>个人拨号选择openvpn，功能强大、稳定可靠。</li><li>如果不希望单独安装客户端拨号，则可选择PPTP(pptp不支持家庭无法使用)。</li><li>多个企业之间或者多个IDC机房直接互联，选择ipsec vpn或openvpn。</li></ul><h2 id="6-OpenVPN-2-3-4部署"><a href="#6-OpenVPN-2-3-4部署" class="headerlink" title="6.OpenVPN 2.3.4部署"></a>6.OpenVPN 2.3.4部署</h2><p><strong>系统环境</strong><br>CentOS版本:6.4</p><p>OpenVPN版本：2.3.4</p><p><strong>需求说明</strong><br>使用VPN，实现广域网内服务器之间的安全互访。</p><p>选择OpenVPN，因为其在可靠性方面值得信赖，在后续的使用中，证明了这一点。</p><p><strong>配置过程</strong></p><h3 id="6-1-安装依赖包"><a href="#6-1-安装依赖包" class="headerlink" title="6.1 安装依赖包"></a>6.1 安装依赖包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install openssl-devel lzo-devel pam-devel gcc</span><br></pre></td></tr></table></figure><h3 id="6-2-下载安装包"><a href="#6-2-下载安装包" class="headerlink" title="6.2 下载安装包"></a>6.2 下载安装包</h3><p>从<a href="https://swupdate.openvpn.org/community/releases/openvpn-2.3.4.tar.gz" target="_blank" rel="noopener">官网下载</a>安装包openvpn-2.3.4.tar.gz，解压</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h3 id="6-3-安装easy-rsa"><a href="#6-3-安装easy-rsa" class="headerlink" title="6.3 安装easy-rsa"></a>6.3 安装easy-rsa</h3><p>新建/etc/openvpn目录，下载easy-rsa</p><p>wget <a href="https://github.com/OpenVPN/easy-rsa/archive/release/2.x.zip" target="_blank" rel="noopener">https://github.com/OpenVPN/easy-rsa/archive/release/2.x.zip</a><br>解压上述文件，进入解压后的目录</p><p>cp -r ./easy-rsa /etc/openvpn<br>修改/etc/openvpn/easy-rsa/2.0/var文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># These are the default values for fields</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># which will be placed in the certificate.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Don't leave any of these fields blank.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> KEY_COUNTRY=<span class="string">"xx"</span></span><br><span class="line"><span class="built_in">export</span> KEY_PROVINCE=<span class="string">"xx"</span></span><br><span class="line"><span class="built_in">export</span> KEY_CITY=<span class="string">"xx"</span></span><br><span class="line"><span class="built_in">export</span> KEY_ORG=<span class="string">"xx"</span></span><br><span class="line"><span class="built_in">export</span> KEY_EMAIL=<span class="string">"xxxx"</span></span><br><span class="line"><span class="built_in">export</span> KEY_OU=<span class="string">"xx"</span></span><br><span class="line">检查本机安装的openssl版本:</span><br><span class="line"></span><br><span class="line">rpm -q openssl</span><br><span class="line">执行结果:</span><br><span class="line"></span><br><span class="line">openssl-1.0.1e-16.el6_5.15.x86_64</span><br><span class="line">重命名预置的openssl配置文件</span><br><span class="line"></span><br><span class="line">cp /etc/openvpn/easy-rsa/2.0/openssl-1.0.0.cnf /etc/openvpn/easy-rsa/2.0/openssl.cnf</span><br></pre></td></tr></table></figure><h3 id="6-4-生成key"><a href="#6-4-生成key" class="headerlink" title="6.4 生成key"></a>6.4 生成key</h3><p>在/etc/openvpn/easy-rsa/2.0执行下列命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">. ./vars</span><br><span class="line">./clean-all</span><br><span class="line">./build-ca server</span><br><span class="line">./build-key-server server <span class="comment">#服务端密钥</span></span><br><span class="line">./build-key xxx <span class="comment">#xxx为客户端名称</span></span><br><span class="line">./build-dh <span class="comment">#Diffie Hellman参数</span></span><br></pre></td></tr></table></figure><h3 id="6-5-开启包转发"><a href="#6-5-开启包转发" class="headerlink" title="6.5 开启包转发"></a>6.5 开启包转发</h3><p>编辑/etc/sysctl.conf，修改</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.ip_forward = 0为net.ipv4.ip_forward = 1</span><br></pre></td></tr></table></figure><p>保存，运行</p><p>sysctl –p<br>配置生效,修改防火墙策略</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -j SNAT --to-source xx.xx.xx.xx (xx.xx.xx.xx为公网IP)</span><br></pre></td></tr></table></figure><h3 id="6-6-配置文件"><a href="#6-6-配置文件" class="headerlink" title="6.6 配置文件"></a>6.6 配置文件</h3><p>从源码包中获取配置文件模板</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /root/download/openvpn-2.3.4/sample/sample-config-files/server.conf /etc/openvpn/</span><br></pre></td></tr></table></figure><p>修改配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">loacl xx.xx.xx.xx</span><br><span class="line">ca /etc/openvpn/keys/ca.crt</span><br><span class="line">cert /etc/openvpn/keys/server.crt</span><br><span class="line">key /etc/openvpn/keys/server.key</span><br><span class="line">dh /etc/openvpn/keys/dh2048.pem</span><br><span class="line">push <span class="string">"redirect-gateway def1 bypass-dhcp"</span></span><br></pre></td></tr></table></figure><h3 id="6-7-服务端启动"><a href="#6-7-服务端启动" class="headerlink" title="6.7 服务端启动"></a>6.7 服务端启动</h3><p>screen启动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openvpn --config /etc/openvpn/server.conf</span><br></pre></td></tr></table></figure><p>后台启动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup openvpn --config /etc/openvpn/server.conf &amp;</span><br></pre></td></tr></table></figure><h2 id="7-客户端配置"><a href="#7-客户端配置" class="headerlink" title="7.客户端配置"></a>7.客户端配置</h2><h3 id="7-1-安装Openvpn客户端，将服务端生成的密钥文件"><a href="#7-1-安装Openvpn客户端，将服务端生成的密钥文件" class="headerlink" title="7.1 安装Openvpn客户端，将服务端生成的密钥文件"></a>7.1 安装Openvpn客户端，将服务端生成的密钥文件</h3><p><a href="openvpn-install-2.3.10-I603-x86_64.exe">客户端下载</a></p><p>ca.crt<br>client.crt<br>client.key<br>放在客户端安装目录的config目录</p><p>修改客户端配置文件client.ovpn</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">remote xx.xx.xx.xx 1194 (服务端IP)</span><br><span class="line">ca ca.crt</span><br><span class="line">cert client.crt</span><br><span class="line">key client.key</span><br></pre></td></tr></table></figure><h3 id="7-2-启动客户端"><a href="#7-2-启动客户端" class="headerlink" title="7.2 启动客户端"></a>7.2 启动客户端</h3><p>Linux<br>启动方式，同服务端相同</p><p>Windows<br>以管理员权限启动客户端OpenVPN GUI</p><p>点击Connect</p><h3 id="7-3-固定客户端IP地址"><a href="#7-3-固定客户端IP地址" class="headerlink" title="7.3 固定客户端IP地址"></a>7.3 固定客户端IP地址</h3><p>打开配置</p><p>client-config-dir ccd<br>在/etc/openvpn新建ccd目录</p><p>在ccd目录中新建以客户端key为名称的文件，如client(无后缀名)</p><p>文件内容ifconfig-push 10.8.0.5 10.8.0.6</p><p>openvpn只支持255.255.255.252 的子网</p><p>252子网只有三个IP，客户端，服务器，广播地址</p><p>如子网10.8.0.36 主机10.8.0.37 10.8.37 广播地址10.8.0.39<br>子网10.8.0.40 主机10.8.0.41 10.8.42 广播地址10.8.0.43<br>子网10.8.0.44 主机10.8.0.45 10.8.46 广播地址10.8.0.47<br>子网10.8.0.48 主机10.8.0.49 10.8.50 广播地址10.8.0.51</p><h3 id="7-4-客户端证书注销"><a href="#7-4-客户端证书注销" class="headerlink" title="7.4 客户端证书注销"></a>7.4 客户端证书注销</h3><p>进入 /etc/openvpn/easy-rsa/2.0 目录</p><p>执行 . ./vars 命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./revoke-full xxx （ xxx 为待注销的客户端名称）</span><br></pre></td></tr></table></figure><p>keys 目录生成一个 crl.pem</p><p>在 服务端 server.conf 配置中，增加配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crl-verify /etc/openvpn/easy-rsa/2.0/keys/crl.pem</span><br></pre></td></tr></table></figure><p>重启服务端生效</p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/VPN/" rel="tag"><i class="fa fa-tag"></i> VPN</a><a href="/tags/OpenVPN/" rel="tag"><i class="fa fa-tag"></i> OpenVPN</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/09/26/mysql-jia-gou-zu-cheng-zhi-cun-chu-yin-qing/" rel="next" title="MySQL 架构组成之存储引擎"><i class="fa fa-chevron-left"></i> MySQL 架构组成之存储引擎</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2017/10/13/xiao-xi-dui-lie-ji-chang-jian-xiao-xi-dui-lie-jie-shao/" rel="prev" title="消息队列及常见消息队列介绍">消息队列及常见消息队列介绍<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"><span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a><a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/chen.png" alt="Zhongzhou Chen"><p class="site-author-name" itemprop="name">Zhongzhou Chen</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">332</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">85</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">183</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-OpenVPN简介"><span class="nav-text">1.OpenVPN简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-vpn的优点与缺点"><span class="nav-text">2.vpn的优点与缺点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-VPN有什么用"><span class="nav-text">3.VPN有什么用?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-vpn分类"><span class="nav-text">4.vpn分类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#PPTP"><span class="nav-text">PPTP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#L2TP"><span class="nav-text">L2TP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IPSec"><span class="nav-text">IPSec</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSLVPN"><span class="nav-text">SSLVPN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三种技术对比"><span class="nav-text">三种技术对比</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-什么是VPN使用的隧道技术与隧道协议"><span class="nav-text">5.什么是VPN使用的隧道技术与隧道协议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-OpenVPN-2-3-4部署"><span class="nav-text">6.OpenVPN 2.3.4部署</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-安装依赖包"><span class="nav-text">6.1 安装依赖包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-下载安装包"><span class="nav-text">6.2 下载安装包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-安装easy-rsa"><span class="nav-text">6.3 安装easy-rsa</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-生成key"><span class="nav-text">6.4 生成key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-5-开启包转发"><span class="nav-text">6.5 开启包转发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-6-配置文件"><span class="nav-text">6.6 配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-7-服务端启动"><span class="nav-text">6.7 服务端启动</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-客户端配置"><span class="nav-text">7.客户端配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-安装Openvpn客户端，将服务端生成的密钥文件"><span class="nav-text">7.1 安装Openvpn客户端，将服务端生成的密钥文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-启动客户端"><span class="nav-text">7.2 启动客户端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-固定客户端IP地址"><span class="nav-text">7.3 固定客户端IP地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-客户端证书注销"><span class="nav-text">7.4 客户端证书注销</span></a></li></ol></li></ol></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Zhongzhou Chen</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">777.2k</span></div><span class="post-meta-divider"></span></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code").find(".line").map(function(t,e){return $(e).text()}).toArray().join("\n"),n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();var o=document.execCommand("copy");document.body.removeChild(n),o?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})</script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,s){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var o=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,n=document.getElementById(e),r=document.getElementById(s);n.addEventListener("input",function(){var y=n.value.trim().toLowerCase(),T=y.split(/[\s\-]+/);1<T.length&&T.push(y);var b=[];if(0<y.length&&o.forEach(function(t){function e(t,e,o,n){for(var r=n[n.length-1],s=r.position,a=r.word,i=[],c=0;s+a.length<=o&&0!=n.length;){a===y&&c++,i.push({position:s,length:a.length});var l=s+a.length;for(n.pop();0!=n.length&&(s=(r=n[n.length-1]).position,a=r.word,s<l);)n.pop()}return h+=c,{hits:i,start:e,end:o,searchTextCount:c}}function o(o,t){var n="",r=t.start;return t.hits.forEach(function(t){n+=o.substring(r,t.position);var e=t.position+t.length;n+='<b class="search-keyword">'+o.substring(t.position,e)+"</b>",r=e}),n+=o.substring(r,t.end)}var n=!1,r=0,h=0,s=t.title.trim(),a=s.toLowerCase(),i=t.content.trim().replace(/<[^>]+>/g,""),c=i.toLowerCase(),l=decodeURIComponent(t.url),p=[],u=[];if(""!=s&&(T.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());-1<(s=e.indexOf(t,r));)a.push({position:s,word:t}),r=s+n;return a}p=p.concat(e(t,a,!1)),u=u.concat(e(t,c,!1))}),(0<p.length||0<u.length)&&(n=!0,r=p.length+u.length)),n){[p,u].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var f=[];0!=p.length&&f.push(e(0,0,s.length,p));for(var d=[];0!=u.length;){var g=u[u.length-1],v=g.position,$=g.word,C=v-20,m=v+80;C<0&&(C=0),m<v+$.length&&(m=v+$.length),m>i.length&&(m=i.length),d.push(e(0,C,m,u))}d.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var x=parseInt("1");0<=x&&(d=d.slice(0,x));var w="";w+=0!=f.length?"<li><a href='"+l+"' class='search-result-title'>"+o(s,f[0])+"</a>":"<li><a href='"+l+"' class='search-result-title'>"+s+"</a>",d.forEach(function(t){w+="<a href='"+l+'\'><p class="search-result">'+o(i,t)+"...</p></a>"}),w+="</li>",b.push({item:w,searchTextCount:h,hitCount:r,id:b.length})}}),1===T.length&&""===T[0])r.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===b.length)r.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{b.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var e='<ul class="search-result-list">';b.forEach(function(t){e+=t.item}),e+="</ul>",r.innerHTML=e}}),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script type="text/javascript" src="/js/src/love.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,log:!1,model:{jsonPath:"/live2dw/assets/shizuku.model.json"},display:{position:"right"},mobile:{show:!0,scale:.2},react:{opacityDefault:.7,opacityOnHover:.2,opacity:.4}})</script></body></html>