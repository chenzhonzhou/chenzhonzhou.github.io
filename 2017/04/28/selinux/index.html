<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><script></script><meta name="theme-color" content="#222"><style>.pace .pace-progress{background:#1e92fb;height:3px}.pace .pace-progress-inner{box-shadow:0 0 10px #1e92fb,0 0 5px #1e92fb}.pace .pace-activity{border-top-color:#1e92fb;border-left-color:#1e92fb}</style><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="HGM141IpbHrSmnAmR6W_zE4bo9Z3f-yXLeHYT3bg1fk"><meta name="baidu-site-verification" content="code-5Ai1DA8e6T"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="Linux,SELinux,"><link rel="alternate" href="/atom.xml" title="凡间的精灵" type="application/atom+xml"><meta name="description" content="1、SELinux 简介SELinux的全称是Security Enhanced Linux, 就是安全加强的Linux。在SELinux之前，root账号能够任意的访问所有文档和服务；如果某个文件设为777，那么任何用户都可以访问甚至删除；这种方式称为DAC（主动访问机制），很不安全。DAC 自主访问控制: 用户根据自己的文件权限来决定对文件的操作，也就是依据文件的own，group，other"><meta name="keywords" content="Linux,SELinux"><meta property="og:type" content="article"><meta property="og:title" content="SELinux"><meta property="og:url" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;04&#x2F;28&#x2F;selinux&#x2F;index.html"><meta property="og:site_name" content="凡间的精灵"><meta property="og:description" content="1、SELinux 简介SELinux的全称是Security Enhanced Linux, 就是安全加强的Linux。在SELinux之前，root账号能够任意的访问所有文档和服务；如果某个文件设为777，那么任何用户都可以访问甚至删除；这种方式称为DAC（主动访问机制），很不安全。DAC 自主访问控制: 用户根据自己的文件权限来决定对文件的操作，也就是依据文件的own，group，other"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;04&#x2F;28&#x2F;selinux&#x2F;%E5%9B%BE%E7%89%871.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;04&#x2F;28&#x2F;selinux&#x2F;%E5%9B%BE%E7%89%872.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;04&#x2F;28&#x2F;selinux&#x2F;%E5%9B%BE%E7%89%873.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;04&#x2F;28&#x2F;selinux&#x2F;%E5%9B%BE%E7%89%874.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;04&#x2F;28&#x2F;selinux&#x2F;%E5%9B%BE%E7%89%875.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;04&#x2F;28&#x2F;selinux&#x2F;%E5%9B%BE%E7%89%876.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;04&#x2F;28&#x2F;selinux&#x2F;%E5%9B%BE%E7%89%877.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;04&#x2F;28&#x2F;selinux&#x2F;%E5%9B%BE%E7%89%878.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;04&#x2F;28&#x2F;selinux&#x2F;%E5%9B%BE%E7%89%879.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;04&#x2F;28&#x2F;selinux&#x2F;%E5%9B%BE%E7%89%8710.png"><meta property="og:updated_time" content="2019-11-18T08:08:04.209Z"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2017&#x2F;04&#x2F;28&#x2F;selinux&#x2F;%E5%9B%BE%E7%89%871.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"always",offset:12,b2t:!0,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://chenzhonzhou.github.io/2017/04/28/selinux/"><title>SELinux | 凡间的精灵</title><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">凡间的精灵</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">凡尘落素一精灵</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://chenzhonzhou.github.io/2017/04/28/selinux/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Zhongzhou Chen"><meta itemprop="description" content=""><meta itemprop="image" content="/images/chen.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="凡间的精灵"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">SELinux</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-28T16:11:59+08:00">2017-04-28</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/SELinux/" itemprop="url" rel="index"><span itemprop="name">SELinux</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">3.3k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">14</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="1、SELinux-简介"><a href="#1、SELinux-简介" class="headerlink" title="1、SELinux 简介"></a>1、SELinux 简介</h2><p><strong>SELinux</strong>的全称是<strong>Security Enhanced Linux</strong>, 就是安全加强的<strong>Linux</strong>。在<strong>SELinux</strong>之前，<strong>root</strong>账号能够任意的访问所有文档和服务；如果某个文件设为<strong>777</strong>，那么任何用户都可以访问甚至删除；这种方式称为<strong>DAC</strong>（主动访问机制），很不安全。</p><p><strong>DAC</strong> 自主访问控制: 用户根据自己的文件权限来决定对文件的操作，也就是依据文件的<strong>own</strong>，<strong>group</strong>，<strong>other/r</strong>，<strong>w</strong>，<strong>x</strong>权限进行限制。<strong>Root</strong>有最高权限无法限制。<strong>r</strong>，<strong>w</strong>，<strong>x</strong>权限划分太粗糙。无法针对不同的进程实现限制。<br><strong>SELinux</strong>则是基于<strong>MAC</strong>（强制访问机制），简单的说，就是程序和访问对象上都有一个安全标签（即<strong>selinux</strong>上下文）进行区分，只有对应的标签才能允许访问。否则即使权限是<strong>777</strong>，也是不能访问的。</p><p>在<strong>SELinux</strong>中，访问控制属性叫做安全上下文。所有客体（文件、进程间通讯通道、套接字、网络主机等）和主体（进程）都有与其关联的安全上下文，一个安全上下文由三部分组成：<strong>用户（u）</strong>、<strong>角色(r)</strong>和<strong>类型(t)标识符</strong>。但我们最关注的是第三个部分</p><p>当程序访问资源时，主体程序必须要通过<strong>selinux</strong>策略内的规则放行后，就可以与目标资源进行安全上下文的比对，若比对失败则无法存取目标，若比对成功则可以开始存取目标，最终能否存取目标还要与文件系统的<strong>rwx</strong>权限的设定有关。所以启用了<strong>selinux</strong>后出现权限不符的情况时，你就得一步一步的分析可能的问题了。<br>以上简单了解即可，下面的是要重点掌握的</p><h2 id="2、Selinux状态查看与配置"><a href="#2、Selinux状态查看与配置" class="headerlink" title="2、Selinux状态查看与配置"></a>2、Selinux状态查看与配置</h2><p>Selinux的配置文件位置：<strong>/etc/selinux/config</strong>，它还有个链接在<strong>/etc/sysconfig/selinux</strong></p><h3 id="2-1-配置selinux"><a href="#2-1-配置selinux" class="headerlink" title="2.1 配置selinux"></a>2.1 配置selinux</h3><p>使用config文件来配置selinux(通过配置文件修改selinux的状态属于永久修改，要重启系统才生效)</p><p><img src="/2017/04/28/selinux/%E5%9B%BE%E7%89%871.png" alt="img"></p><p>文件内容如下图：</p><p><img src="/2017/04/28/selinux/%E5%9B%BE%E7%89%872.png" alt="image-20191118153506421"></p><p><strong>SELINUX=enforcing</strong><br>#此项定义selinux状态。<br>#enforcing—是强制模式系统受selinux保护。就是你违反了策略，你就无法继续操作下去<br>#permissive—是提示模式系统不会受到selinux保护，只是收到警告信息。permissive就是Selinux有效，但是即使你违反了策略的话它让你继续操作，但是把你的违反的内容记录下来(警告信息)<br>#disabled—禁用selinux。</p><p><strong>SELINUXTYPE=targeted</strong><br>#此项定义selinux使用哪个策略模块保护系统。targeted只对apache ,sendmail, bind,postgresql,nfs,cifs等网络服务保护。<br>以上策略配置都放置在/etc/selinux目录中，目录和策略名称相同</p><p><strong>使用selinux相关命令查看和修改状态：（属于立即生效但临时性的）</strong></p><p><strong>①sestatus 查询selinux工作状态</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sestatus </span><br><span class="line">SELinux status:                 enabled</span><br><span class="line">SELinuxfs mount:                /sys/fs/selinux</span><br><span class="line">SELinux root directory:         /etc/selinux</span><br><span class="line">Loaded policy name:             targeted</span><br><span class="line">Current mode:                   permissive</span><br><span class="line">Mode from config file:          permissive</span><br><span class="line">Policy MLS status:              enabled</span><br><span class="line">Policy deny_unknown status:     allowed</span><br><span class="line">Max kernel policy version:      28</span><br></pre></td></tr></table></figure><p><strong>②selinuxenabled检查selinux是否开启,配合echo $?.传回值是0为开启,1为关闭</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# selinuxenabled</span><br><span class="line">[root@localhost ~]# echo $?</span><br><span class="line">0</span><br></pre></td></tr></table></figure><p><strong>③getenforce查看selinux的状态</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# getenforce </span><br><span class="line">Permissive</span><br></pre></td></tr></table></figure><p><strong>④setenforce设定selinux运行状态,1开启（Enforcing）,0关闭(Permissive)</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# setenforce 1</span><br><span class="line">[root@localhost ~]# getenforce </span><br><span class="line">Enforcing</span><br></pre></td></tr></table></figure><h3 id="2-2-查看及修改安全上下文"><a href="#2-2-查看及修改安全上下文" class="headerlink" title="2.2 查看及修改安全上下文"></a>2.2 查看及修改安全上下文</h3><p><strong>查看文件上下文可以通过ls -Z</strong></p><p><img src="/2017/04/28/selinux/%E5%9B%BE%E7%89%873.png" alt="image-20191118153826133"></p><p><strong>查看进程上下文可以使用 ps Z</strong></p><p><img src="/2017/04/28/selinux/%E5%9B%BE%E7%89%874.png" alt="image-20191118153841349"></p><p><strong>查看用户上下文可以用id –Z</strong></p><p><img src="/2017/04/28/selinux/%E5%9B%BE%E7%89%875.png" alt="image-20191118153859045"></p><p>安全上下文以用户:角色:类型(域)标识符的形式出现.(这里的用户指的是selinu用户)</p><h4 id="以下是复制和移动文件时安全上下文的变化"><a href="#以下是复制和移动文件时安全上下文的变化" class="headerlink" title="以下是复制和移动文件时安全上下文的变化"></a>以下是复制和移动文件时安全上下文的变化</h4><p>①以httpd为例，这个httpd的进程可以访问/var/www/html下的文档对象，在/root目录下创建两个测试页文件（如test1.html、test2.html）</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ls -ldZ ./test*.html</span><br></pre></td></tr></table></figure><p>-rw-r–r–. root root unconfined_u:<font color="Blue">object_r:admin_home_t</font>:s0 ./test1.html<br>-rw-r–r–. root root unconfined_u:<font color="Blue">object_r:admin_home_t</font>:s0 ./test2.html</p></blockquote><p>②复制test1.html文件到/var/www/html目录下，剪切test2.html文件到/var/www/html目录下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cp test1.html /var/www/html/</span><br><span class="line">[root@localhost ~]# mv test2.html /var/www/html/</span><br></pre></td></tr></table></figure><p>③查看html目录下文件的安全上下文</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ls -lZ /var/www/html/</span><br></pre></td></tr></table></figure><p>-rw-r–r–. root root unconfined_u:<font color="Blue">object_r:httpd_sys_content_t</font>:s0 test1.html<br>-rw-r–r–. root root unconfined_u:<font color="Blue">object_r:admin_home_t</font>:s0 test2.html</p></blockquote><p>④通过上图可以看到剪切操作时文件的上下文没有发生改变，仍然是原上下文，而复制操作时文件的上下文继承了目标目录的上下文。<br>通过浏览器访问这两个网页文件<br><img src="/2017/04/28/selinux/%E5%9B%BE%E7%89%876.png" alt="img"></p><p><img src="/2017/04/28/selinux/%E5%9B%BE%E7%89%877.png" alt="img"></p><p><strong>可以看到test1.html页面能访问而test2.html却被拒绝访问</strong></p><p>⑤查看权限发现apache用户对这两个文件都具有r权限，但test2.html文件却拒绝访问。</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ls -l /var/www/html/</span><br></pre></td></tr></table></figure><p>total 8<br><font color="Blue">-rw-r–r–</font>. 1 root root 16 Nov 7 16:41 test1.html<br><font color="Blue">-rw-r–r–</font>. 1 root root 16 Nov 7 16:41 test2.html</p></blockquote><p>原因就是因为httpd进程不能访问域类型标签是admin_home_t的资源，被selinux将访问拒绝了。</p><p>⑥查看日志/var/log/audit/audit.log通过日志记录也能看到test2.html文件拒绝httpd进程访问。</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# tail /var/log/audit/audit.log | grep httpd</span><br></pre></td></tr></table></figure><p>type=AVC msg=audit(1478508930.116:811): avc: denied { getattr } for pid=4649 comm=”httpd” path=”/var/www/html/test2.html” dev=”dm-0” ino=204341596<br>scontext=<font color="Blue">system_u:system_r:httpd_t</font>:s0<br>tcontext=unconfined_u:<font color="Blue">object_r:admin_home_t</font>:s0 tclass=file</p></blockquote><p>⑦由于此文件记录的信息很多不宜直接查看，可以借助audit2why和audit2allow</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# audit2why &lt; /var/log/audit/audit.log</span><br><span class="line">type=AVC msg=audit(1478508930.116:811): avc:  denied  &#123; getattr &#125; for  pid=4649 comm=&quot;httpd&quot; path=&quot;/var/www/html/test2.html&quot; dev=&quot;dm-0&quot; ino=204341596 scontext=system_u:system_r:httpd_t:s0 tcontext=unconfined_u:object_r:admin_home_t:s0 tclass=file</span><br><span class="line"></span><br><span class="line">	Was caused by:</span><br><span class="line">		Missing type enforcement (TE) allow rule.</span><br><span class="line"></span><br><span class="line">		You can use audit2allow to generate a loadable module to allow this access.</span><br></pre></td></tr></table></figure><p>注：提供audit2why和audit2allow工具软件包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# rpm -qf /bin/audit2why</span><br><span class="line">policycoreutils-python-2.2.5-20.el7.x86_64</span><br><span class="line">[root@localhost ~]# rpm -qf /bin/audit2allow </span><br><span class="line">policycoreutils-python-2.2.5-20.el7.x86_64</span><br></pre></td></tr></table></figure><p>⑧收集Selinux产生的日志，另一个工具是setroubleshoot，对应的软件包为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# rpm -qf /sbin/setroubleshootd </span><br><span class="line">setroubleshoot-server-3.2.24-1.1.el7.x86_64</span><br></pre></td></tr></table></figure><p>Setroubleshoot将错误信息写入/var/log/messages中</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# tail /var/log/messages | grep setroubleshoot</span><br></pre></td></tr></table></figure><p>Nov 7 16:55:30 localhost setroubleshoot: SELinux is preventing /usr/sbin/httpd from getattr access on the file /var/www/html/test2.html. For complete SELinux messages. run <font color="Blue">sealert -l 8267a718-88e1-4802-bc41-b3bb7200d5b3</font></p></blockquote><p>上面的错误信息大概说的是”selinux阻止httpd访问这个文件，要查看完整的信息，请执行sealert命令”</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sealert -l 8267a718-88e1-4802-bc41-b3bb7200d5b3</span><br></pre></td></tr></table></figure><p>可以用sesearch [–allow] [-s 主体类别] [-t 目标类别] [-b]查询详细规则 sesearch命令由下列软件包提供</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# rpm -qf /bin/sesearch</span><br><span class="line">setools-console-3.3.7-46.el7.x86_64</span><br></pre></td></tr></table></figure><p>找出目标资源类别为httpd_sys_content_t的相关信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sesearch --allow -t httpd_sys_content_t</span><br></pre></td></tr></table></figure><p><img src="/2017/04/28/selinux/%E5%9B%BE%E7%89%878.png" alt="image-20191118155007043"></p><p>从上图显示信息表示[allow 主体程序安全上下文类别 目标资源安全上下文类别]，说明这个资源类别可以被哪个主体程序类别所读取。</p><p>找出主体程序为httpd_t相关的所有信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sesearch -s httpd_t --allow</span><br></pre></td></tr></table></figure><p><img src="/2017/04/28/selinux/%E5%9B%BE%E7%89%879.png" alt="image-20191118155032347"></p><p>从上面的数据就可以看出程序httpd_t为个类别可以访问的哪些资源类别。</p><p>如何解决上述问题呢？</p><p>解决方法就是更改test2.html文件的上下文。有两种方式，一种是通过restorerecon（ restore context) 修复继承当前目录默认的上下文；一种是通过chcon (change context) 修改当前的上下文。<br><strong>a.)使用restorerecon（ restore context) 修复继承当前目录默认的上下文</strong></p><p><strong>分两步实现:</strong><br>首先为 /var/www/html 这个目录下的所有文件添加默认标签类型：<br>semanagefcontext -a -t httpd_sys_content_t ‘/var/www/html(/.*)?’<br>因为html目录的默认标签类型就是httpd_sys_content_t，所以此步可以省略<br>然后用新的标签类型标注已有文件：<br>a.)restorecon -Rv /var/www/html/， 之后httpd就可以访问该目录下的文件了。</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# restorecon -Rv /var/www/html/</span><br><span class="line">restorecon reset /var/www/html/test2.html context unconfined_u:object_r:admin_home_t:s0-&gt;unconfined_u:object_r:httpd_sys_content_t:s0</span><br><span class="line">[root@localhost ~]# ll -lZ /var/www/html/</span><br></pre></td></tr></table></figure><p>-rw-r–r–. root root unconfined_u:object_r:<font color="Blue">httpd_sys_content_t</font>:s0 test1.html<br>-rw-r–r–. root root unconfined_u:object_r:<font color="Blue">httpd_sys_content_t</font>:s0 test2.html</p></blockquote><p>semanage和restorecon命令是由下列软件包提供的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# rpm -qf /sbin/semanage </span><br><span class="line">policycoreutils-python-2.2.5-20.el7.x86_64</span><br><span class="line">[root@localhost ~]# rpm -qf /sbin/restorecon </span><br><span class="line">policycoreutils-2.2.5-20.el7.x86_64</span><br></pre></td></tr></table></figure><p><strong>b.)使用chcon (change context) 修改当前的上下文</strong></p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# chcon -t httpd_sys_content_t /var/www/html/test3.html </span><br><span class="line">[root@localhost ~]# ls -lZ /var/www/html/</span><br></pre></td></tr></table></figure><p>-rw-r–r–. root root unconfined_u:object_r:<font color="Blue">httpd_sys_content_t</font>:s0 test1.html<br>-rw-r–r–. root root unconfined_u:object_r:<font color="Blue">httpd_sys_content_t</font>:s0 test2.html</p></blockquote><p>注：</p><p>chcon意思是change context<br>-t type 类型<br>-R recursive 递归(特别适用于改变某个目录下所有文件的context)<br>-u user<br>-r role</p><p>或</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# chcon --reference=/var/www/html/test1.html /var/www/html/test2.html</span><br><span class="line">[root@localhost ~]# ls -lZ /var/www/html/</span><br></pre></td></tr></table></figure><p>-rw-r–r–. root root unconfined_u:object_r:<font color="Blue">httpd_sys_content_t</font>:s0 test1.html<br>-rw-r–r–. root root unconfined_u:object_r:<font color="Blue">httpd_sys_content_t</font>:s0 test2.html</p></blockquote><p>–reference表示用test1.html文件的上下文修改test2.html文件的上下文。</p><h2 id="3、SELinux的布尔值"><a href="#3、SELinux的布尔值" class="headerlink" title="3、SELinux的布尔值"></a>3、SELinux的布尔值</h2><p>这个布尔值类似一个开关，打开的话，他对应的一些服务就允许执行，否则的话就拒绝执行。</p><p>看看有哪些布尔值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# getsebool -a</span><br></pre></td></tr></table></figure><p>也可用semanage命令（看得更详细一点）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# semanage boolean -l</span><br></pre></td></tr></table></figure><p>知道了布尔值的名字，可以通过sesearch 来确认他关联了哪些服务的域，比如httpd_enable_homedir允许下列规则,如果设置为off的话，那么他们都是无法访问的。</p><p><img src="/2017/04/28/selinux/%E5%9B%BE%E7%89%8710.png" alt="image-20191118155741488"></p><p>设置boolean值,-P为设置永久生效.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# setsebool [-P] 布尔值  on/off</span><br></pre></td></tr></table></figure><h3 id="3-1-下面看一个与布尔值有关的例子"><a href="#3-1-下面看一个与布尔值有关的例子" class="headerlink" title="3.1 下面看一个与布尔值有关的例子"></a>3.1 下面看一个与布尔值有关的例子</h3><h4 id="3-1-1-确认已经启用了-Selinux、启动-FTP"><a href="#3-1-1-确认已经启用了-Selinux、启动-FTP" class="headerlink" title="3.1.1 确认已经启用了 Selinux、启动 FTP"></a>3.1.1 确认已经启用了 Selinux、启动 FTP</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# getenforce </span><br><span class="line">Enforcing</span><br><span class="line">[root@localhost ~]# ps -ef | grep vsftpd</span><br><span class="line">root      6799     1  0 17:37 ?        00:00:00 /usr/sbin/vsftpd /etc/vsftpd/vsftpd.conf</span><br><span class="line">root      6809  3210  0 17:37 pts/0    00:00:00 grep --color=auto vsftpd</span><br></pre></td></tr></table></figure><h4 id="3-1-2-在匿名访问目录下创建-2-个文件进行测试"><a href="#3-1-2-在匿名访问目录下创建-2-个文件进行测试" class="headerlink" title="3.1.2 在匿名访问目录下创建 2 个文件进行测试"></a>3.1.2 在匿名访问目录下创建 2 个文件进行测试</h4><p>一个是在该目录下手动创建，这样该文件会自动继承/var/ftp/pub 下的目录上下文的值，一个用 mv 命令从 root 目录下移动过来，这样的文件会保留 root 目录下的安全上下文，如下</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cp test1.txt /var/ftp/</span><br><span class="line">[root@localhost ~]# mv test2.txt /var/ftp/</span><br><span class="line">[root@localhost ~]# ll -lZ /var/ftp/</span><br></pre></td></tr></table></figure><p>drwxr-xr-x. root root system_u:object_r:public_content_t:s0 pub<br>-rw-r–r–. root root unconfined_u:object_r:<font color="Blue">public_content_t</font>:s0 test1.txt<br>-rw-r–r–. root root unconfined_u:object_r:<font color="Blue">admin_home_t</font>:s0 test2.txt</p></blockquote><h4 id="3-1-3-使用匿名登录测试"><a href="#3-1-3-使用匿名登录测试" class="headerlink" title="3.1.3 使用匿名登录测试"></a>3.1.3 使用匿名登录测试</h4><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ftp localhost</span><br></pre></td></tr></table></figure><p>Trying ::1…<br>Connected to localhost (::1).<br>220 (vsFTPd 3.0.2)<br>Name (localhost:root): ftp<br>331 Please specify the password.<br>Password:<br>230 Login successful.<br>Remote system type is UNIX.<br>Using binary mode to transfer files.<br>ftp&gt; cd pub<br>250 Directory successfully changed.<br>ftp&gt; ls<br>229 Entering Extended Passive Mode (|||7645|).<br>150 Here comes the directory listing.<br><font color="Blue">-rw-r–r– 1 0 0 6 Nov 07 09:50 test1.txt</font><br>226 Directory send OK.<br>ftp&gt;</p></blockquote><p>发现这里看不到 test2.txt 文件<br>已知系统启动了 Selinux，先查看系统日志，有两个工具可以收集到 Selinux 产生的<br>日志，一个是 setroubleshoot，一个是 audit，先使用 audit 工具，使用方法<br>如下：<br>系统中提供了 audit 相关的命令，常用的有 audit2why 和 audit2allow，audit 产生的日志<br>放在/var/log/audit， 由于此文件记录的信息很多不宜直接查看，可以借助 audit2why<br>命令，首先启动 audit</p><h4 id="3-1-4-在客户端登录-FTP-服务器时会出发-audit-deamon-产生日志"><a href="#3-1-4-在客户端登录-FTP-服务器时会出发-audit-deamon-产生日志" class="headerlink" title="3.1.4 在客户端登录 FTP 服务器时会出发 audit deamon 产生日志"></a>3.1.4 在客户端登录 FTP 服务器时会出发 audit deamon 产生日志</h4><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# audit2why &lt; /var/log/audit/audit.log</span><br></pre></td></tr></table></figure><p>type=AVC msg=audit(1478511697.588:987): avc: denied { getattr } for pid=6901 comm=”vsftpd” path=”/test2.txt” dev=”dm-0” ino=204352546 scontext=system_u:system_r:ftpd_t:s0-s0:c0.c1023 tcontext=unconfined_u:object_r:admin_home_t:s0 tclass=file</p><pre><code>Was caused by:
The boolean ftpd_full_access was set incorrectly. 
Description:
Allow ftpd to full access

Allow access by executing:
# setsebool -P ftpd_full_access 1</code></pre></blockquote><p>查看最底部的信息，AVC 是 access vector cache 的缩写， 目的是记录所有与 SELinux 有关的存取统计资料。</p><h4 id="3-1-5-根据日志中的建使用-audit2allow-命令查看给出的建议如下"><a href="#3-1-5-根据日志中的建使用-audit2allow-命令查看给出的建议如下" class="headerlink" title="3.1.5 根据日志中的建使用 audit2allow 命令查看给出的建议如下"></a>3.1.5 根据日志中的建使用 audit2allow 命令查看给出的建议如下</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# audit2allow &lt; /var/log/audit/audit.log</span><br><span class="line">#============= ftpd_t ==============</span><br><span class="line"></span><br><span class="line">#!!!! This avc can be allowed using the boolean &apos;ftpd_full_access&apos;</span><br><span class="line">allow ftpd_t admin_home_t:file getattr;</span><br></pre></td></tr></table></figure><p>验证布尔值中有关 FTP 的定义</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# getsebool -a | grep ftp</span><br></pre></td></tr></table></figure><p><font color="Blue">ftp_home_dir –&gt; off</font><br>ftpd_anon_write –&gt; off<br>ftpd_connect_all_unreserved –&gt; off<br>ftpd_connect_db –&gt; off<br>ftpd_full_access –&gt; off<br>ftpd_use_cifs –&gt; off<br>ftpd_use_fusefs –&gt; off<br>……………………………………………………</p></blockquote><p>发现ftp_home_dir –&gt; off，文件 root.txt 的类型刚好是 root:object_r:user_home_t:s0</p><h4 id="3-1-6-所以更改此-bool-值就可以"><a href="#3-1-6-所以更改此-bool-值就可以" class="headerlink" title="3.1.6 所以更改此 bool 值就可以"></a>3.1.6 所以更改此 bool 值就可以</h4><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# setsebool -P ftp_home_dir on</span><br><span class="line">[root@localhost ~]# getsebool -a | grep ftp</span><br></pre></td></tr></table></figure><p><font color="Blue">ftp_home_dir –&gt; on</font><br>ftpd_anon_write –&gt; off<br>ftpd_connect_all_unreserved –&gt; off<br>ftpd_connect_db –&gt; off<br>ftpd_full_access –&gt; off<br>ftpd_use_cifs –&gt; off<br>ftpd_use_fusefs –&gt; off<br>………………………………………………</p></blockquote><p>（-P 是把该修改写到文件，下次启动仍然有效）</p><p>客户端登录测试,发现 root.txt 文件就可以访问了</p><h4 id="3-1-7-再次访问ftp"><a href="#3-1-7-再次访问ftp" class="headerlink" title="3.1.7 再次访问ftp"></a>3.1.7 再次访问ftp</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ftp localhost</span><br><span class="line">Trying ::1...</span><br><span class="line">Connected to localhost (::1).</span><br><span class="line">220 (vsFTPd 3.0.2)</span><br><span class="line">Name (localhost:root): ftp</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line"></span><br><span class="line">ftp&gt; cd pub</span><br><span class="line">250 Directory successfully changed.</span><br><span class="line"></span><br><span class="line">ftp&gt; ls</span><br><span class="line">229 Entering Extended Passive Mode (|||7645|).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">-rw-r--r--    1 0        0               6 Nov 07 09:50 test1.txt</span><br><span class="line">-rw-r--r--    1 0        0               6 Nov 07 09:50 test2.txt</span><br><span class="line">226 Directory send OK.</span><br><span class="line">ftp&gt;</span><br></pre></td></tr></table></figure><p><strong>总结一下：</strong>如果搭配了某个服务器，然后客户端无法正常访问，应该按照下面的顺序进行排错：</p><ol><li>该服务的配置文件中是否开启了相关的权限 ,比如是否允许匿名用户写入等等；</li><li>文件系统的权限，比如是否需要使用chmod修改权限</li><li>SELinux的上下文和布尔值</li></ol></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a><a href="/tags/SELinux/" rel="tag"><i class="fa fa-tag"></i> SELinux</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/04/25/docker-swarm-qun-ji/" rel="next" title="Docker Swarm群集"><i class="fa fa-chevron-left"></i> Docker Swarm群集</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2017/05/01/activemq-bu-shu/" rel="prev" title="部署ActiveMQ">部署ActiveMQ<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"><span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a><a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/chen.png" alt="Zhongzhou Chen"><p class="site-author-name" itemprop="name">Zhongzhou Chen</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">314</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">84</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">180</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、SELinux-简介"><span class="nav-text">1、SELinux 简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、Selinux状态查看与配置"><span class="nav-text">2、Selinux状态查看与配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-配置selinux"><span class="nav-text">2.1 配置selinux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-查看及修改安全上下文"><span class="nav-text">2.2 查看及修改安全上下文</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#以下是复制和移动文件时安全上下文的变化"><span class="nav-text">以下是复制和移动文件时安全上下文的变化</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、SELinux的布尔值"><span class="nav-text">3、SELinux的布尔值</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-下面看一个与布尔值有关的例子"><span class="nav-text">3.1 下面看一个与布尔值有关的例子</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-确认已经启用了-Selinux、启动-FTP"><span class="nav-text">3.1.1 确认已经启用了 Selinux、启动 FTP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-2-在匿名访问目录下创建-2-个文件进行测试"><span class="nav-text">3.1.2 在匿名访问目录下创建 2 个文件进行测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-3-使用匿名登录测试"><span class="nav-text">3.1.3 使用匿名登录测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-4-在客户端登录-FTP-服务器时会出发-audit-deamon-产生日志"><span class="nav-text">3.1.4 在客户端登录 FTP 服务器时会出发 audit deamon 产生日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-5-根据日志中的建使用-audit2allow-命令查看给出的建议如下"><span class="nav-text">3.1.5 根据日志中的建使用 audit2allow 命令查看给出的建议如下</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-6-所以更改此-bool-值就可以"><span class="nav-text">3.1.6 所以更改此 bool 值就可以</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-7-再次访问ftp"><span class="nav-text">3.1.7 再次访问ftp</span></a></li></ol></li></ol></li></ol></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">Zhongzhou Chen</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">752.6k</span></div><span class="post-meta-divider"></span></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code").find(".line").map(function(t,e){return $(e).text()}).toArray().join("\n"),n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();var o=document.execCommand("copy");document.body.removeChild(n),o?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})</script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,s){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var o=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,n=document.getElementById(e),r=document.getElementById(s);n.addEventListener("input",function(){var y=n.value.trim().toLowerCase(),T=y.split(/[\s\-]+/);1<T.length&&T.push(y);var b=[];if(0<y.length&&o.forEach(function(t){function e(t,e,o,n){for(var r=n[n.length-1],s=r.position,a=r.word,i=[],c=0;s+a.length<=o&&0!=n.length;){a===y&&c++,i.push({position:s,length:a.length});var l=s+a.length;for(n.pop();0!=n.length&&(s=(r=n[n.length-1]).position,a=r.word,s<l);)n.pop()}return h+=c,{hits:i,start:e,end:o,searchTextCount:c}}function o(o,t){var n="",r=t.start;return t.hits.forEach(function(t){n+=o.substring(r,t.position);var e=t.position+t.length;n+='<b class="search-keyword">'+o.substring(t.position,e)+"</b>",r=e}),n+=o.substring(r,t.end)}var n=!1,r=0,h=0,s=t.title.trim(),a=s.toLowerCase(),i=t.content.trim().replace(/<[^>]+>/g,""),c=i.toLowerCase(),l=decodeURIComponent(t.url),p=[],u=[];if(""!=s&&(T.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());-1<(s=e.indexOf(t,r));)a.push({position:s,word:t}),r=s+n;return a}p=p.concat(e(t,a,!1)),u=u.concat(e(t,c,!1))}),(0<p.length||0<u.length)&&(n=!0,r=p.length+u.length)),n){[p,u].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var f=[];0!=p.length&&f.push(e(0,0,s.length,p));for(var d=[];0!=u.length;){var g=u[u.length-1],v=g.position,$=g.word,C=v-20,m=v+80;C<0&&(C=0),m<v+$.length&&(m=v+$.length),m>i.length&&(m=i.length),d.push(e(0,C,m,u))}d.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var x=parseInt("1");0<=x&&(d=d.slice(0,x));var w="";w+=0!=f.length?"<li><a href='"+l+"' class='search-result-title'>"+o(s,f[0])+"</a>":"<li><a href='"+l+"' class='search-result-title'>"+s+"</a>",d.forEach(function(t){w+="<a href='"+l+'\'><p class="search-result">'+o(i,t)+"...</p></a>"}),w+="</li>",b.push({item:w,searchTextCount:h,hitCount:r,id:b.length})}}),1===T.length&&""===T[0])r.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===b.length)r.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{b.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var e='<ul class="search-result-list">';b.forEach(function(t){e+=t.item}),e+="</ul>",r.innerHTML=e}}),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),!1===isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){27===t.which&&$(".search-popup").is(":visible")&&onPopupClose()})</script><script type="text/javascript" src="/js/src/love.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,log:!1,model:{jsonPath:"/live2dw/assets/shizuku.model.json"},display:{position:"right"},mobile:{show:!0,scale:.2},react:{opacityDefault:.7,opacityOnHover:.2,opacity:.4}})</script></body></html>