<!-- build time:Mon Sep 13 2021 11:25:20 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><script></script><meta name="theme-color" content="#222"><style>.pace .pace-progress{background:#1E92FB;height:3px}.pace .pace-progress-inner{box-shadow:0 0 10px #1E92FB,0 0 5px #1E92FB}.pace .pace-activity{border-top-color:#1E92FB;border-left-color:#1E92FB}</style><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="HGM141IpbHrSmnAmR6W_zE4bo9Z3f-yXLeHYT3bg1fk"><meta name="msvalidate.01" content="code-5Ai1DA8e6T"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="监控系统,Nagios,"><link rel="alternate" href="/atom.xml" title="凡间的精灵" type="application/atom+xml"><meta name="description" content="1、Nagios简介Nagios是一款开源免费的网路监视工具，可以监控的设备：Windows，Linux，Unix，Router，Switch，具有报警功能，是一个网络监控系统。它可以监视你指定的主机和服务，并在那些设备“变坏”和“变好”的时候通知管理员。在系统或服务状态异常时发出邮件或短信报警第一时间通知网站运维人员，在状态恢复后发出正常的邮件或短信通知。Nagios Core 原先设计在Lin"><meta name="keywords" content="监控系统,Nagios"><meta property="og:type" content="article"><meta property="og:title" content="Nagios 监控系统"><meta property="og:url" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2016&#x2F;03&#x2F;02&#x2F;nagios-jian-kong-xi-tong&#x2F;index.html"><meta property="og:site_name" content="凡间的精灵"><meta property="og:description" content="1、Nagios简介Nagios是一款开源免费的网路监视工具，可以监控的设备：Windows，Linux，Unix，Router，Switch，具有报警功能，是一个网络监控系统。它可以监视你指定的主机和服务，并在那些设备“变坏”和“变好”的时候通知管理员。在系统或服务状态异常时发出邮件或短信报警第一时间通知网站运维人员，在状态恢复后发出正常的邮件或短信通知。Nagios Core 原先设计在Lin"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2016&#x2F;03&#x2F;02&#x2F;nagios-jian-kong-xi-tong&#x2F;%E5%9B%BE%E7%89%871.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2016&#x2F;03&#x2F;02&#x2F;nagios-jian-kong-xi-tong&#x2F;%E5%9B%BE%E7%89%872.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2016&#x2F;03&#x2F;02&#x2F;nagios-jian-kong-xi-tong&#x2F;%E5%9B%BE%E7%89%873.png"><meta property="og:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2016&#x2F;03&#x2F;02&#x2F;nagios-jian-kong-xi-tong&#x2F;%E5%9B%BE%E7%89%874.png"><meta property="og:updated_time" content="2019-11-16T10:57:15.004Z"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2016&#x2F;03&#x2F;02&#x2F;nagios-jian-kong-xi-tong&#x2F;%E5%9B%BE%E7%89%871.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"always",offset:12,b2t:!0,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://chenzhonzhou.github.io/2016/03/02/nagios-jian-kong-xi-tong/"><title>Nagios 监控系统 | 凡间的精灵</title><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">凡间的精灵</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">凡尘落素一精灵</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://chenzhonzhou.github.io/2016/03/02/nagios-jian-kong-xi-tong/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Zhongzhou Chen"><meta itemprop="description" content=""><meta itemprop="image" content="/images/chen.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="凡间的精灵"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Nagios 监控系统</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-02T14:05:15+08:00">2016-03-02 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">监控系统</span> </a></span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/Nagios/" itemprop="url" rel="index"><span itemprop="name">Nagios</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">4.3k </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">18</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="1、Nagios简介"><a href="#1、Nagios简介" class="headerlink" title="1、Nagios简介"></a>1、Nagios简介</h2><p><strong>Nagios</strong>是一款开源免费的网路监视工具，可以监控的设备：<strong>Windows</strong>，<strong>Linux</strong>，<strong>Unix</strong>，<strong>Router</strong>，<strong>Switch</strong>，具有报警功能，是一个网络监控系统。它可以监视你指定的主机和服务，并在那些设备“变坏”和“变好”的时候通知管理员。</p><p>在系统或服务状态异常时发出邮件或短信报警第一时间通知网站运维人员，在状态恢复后发出正常的邮件或短信通知。<strong>Nagios Core</strong> 原先设计在<strong>Linux</strong>下运行，当然，它在其他的<strong>Unix</strong>系统下应该也能进行工作。</p><p>Nagios Ain’t Gonna Insist On Sainthood” Sainthood 翻译为圣徒<br><strong>官方网站：</strong><a href="http://www.nagios.org" target="_blank" rel="noopener">http://www.nagios.org</a></p><h3 id="Nagios运行模式和优点"><a href="#Nagios运行模式和优点" class="headerlink" title="Nagios运行模式和优点"></a>Nagios运行模式和优点</h3><p><img src="/2016/03/02/nagios-jian-kong-xi-tong/%E5%9B%BE%E7%89%871.png" alt="image-20191116182102720"></p><p><strong>A.运行模式：</strong>数据收集是C/S模式，用户查看监控信息是B/S模式<br><strong>B.优点：</strong></p><ol><li>监控网络服务（SMTP、POP3、HTTP、PING等）；</li><li>监控主机资源（处理器负荷、磁盘利用率等）；</li><li>简单地插件设计使得用户可以方便地扩展自己服务的检测方法；</li><li>当服务或主机问题产生与解决时将告警发送给联系人（通过EMail、短信、用户定义方式）；</li><li>可以定义一些处理程序，使之能够在服务或者主机发生故障时起到预防作用；</li><li>自动的日志滚动功能；</li><li>可选的WEB界面用于查看当前的网络状态、通知和故障历史、日志文件等；</li></ol><h3 id="Nagios工作原理"><a href="#Nagios工作原理" class="headerlink" title="Nagios工作原理"></a>Nagios工作原理</h3><p><img src="/2016/03/02/nagios-jian-kong-xi-tong/%E5%9B%BE%E7%89%872.png" alt="image-20191116182757831"></p><h4 id="1-Nagios插件："><a href="#1-Nagios插件：" class="headerlink" title="1)Nagios插件："></a>1)Nagios插件：</h4><p>nagios-plugins是nagios官方提供的一套插件程序，nagios监控主机的功能其实都是通过执行插件程序来实现的。</p><p>nagios本身并没有监控的功能，所有的监控是由插件完成的，插件将监控的结果返回给nagios，nagios分析这些结果以web的方式展现给我们，同时提供相应的报警功能(这个报警的功能也是由插件完成的)。</p><p>所有的这些插件是一些实现特定功能的可执行程序，默认安装的路径是/usr/local/nagios/libexec，可以自己查看。</p><p>使用NRPE监控LINUX上的”本地信息”</p><p>对系统为linux的主机进行如下监控：CPU负载、磁盘容量、登陆用户数、总进程数、僵尸进程数、swap分区使用情况。</p><p>对于像磁盘容量，cpu负载这样的”本地信息”，nagios只能监测自己所在的主机，而对其他的机器则显得有点无能为力。毕竟没得到被控主机的适当权限是不可能得到这些信息的。为了解决这个问题，nagios有这样一个附加组件—-NRPE。用它就可以完成对linux类型主机”本地信息”的监控。</p><h4 id="2-NRPE总共由两部分组成"><a href="#2-NRPE总共由两部分组成" class="headerlink" title="2)NRPE总共由两部分组成:"></a>2)NRPE总共由两部分组成:</h4><ul><li>check_nrpe 插件,位于在监控主机上</li></ul><ul><li>NRPE daemon,运行在远程的linux主机上(通常就是被监控机)</li></ul><h4 id="3-Nagios通过nrpe插件来远程管理服务"><a href="#3-Nagios通过nrpe插件来远程管理服务" class="headerlink" title="3)Nagios通过nrpe插件来远程管理服务"></a>3)Nagios通过nrpe插件来远程管理服务</h4><ol><li>Nagios会运行check_nrpe这个插件,告诉它要检查什么。</li><li>通过SSL方式，check_nrpe插件会连接到远程的NRPE daemon。</li><li>NRPE运行本地的各种插件去检测本地的服务和状态（chenk_disk,..etc）。</li><li>NRPE将检查的结果返回给check_nrpe插件，插件再把结果送到Nagios状态队列。</li><li>Nagios依次读取队列中的信息，再把结果显示出来。</li></ol><p><strong>注意：</strong>NRPE daemon需要nagios插件安装在远程的linux主机上,否则,daemon不能做任何的监控。</p><h4 id="4-通过NRPE的检测分为两种"><a href="#4-通过NRPE的检测分为两种" class="headerlink" title="4)通过NRPE的检测分为两种"></a>4)通过NRPE的检测分为两种</h4><ol><li><p><strong>直接检测:</strong>检测的对象是运行NRPE的那台linux主机的本地资源。</p><p>被监控机上安装有nrpe,并且还有插件,最终的监控是由这些插件来进行的.当监控主机将监控请求发给nrpe后,nrpe调用插件来完成监控。</p></li><li><p><strong>间接检测:</strong>当运行nagios的监控主机无法访问到某台被监控机,但是运行NRPE的机器可以访问到时,NRPE就可以充当一个代理,将监控请求发送到被监控机(必须要说明的是,通常被监控机与监控机在同一网络内,所以这样的情况很少)</p></li></ol><h4 id="5-nagios可以做到"><a href="#5-nagios可以做到" class="headerlink" title="5)nagios可以做到"></a>5)nagios可以做到</h4><ol><li><strong>数据报警</strong>（报警功能恒强悍）[故障出发，故障恢复都可以]。</li><li><strong>依赖分析报警</strong>（发现关键设备故障，相连的设备就不报警）。</li><li><strong>数据采集</strong>（采集的数据比较独特，他只关心警戒位，只关心正常与否的状态，状态转换时可以实现报警，所以它采集的数据不需要保存），当然也有插件弥补这个不足，如PNP4Nagios。</li></ol><h4 id="6-Nagios所需要的软件"><a href="#6-Nagios所需要的软件" class="headerlink" title="6)Nagios所需要的软件"></a>6)Nagios所需要的软件</h4><p><strong>LAMP环境，不需要mysql</strong></p><table><thead><tr><th>组件</th><th>描述</th></tr></thead><tbody><tr><td>nagios-3.5.1.tar.gz</td><td>Nagios核心文件，Nagios服务文件，不建议用最新，很多插件没做好</td></tr><tr><td>nagios-plugins-2.1.1.tar.gz</td><td>Nagios 插件，用于存放和收集脚本和命令</td></tr><tr><td>NSCP-0.5.0</td><td>也就是Nsclient++，用来监控Windows，分为64位和32位版本</td></tr><tr><td>nrpe-2.15.tar.gz</td><td>代理服务，用于监控非Nagios服务器的服务器本地私有信息代理</td></tr><tr><td>vautour_style.zip</td><td>举例主题包</td></tr></tbody></table><h2 id="2、部署Nagios监控服务"><a href="#2、部署Nagios监控服务" class="headerlink" title="2、部署Nagios监控服务"></a>2、部署Nagios监控服务</h2><h3 id="2-1-创建Nagios运行用户和用户组"><a href="#2-1-创建Nagios运行用户和用户组" class="headerlink" title="2.1 创建Nagios运行用户和用户组"></a>2.1 创建Nagios运行用户和用户组</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@centos1</span> ~]<span class="meta"># useradd -s /sbin/nologin nagios</span></span><br><span class="line">[root<span class="symbol">@centos1</span> ~]<span class="meta"># mkdir /usr/local/nagios</span></span><br><span class="line">[root<span class="symbol">@centos1</span> ~]<span class="meta"># chown -R nagios:nagios /usr/local/nagios/</span></span><br></pre></td></tr></table></figure><h3 id="2-2-编译安装Nagios"><a href="#2-2-编译安装Nagios" class="headerlink" title="2.2 编译安装Nagios"></a>2.2 编译安装Nagios</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>centos1 ~]# tar zxf nagios<span class="number">-4.0</span><span class="number">.1</span>.tar.gz</span><br><span class="line">[<span class="symbol">root@</span>centos1 ~]# cd nagios<span class="number">-4.0</span><span class="number">.1</span></span><br><span class="line">[<span class="symbol">root@</span>centos1 nagios<span class="number">-4.0</span><span class="number">.1</span>]# ./configure --prefix=/usr/local/nagios/</span><br><span class="line">[<span class="symbol">root@</span>centos1 nagios<span class="number">-4.0</span><span class="number">.1</span>]# make all</span><br><span class="line">[<span class="symbol">root@</span>centos1 nagios<span class="number">-4.0</span><span class="number">.1</span>]# make istall</span><br><span class="line">[<span class="symbol">root@</span>centos1 nagios<span class="number">-4.0</span><span class="number">.1</span>]# make install-init    </span><br><span class="line"><span class="comment">//安装生成/etc/rc.d/init.d/nagios  启动脚本</span></span><br><span class="line">[<span class="symbol">root@</span>centos1 nagios<span class="number">-4.0</span><span class="number">.1</span>]# make install-commandmode    </span><br><span class="line"><span class="comment">//安装生成/usr/local/nagios/etc下的nagios相关配置文件</span></span><br><span class="line">[<span class="symbol">root@</span>centos1 nagios<span class="number">-4.0</span><span class="number">.1</span>]# make install-config       </span><br><span class="line"><span class="comment">//设定相应nagios工作目录的权限</span></span><br><span class="line">[<span class="symbol">root@</span>centos1 nagios<span class="number">-4.0</span><span class="number">.1</span>]# make install-webconf     </span><br><span class="line"><span class="comment">//安装Nagios的WEB配置文件到Apache的conf.d目录下到此时，安装过程就结束了</span></span><br><span class="line">[<span class="symbol">root@</span>centos1 nagios<span class="number">-4.0</span><span class="number">.1</span>]# chkconfig --add nagios</span><br><span class="line">[<span class="symbol">root@</span>centos1 nagios<span class="number">-4.0</span><span class="number">.1</span>]# chkconfig nagios on</span><br></pre></td></tr></table></figure><h3 id="2-33-验证安装是否成功"><a href="#2-33-验证安装是否成功" class="headerlink" title="2.33 验证安装是否成功"></a>2.33 验证安装是否成功</h3><p>需要查看/usr/local/nagios目录是否有如下内容：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 nagios-4.<span class="number">0</span>.<span class="number">1</span>]<span class="comment"># ls /usr/local/nagios/</span></span><br><span class="line"><span class="keyword">bin </span> etc  libexec  <span class="keyword">sbin </span> <span class="keyword">share </span> var</span><br></pre></td></tr></table></figure><h3 id="2-4-安装Nagios插件"><a href="#2-4-安装Nagios插件" class="headerlink" title="2.4 安装Nagios插件"></a>2.4 安装Nagios插件</h3><p>Nagios提供的各种监控功能基本上是通过插件来完成的。<br>下载地址：<a href="https://www.nagios-plugins.org/download/nagios-plugins-1.5.tar.gz" target="_blank" rel="noopener">https://www.nagios-plugins.org/download/nagios-plugins-1.5.tar.gz</a></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>centos1 ~]# tar zxf nagios-plugins<span class="number">-1.5</span>.tar.gz</span><br><span class="line">[<span class="symbol">root@</span>centos1 ~]# cd nagios-plugins<span class="number">-1.5</span></span><br><span class="line">[<span class="symbol">root@</span>centos1 nagios-plugins<span class="number">-1.5</span>]# ./configure --prefix=/usr/local/nagios/</span><br><span class="line">[<span class="symbol">root@</span>centos1 nagios-plugins<span class="number">-1.5</span>]# make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="2-5-安装NRRE"><a href="#2-5-安装NRRE" class="headerlink" title="2.5 安装NRRE"></a>2.5 安装NRRE</h3><p>如果要获取远程主机上的本地资源或属性，如CPU利用率、磁盘利用率等，需要借助外部构件NRRE来完成。<br>下载地址：<a href="https://www.nagios-plugins.org/download/nagios-plugins-1.5.tar.gz" target="_blank" rel="noopener">https://www.nagios-plugins.org/download/nagios-plugins-1.5.tar.gz</a><br>监控端与被监控主机之间使用SSL安全通道，需要首先安装openssl-devel</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@centos1</span> ~]<span class="meta"># yum -y install openssl-devel</span></span><br><span class="line">[root<span class="symbol">@centos1</span> ~]<span class="meta"># cd nrpe-2.15</span></span><br><span class="line">[root<span class="symbol">@centos1</span> nrpe<span class="number">-2.15</span>]<span class="meta"># ./configure</span></span><br><span class="line">[root<span class="symbol">@centos1</span> nrpe<span class="number">-2.15</span>]<span class="meta"># make all</span></span><br><span class="line">[root<span class="symbol">@centos1</span> nrpe<span class="number">-2.15</span>]<span class="meta"># make install-plugin</span></span><br></pre></td></tr></table></figure><h3 id="2-6-安装与配置Apache和PHP"><a href="#2-6-安装与配置Apache和PHP" class="headerlink" title="2.6 安装与配置Apache和PHP"></a>2.6 安装与配置Apache和PHP</h3><p>Apache和PHP不是安装Nagios所必需的，但是Nagios提供了Web监控界面，通过Web监控界面可以清晰地看到被监控主机、资源的运行状态，因此，安装一个Web服务是很有必要的。<br><strong>需要注意的是</strong>，Nagios在Nagios3.1.x版本以后，配置Web监控界面时需要PHP支持。</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@centos1</span> ~]<span class="meta"># yum -y instll httpd</span></span><br><span class="line">[root<span class="symbol">@centos1</span> ~]<span class="meta"># yum -y instll php mysql-devel</span></span><br></pre></td></tr></table></figure><p>为了安全起见，一般情况下要让Nagios的Web监控页面必须经过授权才能访问，这需要增加验证配置，即在/etc/httpd/conf.d/nagios.conf 配置文件的最后添加如下信息，因为前面安装Nagios时添加了make install-webconf所以以下配置都已经生成好了。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 ~]# cat /etc/httpd/conf.d/nagios.conf</span><br><span class="line">ScriptAlias /nagios/cgi-bin "/usr/local/nagios/sbin"</span><br><span class="line">&lt;Directory "/usr/local/nagios/sbin"&gt;</span><br><span class="line">#  SSLRequireSSL</span><br><span class="line">   <span class="keyword">Options</span> ExecCGI</span><br><span class="line">   AllowOverride <span class="keyword">None</span></span><br><span class="line">   <span class="keyword">Order</span> allow,deny</span><br><span class="line">   Allow <span class="keyword">from</span> <span class="keyword">all</span></span><br><span class="line">#  <span class="keyword">Order</span> deny,allow</span><br><span class="line">#  Deny <span class="keyword">from</span> <span class="keyword">all</span></span><br><span class="line">#  Allow <span class="keyword">from</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">   AuthName "Nagios Access"</span><br><span class="line">   AuthType Basic</span><br><span class="line">   AuthUserFile /usr/<span class="keyword">local</span>/nagios/etc/htpasswd.users</span><br><span class="line">   Require <span class="keyword">valid</span>-<span class="keyword">user</span></span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">Alias</span> /nagios "/usr/local/nagios/share"</span><br><span class="line"></span><br><span class="line">&lt;Directory "/usr/local/nagios/share"&gt;</span><br><span class="line">#  SSLRequireSSL</span><br><span class="line">   <span class="keyword">Options</span> <span class="keyword">None</span></span><br><span class="line">   AllowOverride <span class="keyword">None</span></span><br><span class="line">   <span class="keyword">Order</span> allow,deny</span><br><span class="line">   Allow <span class="keyword">from</span> <span class="keyword">all</span></span><br><span class="line">#  <span class="keyword">Order</span> deny,allow</span><br><span class="line">#  Deny <span class="keyword">from</span> <span class="keyword">all</span></span><br><span class="line">#  Allow <span class="keyword">from</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">   AuthName "Nagios Access"</span><br><span class="line">   AuthType Basic</span><br><span class="line">   AuthUserFile /usr/<span class="keyword">local</span>/nagios/etc/htpasswd.users</span><br><span class="line">   Require <span class="keyword">valid</span>-<span class="keyword">user</span></span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure><h3 id="2-7-生成nagios网页用户名和密码"><a href="#2-7-生成nagios网页用户名和密码" class="headerlink" title="2.7 生成nagios网页用户名和密码"></a>2.7 生成nagios网页用户名和密码</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 ~]# htpasswd -c /usr/local/nagios/etc/htpasswd.users nagiosadm</span><br><span class="line">New password: </span><br><span class="line">Re-type new password: </span><br><span class="line">Adding password <span class="keyword">for</span><span class="built_in"> user </span>nagiosadm</span><br></pre></td></tr></table></figure><h3 id="2-8-查看认证文件内容，并启动Web服务"><a href="#2-8-查看认证文件内容，并启动Web服务" class="headerlink" title="2.8 查看认证文件内容，并启动Web服务"></a>2.8 查看认证文件内容，并启动Web服务</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 ~]<span class="meta"># cat /usr/local/nagios/etc/htpasswd.users </span></span><br><span class="line">nagiosadm:WpsO2JN/pwGsc              <span class="comment">//因为采用了加密算法，所以密码不是明文</span></span><br><span class="line">[root@centos1 ~]<span class="meta"># service httpd start</span></span><br><span class="line">Starting httpd: httpd: apr_sockaddr_info_get() failed <span class="keyword">for</span> centos1.benet.com</span><br><span class="line">httpd: Could <span class="keyword">not</span> reliably determine the server's fully qualified domain name, <span class="keyword">using</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">for</span> ServerName</span><br><span class="line">                                                           [  OK  ]</span><br></pre></td></tr></table></figure><h3 id="2-9-到此就可以访问监控网页了"><a href="#2-9-到此就可以访问监控网页了" class="headerlink" title="2.9 到此就可以访问监控网页了"></a>2.9 到此就可以访问监控网页了</h3><p>（别忘了做防火墙入站规则，访问登录页面后输入刚刚创建的登录用户，密码）</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>centos1 etc]# iptables -I INPUT -p tcp --dport <span class="number">80</span> -j ACCEPT</span><br></pre></td></tr></table></figure><p><img src="/2016/03/02/nagios-jian-kong-xi-tong/%E5%9B%BE%E7%89%873.png" alt="image-20191116183725675"></p><h2 id="3、配置Nagios监控系统"><a href="#3、配置Nagios监控系统" class="headerlink" title="3、配置Nagios监控系统"></a>3、配置Nagios监控系统</h2><h3 id="3-1-默认配置文件介绍"><a href="#3-1-默认配置文件介绍" class="headerlink" title="3.1 默认配置文件介绍"></a>3.1 默认配置文件介绍</h3><p>接下来配置Nagios，在配置之前我们要了解Nagios配置文件的作用及目录层次结构，Nagios安装完毕之后，默认的配置文件在/usr/local/nagios/etc/目录下</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">root@centos1 ~</span>]<span class="meta"># cd /usr/local/nagios/etc/</span></span><br><span class="line">cgi.cfg             <span class="comment">//控制CGI访问的配置文件</span></span><br><span class="line">nagios.cfg           <span class="comment">//Nagios主配置文件</span></span><br><span class="line">resource.cfg         <span class="comment">//变量定义文件，又称为资源文件，在这此文件中定义变量，以便由其他配置文件引用，如$USER1$</span></span><br><span class="line">objects             <span class="comment">// objects是一个目录，在此目录下有很多配置文件模板，用于定义Nagios对象</span></span><br><span class="line">objects/commands.cfg    <span class="comment">//定义命令配置文件，其中定义的命令可以被其他配置文件引用</span></span><br><span class="line">objects/contacts.cfg     <span class="comment">//定义联系人和联系人组的配置文件</span></span><br><span class="line">objects/localhost.cfg    <span class="comment">//定义监控本地主机的配置文件</span></span><br><span class="line">objects/printer.cfg      <span class="comment">//定义监控打印机的一个配置文件模板，默认没有启用此文件</span></span><br><span class="line">objects/<span class="keyword">switch</span>.cfg       <span class="comment">//定义监控路由器的一个配置文件模板，默认没有启用些文件</span></span><br><span class="line">objects/templates.cfg    <span class="comment">//定义主机和服务的一个模板配置文件，可以在其他配置文件中引用</span></span><br><span class="line">objects/timeperiods.cfg  <span class="comment">//定义Nagios监控时间段的配置文件</span></span><br><span class="line">objects/windows.cfg      <span class="comment">//定义监控Windows主机的一个配置文件模板，默认没有启用此文件</span></span><br></pre></td></tr></table></figure><h3 id="3-2-配置文件之间的关系"><a href="#3-2-配置文件之间的关系" class="headerlink" title="3.2 配置文件之间的关系"></a>3.2 配置文件之间的关系</h3><p>在Nagios的配置过程中涉及的几个定义有主机、主机组、服务、服务组、联系人、联系人组、监控时间和监控命令等。从这些定义可以看出，Nagios各个配置文件之间是互为关联、彼此引用的。成功配置出一台Nagios监控系统，必须要弄清楚每个配置文件之间依赖与被依赖的关系，最重要的有四点。</p><ul><li>定义监控哪些主机、主机组、服务和服务组</li><li>定义这个监控要用什么命令实现</li><li>定义监控的时间段</li><li>定义主机或服务出现问题时要通知的联系人和联系人组</li></ul><h3 id="3-3-配置Nagios"><a href="#3-3-配置Nagios" class="headerlink" title="3.3 配置Nagios"></a>3.3 配置Nagios</h3><p>为了能更清楚地说明问题，同时也为了维护方便，建议将Nagios各个定义对象创建独立的配置文件</p><ul><li>创建conf目录来定义host主机</li><li>创建hostgroups.cfg文件来定义主机组</li><li>用默认的contacts.cfg文件来定义联系人和联系人组</li><li>用默认的commands.cfg文件来定义命令</li><li>用默认的timeperiods.cfg来定义监控时间段</li><li>用默认的templates.cfg文件作为资源引用文件</li></ul><p>初步了解Nagios的配置文件后，接下来开始修改配置文件</p><p><strong>①编辑主配置文件 （添加红色内容，为需要调用的配置文件）</strong></p><p>注：前面数字为行号</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@centos1</span> etc]<span class="meta"># vim /usr/local/nagios/etc/nagios.cfg</span></span><br></pre></td></tr></table></figure><blockquote><p>29 cfg_file=/usr/local/nagios/etc/objects/commands.cfg<br>30 cfg_file=/usr/local/nagios/etc/objects/contacts.cfg<br>31 cfg_file=/usr/local/nagios/etc/objects/timeperiods.cfg<br>32 cfg_file=/usr/local/nagios/etc/objects/templates.cfg<br>33 <font color="red">cfg_file=/usr/local/nagios/etc/objects/hostgroups.cfg</font><br>34 <font color="red">cfg_dir=/usr/local/nagios/etc/conf</font> //为了把主机配置信息都放置在此文件夹下方便管理，如果想把某个目录下的所有文件都包含进来，中以使用cfg_dir<br>[root@centos1 etc]# mkdir /usr/local/nagios/etc/conf</p></blockquote><p><strong>②定义一个check_nrpe监控命令（添加以下红色内容）</strong></p><p>注：前面数字为行号</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 etc]# vim <span class="regexp">/usr/</span>local<span class="regexp">/nagios/</span>etc<span class="regexp">/objects/</span>commands.cfg</span><br></pre></td></tr></table></figure><blockquote><p>225 <font color="red">#for chen</font> //添加一个注释名称，以防以后忘记改了哪里<br>226 <font color="red">define command{</font><br>227 <font color="red">command_name check_nrpe</font><br>228 <font color="red">command_line $USER1$/check_nrpe -H $HOSTADDRESS$ -c $ARG1$</font><br>229 <font color="red">}</font><br>230<br>231 ###############################################################################<br>232<br>233 # ‘process-host-perfdata’ command definition<br>234 define command{<br>235 command_name process-host-perfdata<br>236 command_line /usr/bin/printf “%b” “$LASTHOSTCHECK$\t$HOSTNAME$\t$HOSTSTATE$\t$HOSTATTEMPT$\t$HOSTSTATETYPE$\t $HOSTEXECUTIONTIME$\t$HOSTOUTPUT$\t$HOSTPERFDATA$\n” &gt;&gt; /usr/local/nagios/var/host-perfdata.out<br>237 }</p></blockquote><p><strong>③定义监控服务联系人（添加以下内容）</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[root@centos1</span> <span class="string">etc]# vim /usr/local/nagios/etc/objects/contacts.cfg</span></span><br><span class="line"><span class="comment">#for chen</span></span><br><span class="line"><span class="attr">define</span> <span class="string">contact&#123;</span></span><br><span class="line">        <span class="attr">contact_name</span>                    <span class="string">ywgcsz  </span></span><br><span class="line">        <span class="attr">alias</span>                           <span class="string">ywgcsz  </span></span><br><span class="line">        <span class="attr">service_notification_period</span>     <span class="string">24x7    </span></span><br><span class="line">        <span class="attr">host_notification_period</span>        <span class="string">24x7    </span></span><br><span class="line">        <span class="attr">service_notification_options</span>    <span class="string">w,u,c,r   </span></span><br><span class="line">        <span class="attr">host_notification_options</span>       <span class="string">d,u,r     </span></span><br><span class="line"></span><br><span class="line">        <span class="attr">service_notification_commands</span> <span class="string">notify-service-by-email</span></span><br><span class="line">        <span class="attr">host_notification_commands</span> <span class="string">notify-host-by-email</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">email</span> <span class="string">root@centos1.benet.com</span></span><br><span class="line">        <span class="attr">pager</span> <span class="string">13488886666,13466668888</span></span><br><span class="line">        <span class="attr">&#125;</span></span><br><span class="line"><span class="attr">define</span> <span class="string">contactgroup&#123;</span></span><br><span class="line">        <span class="attr">contactgroup_name</span>       <span class="string">ywgcsz</span></span><br><span class="line">        <span class="attr">alias</span>                   <span class="string">ywgcsz</span></span><br><span class="line">        <span class="attr">members</span>                 <span class="string">ywgcsz</span></span><br><span class="line">        <span class="attr">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>注：</strong>以上配置中各参数解释如下</p><table><thead><tr><th>配置</th><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>contact_name</td><td>ywgcsz</td><td>定义联系人名称</td></tr><tr><td>alias</td><td>ywgcsz</td><td>别名</td></tr><tr><td>service_notification_period</td><td>24x7</td><td>监控主机服务7x24小时</td></tr><tr><td>host_notification_period</td><td>24x7</td><td>监控主机对角色应用服务7x24小时</td></tr><tr><td>service_notification_options</td><td>w,u,c,r</td><td>告警级别参数</td></tr><tr><td>host_notification_options</td><td>d,u,r</td><td>定义主机在什么状态下需要发送通知给使用者，d:down,表示宕机状态；u:unreachable，不可到达状态;r:recovery,表示重新恢复状态</td></tr><tr><td>service_notification_commands</td><td>notify-service-by-email</td><td>调用邮件名称</td></tr><tr><td>host_notification_commands</td><td>notify-host-by-email</td><td>调用飞信名称</td></tr><tr><td>email</td><td><a href="mailto:root@centos1.benet.com" target="_blank" rel="noopener">root@centos1.benet.com</a></td><td>定义用于接收的电子邮箱</td></tr><tr><td>pager</td><td>13488886666,13466668888</td><td>定义飞信接收手机</td></tr></tbody></table><p><strong>④定义主机组（文件需手动创建）</strong></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>centos1 etc]# vim /usr/local/nagios/etc/objects/hostgroups.cfg</span><br><span class="line">define hostgroup&#123;</span><br><span class="line">        hostgroup_name  mysql</span><br><span class="line">        alias           mysql</span><br><span class="line">        members         <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p><strong>⑤相应的配置文件已经修改完毕，下面开始具体监控MySQl、HTTP主机的存活，负载、进程</strong></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>centos1 etc]# vim /usr/local/nagios/etc/conf/<span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span>.cfg</span><br><span class="line">define host&#123;</span><br><span class="line">        host_name                       <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span>   <span class="comment">//定义监控哪台主机</span></span><br><span class="line">        alias                           <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span></span><br><span class="line">        address                         <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span></span><br><span class="line">        check_command                   check-host-alive</span><br><span class="line">        max_check_attempts              <span class="number">5</span></span><br><span class="line">        check_period                    <span class="number">24</span>x7</span><br><span class="line">        contact_groups                  ywgcsz</span><br><span class="line">        notification_period             <span class="number">24</span>x7</span><br><span class="line">        notification_options            d,u,r</span><br><span class="line">        &#125;</span><br><span class="line">define service&#123;</span><br><span class="line">        host_name                       <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span>  <span class="comment">//定义监控这台主机的存活</span></span><br><span class="line">        service_description             check-host-alive</span><br><span class="line">        check_command                   check-host-alive  <span class="comment">//监测命令</span></span><br><span class="line">        max_check_attempts              <span class="number">3</span>           <span class="comment">//尝试3次</span></span><br><span class="line">        normal_check_interval           <span class="number">2</span>           <span class="comment">//间隔2s</span></span><br><span class="line">        retry_check_interval            <span class="number">2</span>			<span class="comment">//从度2次</span></span><br><span class="line">        check_period                    <span class="number">24</span>x7</span><br><span class="line">        notification_interval           <span class="number">10</span>          <span class="comment">//通知间隔10分钟</span></span><br><span class="line">        notification_period             <span class="number">24</span>x7</span><br><span class="line">        notification_options             w,u,c,r</span><br><span class="line">        contact_groups                  ywgcsz</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">define service&#123;</span><br><span class="line">        host_name                       <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span></span><br><span class="line">        service_description             check-procs            <span class="comment">//监控CPU</span></span><br><span class="line">        check_command                   check_nrpe!check_total_procs   <span class="comment">//！为分隔符，表示使用两个插件</span></span><br><span class="line">        max_check_attempts              <span class="number">3</span></span><br><span class="line">        normal_check_interval           <span class="number">2</span></span><br><span class="line">        retry_check_interval            <span class="number">2</span></span><br><span class="line">        check_period                    <span class="number">24</span>x7</span><br><span class="line">        notification_interval           <span class="number">10</span></span><br><span class="line">        notification_period             <span class="number">24</span>x7</span><br><span class="line">        notification_options             w,u,c,r</span><br><span class="line">        contact_groups                  ywgcsz</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">define service&#123;</span><br><span class="line">        host_name                       <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span></span><br><span class="line">        service_description             check-load              <span class="comment">//监控CPU负载</span></span><br><span class="line">        check_command                   check_nrpe!check_load     <span class="comment">//！为分隔符，表示使用两个插件</span></span><br><span class="line"></span><br><span class="line">        max_check_attempts              <span class="number">3</span></span><br><span class="line">        normal_check_interval           <span class="number">2</span></span><br><span class="line">        retry_check_interval            <span class="number">2</span></span><br><span class="line">        check_period                    <span class="number">24</span>x7</span><br><span class="line">        notification_interval           <span class="number">10</span></span><br><span class="line">        notification_period             <span class="number">24</span>x7</span><br><span class="line">        notification_options             w,u,c,r</span><br><span class="line">        contact_groups                  ywgcsz</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p><strong>⑥修改/usr/local/nagios/etc/cgi.cfg</strong><br>将use_authentication=1修改为0即可</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@centos1 etc]</span><span class="comment"># vim /usr/local/nagios/etc/cgi.cfg</span></span><br><span class="line"><span class="attr">use_authentication</span>=<span class="number">0</span></span><br></pre></td></tr></table></figure><p><strong>⑦到此需要对nagios作语法检测（如有错，会提示相应的文件、相应的行）,确认无误后启动Nagios服务</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 etc]# /usr/local/nagios/bin/nagios -v /usr/local/nagios/etc/nagios.cfg </span><br><span class="line">Checking objects<span class="built_in">..</span>.</span><br><span class="line">	Checked 11 services.</span><br><span class="line">	Checked 2 hosts.</span><br><span class="line">	Checked 2 host groups.</span><br><span class="line">	Checked 0<span class="built_in"> service </span>groups.</span><br><span class="line">	Checked 2 contacts.</span><br><span class="line">	Checked 2 contact groups.</span><br><span class="line">	Checked 25 commands.</span><br><span class="line">	Checked 5 time periods.</span><br><span class="line">	Checked 0 host escalations.</span><br><span class="line">	Checked 0<span class="built_in"> service </span>escalations.</span><br><span class="line">Checking <span class="keyword">for</span> circular paths<span class="built_in">..</span>.</span><br><span class="line">	Checked 2 hosts</span><br><span class="line">	Checked 0<span class="built_in"> service </span>dependencies</span><br><span class="line">	Checked 0 host dependencies</span><br><span class="line">	Checked 5 timeperiods</span><br><span class="line">Checking global event handlers<span class="built_in">..</span>.</span><br><span class="line">Checking obsessive compulsive processor commands<span class="built_in">..</span>.</span><br><span class="line">Checking misc settings<span class="built_in">..</span>.</span><br><span class="line"></span><br><span class="line">Total Warnings: 0</span><br><span class="line">Total Errors:   0</span><br><span class="line">Things look okay - <span class="literal">No</span> serious problems were detected during the pre-flight check</span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 ~]#<span class="built_in"> service </span>nagios start</span><br><span class="line">nagios is stopped</span><br><span class="line">Starting nagios:                                           [  OK  ]</span><br></pre></td></tr></table></figure><h2 id="4、配置Nagios被监控端"><a href="#4、配置Nagios被监控端" class="headerlink" title="4、配置Nagios被监控端"></a>4、配置Nagios被监控端</h2><p>到此我们需要回到被监控的服务器上安装Nagios插件<br><strong>①安装所需依赖包并创建运行用户</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@centos2</span> ~]<span class="meta"># yum -y install openssl openssl-devel</span></span><br><span class="line">[root<span class="symbol">@centos2</span> ~]<span class="meta"># useradd nagios -s /sbin/nologin</span></span><br></pre></td></tr></table></figure><p><strong>②编译安装nagios-plugins</strong></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>centos2 ~]# tar zxf nagios-plugins<span class="number">-1.5</span>.tar.gz </span><br><span class="line">[<span class="symbol">root@</span>centos2 ~]# cd nagios-plugins<span class="number">-1.5</span></span><br><span class="line">[<span class="symbol">root@</span>centos2 nagios-plugins<span class="number">-1.5</span>]# ./configure --prefix=/usr/local/nagios</span><br><span class="line">[<span class="symbol">root@</span>centos2 nagios-plugins<span class="number">-1.5</span>]# make &amp;&amp; make install</span><br><span class="line">[<span class="symbol">root@</span>centos2 nagios-plugins<span class="number">-1.5</span>]# chown -R nagios:nagios /usr/local/nagios/</span><br></pre></td></tr></table></figure><p><strong>③编译安装nrpe</strong></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@centos2</span> ~]<span class="meta"># tar zxf nrpe-2.15.tar.gz </span></span><br><span class="line">[root<span class="symbol">@centos2</span> ~]<span class="meta"># cd nagios-</span></span><br><span class="line">bash: cd: nagios-: No such file <span class="literal">or</span> directory</span><br><span class="line">[root<span class="symbol">@centos2</span> ~]<span class="meta"># cd nrpe-2.15</span></span><br><span class="line">[root<span class="symbol">@centos2</span> nrpe<span class="number">-2.15</span>]<span class="meta"># ./configure --prefix=/usr/local/nagios/</span></span><br><span class="line">[root<span class="symbol">@centos2</span> nrpe<span class="number">-2.15</span>]<span class="meta"># make all</span></span><br><span class="line">[root<span class="symbol">@centos2</span> nrpe<span class="number">-2.15</span>]<span class="meta"># make install-plugin</span></span><br><span class="line">[root<span class="symbol">@centos2</span> nrpe<span class="number">-2.15</span>]<span class="meta"># make install-daemon</span></span><br><span class="line">[root<span class="symbol">@centos2</span> nrpe<span class="number">-2.15</span>]<span class="meta"># make install-daemon-config</span></span><br></pre></td></tr></table></figure><p><strong>④添加监控服务器的IP地址</strong></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>centos2 nrpe<span class="number">-2.15</span>]# vim /usr/local/nagios/etc/nrpe.cfg</span><br><span class="line"><span class="number">81</span> allowed_hosts=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>,<span class="number">192.168</span><span class="number">.1</span><span class="number">.101</span></span><br></pre></td></tr></table></figure><p><strong>⑤启动nrpe服务</strong></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>centos2 nrpe<span class="number">-2.15</span>]# /usr/local/nagios/bin/nrpe -c /usr/local/nagios/etc/nrpe.cfg –d</span><br><span class="line">[<span class="symbol">root@</span>centos2 nrpe<span class="number">-2.15</span>]# ss -anptu | grep nrpe</span><br><span class="line">tcp    LISTEN     <span class="number">0</span>      <span class="number">5</span>                     :::<span class="number">5666</span>                 :::*      users:((<span class="string">"nrpe"</span>,<span class="number">20499</span>,<span class="number">5</span>))</span><br><span class="line">tcp    LISTEN     <span class="number">0</span>      <span class="number">5</span>                      *:<span class="number">5666</span>                  *:*      users:((<span class="string">"nrpe"</span>,<span class="number">20499</span>,<span class="number">4</span>))</span><br></pre></td></tr></table></figure><p><strong>注：</strong>如果想重启，只有杀掉进程后再次启动</p><p><strong>⑥添加防火墙策略</strong></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>centos2 nrpe<span class="number">-2.15</span>]# iptables -I INPUT -p tcp --dport <span class="number">5666</span> -j ACCEP</span><br></pre></td></tr></table></figure><p><strong>⑧在监控服务器上测试NRPE运行是否正常</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos1 etc]# /usr/local/nagios/libexec/check_nrpe -H 192.168.1.102</span><br><span class="line">connect <span class="keyword">to</span><span class="built_in"> address </span>192.168.1.102<span class="built_in"> port </span>5666: <span class="literal">No</span><span class="built_in"> route </span><span class="keyword">to</span> host</span><br><span class="line">connect <span class="keyword">to</span> host 192.168.1.102<span class="built_in"> port </span>5666: <span class="literal">No</span><span class="built_in"> route </span><span class="keyword">to</span> host[root@centos1 etc]# /usr/local/nagios/libexec/check_nrpe -H 192.168.1.102</span><br><span class="line">NRPE v2.15</span><br></pre></td></tr></table></figure><p><strong>⑨查看服务器的监控情况</strong></p><p><img src="/2016/03/02/nagios-jian-kong-xi-tong/%E5%9B%BE%E7%89%874.png" alt="image-20191116185609656"></p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/" rel="tag"><i class="fa fa-tag"></i> 监控系统</a> <a href="/tags/Nagios/" rel="tag"><i class="fa fa-tag"></i> Nagios</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2016/02/28/linux-ji-chu-ying-yong/" rel="next" title="Linux基础应用"><i class="fa fa-chevron-left"></i> Linux基础应用</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2016/03/17/h3c-chang-yong-ming-ling/" rel="prev" title="H3C常用命令">H3C常用命令 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"><span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a> <a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/chen.png" alt="Zhongzhou Chen"><p class="site-author-name" itemprop="name">Zhongzhou Chen</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">282</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">84</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">164</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、Nagios简介"><span class="nav-text">1、Nagios简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Nagios运行模式和优点"><span class="nav-text">Nagios运行模式和优点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nagios工作原理"><span class="nav-text">Nagios工作原理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Nagios插件："><span class="nav-text">1)Nagios插件：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-NRPE总共由两部分组成"><span class="nav-text">2)NRPE总共由两部分组成:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Nagios通过nrpe插件来远程管理服务"><span class="nav-text">3)Nagios通过nrpe插件来远程管理服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-通过NRPE的检测分为两种"><span class="nav-text">4)通过NRPE的检测分为两种</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-nagios可以做到"><span class="nav-text">5)nagios可以做到</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-Nagios所需要的软件"><span class="nav-text">6)Nagios所需要的软件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、部署Nagios监控服务"><span class="nav-text">2、部署Nagios监控服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-创建Nagios运行用户和用户组"><span class="nav-text">2.1 创建Nagios运行用户和用户组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-编译安装Nagios"><span class="nav-text">2.2 编译安装Nagios</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-33-验证安装是否成功"><span class="nav-text">2.33 验证安装是否成功</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-安装Nagios插件"><span class="nav-text">2.4 安装Nagios插件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-安装NRRE"><span class="nav-text">2.5 安装NRRE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-安装与配置Apache和PHP"><span class="nav-text">2.6 安装与配置Apache和PHP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-生成nagios网页用户名和密码"><span class="nav-text">2.7 生成nagios网页用户名和密码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-8-查看认证文件内容，并启动Web服务"><span class="nav-text">2.8 查看认证文件内容，并启动Web服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-9-到此就可以访问监控网页了"><span class="nav-text">2.9 到此就可以访问监控网页了</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、配置Nagios监控系统"><span class="nav-text">3、配置Nagios监控系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-默认配置文件介绍"><span class="nav-text">3.1 默认配置文件介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-配置文件之间的关系"><span class="nav-text">3.2 配置文件之间的关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-配置Nagios"><span class="nav-text">3.3 配置Nagios</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、配置Nagios被监控端"><span class="nav-text">4、配置Nagios被监控端</span></a></li></ol></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Zhongzhou Chen</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">597k</span></div><span class="post-meta-divider"></span></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><script type="text/javascript" src="/js/src/clipboard.min.js"></script><script type="text/javascript" src="/js/src/clipboard-use.js"></script><script type="text/javascript" src="/js/src/love.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,log:!1,model:{jsonPath:"/live2dw/assets/shizuku.model.json"},display:{position:"right"},mobile:{show:!0,scale:.5},react:{opacityDefault:.7,opacityOnHover:.2}})</script></body></html><!-- rebuild by neat -->