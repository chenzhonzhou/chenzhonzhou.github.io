<!-- build time:Tue Sep 14 2021 14:49:33 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><script></script><meta name="theme-color" content="#222"><style>.pace .pace-progress{background:#1E92FB;height:3px}.pace .pace-progress-inner{box-shadow:0 0 10px #1E92FB,0 0 5px #1E92FB}.pace .pace-activity{border-top-color:#1E92FB;border-left-color:#1E92FB}</style><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="HGM141IpbHrSmnAmR6W_zE4bo9Z3f-yXLeHYT3bg1fk"><meta name="baidu-site-verification" content="code-5Ai1DA8e6T"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="Linux,sed,"><link rel="alternate" href="/atom.xml" title="凡间的精灵" type="application/atom+xml"><meta name="description" content="我们知道，vim 采用的是交互式文本编辑模式，你可以用键盘命令来交互性地插入、删除或替换数据中的文本。但本节要讲的 sed 命令不同，它采用的是流编辑模式，最明显的特点是，在 sed 处理数据之前，需要预先提供一组规则，sed 会按照此规则来编辑数据。sed 会根据脚本命令来处理文本文件中的数据，这些命令要么从命令行中输入，要么存储在一个文本文件中，此命令执行数据的顺序如下：每次仅读取一行内容；根"><meta name="keywords" content="Linux,sed"><meta property="og:type" content="article"><meta property="og:title" content="Linux sed命令详解"><meta property="og:url" content="http:&#x2F;&#x2F;chenzhonzhou.github.io&#x2F;2015&#x2F;06&#x2F;15&#x2F;linux-sed-ming-ling-xiang-jie&#x2F;index.html"><meta property="og:site_name" content="凡间的精灵"><meta property="og:description" content="我们知道，vim 采用的是交互式文本编辑模式，你可以用键盘命令来交互性地插入、删除或替换数据中的文本。但本节要讲的 sed 命令不同，它采用的是流编辑模式，最明显的特点是，在 sed 处理数据之前，需要预先提供一组规则，sed 会按照此规则来编辑数据。sed 会根据脚本命令来处理文本文件中的数据，这些命令要么从命令行中输入，要么存储在一个文本文件中，此命令执行数据的顺序如下：每次仅读取一行内容；根"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2019-11-12T02:22:20.243Z"><meta name="twitter:card" content="summary"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"always",offset:12,b2t:!0,scrollpercent:!0,onmobile:!0},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://chenzhonzhou.github.io/2015/06/15/linux-sed-ming-ling-xiang-jie/"><title>Linux sed命令详解 | 凡间的精灵</title><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">凡间的精灵</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">凡尘落素一精灵</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://chenzhonzhou.github.io/2015/06/15/linux-sed-ming-ling-xiang-jie/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Zhongzhou Chen"><meta itemprop="description" content=""><meta itemprop="image" content="/images/chen.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="凡间的精灵"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Linux sed命令详解</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-06-15T15:08:17+08:00">2015-06-15 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">4.4k </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">18</span></div></div></header><div class="post-body" itemprop="articleBody"><p>我们知道，vim 采用的是交互式文本编辑模式，你可以用键盘命令来交互性地插入、删除或替换数据中的文本。但本节要讲的 sed 命令不同，它采用的是流编辑模式，最明显的特点是，在 sed 处理数据之前，需要预先提供一组规则，sed 会按照此规则来编辑数据。</p><p>sed 会根据脚本命令来处理文本文件中的数据，这些命令要么从命令行中输入，要么存储在一个文本文件中，此命令执行数据的顺序如下：</p><ol><li>每次仅读取一行内容；</li><li>根据提供的规则命令匹配并修改数据。注意，sed 默认不会直接修改源文件数据，而是会将数据复制到缓冲区中，修改也仅限于缓冲区中的数据；</li><li>将执行结果输出。</li></ol><p>当一行数据匹配完成后，它会继续读取下一行数据，并重复这个过程，直到将文件中所有数据处理完毕。</p><p>sed 命令的基本格式如下：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@localhost ~]</span># sed <span class="string">[选项]</span> <span class="string">[脚本命令]</span> 文件名</span><br></pre></td></tr></table></figure><p>该命令常用的选项及含义，如表 1 所示。</p><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td>-e 脚本命令</td><td>该选项会将其后跟的脚本命令添加到已有的命令中。</td></tr><tr><td>-f 脚本命令文件</td><td>该选项会将其后文件中的脚本命令添加到已有的命令中。</td></tr><tr><td>-n</td><td>默认情况下，sed 会在所有的脚本指定执行完毕后，会自动输出处理后的内容，而该选项会屏蔽启动输出，需使用 print 命令来完成输出。</td></tr><tr><td>-i</td><td>此选项会直接修改源文件，要慎用。</td></tr></tbody></table><p>成功使用 sed 命令的关键在于掌握各式各样的脚本命令及格式，它能帮你定制编辑文件的规则。</p><h3 id="sed脚本命令"><a href="#sed脚本命令" class="headerlink" title="sed脚本命令"></a>sed脚本命令</h3><h4 id="sed-s-替换脚本命令"><a href="#sed-s-替换脚本命令" class="headerlink" title="sed s 替换脚本命令"></a>sed s 替换脚本命令</h4><p>此命令的基本格式为：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[address]</span>s/pattern/replacement/flags</span><br></pre></td></tr></table></figure><p>其中，address 表示指定要操作的具体行，pattern 指的是需要替换的内容，replacement 指的是要替换的新内容。</p><p>此命令中常用的 flags 标记如表 2 所示</p><table><thead><tr><th>flags 标记</th><th>功能</th></tr></thead><tbody><tr><td>n</td><td>1~512 之间的数字，表示指定要替换的字符串出现第几次时才进行替换，例如，一行中有 3 个 A，但用户只想替换第二个 A，这是就用到这个标记；</td></tr><tr><td>g</td><td>对数据中所有匹配到的内容进行替换，如果没有 g，则只会在第一次匹配成功时做替换操作。例如，一行数据中有 3 个 A，则只会替换第一个 A；</td></tr><tr><td>p</td><td>会打印与替换命令中指定的模式匹配的行。此标记通常与 -n 选项一起使用。</td></tr><tr><td>w file</td><td>将缓冲区中的内容写到指定的 file 文件中；</td></tr><tr><td>&amp;</td><td>用正则表达式匹配的内容进行替换；</td></tr><tr><td>\n</td><td>匹配第 n 个子串，该子串之前在 pattern 中用 () 指定。</td></tr><tr><td>\</td><td>转义（转义替换部分包含：&amp;、\ 等）。</td></tr></tbody></table><p>比如，可以指定 sed 用新文本替换第几处模式匹配的地方：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># sed 's/test/trial/2' data4.txt</span></span><br><span class="line">This <span class="keyword">is</span> a test <span class="keyword">of</span> <span class="keyword">the</span> trial <span class="keyword">script</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="keyword">the</span> <span class="keyword">second</span> test <span class="keyword">of</span> <span class="keyword">the</span> trial <span class="keyword">script</span>.</span><br></pre></td></tr></table></figure><p>可以看到，使用数字 2 作为标记的结果就是，sed 编辑器只替换每行中第 2 次出现的匹配模式。</p><p>如果要用新文件替换所有匹配的字符串，可以使用 g 标记：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># sed 's/test/trial/g' data4.txt</span></span><br><span class="line">This <span class="keyword">is</span> a trial <span class="keyword">of</span> <span class="keyword">the</span> trial <span class="keyword">script</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="keyword">the</span> <span class="keyword">second</span> trial <span class="keyword">of</span> <span class="keyword">the</span> trial <span class="keyword">script</span>.</span><br></pre></td></tr></table></figure><p>我们知道，-n 选项会禁止 sed 输出，但 p 标记会输出修改过的行，将二者匹配使用的效果就是只输出被替换命令修改过的行，例如：</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># sed 's/test/trial/w test.txt' data5.txt</span></span><br><span class="line">This <span class="keyword">is</span> a trial line.</span><br><span class="line">This <span class="keyword">is</span> a different line.</span><br><span class="line">[root@localhost ~]<span class="comment">#cat test.txt</span></span><br><span class="line">This <span class="keyword">is</span> a trial line.</span><br></pre></td></tr></table></figure><p>w 标记会将匹配后的结果保存到指定文件中，比如：</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># sed 's/test/trial/w test.txt' data5.txt</span></span><br><span class="line">This <span class="keyword">is</span> a trial line.</span><br><span class="line">This <span class="keyword">is</span> a different line.</span><br><span class="line">[root@localhost ~]<span class="comment">#cat test.txt</span></span><br></pre></td></tr></table></figure><p>在使用 s 脚本命令时，替换类似文件路径的字符串会比较麻烦，需要将路径中的正斜线进行转义，例如：</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sed 's/<span class="symbol">\/</span>bin<span class="symbol">\/</span>bash/<span class="symbol">\/</span>bin<span class="symbol">\/</span>csh/' /etc/passwd</span><br></pre></td></tr></table></figure><h4 id="sed-d-替换脚本命令"><a href="#sed-d-替换脚本命令" class="headerlink" title="sed d 替换脚本命令"></a>sed d 替换脚本命令</h4><p>此命令的基本格式为：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[address]</span>d</span><br></pre></td></tr></table></figure><p>如果需要删除文本中的特定行，可以用 d 脚本命令，它会删除指定行中的所有内容。但使用该命令时要特别小心，如果你忘记指定具体行的话，文件中的所有内容都会被删除，举个例子：</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="comment">@localhost ~]# cat data1.txt</span></span><br><span class="line"><span class="comment">The quick brown fox jumps over the lazy dog</span></span><br><span class="line"><span class="comment">The quick brown fox jumps over the lazy dog</span></span><br><span class="line"><span class="comment">The quick brown fox jumps over the lazy dog</span></span><br><span class="line"><span class="comment">The quick brown fox jumps over the lazy dog</span></span><br><span class="line"><span class="comment">[root@</span>localhost ~]<span class="meta"># sed 'd' data1.txt</span></span><br><span class="line"><span class="meta">#什么也不输出，证明成了空文件</span></span><br></pre></td></tr></table></figure><p>当和指定地址一起使用时，删除命令显然能发挥出大的功用。可以从数据流中删除特定的文本行。</p><p>address 的具体写法后续会做详细介绍，这里只给大家举几个简单的例子：</p><ul><li><p>通过行号指定，比如删除 data6.txt 文件内容中的第 3 行：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# <span class="keyword">cat</span> data6.txt</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">1</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">2</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">3</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">4</span>.</span><br><span class="line">[root@localhost ~]# sed <span class="string">'3d'</span> data6.txt</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">1</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">2</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">4</span>.</span><br></pre></td></tr></table></figure></li><li><p>或者通过特定行区间指定，比如删除 data6.txt 文件内容中的第 2、3行：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sed <span class="string">'2,3d'</span> data6.txt</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">1</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">4</span>.</span><br></pre></td></tr></table></figure></li><li><p>也可以使用两个文本模式来删除某个区间内的行，但这么做时要小心，你指定的第一个模式会“打开”行删除功能，第二个模式会“关闭”行删除功能，因此，sed 会删除两个指定行之间的所有行（包括指定的行），例如：</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">root@</span>localhost ~]#sed <span class="string">'/1/,/3/d'</span> data6.txt</span><br><span class="line">#删除第 <span class="number">1</span>~<span class="number">3</span> 行的文本数据</span><br><span class="line">This <span class="keyword">is</span> line number <span class="number">4.</span></span><br></pre></td></tr></table></figure></li><li><p>或者通过特殊的文件结尾字符，比如删除 data6.txt 文件内容中第 3 行开始的所有的内容：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sed <span class="string">'3,$d'</span> data6.txt</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">1</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">2</span>.</span><br></pre></td></tr></table></figure></li></ul><p>在此强调，在默认情况下 sed 并不会修改原始文件，这里被删除的行只是从 sed 的输出中消失了，原始文件没做任何改变。</p><h4 id="sed-a-和-i-脚本命令"><a href="#sed-a-和-i-脚本命令" class="headerlink" title="sed a 和 i 脚本命令"></a>sed a 和 i 脚本命令</h4><p>a 命令表示在指定行的后面附加一行，i 命令表示在指定行的前面插入一行，这里之所以要同时介绍这 2 个脚本命令，因为它们的基本格式完全相同，如下所示：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[address]</span>a（或 i）\新文本内容</span><br></pre></td></tr></table></figure><p>下面分别就这 2 个命令，给读者举几个例子。比如说，将一个新行插入到数据流第三行前，执行命令如下：</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sed '<span class="number">3</span>i\</span><br><span class="line">&gt; This <span class="keyword">is</span> an inserted <span class="literal">line</span>.' data6.txt</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">1</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">2</span>.</span><br><span class="line">This <span class="keyword">is</span> an inserted <span class="literal">line</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">3</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">4</span>.</span><br></pre></td></tr></table></figure><p>再比如说，将一个新行附加到数据流中第三行后，执行命令如下：</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sed '<span class="number">3</span>a\</span><br><span class="line">&gt; This <span class="keyword">is</span> an appended <span class="literal">line</span>.' data6.txt</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">1</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">2</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">3</span>.</span><br><span class="line">This <span class="keyword">is</span> an appended <span class="literal">line</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">4</span>.</span><br></pre></td></tr></table></figure><p>如果你想将一个多行数据添加到数据流中，只需对要插入或附加的文本中的每一行末尾（除最后一行）添加反斜线即可，例如：</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sed '<span class="number">1</span>i\</span><br><span class="line">&gt; This <span class="keyword">is</span> one <span class="literal">line</span> <span class="keyword">of</span> <span class="keyword">new</span> <span class="literal">text</span>.\</span><br><span class="line">&gt; This <span class="keyword">is</span> another <span class="literal">line</span> <span class="keyword">of</span> <span class="keyword">new</span> <span class="literal">text</span>.' data6.txt</span><br><span class="line">This <span class="keyword">is</span> one <span class="literal">line</span> <span class="keyword">of</span> <span class="keyword">new</span> <span class="literal">text</span>.</span><br><span class="line">This <span class="keyword">is</span> another <span class="literal">line</span> <span class="keyword">of</span> <span class="keyword">new</span> <span class="literal">text</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">1</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">2</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">3</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">4</span>.</span><br></pre></td></tr></table></figure><p>可以看到，指定的两行都会被添加到数据流中。</p><h4 id="sed-c-替换脚本命令"><a href="#sed-c-替换脚本命令" class="headerlink" title="sed c 替换脚本命令"></a>sed c 替换脚本命令</h4><p>c 命令表示将指定行中的所有内容，替换成该选项后面的字符串。该命令的基本格式为：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[address]</span>c\用于替换的新文本</span><br></pre></td></tr></table></figure><p>举个例子：</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sed '<span class="number">3</span>c\</span><br><span class="line">&gt; This <span class="keyword">is</span> a changed <span class="literal">line</span> <span class="keyword">of</span> <span class="literal">text</span>.' data6.txt</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">1</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">2</span>.</span><br><span class="line">This <span class="keyword">is</span> a changed <span class="literal">line</span> <span class="keyword">of</span> <span class="literal">text</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">4</span>.</span><br><span class="line">在这个例子中，sed 编辑器会修改第三行中的文本，其实，下面的写法也可以实现此目的：</span><br><span class="line">[root@localhost ~]# sed '/number <span class="number">3</span>/c\</span><br><span class="line">&gt; This <span class="keyword">is</span> a changed <span class="literal">line</span> <span class="keyword">of</span> <span class="literal">text</span>.' data6.txt</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">1</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">2</span>.</span><br><span class="line">This <span class="keyword">is</span> a changed <span class="literal">line</span> <span class="keyword">of</span> <span class="literal">text</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="literal">line</span> number <span class="number">4</span>.</span><br></pre></td></tr></table></figure><h4 id="sed-y-转换脚本命令"><a href="#sed-y-转换脚本命令" class="headerlink" title="sed y 转换脚本命令"></a>sed y 转换脚本命令</h4><p>y 转换命令是唯一可以处理单个字符的 sed 脚本命令，其基本格式如下：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[address]</span>y/inchars/outchars/</span><br></pre></td></tr></table></figure><p>转换命令会对 inchars 和 outchars 值进行一对一的映射，即 inchars 中的第一个字符会被转换为 outchars 中的第一个字符，第二个字符会被转换成 outchars 中的第二个字符…这个映射过程会一直持续到处理完指定字符。如果 inchars 和 outchars 的长度不同，则 sed 会产生一条错误消息。</p><p>举个简单例子：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sed <span class="string">'y/123/789/'</span> data8.txt</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">7</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">8</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">9</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">4</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">7</span> again.</span><br><span class="line">This <span class="keyword">is</span> yet another <span class="built_in">line</span>.</span><br><span class="line">This <span class="keyword">is</span> the <span class="keyword">last</span> <span class="built_in">line</span> in the <span class="keyword">file</span>.</span><br></pre></td></tr></table></figure><p>可以看到，inchars 模式中指定字符的每个实例都会被替换成 outchars 模式中相同位置的那个字符。</p><p>转换命令是一个全局命令，也就是说，它会文本行中找到的所有指定字符自动进行转换，而不会考虑它们出现的位置，再打个比方：</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># echo "This 1 is a test of 1 try." | sed 'y/123/456/'</span></span><br><span class="line">This <span class="number">4</span> <span class="keyword">is</span> a test <span class="keyword">of</span> <span class="number">4</span> <span class="keyword">try</span>.</span><br></pre></td></tr></table></figure><p>sed 转换了在文本行中匹配到的字符 1 的两个实例，我们无法限定只转换在特定地方出现的字符。</p><h4 id="sed-p-打印脚本命令"><a href="#sed-p-打印脚本命令" class="headerlink" title="sed p 打印脚本命令"></a>sed p 打印脚本命令</h4><p>p 命令表示搜索符号条件的行，并输出该行的内容，此命令的基本格式为：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[address]</span>p</span><br></pre></td></tr></table></figure><p>p 命令常见的用法是打印包含匹配文本模式的行，例如：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# <span class="keyword">cat</span> data6.txt</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">1</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">2</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">3</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">4</span>.</span><br><span class="line">[root@localhost ~]# sed -n <span class="string">'/number 3/p'</span> data6.txt</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">3</span>.</span><br></pre></td></tr></table></figure><p>可以看到，用 -n 选项和 p 命令配合使用，我们可以禁止输出其他行，只打印包含匹配文本模式的行。</p><p>如果需要在修改之前查看行，也可以使用打印命令，比如与替换或修改命令一起使用。可以创建一个脚本在修改行之前显示该行，如下所示：</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># sed -n '/3/&#123;</span></span><br><span class="line">&gt; p</span><br><span class="line">&gt; <span class="regexp">s/line/test/p</span></span><br><span class="line">&gt; &#125;<span class="string">' data6.txt</span></span><br><span class="line"><span class="string">This is line number 3.</span></span><br><span class="line"><span class="string">This is test number 3.</span></span><br></pre></td></tr></table></figure><p>sed 命令会查找包含数字 3 的行，然后执行两条命令。首先，脚本用 p 命令来打印出原始行；然后它用 s 命令替换文本，并用 p 标记打印出替换结果。输出同时显示了原来的行文本和新的行文本。</p><h4 id="sed-w-脚本命令"><a href="#sed-w-脚本命令" class="headerlink" title="sed w 脚本命令"></a>sed w 脚本命令</h4><p>w 命令用来将文本中指定行的内容写入文件中，此命令的基本格式如下：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[address]</span>w filename</span><br></pre></td></tr></table></figure><p>这里的 filename 表示文件名，可以使用相对路径或绝对路径，但不管是哪种，运行 sed 命令的用户都必须有文件的写权限。<br>下面的例子是将数据流中的前两行打印到一个文本文件中：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sed <span class="string">'1,2w test.txt'</span> data6.txt</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">1</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">2</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">3</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">4</span>.</span><br><span class="line">[root@localhost ~]# <span class="keyword">cat</span> test.txt</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">1</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">2</span>.</span><br></pre></td></tr></table></figure><p>当然，如果不想让行直接输出，可以用 -n 选项，再举个例子：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cat data11.txt</span></span><br><span class="line"><span class="keyword">Blum, </span>R       <span class="keyword">Browncoat</span></span><br><span class="line"><span class="keyword">McGuiness, </span>A  Alliance</span><br><span class="line"><span class="keyword">Bresnahan, </span>C  <span class="keyword">Browncoat</span></span><br><span class="line"><span class="keyword">Harken, </span>C     Alliance</span><br><span class="line">[root@localhost ~]<span class="comment"># sed -n '/Browncoat/w Browncoats.txt' data11.txt</span></span><br><span class="line">cat <span class="keyword">Browncoats.txt</span></span><br><span class="line"><span class="keyword">Blum, </span>R       <span class="keyword">Browncoat</span></span><br><span class="line"><span class="keyword">Bresnahan, </span>C  <span class="keyword">Browncoat</span></span><br></pre></td></tr></table></figure><p>可以看到，通过使用 w 脚本命令，sed 可以实现将包含文本模式的数据行写入目标文件。</p><h4 id="sed-r-脚本命令"><a href="#sed-r-脚本命令" class="headerlink" title="sed r 脚本命令"></a>sed r 脚本命令</h4><p>r 命令用于将一个独立文件的数据插入到当前数据流的指定位置，该命令的基本格式为：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[address]</span>r filename</span><br></pre></td></tr></table></figure><p>sed 命令会将 filename 文件中的内容插入到 address 指定行的后面，比如说：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# <span class="keyword">cat</span> data12.txt</span><br><span class="line">This <span class="keyword">is</span> <span class="keyword">an</span> added <span class="built_in">line</span>.</span><br><span class="line">This <span class="keyword">is</span> the second added <span class="built_in">line</span>.</span><br><span class="line">[root@localhost ~]# sed <span class="string">'3r data12.txt'</span> data6.txt</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">1</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">2</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">3</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="keyword">an</span> added <span class="built_in">line</span>.</span><br><span class="line">This <span class="keyword">is</span> the second added <span class="built_in">line</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">4</span>.</span><br></pre></td></tr></table></figure><p>如果你想将指定文件中的数据插入到数据流的末尾，可以使用 $ 地址符，例如：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sed <span class="string">'$r data12.txt'</span> data6.txt</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">1</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">2</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">3</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="built_in">line</span> <span class="keyword">number</span> <span class="number">4</span>.</span><br><span class="line">This <span class="keyword">is</span> <span class="keyword">an</span> added <span class="built_in">line</span>.</span><br><span class="line">This <span class="keyword">is</span> the second added <span class="built_in">line</span>.</span><br></pre></td></tr></table></figure><h4 id="sed-q-退出脚本命令"><a href="#sed-q-退出脚本命令" class="headerlink" title="sed q 退出脚本命令"></a>sed q 退出脚本命令</h4><p>q 命令的作用是使 sed 命令在第一次匹配任务结束后，退出 sed 程序，不再进行对后续数据的处理。<br>比如：可以看到，sed 命令在打印输出第 2 行之后，就停止了，是 q 命令造成的，再比如：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># sed <span class="string">'/number 1/&#123; s/number 1/number 0/;q; &#125;'</span> test.txt</span></span><br><span class="line">This is line <span class="built_in">number</span> <span class="number">0.</span></span><br></pre></td></tr></table></figure><p>使用 q 命令之后，sed 命令会在匹配到 number 1 时，将其替换成 number 0，然后直接退出。</p><h2 id="sed-脚本命令的寻址方式"><a href="#sed-脚本命令的寻址方式" class="headerlink" title="sed 脚本命令的寻址方式"></a>sed 脚本命令的寻址方式</h2><p>前面在介绍各个脚本命令时，我们一直忽略了对 address 部分的介绍。对各个脚本命令来说，address 用来表明该脚本命令作用到文本中的具体行。</p><p>默认情况下，sed 命令会作用于文本数据的所有行。如果只想将命令作用于特定行或某些行，则必须写明 address 部分，表示的方法有以下 2 种：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[address]</span>脚本命令</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">address</span> &#123;</span><br><span class="line">  多个脚本命令</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上两种形式在前面例子中都有具体实例，因此这里不再做过多赘述。</p><h4 id="以数字形式指定行区间"><a href="#以数字形式指定行区间" class="headerlink" title="以数字形式指定行区间"></a>以数字形式指定行区间</h4><p>当使用数字方式的行寻址时，可以用行在文本流中的行位置来引用。sed 会将文本流中的第一行编号为 1，然后继续按顺序为接下来的行分配行号。</p><p>在脚本命令中，指定的地址可以是单个行号，或是用起始行号、逗号以及结尾行号指定的一定区间范围内的行。这里举一个 sed 命令作用到指定行号的例子：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment">#sed '2s/dog/cat/' data1.txt</span></span><br><span class="line">The quick <span class="keyword">brown </span>fox <span class="keyword">jumps </span>over the lazy dog</span><br><span class="line">The quick <span class="keyword">brown </span>fox <span class="keyword">jumps </span>over the lazy cat</span><br><span class="line">The quick <span class="keyword">brown </span>fox <span class="keyword">jumps </span>over the lazy dog</span><br><span class="line">The quick <span class="keyword">brown </span>fox <span class="keyword">jumps </span>over the lazy dog</span><br></pre></td></tr></table></figure><p>可以看到，sed 只修改地址指定的第二行的文本。下面的例子中使用了行地址区间：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># sed '2,3s/dog/cat/' data1.txt</span></span><br><span class="line">The quick <span class="keyword">brown </span>fox <span class="keyword">jumps </span>over the lazy dog</span><br><span class="line">The quick <span class="keyword">brown </span>fox <span class="keyword">jumps </span>over the lazy cat</span><br><span class="line">The quick <span class="keyword">brown </span>fox <span class="keyword">jumps </span>over the lazy cat</span><br><span class="line">The quick <span class="keyword">brown </span>fox <span class="keyword">jumps </span>over the lazy dog</span><br></pre></td></tr></table></figure><p>在此基础上，如果想将命令作用到文本中从某行开始的所有行，可以用特殊地址——美元符（$）：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># sed '2,$s/dog/cat/' data1.txt</span></span><br><span class="line">The quick <span class="keyword">brown </span>fox <span class="keyword">jumps </span>over the lazy dog</span><br><span class="line">The quick <span class="keyword">brown </span>fox <span class="keyword">jumps </span>over the lazy cat</span><br><span class="line">The quick <span class="keyword">brown </span>fox <span class="keyword">jumps </span>over the lazy cat</span><br><span class="line">The quick <span class="keyword">brown </span>fox <span class="keyword">jumps </span>over the lazy cat</span><br></pre></td></tr></table></figure><h4 id="用文本模式指定行区间"><a href="#用文本模式指定行区间" class="headerlink" title="用文本模式指定行区间"></a>用文本模式指定行区间</h4><p>sed 允许指定文本模式来过滤出命令要作用的行，格式如下：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/pattern/<span class="keyword">command</span></span><br></pre></td></tr></table></figure><p>注意，必须用正斜线将要指定的 pattern 封起来，sed 会将该命令作用到包含指定文本模式的行上。</p><p>举个例子，如果你想只修改用户 demo 的默认 shell，可以使用 sed 命令，执行命令如下：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># grep demo /etc/passwd</span></span><br><span class="line"><span class="symbol">demo:</span><span class="symbol">x:</span><span class="number">502</span><span class="symbol">:</span><span class="number">502</span><span class="symbol">:</span><span class="symbol">:/home/Samantha</span><span class="symbol">:/bin/bash</span></span><br><span class="line">[root@localhost ~]<span class="comment"># sed '/demo/s/bash/csh/' /etc/passwd</span></span><br><span class="line"><span class="symbol">root:</span><span class="symbol">x:</span><span class="number">0</span><span class="symbol">:</span><span class="number">0</span><span class="symbol">:root</span><span class="symbol">:/root</span><span class="symbol">:/bin/bash</span></span><br><span class="line">...</span><br><span class="line"><span class="symbol">demo:</span><span class="symbol">x:</span><span class="number">502</span><span class="symbol">:</span><span class="number">502</span><span class="symbol">:</span><span class="symbol">:/home/demo</span><span class="symbol">:/bin/csh</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>虽然使用固定文本模式能帮你过滤出特定的值，就跟上面这个用户名的例子一样，但其作用难免有限，因此，sed 允许在文本模式使用正则表达式指明作用的具体行。正则表达式允许创建高级文本模式匹配表达式来匹配各种数据。这些表达式结合了一系列通配符、特殊字符以及固定文本字符来生成能够匹配几乎任何形式文本的简练模式。</p><p>关于正则表达式，本节不做过多介绍，有兴趣的读者可阅读《<a href="http://deerchao.net/tutorials/regex/regex-1.htm" target="_blank" rel="noopener">正则表达式入门教程</a>》一文，这里仅给读者提供一个简单示例：</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@localhost</span> ~]<span class="comment"># cat test.txt</span></span><br><span class="line"><span class="variable">&lt;html&gt;</span></span><br><span class="line"><span class="variable">&lt;title&gt;</span>First Wed<span class="variable">&lt;/title&gt;</span></span><br><span class="line"><span class="variable">&lt;body&gt;</span></span><br><span class="line">h1Helloh1</span><br><span class="line">h2Helloh2</span><br><span class="line">h3Helloh3</span><br><span class="line"><span class="variable">&lt;/body&gt;</span></span><br><span class="line"><span class="variable">&lt;/html&gt;</span></span><br><span class="line"><span class="comment">#使用正则表示式给所有第一个的h1、h2、h3添加&lt;&gt;，给第二个h1、h2、h3添加&lt;/&gt;</span></span><br><span class="line">[root<span class="meta">@localhost</span> ~]<span class="comment"># cat sed.sh</span></span><br><span class="line">/h[0-9]/&#123;</span><br><span class="line">    s//\<span class="variable">&lt;&amp;\&gt;</span>/1</span><br><span class="line">    s//\<span class="variable">&lt;\/&amp;\&gt;</span>/2</span><br><span class="line">&#125;</span><br><span class="line">[root<span class="meta">@localhost</span> ~]<span class="comment"># sed -f sed.sh test.txt</span></span><br><span class="line"><span class="variable">&lt;h1&gt;</span>Hello<span class="variable">&lt;/h1&gt;</span></span><br><span class="line"><span class="variable">&lt;h2&gt;</span>Hello<span class="variable">&lt;/h2&gt;</span></span><br><span class="line"><span class="variable">&lt;h3&gt;</span>Hello<span class="variable">&lt;/h3&gt;</span></span><br></pre></td></tr></table></figure><p>这里仅介绍了 sed 命令每次只读取一行内容并处理，有关 sed 命令如何一次处理多行文本内容可点击《<a href="http://c.biancheng.net/view/4056.html" target="_blank" rel="noopener">Linux sed命令高级用法</a>》继续学习。</p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a> <a href="/tags/sed/" rel="tag"><i class="fa fa-tag"></i> sed</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2015/06/11/linux-awk-ming-ling-xiang-jie/" rel="next" title="Linux awk命令详解"><i class="fa fa-chevron-left"></i> Linux awk命令详解</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2015/06/22/linux-tar-ming-ling-yong-fa/" rel="prev" title="Linux tar命令用法">Linux tar命令用法 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"><span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a> <a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/chen.png" alt="Zhongzhou Chen"><p class="site-author-name" itemprop="name">Zhongzhou Chen</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">283</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">84</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">164</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#sed脚本命令"><span class="nav-text">sed脚本命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#sed-s-替换脚本命令"><span class="nav-text">sed s 替换脚本命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sed-d-替换脚本命令"><span class="nav-text">sed d 替换脚本命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sed-a-和-i-脚本命令"><span class="nav-text">sed a 和 i 脚本命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sed-c-替换脚本命令"><span class="nav-text">sed c 替换脚本命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sed-y-转换脚本命令"><span class="nav-text">sed y 转换脚本命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sed-p-打印脚本命令"><span class="nav-text">sed p 打印脚本命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sed-w-脚本命令"><span class="nav-text">sed w 脚本命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sed-r-脚本命令"><span class="nav-text">sed r 脚本命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sed-q-退出脚本命令"><span class="nav-text">sed q 退出脚本命令</span></a></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#sed-脚本命令的寻址方式"><span class="nav-text">sed 脚本命令的寻址方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#以数字形式指定行区间"><span class="nav-text">以数字形式指定行区间</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#用文本模式指定行区间"><span class="nav-text">用文本模式指定行区间</span></a></li></ol></li></div></div></section><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Zhongzhou Chen</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">597.5k</span></div><span class="post-meta-divider"></span></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code").find(".line").map(function(t,e){return $(e).text()}).toArray().join("\n"),n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();var o=document.execCommand("copy");document.body.removeChild(n),o?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})</script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><script type="text/javascript" src="/js/src/love.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right"},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script></body></html><!-- rebuild by neat -->